<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
    <!ENTITY rfc2119 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>
    <!ENTITY rfc5213 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5213.xml'>      
    <!ENTITY rfc6275 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6275.xml'>
    <!ENTITY rfc4291 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4291.xml'>      
    <!ENTITY rfc3484 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3484.xml'>
    <!ENTITY rfc2136 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2136.xml'>
    <!ENTITY rfc5142 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5142.xml'>
    <!ENTITY rfc4303 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4303.xml'>
    <!ENTITY rfc5996 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5996.xml'>
    <!ENTITY rfc5779 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5779.xml'>
    <!ENTITY rfc6097 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6097.xml'>
    <!ENTITY rfc2616 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2616.xml'>
    <!ENTITY rfc5844 PUBLIC '' 
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5844.xml'>
]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>


<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes"?>
<?rfc autobreaks="yes" ?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc rfcedstyle="yes"?>

<rfc number="6463" category="std" ipr="trust200902" submissionType="IETF">
    <front>
        <title abbrev="Runtime LMA Assignment">Runtime Local Mobility Anchor
(LMA) Assignment Support for&nbsp;Proxy&nbsp;Mobile&nbsp;IPv6</title>
        <author initials='J.' surname="Korhonen" fullname='Jouni Korhonen' role="editor">
           <organization abbrev="Nokia Siemens Networks">Nokia Siemens Networks</organization>
            <address>
                <postal>
                    <street>Linnoitustie 6</street>
                    <code>FI-02600 Espoo</code>
                    <country>Finland</country>
                </postal>
                <email>jouni.nospam@gmail.com</email>
             </address>
        </author>
        <author initials='S.' surname="Gundavelli" fullname='Sri Gundavelli'>
           <organization abbrev="Cisco">Cisco</organization>
            <address>
                <postal>
                    <street>170 West Tasman Drive</street>
                    <city>San Jose</city><region>CA</region><code>95134</code>
                    <country>USA</country>
                </postal>
                <email>sgundave@cisco.com</email>
             </address>
        </author>
        <author initials='H.' surname="Yokota" fullname='Hidetoshi Yokota'>
           <organization abbrev="KDDI Lab">KDDI Lab</organization>
            <address>
                <postal>
                    <street>2-1-15 Ohara, Fujimino</street>
                    <city>Saitama</city><code>356-8502</code>
                    <country>Japan</country>
                </postal>
                <email>yokota@kddilabs.jp</email>
             </address>
        </author>

        <author initials='X.' surname="Cui" fullname='Xiangsong Cui'>
           <organization abbrev="Huawei Technologies">Huawei Technologies</organization>
            <address>
                <postal>
                    <street>Huawei Building, No. 156 Beiqing Rd.</street>
                    <street>Z-park, Shi-Chuang-Ke-Ji-Shi-Fan-Yuan</street>
                    <city>Hai-Dian District, Beijing</city>
                    <code>100095</code>
                    <country>P.R. China</country>
                </postal>
                <email>Xiangsong.Cui@huawei.com</email>
             </address>
        </author>
        
        <date month="February" year="2012"/>

<!-- [rfced] Please insert any keywords (beyond those that appear in
the title) for use on http://www.rfc-editor.org/rfcsearch.html. -->

<keyword>example</keyword>

        <abstract>
         <t>This document describes a runtime local mobility anchor assignment
         functionality and corresponding mobility options for Proxy Mobile
         IPv6. The runtime local mobility anchor assignment takes place during
         a Proxy Binding Update and a Proxy Binding Acknowledgement message
         exchange between a mobile access gateway and a local mobility anchor.
         The runtime local mobility anchor assignment functionality defined in
         this specification can be used, for example, for load-balancing purposes.
         </t>
        </abstract>
    </front>

    <middle>
         <section title="Introduction">
         <t>This specification describes a runtime assignment of a local
            mobility anchor (LMA) for the Proxy Mobile IPv6
            (PMIPv6) <xref target="RFC5213"/> protocol. The runtime LMA assignment
            takes place during a Proxy Binding Update (PBU) and a Proxy Binding
            Acknowledgement (PBA) message exchange between a mobile access
            gateway (MAG) and a LMA. The runtime LMA assignment functionality defined
            in this specification can be used, for example, for load-balancing
            purposes. MAGs and LMAs can also implement other load-balancing
            mechanisms that are completely
            transparent at the PMIPv6 protocol level and do not depend on the
            functionality defined in this specification.
         </t>
         <t>The runtime LMA assignment functionality does not depend on the
            Domain Name System (DNS) or the Authentication, Authorization, and
            Accounting (AAA) infrastructure for the assignment of the LMA to which
            the mobile node (MN) is anchored.  All MAGs and LMAs (either
            rfLMAs or r2LMAs; see <xref target="terms"/>) have to belong
            to the same PMIPv6 domain.
         </t>
         <t>There are a number of reasons why the runtime LMA assignment is
            a useful addition to the PMIPv6 protocol. A few are identified below:
         </t>
         
         <t><list style='hanging'>

         <t hangText="o">LMAs with multiple IP addresses: a cluster of
         LMAs or a blade architecture LMA may appear to the routing system
         as multiple LMAs with separate unicast IP addresses. A MAG can
         initially select any of the LMAs as the serving LMA using, for
         example, DNS- and AAA-based solutions. However, MAG's initial
         selection may be suboptimal from the LMA point of view and
         immediate runtime assignment to a "proper LMA" would be needed.
         The LMA could use a <xref target="RFC5142"/>-based approach,
         but that would imply unnecessary setting up of a mobility session
         in a "wrong LMA" with associated back-end support system interactions,
         additional signaling between the MAG and the LMA, and
         re-establishing a mobility session to the new LMA again with
         associated signaling.
         </t>

         <t hangText="o">Bypassing a load-balancer: a cluster of LMAs or a blade
            architecture LMA may have a load-balancer in front of them or integrated 
            in one of the LMAs. The load-balancer would represent multiple LMAs
            during the LMA discovery phase and only its IP address would be
            exposed to the MAG thus hiding possible individual LMA or LMA blade IP
            addresses from the MAG. However, if all traffic must always go
            through the load-balancer, it quickly becomes a bottleneck.
            Therefore, a PMIPv6 protocol-level support for bypassing the
            load-balancer after the initial PBU/PBA exchange would greatly help
            scalability. Also, bypassing the load-balancer as soon as possible
            allows implementing load-balancers that do not maintain any
            MN-specific state information.
         </t>

         <t hangText="o">Independence from DNS: DNS-based load-balancing is a
            common practice. However, keeping MAGs up to date with LMA load
            status using DNS is hard, e.g., due to caching and unpredictable zone
            update delays <xref target="RFC6097"/>.
            Generally, LMAs constantly updating the
            <xref target="RFC2136"/> zone's master DNS server might not feasible
            in a large PMIPv6 domain due to increased load on the master DNS
            server and additional background signaling. Furthermore, MAGs may perform
            (LMA) destination address selection decisions that are not in line
            with what the DNS administrator actually wanted <xref target="RFC3484"/>.
         </t>

         <t hangText="o">Independence from AAA: AAA-based solutions have basically
            the same arguments as DNS-based solutions above. It is also typical
            that AAA-based solutions offload the initial LMA selection to the
            DNS infrastructure <xref target="RFC5779"/>. The AAA infrastructure
            does not return an IP address or a Fully Qualified domain Name (FQDN)
            to a single LMA; rather, it returns a FQDN representing a group of LMAs.
         </t>

         <t hangText="o">Support for IPv6 anycast addressing <xref target="RFC4291"/>:
         the current PMIPv6 specification does not specify how the PMIPv6 protocol
         should treat anycast addresses assigned to mobility agents. For example, a
         blade architecture LMA may have a unique unicast IP address for each
         blade and a single anycast address for all blades. A MAG could
         then initially send a PBU to an anycast LMA address and receive a
         PBA from an anycast LMA address. Once the
         MAG receives the unicast address of the runtime-assigned LMA blade
         through the initial PBU/PBA exchange, the subsequent communication
         continues using the unicast address.
         </t>            
         </list></t>

         <t>As a summary, the DNS/AAA-based approaches cannot be used to 
         select an "appropriate" LMA at runtime. Therefore, this specification
         defines a solution that is applicable for LMA
         implementations where the IP address known to the MAG is not the
         best LMA of choice at runtime.
         </t>

         </section>

       <section title="Requirements and Terminology">
         <section title="Requirements">
           <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
              "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
              and "OPTIONAL" in this document are to be interpreted as
              described in <xref target="RFC2119"/>.
           </t>
         </section>
         <section title="Terminology" anchor="terms">
           <t>In addition to the terminology defined in <xref target="RFC5213"/>,
              the following terminology is also used:
           </t>

           <t>
           <list style='hanging'>
             <t hangText="rfLMA"><vspace blankLines="1"/>
                An LMA that receives a PBU from a MAG and decides to assign
                an IP mobility session with a new target LMA (r2LMA).
             </t>
             <t hangText="r2LMA"><vspace blankLines="1"/>
                The LMA assigned to a MAG as a result of the runtime LMA
                assignment.
             </t>
             <t hangText="Runtime Assignment Domain"><vspace blankLines="1"/>
             A group of LMAs that consists of at least one rfLMA and one or more
             r2LMAs (all are part of the same PMIPv6 domain).  A rfLMA is allowed 
			 to assign MAGs only with r2LMAs that
             belong to the same runtime assignment domain. The rfLMA and one or
             more r2LMAs may consist of multiple blades in a single network
             element, multiple physical network elements, or multiple LMAs
             distributed geographically.
             </t>
           </list>
           </t>
         </section>
       </section>
       
       <section title="Proxy Mobile IPv6 Domain Assumptions">
           <t>The runtime LMA assignment functionality has few assumptions
           within the PMIPv6 domain.
           </t>

           <t>Each LMA in a runtime assignment domain MUST be reachable at a
           unicast IP address. The rfLMA and the r2LMA MUST have a prior
           agreement, adequate means to secure their inter-LMA communication,
           and an established trust relationship to perform the runtime LMA
           assignment.
           </t>
           <t>Each LMA and MAG participating in the runtime LMA assignment is
           assumed to have required Security Associations (SAs) pre-established.
           Dynamic negotiation of the SAs using, e.g., IKEv2
           <xref target="RFC5996"/>, SHOULD be supported but is out of scope of
           this specification.
           </t>
       </section>

       
       <section title="Mobility Options" anchor="rediropt">
        <t>In the following sections, all presented values, bit fields, and
        addresses are in network byte order.
        </t>
        <section title="Redirect-Capability Mobility Option">
         <t>The Redirect-Capability mobility
         option has the alignment requirement of 4n. There can be zero or one
         Redirect-Capability mobility option in the PBU. The format of the
         Redirect-Capability mobility option is shown below:
         </t>
         <t>
         <figure title="Redirect-Capability Mobility Option">
                    <artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Option Type   | Option Length |          Reserved             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
         </figure>


         <list style='symbols'>
         <t>Option Type: 8-bit identifier set to 46.
         </t>

         <t>Option Length: 8-bit unsigned integer, representing
         the length of the Redirect-Capability mobility option in octets,
         excluding the Option Type and Length fields. The
         Option Length MUST be set to 2.
         </t>

         <t>Reserved: This field is reserved for future use.
         This field MUST be set to zero by the sender and ignored by
         the receiver.
         </t>
         </list>
         </t>
         <t>The Redirect-Capability option is used by the MAG to inform the LMA
         that it implements and has enabled the runtime LMA assignment 
         functionality.
         </t>
         </section>

         <section title="Redirect Mobility Option">
         <t>The Redirect mobility option in the PBA MUST contain an
         unicast address of the r2LMA and the address family MUST
         be the same as the currently used transport between the MAG and the rfLMA.
         There can be zero or one Redirect mobility option in the PBA.
         The Redirect mobility option has the alignment requirement of 4n.
         The format of the Redirect mobility option is shown below:

         <figure title="Redirect Mobility Option">
                    <artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Option Type   | Option Length |K|N|      Reserved             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                  Optional IPv6 r2LMA Address                  |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Optional IPv4 r2LMA Address                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
         </figure>
</t>
<t>
         <list style='symbols'>
         <t>Option Type: 8-bit identifier set to 47.
         </t>

         <t>Option Length: 8-bit unsigned integer, representing
            the length of the Redirect mobility option in octets, excluding the
            Option Type and Length fields. If the 'K' flag is set and 'N' is unset,
            then the length MUST be 18. If the 'K' flag is unset and 'N' is set,
            then the length MUST be 6. Both the 'K' and 'N' flags cannot be set or
            unset simultaneously.
         </t>
         <t>'K' flag: This bit is set (1) if the 'Optional IPv6 r2LMA Address' is
             included in the mobility option. Otherwise, the bit is unset (0).
         </t>
         <t>'N' flag: This bit is set (1) if the 'Optional IPv4 r2LMA Address' is
            included in the mobility option. Otherwise, the bit is unset (0).
         </t>
         <t>Reserved: This field is reserved for future use.
            MUST be set to zero by the sender and ignored by
            the receiver.

         </t>
         <t>Optional IPv6 r2LMA Address: the unicast IPv6 address of the
            r2LMA. This value is present when the corresponding PBU was
            sourced from an IPv6 address.
         </t>
         <t>Optional IPv4 r2LMA Address: the IPv4 address of the
            r2LMA.  This value is present when the corresponding PBU was
            sourced from an IPv4 address (for IPv4 transport, see
            <xref target="RFC5844"/>).
         </t>
         </list>
         </t>
         <t>The Redirect option is used by the LMA to inform the MAG that the
         runtime LMA assignment took place and the MAG has to update its
         Binding Update List Entry (BULE) for the mobility session.
         </t>
         </section>


         <section title="Load Information Mobility Option">
         <t>The Load Information mobility option can be included in any PBA
         and is used to report priority and key load information of a LMA
         to a MAG (or to a 'proxy-MAG'). 

The Load Information mobility option
         has the alignment requirement of 4n. The format of the 
         mobility option is shown below:
         </t>
         <t>
         <figure title="Load Information Mobility Option">
<artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Option Type   | Option Length |          Priority             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sessions in Use                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Maximum Sessions                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Used Capacity                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Maximum Capacity                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
         </figure>

         <list style='symbols'>
         <t>Option Type: 8-bit identifier set to 48.
         </t>

         <t>Option Length: 8-bit unsigned integer, representing
            the length of the Load Information mobility option in octets,
            excluding the Option Type and Length fields. The length
            is set to 18.
         </t>
         <t>Priority: 16-bit unsigned integer, representing the priority
         of an LMA. The lower value, the higher the priority. The priority
         only has meaning among a group of LMAs under the same administration,
         for example, determined by a common LMA FQDN, a domain name, or a
         realm. 
         </t>
         <t>Sessions in Use: 32-bit unsigned integer, representing the
         number of parallel mobility sessions the LMA has in use.
         </t>
         <t>Maximum Sessions: 32-bit unsigned integer, representing the
         maximum number of parallel mobility sessions the LMA is willing
         to accept.
         </t>
         <t>Used Capacity: 32-bit unsigned integer, representing the
         used bandwidth/throughput capacity of the LMA in kilobytes per
         second.
         </t>
         <t>Maximum Capacity: 32-bit unsigned integer, representing the
         maximum bandwidth/throughput capacity in kilobytes per
         second the LMA is willing to accept.
         </t>
         </list>
         </t>
         <t>The session and capacity information can easily be used to
         calculate different load factors of the LMA. A MAG (or a 'proxy-MAG')
         MAY use the priority and load information to internally maintain
         priority ordering of LMAs.
         </t>
         </section>

         <section title="Alternate IPv4 Care-of Address Mobility Option" anchor="a4coa">
         <t>The Alternate IPv4 Care-of Address (A4CoA)
         mobility option has the alignment requirement of 4n+2. The format
         of the mobility option is shown below:


         <figure title="Alternate IPv4 Care-of Address Mobility Option">
<artwork><![CDATA[
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
                                +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                | Option Type   | Option Length |          
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Alternate IPv4 Care-of Address                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
]]></artwork>
         </figure>
</t>
<t>
         <list style='symbols'>
         <t>Option Type: 8-bit identifier set to 49.
         </t>

         <t>Option Length: 8-bit unsigned integer, representing
            the length of the Load Information mobility option in octets,
            excluding the Option Type and Length fields. The length
            is set to 4.
         </t>
         <t>Alternate IPv4 Care-of Address: an IPv4 equivalent of the
         <xref target="RFC6275"/> Alternate Care-of Address option for
         IPv6. In the context of PMIPv6, its semantic is equivalent
         to the Alternate Care-of Address option for IPv6.
         </t>
         </list></t>
         <t>A MAG MAY include the
         Alternate IPv4 Care-of Address option in a PBU. An LMA that
         receives and implements the Alternate IPv4 Care-of Address
         option MUST echo the option as  such back to the MAG in a reply
         PBA.
         </t>
         </section>
  </section>
  <section title="Runtime LMA Assignment" anchor="during">
    <section title="General Operation">
      <t>During the runtime LMA assignment, the PBA is returned from the
      LMA Address to which the PBU was sent, i.e., from the rfLMA address. After
      the runtime LMA assignment, all PMIPv6 communication continues directly
      between the MAG and the r2LMA bypassing the rfLMA. The overall
      runtime LMA assignment flow sequence is shown in <xref target="scenario1"/>.
      </t>

      <t><figure title="Runtime LMA Assignment from rfLMA to r2LMA and
      Setting Up a Mobility Session in the r2LMA within a Runtime
      Assignment Domain" anchor="scenario1">
<artwork><![CDATA[
 [MAG]   [rfLMA]  [r2LMA]
   |        |        |
1) |--PBU-->|        | LMA assignment takes place in rfLMA.
   |        |        |
2) |        | ~ ~ ~ >|\ 
   |        |        | + BCE gets created in r2LMA.
3) |        |<~ ~ ~ ~|/
   |        |        |
4) |<--PBA--|        | PBA contains r2LMA information.
   |        |        |
   |<=====data======>|
   |        |        |
5) |-------PBU------>| Lifetime extension,
6) |<------PBA-------| de-registration, etc.
   |        |        |
]]></artwork></figure>
      </t>
      <t>The assumption in the signaling flow step 1) shown in
      <xref target="scenario1"/> is that the mobility session gets
      created in the r2LMA, although the rfLMA is responsible for
      interfacing with the MAG. There are several possible solutions
      for the rfLMA and the r2LMA interaction depending on, e.g., the
      co-location properties of the rfLMA and the r2LMA. This specification
      describes two:

      <list style="symbols">
        <t>Co-located rfLMA and r2LMA functions, where the 'rfLMA side of the
        LMA' is reachable via an anycast address or the loopback address of
        the LMA. See <xref target="anycast"/> for further details.</t>
        
        <t>Separate rfLMA and r2LMA functions, where the rfLMA acts as a
        non-transparent 'proxy-MAG' to a r2LMA. See
        <xref target="proxymag"/> for further details.</t>
        
      </list>
        There are other possible implementations of the rfLMA and the r2LMA.
        At the end, as long as the protocol between the MAG and the rfLMA
        follows this specification , the co-location or inter-communication
        properties of the rfLMA and the r2LMA do not matter.
      </t>
    </section>

    <section title="Mobile Access Gateway Operation" anchor="magconsi">
      <t>In the base PMIPv6 protocol <xref target="RFC5213"/>, a MAG sends a
      PBU to an LMA; this results in creation of a Binding Cache Entry (BCE)
      at the LMA and the
      LMA sending a PBA sent back to the MAG. The MAG in turn creates a
      corresponding Binding Update List Entry (BULE). This specification extends
      the base protocol with the runtime LMA assignment functionality.
      </t>

      <t>
      If the MAG supports the runtime LMA
      assignment and the functionality is also enabled (see the EnableLMARedirectFunction
      configuration variable in <xref target="objects"/>), then the MAG
      includes the Redirect-Capability mobility option in a PBU that
      establishes a new mobility session (i.e., Handoff Indicator Option in the
      PBU has the value of 1). The Redirect-Capability mobility
      option in the PBU is also an indication to an LMA that the MAG
      supports the runtime LMA assignment functionality and is prepared to
      be assigned with a different LMA. The runtime LMA assignment concerns
      always one mobility session at a time.
      </t>
      <t>If the MAG receives a PBA that contains the Redirect mobility 
      option without first including the Redirect-Capability
      mobility option in the corresponding PBU, then the MAG MUST ignore
      the option and process the PBA as described in RFC 5213.
      </t>

      <t>If the MAG receives a PBA that contains the Redirect mobility 
      option and the MAG had included the Redirect-Capability mobility
      option in the corresponding PBU, then the
      MAG MUST perform the following steps in addition to the normal
      <xref target="RFC5213"/> PBA processing:
      </t>

      <t><list style='symbols'>
        <t>The MAG updates its BULE to contain the r2LMA address
        included in the received Redirect mobility option.
        </t>
        <t>If there is no SA between the MAG and the r2LMA, the MAG SHOULD
        initiate a dynamic creation of the SA between the MAG and the
        r2LMA as described in Section 4 of RFC 5213.  If the dynamic SA
        creation fails, the MAG SHOULD log the event. The MAG MAY retry the
        dynamic creation of the SA, and if those also fail, the newly created
        BULE (and also the BUL in the r2LMA) will eventually timeout. If the
        failure is persistent, it can be regarded as a system-level
        configuration error.
        </t>
      </list>
      </t>
      
      <t>The MAG is not required to send a fresh PBU to
      the r2LMA after a successful runtime assignment. The mobility
      session has already been established in the r2LMA.

      The MAG MUST send all user traffic to the r2LMA address. The
      MAG MUST send subsequent binding refresh PBUs (e.g., lifetime
      extension, handoff, etc.) to the r2LMA address.
      If there is no existing
      tunnel between the MAG and the r2LMA unicast address, then the MAG
      creates one as described in Section 6.9.1.2 of <xref target="RFC5213"/>.
      </t>

    </section>

    <section title="Local Mobility Anchor Operation" anchor="commonlma">
      <t>The text in the following sections refers to an 'LMA' when it
      means the combination of the rfLMA and the r2LMA, i.e., the entity
      where runtime LMA assignment is possible. When the text points to
      a specific LMA role during the runtime assignment, it uses either
      the 'rfLMA' or the 'r2LMA'.
      </t>

      <t>If the runtime assignment functionality is enabled (see the EnableLMARedirectFunction
      configuration variable in <xref target="objects"/>) in the rfLMA but the
      LMA assignment is not going to take place for some reason, and
      the rfLMA is not willing to serve (or not capable of serving) as a normal <xref target="RFC5213"/>
      LMA for the MAG, then the rfLMA MUST reject the PBU and send back
      a PBA with Status Value set to 130 (Insufficient resources) error code.
      If the rfLMA is able to make the assignment to an r2LMA,
      it returns a PBA with the Redirect mobility option as defined
      below. Otherwise, the rfLMA MUST act as a normal <xref target="RFC5213"/>- or
      <xref target="RFC5844"/>-defined LMA for the MAG.
      </t>
      <t>The rfLMA MUST only assign the MAG to a new r2LMA with which it knows
      the MAG has an SA or with which it knows the MAG can establish an SA
      dynamically. The rfLMA MUST NOT assign the MAG with a r2LMA that
      the rfLMA and the r2LMA do not have a prior agreement and an
      established trust relationship for the runtime LMA assignment.

<!-- Please clarify this sentence; it does not parse.

Original:
The rfLMA MUST NOT assign the MAG with a r2LMA that
the rfLMA and the r2LMA do not have a prior agreement and an
established trust relationship for the runtime LMA assignment.

Perhaps (if it may be rephrased in the affirmative):
The rfLMA MUST assign the MAG with a r2LMA only if
the rfLMA and the r2LMA have a prior agreement and an
established trust relationship for the runtime LMA assignment.
-->

      These SA-related knowledge issues and trust relationships are
      deployment specific in a PMIPv6 domain and in a runtime assignment
      domain, and out of scope of this specification. Possible context
      transfer and other coordination management between the rfLMA and
      the r2LMA are again deployment specific for LMAs in a runtime assignment
      domain. The rfLMA MUST NOT change the used transport IP address family
      during the runtime LMA assignment.
      </t>
 
      <t>As a result of a successful runtime LMA assignment, the PBA MUST
      contain the Redirect mobility option with a valid r2LMA unicast
      address and the PBA Status Value indicating success.
      </t>          
      <t>Next, we describe two deployment and implementation models for the
      runtime LMA assignment.  In <xref target="anycast"/>, we describe a
      model where the rfLMA and r2LMA are co-located. In <xref target="proxymag"/>
      we describe a model where the rfLMA acts as a non-transparent 'proxy-MAG',
      and where the rfLMA and the r2LMA are separate. There can be even more
      implementation options depending on the rfLMA and the r2LMA co-location
      properties, and how the inter-LMA communication is arranged.
      </t>

      <section title="Co-Located rfLMA and r2LMA Functions" anchor="anycast">
       <t>In this solution approach, the rfLMA and the r2LMA are part of 
       the same 'co-located LMA', and may even be using the same physical
       network interface. The rfLMA is reachable via an anycast or a
       loopback address of the LMA. Each r2LMA is reachable via its
       unicast address. <xref target="co-located"/> illustrates example
       signaling flows for the solution.
       </t>
       <t>The MAG-LMA SA is between the MAG and the rfLMA
       (i.e., the anycast or the loopback address of the LMA). How this SA
       has been set up is out of scope of this specification, but a manual
       SA configuration is one possibility. 
       </t>
       <t>The rfLMA becomes active when the runtime LMA assignment
       functionality is enabled (see the EnableLMARedirectFunction
       configuration variable in <xref target="objects"/>). When the rfLMA
       receives a PBU destined to it, and the PBU contains the Redirect-Capability
       mobility option, then the 'co-located LMA' MUST create a mobility session
       in a r2LMA role using the procedures described in <xref target="RFC5213"/>.  If there
       is no existing tunnel between the MAG and the r2LMA unicast address,
       then the r2LMA creates one as described in Section 5.3 of
       <xref target="RFC5213"/>. The r2LMA used for accepting and anchoring
       the mobility session MUST also have the runtime LMA assignment
       functionality enabled (see the EnableLMARedirectAcceptFunction
       configuration variable in <xref target="objects"/>).
       </t>
       <t>If the mobility session creation succeeded, then the 'co-located LMA'
       in the rfLMA role sends a PBA to the MAG. The PBA is sourced using the
       rfLMA (anycast or loopback) address. The PBA MUST contain the r2LMA
       unicast address (IPv6 or IPv4) in the Redirect mobility option.
       </t> 
       <t>If the PBU is received on the r2LMA unicast address, then
       the PBU is processed as described in RFC 5213 and the response
       PBA MUST NOT contain the Redirect mobility option.
       </t>
       <t>If the PBU is received on the rfLMA address and there is
       no Redirect-Capability mobility option in the PBU, then the
       'co-located LMA' MAY choose to be a LMA for the MAG (assuming the
       rfLMA address is not an anycast address). Otherwise, the rfLMA MUST
       reject the PBU and send back a PBA in a rfLMA role with
       Status Value set to 130 (Insufficient resources) error code (as
       mentioned in <xref target="commonlma"/>).
       </t>

      <t><figure title="Co-Located rfLMA and r2LMA Example" anchor="co-located">
<artwork><![CDATA[
      [MAG]                       [rfLMA  /r2LMA_1/r2LMA_2/r2LMA_3]
        |                             |       |       |       |
MAG discovers rfLMA                   |       |       |       |
BULE for rfLMA                        |       |       |       |
        |                             |       |       |       |
        |-- PBU --------------------->|       |       |       |
        |   src=MAG_Proxy-CoA,        |       |       |       |
        |   dst=rfLMA,                |       |       |       |
        |   Redirect-Capability, ..   |  r2LMA gets selected  |
        |                             BCE is created in r2LMA_2
        |                             |Tunnel setup in r2LMA_2|
        |                             |       |       |       |
        |<- PBA ----------------------|       |       |       |
        |   src=rfLMA,                |       |       |       |
        |   dst=MAG_Proxy-CoA,        |       |       |       |
        |   Redirect=r2LMA_2_address, |       |       |       |
        |   Load Info, ..             |       |       |       |
        |                             |       |       |       |
BULE updated to r2LMA_2               |       |       |       |
   Tunnel setup                       |       |       |       |
        |                             |       |       |       |
        |<=========== MAG-r2LMA_2 tunnel ============>|       |
        |                             |       |       |       |
Lifetime extension, etc.              |       |       |       |
        |                             |       |       |       |
        |-- PBU ------------------------------------->|       |
        |   src=MAG_Proxy-CoA,        |       |       |       |
        |   dst=r2LMA_2, ..           |       |       |       |
        |                             |       |       |       |
        |<- PBA --------------------------------------|       |
        |   src=r2LMA_2,              |       |       |       |
        |   dst=MAG_Proxy-CoA,        |       |       |       |
        |   Load Info, ..             |       |       |       |
        |                             |       |       |       |
]]></artwork></figure>
       </t>
      </section>

      <section title="Separate rfLMA and r2LMA Functions (Proxy-MAG)" anchor="proxymag">
       <t>In this solution approach, the rfLMA and the r2LMA are two isolated
       functions, and may even be physically separate networking nodes.
       The r2LMA can be any <xref target="RFC5213"/>- or <xref
target="RFC5844"/>-compliant LMA that doesn't have
       any knowledge of this specification when IPv6 transport is used.
       In case of IPv4 transport, the <xref target="RFC5844"/>-compliant LMA MUST also
       implement the Alternate IPv4 Care-of Address option (see 
       <xref target="a4coa"/>). <xref target="separated"/> illustrates
       example signaling flows for the solution.
       </t>
       <t>The rfLMA is actually a non-transparent 'proxy-MAG' that shows up as an LMA
       implementing this specification towards the MAG, and as a base
       <xref target="RFC5213"/>-compliant MAG to the r2LMA. (See <xref target="RFC2616"/>
       for a generic definition of a non-transparent proxy; although it's for
       HTTP, the idea also applies here.)  This type of operation is
       also referred to as 'chaining' in other contexts. The protocol between
       the 'proxy-MAG' and the  r2LMA is the base <xref target="RFC5213"/> PMIPv6 protocol.       
       </t>
       <t>The MAG-LMA SA is between the MAG and the rfLMA, and <xref target="RFC5213"/> SA
       considerations apply fully. The MAG has no knowledge of the
       'proxy-MAG'-r2LMA SA. <xref target="RFC5213"/> considerations regarding the SA
       between the 'proxy-MAG' and the r2LMA apply fully. It is also
       possible that 'proxy-MAG'-r2LMA security is arranged using other
       means than IPsec, for example, using layer-2 VPNs.
       </t>
    
       <t>When the rfLMA receives a PBU, and the PBU contains the
       Redirect-Capability mobility option, then the rfLMA in a
       'proxy-MAG' role:              
       <list style="symbols">
        <t>Processes the PBU using the procedures described in RFC 5213
        except that no mobility session gets created. Instead, the rfLMA
        creates a proxy state based on the received PBU.
        </t>
      
        <t>Assigns a r2LMA to the MAG.</t>
      
        <t>Creates a new PBU', which includes all non-security
        related mobility options from the original PBU and an Alternate 
        Care-of Address (ACoA) option containing the Proxy Care-of Address
        of the original MAG. If the original PBU already included an ACoA option, then the  content of the ACoA option in the PBU' MUST be the same as in the
        original PBU.
        <vspace blankLines="1"/>
        Note, in case of IPv4 transport <xref target="RFC5844"/>, the
        Alternate IPv4 Care-of Address (A4CoA) option MUST be used and
        contain the IPv4 Proxy Care-of Address of the original MAG.
        </t>
      
        <t>Sends the new PBU' sourced from its 'proxy-MAG'
        IPv6 or IPv4 Proxy Care-of Address and destined to the r2LMA
        address using the procedures described in RFC 5213 (or RFC 5844
        in case of IPv4 transport).
        </t>
       </list>
       </t>
    
       <t>The r2LMA processes the received PBU' using the procedures
       described in RFC 5213 or RFC 5844. In case of IPv4 transport,
       the r2LMA uses the IPv4 Proxy Care-of Address from the Alternate
       IPv4 Care-of Address option for the tunnel setup and the creation
       of the BCE. The reply PBA' MUST be destined to
       the source address of the received PBU', i.e., the Care-of Address
       the 'proxy-MAG'.
       </t>
 
       <t>Once the rfLMA in a 'proxy-MAG' role receives a reply PBA' from
       the r2LMA and the mobility session creation succeeded in the r2LMA,
       the rfLMA sends a PBA to the original MAG. The PBA is sourced from
       the rfLMA address and destined to the MAG (IPv6 or IPv4) Proxy Care-of 
       Address. The PBA MUST contain the r2LMA (IPv6 or IPv4) unicast
       address in the Redirect mobility option. Other
       non-security-related mobility options (including the Load
       Information option) are copied from the PBA' to the PBA as such.
       </t>
       <t>If one of these errors occurs:
       <list style="symbols">
        <t>the PBA' Status Value indicates that the mobility session
        creation failed in the r2LMA. For example, the Status Value in the
        PBA' is set to 130 (Insufficient resources), or
        </t>
        <t>there was no PBA' response from the r2LMA, or
        </t>
        <t>the PBA' did not include the Alternate IPv4 Care-of Address
        option although it was included in the corresponding PBU' (when
        using IPv4 transport),
        </t>
       </list>

       then the rfLMA SHOULD assign the MAG to a new r2LMA and rerun
       the procedure for sending the PBU' described earlier for the new r2LMA.
       The number and order of r2LMA reassignment attempts is controlled
       by the local policy and the amount of known r2LMAs in the rfLMA.
       When the rfLMA in a 'proxy-MAG' role concludes the mobility session
       creation failed with r2LMA(s), the rfLMA MUST set the Status Value
       in the PBA as received from the latest contacted PBA' Status Value
       or to 130 (Insufficient resources) in case of no responses from
       rfLMAs,
       and send the reply PBA to the MAG. The PBA is sourced from the
       rfLMA address and destined to the MAG Proxy Care-of 
       Address. Other possible non-security-related mobility options
       (including the Load Information option) are copied from the PBA'
       to the PBA as such.
       </t>

       <t>Once the rfLMA has sent the reply PBA to the MAG, it can remove
       the proxy state.  Subsequent traffic between the MAG and the r2LMA
       will bypass the rfLMA (assuming the mobility session creation
       succeeded in the r2LMA).
       </t>
       <t>If the rfLMA receives a PBU with no Redirect-Capability
       mobility option in the PBU, then the PBU is processed as described
       in <xref target="commonlma"/>, i.e., the rfLMA may or may not act
       as an <xref target="RFC5213"/> or <xref target="RFC5844"/> LMA to the MAG.
       </t>

      <t><figure title="Separate rfLMA and r2LMA ('proxy-MAG') Example" anchor="separated">
<artwork><![CDATA[
  [MAG]                        [rfLMA]                      [r2LMA]
    |                             |                             |
MAG discovers rfLMA               |                             |
BULE for rfLMA                    |                             |
    |                             |                             |
    |-- PBU --------------------->|  rfLMA assigns a r2LMA and  |
    |   src=MAG_Proxy-CoA,        |  creates a proxy state      |
    |   dst=rfLMA,                |                             |
    |   Redirect-Capability, ..   |                             |
    |                             |-- PBU' -------------------->|
    |                             |   src=proxy-MAG_Proxy-CoA,  |
    |                             |   dst=r2LMA,                |
    |                             |   ACoA/A4CoA=MAG_Proxy-CoA, |
    |                             |   ..                        |
    |                             |             BCE created in r2LMA
    |                             |                     Tunnel setup
    |                             |       Proxy-CoA is MAG's address
    |                             |                             |
    |   rfLMA removes the         |<- PBA' ---------------------|
    |   proxy state               |   src=r2LMA,                |
    |                             |   dst=proxy-MAG_Proxy-CoA,  |
    |                             |   Load Info, ..             |
    |<- PBA ----------------------|                             |
    |   src=rfLMA,                |                             |
    |   dst=MAG_Proxy-CoA,        |                             |
    |   Redirect=r2LMA_address,   |                             |
    |   Load Info, ..             |                             |
    |                             |                             |
BULE updated to r2LMA             |                             | 
Tunnel setup                      |                             |
    |                             |                             |
    |<===================== MAG-r2LMA tunnel ==================>|
    |                             |                             |
Lifetime extension, etc.          |                             |
    |                             |                             |
    |-- PBU --------------------------------------------------->|
    |   src=MAG_Proxy-CoA, dst=r2LMA, ..                        |
    |                             |                             |
    |<- PBA ----------------------------------------------------|
    |   src=r2LMA, dst=MAG_Proxy-CoA, Load Info, ..             |
    |                             |                             |
]]></artwork></figure>
      </t>
     </section>
    </section>
  </section>
       
  <section title="Handoff and Multi-Homing Considerations">
  <t>A MN can be multi-homed, i.e., have network connectivity over multiple
  interfaces connected to one or more accesses. If PMIPv6-based handovers between
  multiple interfaces or accesses are desired, then a single LMA should
  have a control over all possible multi-homed mobility sessions the MN
  has. Once
  the MN has established one mobility session with one LMA, the
  subsequent mobility sessions of the same MN would be anchored to the
  LMA that was initially assigned. If each mobility session over a 
  different interface (and possibly a MAG) has no requirements for
  PMIPv6-based handovers between accesses or interfaces, then the rest of the
  considerations in this section do not apply.
  </t>

   <!--t>A MN can be multi-homed, i.e., have network connectivity over multiple
   interfaces connected one or more accesses.  A single LMA entity SHOULD
   have the control over all possible multi-homed mobility sessions the MN
   has or otherwise handovers between different accesses and interfaces
   become challenged, if not impossible. 
   Therefore, once the MN has established one mobility session with one LMA,
   the subsequent mobility sessions of the same MN SHOULD be anchored to the
   LMA that was initially assigned.
   </t-->
   <t>
   One possible solution already supported by this specification is
   applying the runtime LMA assignment only for the very first initial
   attach a multi-homed MN does towards a PMIPv6 domain.  After the
   initial attach, the assigned r2LMA address has been stored in the
   policy profile.  For the subsequent mobility sessions of the multi-homed MN, the same assigned r2LMA address would be used and there is
   no need to contact the rfLMA. 
Ensuring the discovery of the same r2LMA each time 
relies on the MN having an identity that can always point to
the same policy profile, independent of the access that is used.
</t>

   <t>MAGs have a control over selectively enabling and disabling the
   runtime assignment of the LMA. If the multi-homed MN is attached to
   a PMIPv6 domain via multiple MAGs, the assigned r2LMA address should
   be stored in the remote policy store and downloaded as a part of the
   policy profile download to a MAG. Alternatively, MAGs can share policy
   profile information using other means. In both cases, the actual
   implementation of the policy profile information sharing is specific
   to a PMIPv6 deployment and out of scope of this specification. 
   </t> 
  </section>
       
  <section title="Protocol Configuration Variables" anchor="objects">
   <t>This specification defines two configuration variables that control
   the runtime LMA assignment functionality within a PMIPv6 domain.
   </t>
   <t><list style='hanging'>
    <t hangText="EnableLMARedirectFunction">
    <vspace blankLines="1"/>
    This configuration variable is available in both a MAG and in a
    rfLMA. When set to TRUE (i.e., enabled), the PMIPv6 node enables
    the runtime LMA assignment functionality. The default value is 
    FALSE (i.e., disabled).
    </t>
    <t hangText="EnableLMARedirectAcceptFunction">
    <vspace blankLines="1"/>
    This configuration variable is available in a r2LMA.
    When set to TRUE (i.e., enabled), the r2LMA is able to accept
    runtime LMA assignment mobility sessions from a rfLMA.  The
    default value is FALSE (i.e.,  disabled).
    </t>
   </list>
   </t>
   <t>Note that the MAG and LMA configuration variables from
   Sections 9.1 and 9.2 of <xref target="RFC5213"/> do not apply for
   an LMA when it is in an rfLMA role.
   </t>
  </section>

  <section title="Security Considerations">
   <t>The security considerations of PMIPv6 signaling described in
   RFC 5213 apply to this document. An incorrectly configured LMA
   may cause unwanted runtime LMA assignment attempts to non-existing
   LMAs or to other LMAs that do not have and will not have an SA with
   the MAG. Consequently, the MAG will experience failed binding
   updates or unsuccessful creation of mobility sessions. An
   incorrectly configured LMA may also cause biased load distribution
   within a PMIPv6 domain. This document also assumes that the LMAs
   that participate in runtime LMA assignment have adequate prior
   agreement and trust relationships between each other. 
   </t>
         <t>If the SAs between MAGs and LMAs are manually keyed (as may be
         needed by the scenario described in <xref target="during"/>), then
         the anti-replay service of ESP-protected PMIPv6 traffic cannot
         typically be provided. This is, however, deployment specific to a
         PMIPv6 domain.
         </t>
         <t>If a PMIPv6 domain deployment with a runtime LMA assignment requires
         that a rfLMA has to modify a PBU/PBA in any way, e.g., by changing
         the source and destination IP address or any other field of the
         encapsulating IP packet, then the security mechanism (such as possible
         authentication options) used to protect the PBU/PBA MUST NOT cover the
         outer IP packet on those parts that might get modified. Alternatively,
         the rfLMA can do all required security processing on the
         PBU/PBA, and the communication between the rfLMA and the r2LMA         
         would be unprotected at the PMIPv6 protocol level. In this case, the
         runtime assignment domain MUST implement an adequate level of security
         using other means, such as layer-2 VPNs.
         </t>
   </section>
        
   <section title="IANA Considerations">
    <t>New mobility options for use with PMIPv6 are defined
    in the <xref target="RFC6275"/> "Mobility Options"
    registry. The mobility options are defined in <xref target="rediropt"/>:
    <figure><artwork><![CDATA[
    Redirect-Capability Mobility Option             46
    Redirect Mobility Option                        47
    Load Information Mobility Option                48
    Alternate IPv4 Care-of Address                  49
]]></artwork></figure>
    </t>

   </section>     
   <section title="Acknowledgements">
    <t>The author would like to thank Basavaraj Patil, Domagoj Premec,
    Ahmad Muhanna, Vijay Devarapalli, Rajeev Koodli, Yungui Wang,
    Pete McCann, and
    Qin Wu for their discussion of this document. A special thanks
    to Qian Li for her detailed feedback on the protocol details.
    </t>
   </section>
  </middle>

  <back>
   <references title="Normative References">
        &rfc2119;
        &rfc5213;
        &rfc6275;
   </references>
   <references title="Informative References">
        &rfc5844;
        &rfc3484;
        &rfc4291;
        &rfc2136;
        &rfc5142;
        &rfc5996;
        &rfc6097;
        &rfc5779;
        &rfc2616;
   </references>
  </back>
</rfc>
