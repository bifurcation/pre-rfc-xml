<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<?rfc toc="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc category="exp" ipr="trust200811" number="8099" submissionType="IETF" consensus="yes">

  <front>
    <title abbrev="Topology-Transparent Zone"> 
     OSPF Topology-Transparent Zone
    </title>

 <author initials="H." fullname="Huaimo Chen" 
         surname="Chen">

      <organization>
         Huawei Technologies
      </organization>

      <address>
        <postal>

          <street> </street>
          <city>Boston</city>
          <region>MA</region>
          <country>United States of America</country>
        </postal>

        <email>huaimo.chen@huawei.com</email>
      </address>
  </author>


 <author initials="R." fullname="Renwei Li" 
         surname="Li">

      <organization>
         Huawei Technologies
      </organization>

      <address>
        <postal>
          <street> 2330 Central expressway </street>
          <city>Santa Clara</city>
          <region>CA</region>
          <country>United States of America</country>
        </postal>
        <email>renwei.li@huawei.com</email>
      </address>
  </author>


 <author initials="A" fullname="Alvaro Retana" 
            surname="Retana">
      <organization>Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>7025 Kit Creek Rd.</street>

          <city>Raleigh</city>

          <region>NC</region>

          <code>27709</code>

          <country>United States of America</country>
        </postal>

        <email>aretana@cisco.com</email>
      </address>
    </author>


 <author initials="Y" fullname="Yi Yang" 
            surname="Yang">
      <organization>Sockrate</organization>

      <address>
        <postal>
          <street> </street>
          <city>Cary</city>
          <region>NC</region>
          <code> </code>
          <country>United States of America</country>
        </postal>
        <email>yyang1998@gmail.com</email>
      </address>
    </author>



 <author initials="Z" fullname="Zhiheng Liu" 
            surname="Liu">
      <organization>China Mobile</organization>

      <address>
        <postal>
          <street>No.32 Xuanwumen West Street, Xicheng District</street>

          <city>Beijing</city>

          <region></region>

          <code>100053</code>

          <country>China</country>
        </postal>
        <email>liu.cmri@gmail.com</email>
      </address>
 </author>

    <date month="February" year="2017" />

    <area>General</area>

    <workgroup>Internet Engineering Task Force</workgroup>

<keyword>IGP</keyword>
<keyword>OSPF</keyword>
<keyword>TTZ</keyword>

<abstract>
<t>     
This document presents a Topology-Transparent Zone (TTZ) in an OSPF area. 
A TTZ comprises a group of routers 
and a number of links connecting these routers. 
Any router outside of the zone is not aware of the zone. 

A TTZ hides the internal topology of the TTZ from the outside.  It
does not directly advertise any internal information about the TTZ 
to a router outside of the TTZ.

The information about the links and routers such as a link down 
inside the TTZ is 
not advertised to any router outside of the TTZ. 
</t> 
</abstract>

</front>
<middle>
  
<section title="Introduction">
   
<t>
Networks expand as business grows and traffic increases. For scalability and manageability, a hierarchical network architecture is usually deployed in OSPF networks by regrouping routers into areas, which is often challenging and causes service interruptions. 
</t>

<t>
At first, reorganizing a network from one area into multiple areas or 
from a number of existing areas into even more areas 
is a very challenging and time-consuming task since it involves 
significant network architecture changes.

Considering the one area case, originally the network has only one area, 
which is the backbone. 
This original backbone area will be reorganized into 
a new backbone and a number of non-backbone areas. In general, 
each of the non-backbone areas is connected to the new backbone 
area through the Area Border Routers (ABRs) between the non-backbone and 
the backbone area (refer to RFC 2328, Section 3). 

It demands careful redesigning of network topology in advance to guarantee backbone area continuity and non-backbone-area reachability, and it requires significant modifications of configurations on many routers to ensure consistent routing.
</t>

<t>
Second, the services carried by the network may be interrupted 
while the network is being reorganized from one area into multiple areas 
or from a number of existing areas into even more areas 
since every OSPF interface with an area change is going 
down with its old area and then up with a new area.
</t>

<t>
This document presents a Topology-Transparent Zone (TTZ) in an OSPF area
and describes extensions to OSPFv2 for supporting
the TTZ, which is scalable and resolves 
the issues above. 
A TTZ hides the internal topology of the TTZ from the outside.  It
does not directly advertise any internal information about the TTZ 
to any router outside of the TTZ.
</t>


</section>


  
<section title="Terminology">

<t>
<list style="hanging" hangIndent="4">
<t hangText="TTZ link or TTZ-internal link:">
<vspace />
A link whose ends are within a single TTZ. 
</t>

<t hangText="TTZ-internal router:">
<vspace />
A router whose links are TTZ-internal links inside a single TTZ.
</t>

<t hangText="TTZ-external router:">
<vspace />
A router outside of a TTZ that has no TTZ-internal links.
</t>

<t hangText="TTZ-external link:">
<vspace />
A link not configured to be within a TTZ.
</t>

<t hangText="TTZ edge router:">
<vspace />
A router is called a TTZ edge router if some, but not all, of its links are within a single TTZ. 
</t>

<t hangText="TTZ router:">
<vspace />
A TTZ-internal router or a TTZ edge router.
</t></list></t>
</section>


<section title="Conventions Used in This Document">
<t>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <xref target="RFC2119"/>.
</t>
</section>  


<section title="Requirements">
<t>
A Topology-Transparent Zone may be deployed to resolve some 
critical issues in existing networks and 
future networks.
The requirements for a TTZ are listed as follows:

<list style="symbols">
  <t>Routers outside a TTZ MUST NOT require any changes to operate with the TTZ.</t>
  <t>A TTZ MUST be enclosed in a single area.</t>
  <t>A TTZ MUST hide the topology of the TTZ from any router outside of the TTZ.</t>
</list>
</t>
</section>


<section title="Topology-Transparent Zone">

<section title="Overview of Topology-Transparent Zone" anchor="overview_top-trans_zone">
<t>
A Topology-Transparent Zone is identified by a TTZ identifier (ID), and it consists of a group of routers and a number of links connecting the routers.
A TTZ MUST be contained within an OSPF area.
</t>

<t>
A TTZ ID is a 32-bit number that is unique for identifying a TTZ. 
The TTZ ID SHOULD NOT be 0 in order 
to avoid confusion with Area 0.
The same TTZ ID MUST be configured on the routers and/or links that make up a specific instance of a TTZ.  All TTZ instances in an OSPF area MUST be unique.
</t>

<t>
In addition to having similar functions of an OSPF area, 
an OSPF TTZ makes some improvements on an OSPF area, 
which include: 

<list style="symbols">
  <t>
   An OSPF TTZ represents a set of TTZ edge routers, connected by a    
      full mesh of virtual connections between them.
  </t>

  <t>
   Non-TTZ link-state information is handled as normal. TTZ routers receive the link-state information about the topology outside of the TTZ, store the information, and flood the information through the TTZ to the routers outside of the TTZ.
  </t>
</list>
</t>
</section>

<section title="TTZ Example">

<t>
The figure below shows an area containing a TTZ: TTZ 600.
<figure> 
  <artwork> <![CDATA[ 
              TTZ 600                       ---- TTZ-Internal Link
                \                           ==== Normal Link
  Area X         \ ^~^~^~^~^~^~^~^~^~^~^~^~
                  (                        )
 ===[R15]========(==[T61]----[T81]---[T63]==)======[R29]===
     ||         (   |    \          /    |   )       ||
     ||         (   |     \        /     |   )       ||
     ||         ( [T75]    \      /      |   )       ||
     ||         (   |    ___\    /       |   )       ||
     ||         (   |   /   [T71]     [T79]  )       ||
     ||         (   | [T73] /    \       |   )       ||
     ||         (   |      /      \      |   )       ||
     ||         (   |     /        \     |   )       ||
     ||         (   |    /          \    |   )       ||
 ===[R17]========(==[T65]---[T77]----[T67]==)======[R31]===
      \\          (//                    \\)       //
       ||         //v~v~v~v~v~v~v~v~v~v~v~\\      ||
       ||        //                        \\     ||
       ||       //                          \\    ||
        \\     //                            \\  //
    ======[R23]==============================[R25]=====
          //                                     \\
         //                                       \\
  ]]>
  </artwork>
</figure>

All the routers in the figure are in area X.
Routers with T (i.e., T61, T63, T65, T67, T71, T73, T75, T77, T79, and T81) 
are also in TTZ 600,
which contains the TTZ-internal links connecting them.
To create a TTZ, we need to configure it (refer to <xref target="operations"/>).
</t>

<t>
There are two types of routers in a TTZ:
TTZ-internal and TTZ edge routers.
TTZ 600 has four TTZ edge routers: T61, T63, T65, and T67. 
Each of them has at least one adjacent router in TTZ 600 and
one adjacent router outside of TTZ 600.
For instance, router T61 is a TTZ edge router 
since it has an adjacent router, R15, outside of TTZ 600 and
three adjacent routers T71, T75, and T81 in TTZ 600.
</t>

<t> 
In addition, TTZ 600 comprises six TTZ-internal routers: 
T71, T73, T75, T77, T79, and T81. 
Each of them has all its adjacent routers in TTZ 600.
 
For instance, router T71 is a TTZ-internal router 
since its adjacent routers, T61, T63, T65, T67, and T73, are all in TTZ 600.

It should be noted that, by definition, a TTZ-internal router cannot 
also be an ABR.
</t>

<t>
A TTZ hides the internal topology of the TTZ from the outside. 
It does not directly advertise  
any internal information about the TTZ to any router 
outside of the TTZ.
</t>

<t> 
For instance, TTZ 600 does not send 
the information about TTZ-internal router T71 to any router 
outside of TTZ 600; 
it does not send the information about the link between 
TTZ routers T61 and T71 to any router outside of TTZ 600.
</t>

<t>
The figure below illustrates area X from the point of view 
of a router outside of TTZ 600 after TTZ 600 is created.

<figure>
  <artwork> <![CDATA[ 
  Area X                                    ==== Normal Link
                                            
 ===[R15]===========[T61]=========[T63]=========[R29]===
     ||             ||  \\      //   ||           ||
     ||             ||   \\    //    ||           ||
     ||             ||    \\  //     ||           ||
     ||             ||     \\//      ||           ||
     ||             ||      //\      ||           ||
     ||             ||     // \\     ||           ||
     ||             ||    //   \\    ||           ||
     ||             ||   //     \\   ||           ||
     ||             ||  //       \\  ||           ||
 ===[R17]===========[T65]=========[T67]=========[R31]===
      \\           //                  \\        //
       ||         //                    \\      ||
       ||        //                      \\     ||
       ||       //                        \\    ||
        \\     //                          \\  //
    ======[R23]============================[R25]=====
          //                                   \\
         //                                     \\
  ]]>
  </artwork>
</figure>
From a router outside of the TTZ,
a TTZ is seen as the TTZ edge routers connected to each other. 
For instance, router R15 sees that T61, T63, T65, and T67
are connected to each other. 
</t>

<t>
In addition, a router outside of the TTZ
sees TTZ edge routers having normal connections
to the routers outside of the TTZ.

For example, router R15 sees that 
T61, T63, T65, and T67 have the normal connections
to R15; R29; R17 and R23; and R25 and R31, respectively.
</t>

</section>

</section>




<section title="Extensions to OSPF Protocols" anchor="extensions_to_ospf_protocols">

<t>
The link-state information about a TTZ includes router Link-State Advertisements (LSAs), 
which can be contained and advertised  
in opaque LSAs <xref target="RFC5250"/> within the TTZ. 
Some control information regarding a TTZ can also be 
contained and advertised in opaque LSAs within the TTZ. 
These opaque LSAs are called TTZ opaque LSAs 
or TTZ LSAs for short.
</t> 

<section title="General Format of TTZ LSA">
<t>
The following is the general format of a TTZ LSA.  It has a Link-State (LS) Type
   = 10/9 and TTZ LSA Type, and it contains a number of TLVs.

<figure>
  <artwork> <![CDATA[ 
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            LS age             |     Options   | LS Type = 10/9|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |TTZ LSA Type(9)|                   Instance ID                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Advertising Router                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      LS Sequence Number                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         LS checksum           |           Length              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                              TLVs                             ~  
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    
  ]]>
  </artwork>
</figure>

</t>

<t>
There are three TTZ LSAs of LS Type 10 defined:

<list style="symbols">

<t>
TTZ router LSA: a TTZ LSA containing a TTZ ID TLV and a TTZ Router TLV.
</t>

<t>
TTZ control LSA: a TTZ LSA containing a TTZ ID TLV and a TTZ Options TLV.
</t>

<t>
TTZ indication LSA: a TTZ LSA containing a TTZ ID TLV with E = 0, which indicates that the router originating this LSA is a TTZ-internal router. 
</t>
</list>
</t>


<t>
There is one TTZ LSA of LS Type 9:

<list style="symbols">
<t>
TTZ discovery LSA: a TTZ LSA containing a TTZ ID TLV and an optional TTZ Options TLV.
</t>
</list>
</t>

</section>


<section title="TTZ ID TLV">

<t>
A TTZ ID TLV has the following format. It contains a TTZ ID
(refer to <xref target="overview_top-trans_zone"/>)
and some flags. It has the TLV-Length of 8 octets.

<figure>
  <artwork> <![CDATA[ 
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      TTZ ID TLV Type (1)      |        TLV-Length (8)         | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
   |                            TTZ ID                             |  
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Reserved (MUST be zero)                   |E|Z| 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
  
   E = 1: Indicating a router is a TTZ edge router
   Z = 1: Indicating a router has migrated to TTZ 
  ]]>
  </artwork>
</figure>

When a TTZ router originates a TTZ LSA containing a TTZ ID TLV, 
it MUST set flag E to 1 in the TTZ ID TLV if it is a TTZ edge router
and to 0 if it is a TTZ-internal router.
It MUST set flag Z to 1 after it has migrated to TTZ 
and to 0 before it migrates to TTZ or after it rolls back from TTZ
(refer to <xref target="ttz_options_tlv"/>). 
</t>
</section>


<section title="TTZ Router TLV">

<t>
The format of a TTZ Router TLV is as follows. It has the same content as a standard OSPF router LSA (RFC 2328) with the following modifications.

<figure>
  <artwork> <![CDATA[ 
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      TTZ RT TLV Type (2)      |          TLV-Length           | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |     0   |V|E|B|        0      |            # links            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Link ID                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Link Data                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     # TOS     |            metric             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                              ...                              ~ 

   Note: TOS = Type of Service

  ]]>
  </artwork>
</figure>
</t>
<t>
For a router link, the existing 8-bit Link Type field 
for a router link is split into two fields as follows:
</t>

<figure>
  <artwork> <![CDATA[ 
      0   1   2   3   4   5   6   7  
    +---+---+---+---+---+---+---+---+
    | I |         Type-1            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 
    I bit flag: 
      1: Router link is a TTZ-internal link.
      0: Router link is a TTZ-external link.
    Type-1: The kind of the link.  The values for Type-1 are the same 
            as those for Type defined in RFC 2328, Section 12.4.1.
  ]]>
  </artwork>
</figure>

<t>
The Link Type field is 8 bits and the values 128-255 of the field are
reserved (refer to <xref target="RFC4940"/>), which allows the reuse of the bottom 7
bits to indicate the type of TTZ-internal or external link.
</t>

</section>


<section title="TTZ Options TLV" anchor="ttz_options_tlv">

<t>
The format of a TTZ Options TLV is as follows.

<figure>
  <artwork> <![CDATA[ 
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      TTZ OP TLV Type (3)      |          TLV-Length           | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  
   |  OP |                 Reserved (MUST be zero)                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   
    OP Value    Meaning (Operation)
    0x001 (T):  Advertising TTZ Topology Information for Migration
    0x010 (M):  Migrating to TTZ
    0x011 (N):  Advertising Normal Topology Information for Rollback
    0x100 (R):  Rolling Back from TTZ
  ]]>
  </artwork>
</figure>

An OP field of 3 bits is defined. It may have a value of 
0x001 for T, 0x010 for M, 0x011 for N, or 0x100 for R, which indicates one of the four operations above. When any of the other values is received, it is ignored. 
</t>

<t>
<list style="hanging" hangIndent="4">
<t hangText="Advertising TTZ Topology Information for Migration (T):">
 <vspace />
 After a user configures a TTZ router to advertise TTZ topology information,
advertising TTZ topology information for migration is triggered.
The TTZ router originates a TTZ control LSA having a TTZ Options TLV
with OP for T. It also originates its other TTZ LSA such as a TTZ router LSA or TTZ indication LSA.
When another TTZ router receives the LSA with OP for T,
it originates its TTZ LSA as described in <xref target="constructing_lsas_for_ttz"/>.
</t>

<t hangText="Migrating to TTZ (M):">
 <vspace />
After a user configures a TTZ router to migrate to TTZ,
migrating to TTZ is triggered.
The TTZ router originates a TTZ control LSA having a TTZ Options TLV
with OP for M and migrates to TTZ.
When another TTZ router receives the LSA with OP for M,
it also migrates to TTZ. 
When a router migrates to TTZ, it computes routes using the TTZ topology
and the topology outside of the TTZ.
For a TTZ-internal router, it also updates its TTZ indication LSA with Z = 1.
For a TTZ edge router, it updates its TTZ router LSA with Z = 1 and its router LSA for virtualizing the TTZ. A TTZ router determines whether it is internal or edge based on
configurations (refer to <xref target="configuring_ttz"/>).
</t>

<t hangText="Advertising Normal Topology Information for Rollback (N):">
 <vspace />
After a user configures a TTZ router to advertise normal topology information,
advertising Normal topology information for rollback is triggered.
The TTZ router originates a TTZ control LSA having a TTZ Options TLV
with OP for N.
It also advertises its normal LSAs such as its normal router LSA
and stops advertising its other TTZ LSAs.
When another TTZ router receives the LSA with OP for N,
it forwards the LSA,
advertises its normal LSAs, and stops advertising its TTZ LSAs.
</t>

<t hangText="Rolling back from TTZ (R):">
<vspace />
After a user configures a TTZ router to roll back from TTZ, 
rolling back from TTZ is triggered.
The TTZ router originates a TTZ control LSA having a TTZ Options TLV
with OP for R
and rolls back from TTZ. When another TTZ router receives the LSA with OP for R,
it also rolls back from TTZ. 
</t></list></t>

<t>
After a TTZ router originates a TTZ control LSA in response to
a configuration described above to control TTZ,
it flushes the TTZ control LSA if OP in the LSA is set for the configuration and the configuration is removed. 
</t>

</section>


<section title="Link Scope TTZ LSA">
<t>
A TTZ LSA of LS Type 9 has the following format.

<figure>
  <artwork> <![CDATA[ 
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            LS age             |     Options   | LS Type = 9   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |TTZ LSA Type(9)|                   Instance ID                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Advertising Router                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      LS Sequence Number                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         LS checksum           |           Length              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                           TTZ ID TLV                          ~ 
   +---------------------------------------------------------------+
   |                                                               |
   ~                        (TTZ Options TLV)                      ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    
  ]]>
  </artwork>
</figure>

It contains a mandatory TTZ ID TLV, 
which may be followed by an optional TTZ Options TLV. 
It is used to discover a TTZ neighbor.
</t>

</section>
</section>



<section title="Constructing LSAs for TTZ" anchor="constructing_lsas_for_ttz">

<t>
For a TTZ, its topology is represented by the LSAs generated 
by its TTZ routers for the link states in the TTZ, which include 
TTZ router LSAs by TTZ edge routers, 
TTZ indication LSAs by TTZ-internal routers, 
normal router LSAs, and network LSAs.
The TTZ router LSAs and TTZ indication LSAs MUST be generated 
after advertising TTZ topology information for migration is triggered.
</t>

<t>
A TTZ edge router generates a TTZ router LSA that has a TTZ ID TLV and
   a TTZ Router TLV.  The former includes the ID of the TTZ to which the
   router belongs and flag E is set to 1, which indicates the originator of
   the LSA is a TTZ edge router.  
The TTZ Router TLV contains  
the TTZ-external links to the routers outside of the TTZ and
the TTZ-internal links to the routers inside of the TTZ 
as described in <xref target="extensions_to_ospf_protocols"/>. The TTZ router LSA containing this TLV is constructed and 
advertised within the TTZ. 
</t>

<t>
A TTZ-internal router generates a TTZ indication LSA that has a TTZ ID TLV
   containing the ID of the TTZ to which the router belongs and flag E is
   set to 0, which indicates the originator of the LSA is a TTZ-internal
   router. For a TTZ-internal router, its regular router LSA is 
still generated. If a TTZ router is a Designated Router (DR), 
it originates its regular network LSA. 
</t>

<t>
After receiving a trigger to migrate to TTZ such as 
a TTZ control LSA with OP for M,  
a TTZ edge router MUST originate  
its normal router LSA for virtualizing a TTZ, which 
comprises three groups of links in general.
</t>

<t>
The first group is the router links connecting the
TTZ-external routers.
These router links are normal router links.
There is a router link for every adjacency between 
this TTZ edge router and a TTZ-external router.
</t>

<t>
The second group is the "virtual" router links 
connecting to the other TTZ edge routers.
For each of the other TTZ edge routers, 
there is a corresponding point-to-point (P2P) router link to it from this TTZ edge router.

The cost of the link is the cost of the shortest path from this TTZ edge router to the other TTZ edge router within the TTZ.
</t>

<t>
In addition, the LSA may contain a third group of links,
which are the stub links for the loopback addresses inside the TTZ
to be accessed by nodes outside of the TTZ.
</t>


<section title="TTZ Migration Process">
<t>
After migration to TTZ is triggered, 
a TTZ router computes routes using its TTZ topology (refer to <xref target="computation_of_routing_table"/>),
and a TTZ edge router originates its normal router LSA for virtualizing the TTZ in two steps: 

<list style="hanging">
    <t hangText="Step 1:">The router updates its router LSA by adding a P2P link
     to each of the other known edge routers in the TTZ and also by adding the
     stub links for the loopback addresses in the TTZ to be accessed outside of the TTZ according to configuration policies of operators.
</t>

    <t hangText="Step 2:">
After MaxLSAGenAdvTime (0.3 s) or sr-time + MaxLSAAdvTime (0.1 s),  
it removes the TTZ links from its router LSA,
     where sr&nbhy;time is the time from updating its router LSA to receiving the ack 
for its router LSA and receiving the updated router LSAs originated by the 
other TTZ edge routers. 
In other words, it removes the
   TTZ links from its router LSA after
   sending its updated router LSA and receiving the updated router LSAs
   originated by the other TTZ edge routers for MaxLSAAdvTime or after
   sending its updated router LSA for MaxLSAGenAdvTime.
MaxLSAAdvTime and MaxLSAGenAdvTime SHOULD be set to 100 ms and 300 ms, respectively,
but MAY be configurable.
The former is the maximum time for an LSA to be advertised 
to all the routers in an area.
The latter is the maximum time for all TTZ router LSAs to be
generated by all TTZ edge routers and advertised to all the routers
in an area after a first TTZ router LSA is generated.
</t>
</list>

This is to avoid a possible route down or change in a TTZ-external router while the TTZ is being virtualized. 
If each TTZ edge router originates its router LSA by adding its P2P links to the other TTZ edge routers and removing its TTZ links in one step, 
a route taking a path through the TTZ in the TTZ-external router may be down or changed before all the router LSAs generated by the TTZ edge routers reach the TTZ-external router. 
When the TTZ-external router computes routes with some router LSAs originated by the TTZ edge routers, bidirectional checks for some of the P2P links will fail. 
Thus, the route taking the path through the shortest path for the P2P link failing the bidirectional check will be down or changed. 
</t>

<t>
To roll back from a TTZ smoothly 
after receiving a trigger to roll back from TTZ, 
a TTZ edge router MUST originate its normal router LSA in the above two steps
in a reverse way.
<list style="hanging">
    <t hangText="Step 1:"> 
Initially, it updates its normal router LSA by adding the normal links for the links configured as TTZ links into the LSA.</t>

    <t hangText="Step 2:"> 
It then removes the P2P links to the other edge routers of the TTZ for virtualizing the TTZ and the stub links for the loopback addresses from its updated router LSA 
after sending its updated router LSA and 
receiving the updated router LSAs originated by the other TTZ edge routers
for MaxLSAAdvTime 
or after sending its updated router LSA for MaxLSAGenAdvTime.
</t>
</list>
</t>

</section>
</section>


<section title="Establishing Adjacencies" anchor="establishing_adjacencies">

<t>
This section describes the TTZ adjacencies.
</t>

<section title="Discovery of TTZ Neighbors">
<t>
When two routers A and B are connected by a P2P link and 
have a normal adjacency, 
they TTZ discover each other through  
a TTZ LSA of LS Type 9 with a TTZ ID TLV.
We call this LSA D-LSA for short.
</t>

<t>
If two ends of the link have different TTZ IDs or 
only one end is configured with a TTZ ID,
TTZ adjacency over the link MUST NOT be "formed".
</t>

<t>
If two ends of the link have the same TTZ ID and Z flag value, 
A and B are TTZ neighbors. 
The following is a sequence of events related to TTZ for this case.
<figure>
  <artwork> <![CDATA[ 
        A                                         B
   Configure TTZ                             Configure TTZ
                       D-LSA (TTZ ID=100)
                     ----------------------> Same TTZ ID and Z
                                             A is B's TTZ Neighbor
                       D-LSA (TTZ ID=100)
   Same TTZ ID and Z <----------------------
   B is A's TTZ Neighbor
   ]]>
   </artwork>
</figure>

A sends B a D-LSA with TTZ ID after the TTZ is configured on it.
B sends A a D-LSA with TTZ ID after the TTZ is configured on it.
</t>

<t> 
When A receives the D-LSA from B and 
determines they have the same TTZ ID and Z flag value, 
B is A's TTZ neighbor. 

A also sends B all the TTZ LSAs it has and originates its TTZ LSA
when one of the following conditions is met.
 
<list style="hanging">
  <t hangText=" o"> Z = 0 and there is a TTZ LSA with OP for T.</t>
  <t hangText=" o"> Z = 1. </t>
</list> 
</t>

<t>
B is symmetric to A and acts similarly to A.
</t>


<t>
If two ends of the link have the same TTZ ID but the Z flags are different, 
a TTZ adjacency over the link MUST be "formed" in the following steps. 
Suppose that A has migrated to TTZ and B has not 
(i.e., flag Z in A's D-LSA is 1, and flag Z in B's D-LSA is 0).

<figure>
  <artwork> <![CDATA[ 
        A                                          B
   Configure TTZ                              Configure TTZ
                      D-LSA(TTZ ID=100,Z=1)
                     ----------------------> Same TTZ ID, but 
                                             different Z
                                             A is B's TTZ Neighbor
                      D-LSA(TTZ ID=100,Z=0)
   Same TTZ ID, but <----------------------
   different Z
   B is A's TTZ Neighbor
                            TTZ LSAs
                    ----------------------->
                            TTZ LSAs
                    <-----------------------
   ]]>
   </artwork>
</figure>
</t>

<t>
When A receives the D-LSA from B and 
determines they have the same TTZ ID but its Z = 1 and B's Z = 0, 
A sends B all the TTZ LSAs it has and triggers B to migrate to TTZ.
A updates and sends B its D-LSA by
   adding a TTZ Options TLV with OP for M after sending B all the TTZ LSAs.
<figure>
  <artwork> <![CDATA[ 
                      D-LSA(TTZ ID=100,OP=M)
   Add TTZ Options  -----------------------> Migrate to TTZ
   TLV with OP for M
                      D-LSA(TTZ ID=100,Z=1)  Migrated to TTZ
                    <----------------------- Set Z=1 

                      D-LSA(TTZ ID=100,Z=1)
   Remove           ----------------------->
   TTZ Options TLV
   ]]>
   </artwork>
</figure>
</t>

<t>
When B receives the D-LSA from A and 
determines they have the same TTZ ID but its Z = 0 and A's Z = 1, 
B sends A all the TTZ LSAs it has.
</t>

<t>
When B receives the D-LSA from A with OP for M, 
it starts to migrate to TTZ. 
B updates and advertises its LSAs as needed.
</t>

<t>
After receiving B's D-LSA with Z = 1, 
A updates and sends B its D-LSA by removing the TTZ Options TLV. 
It also updates and advertises its LSAs as needed.
</t>

<t>
When a number of routers connected through a broadcast link
have normal adjacencies among them,
they also TTZ discover each other through D-LSAs.
The Designated Router (DR) for the link MUST "form" TTZ 
adjacencies with the other routers
if all the routers attached to the link have the same TTZ ID configured
on the connections to the link.
Otherwise, the DR MUST NOT "form" any TTZ adjacency with any router 
attached to the link.
</t>

<t>
When a number of routers connected through a broadcast link
have TTZ adjacencies among them,
if a misconfigured router is introduced on the broadcast link, 
the DR for the link MUST NOT "form" any TTZ adjacency with this misconfigured router.
</t>

<t>
For routers connected via a link without any adjacency among them,
they TTZ discover 
each other through D-LSAs in the same way as described above
after they form a normal adjacency.
</t>

<t>
A TTZ adjacency over a link MUST be removed when one of the following events happens.
<list style="symbols">
  <t>TTZ ID on one end of the link is changed to a different one.</t>
  <t>TTZ ID on one end of the link is removed.</t>
  <t>The D-LSA is not received after the D-LSA-MAX-RETRANSMIT-TIME 
or is explicitly flushed. 
The D-LSA-MAX-RETRANSMIT-TIME SHOULD be set to 60 minutes, 
but MAY be configurable.</t>
  
  <t>Normal adjacency over the link is down.</t>
</list> 
When the TTZ ID on one end of the link is removed, the corresponding D-LSA is flushed.
</t>
</section>

<section title="Adjacency between TTZ Edge and TTZ-External Router">
<t> 
A TTZ edge router forms an adjacency with any TTZ-external router to which it is connected.
</t>

<t>
When the TTZ edge router synchronizes its link-state
database with the TTZ-external router, 
it sends the TTZ-external router
the information about all the LSAs except for the
LSAs belonging to the TTZ that are hidden from any router outside of the
TTZ.
</t>

<t>
At the end of the link-state database synchronization,
the TTZ edge router originates its own router LSA for virtualizing the TTZ
and 
sends this LSA to its adjacent routers, including the TTZ-external router.
</t>


</section>
</section>

<section title="Advertisement of LSAs">
<t>
LSAs can be divided into a couple of classes according to their 
Advertisements. 
The first class of LSAs is advertised within a TTZ.
The second is advertised through a TTZ.
</t>
 
<section title="Advertisement of LSAs within TTZ">

<t> 
Any LSA about a link state in a TTZ is advertised only within the TTZ.
It is not advertised to any router outside of the TTZ.

For example, 
a router LSA generated for a TTZ-internal router is advertised 
only within the TTZ.
</t>

<t>
Any network LSA generated for a broadcast or Non-Broadcast Multi-Access (NBMA) network in a TTZ
is advertised only within the TTZ. 
It is not advertised outside of the TTZ.
</t>

<t>
Any opaque LSA generated for a TTZ-internal TE link
is advertised only within the TTZ.
</t> 

<t>
After migrating to TTZ, every edge router of a TTZ 
MUST NOT advertise any LSA about a link state in the TTZ
to any router outside of the TTZ.

The TTZ edge router determines whether 
an LSA is about a TTZ-internal link state by checking if
the advertising router of the LSA is a TTZ-internal router
(i.e., there is a TTZ indication LSA generated 
by the TTZ-internal router that has the same advertising router).
</t>

<t>
For any TTZ LSA originated by a router within the TTZ,
every edge router of the TTZ MUST NOT advertise it 
to any router outside of the TTZ.
</t>
</section>

<section title="Advertisement of LSAs through TTZ">

<t> 
Any LSA about a link state outside of a TTZ 
received by an edge router of the TTZ 
is advertised using the TTZ as transit.
For example,
when an edge router of a TTZ receives an LSA  
from a router outside of the TTZ,
it floods it to its neighboring routers both inside 
and outside of the TTZ.
This LSA may be any LSA such as a router LSA 
that is advertised within an OSPF area.
</t>

<t>
The routers in the TTZ continue to flood the LSA.
When another edge router of the TTZ receives the LSA,
it floods the LSA to its neighboring routers both 
inside and outside of the TTZ.
</t>
</section>
</section>

<section title="Computation of Routing Table" anchor="computation_of_routing_table">
<t>
After a router migrates to TTZ, 
the computation of the routing table on the router 
is the same as that described in RFC 2328, Section 16 
with one exception.  
The router in a TTZ ignores the router LSAs 
generated by the TTZ edge routers for 
virtualizing the TTZ. 

It computes routes 
using the TTZ router LSAs and the regular LSAs,
excluding the router LSAs for virtualizing the TTZ.

That is, it computes routes using the TTZ topology 
and the topology outside of the TTZ, 
excluding the links for virtualizing the TTZ.
</t>
</section>

<section title="Operations" anchor="operations">


<section title="Configuring TTZ" anchor="configuring_ttz">
<t>
This section proposes some options for configuring a TTZ.
</t>

<t>
  1. Configuring TTZ on Every Link in TTZ
</t>

<t>
If every link in a TTZ is configured with the same TTZ ID 
as a TTZ link, the TTZ is determined.
A router with some links in a TTZ and some links not in this TTZ is 
a TTZ edge router.
A router with all its links in a TTZ is a TTZ-internal router.
</t>

<t>
  2. Configuring TTZ on Routers in TTZ
</t>

<t>
A same TTZ ID is configured on every TTZ-internal router in a TTZ
and on every TTZ edge router's links 
connecting to the routers in the TTZ.
</t>

<t>
A router configured with the TTZ ID on some of its links 
is a TTZ edge router.
A router configured with the TTZ ID only is  
a TTZ-internal router. 
All the links on a TTZ-internal router are TTZ links.

This option is simpler than option 1 above.
</t>

<t>
For a TTZ edge router X with different TTZ IDs on its different links,
router X connects two or more different TTZs.
In this case, router X originates its router LSA 
for virtualizing the TTZs. 
This LSA includes the normal links connecting to routers 
outside of these TTZs
and the virtual links to the other edge routers of 
each of these TTZs.
Router X also originates its TTZ router LSA for each of the TTZs.
The TTZ router LSA for TTZ N includes
the links to the routers outside of these TTZs, 
the virtual links to the other edge routers of the other TTZs,
and the TTZ links to the routers in TTZ N.
</t>


</section>

<section title="Migration to TTZ">

<t>
For a group of routers and a number of links connecting 
the routers in an area,
making them transfer to work as a TTZ without any service 
interruption takes a few steps or stages.
</t>

<t>
At first, a user configures the TTZ feature on every router in the TTZ.
In this stage, a router does not originate or advertise its TTZ topology information. 
It will discover its TTZ neighbors. 
</t>


<t>
Second, after configuring the TTZ, a user issues a configuration on 
one router in the TTZ, which triggers every router in the TTZ 
to generate and advertise TTZ information 
among the routers in the TTZ. 
When the router receives the configuration, 
it originates a TTZ control LSA with OP for T 
(indicating TTZ information generation and advertisement for migration).

It also originates its TTZ LSA, such as TTZ router LSA or TTZ indication LSA, 
and advertises the LSA to its TTZ neighbors.
When another router in the TTZ receives the LSA with OP for T,
it originates its TTZ LSA.
In this stage, every router in the TTZ has dual roles. 
One is to function as a normal router.
The other is to generate and advertise TTZ information. 
</t>

<t>
Third, a user checks whether 
a router in the TTZ is ready for migration to TTZ. 
A router in the TTZ is ready 
after it has received 
all the TTZ LSAs, including TTZ router LSAs
from TTZ edge routers and TTZ indication LSAs 
from TTZ-internal routers.
This information may be displayed on a router
through a configuration.
</t>

<t>
Then, a user activates the TTZ through using
a configuration such as migrate to TTZ on one router in the TTZ.
The router migrates to TTZ, 
generates and advertises a TTZ control LSA with OP for M 
(indicating Migrating to TTZ) after it receives the configuration.  
After another router in the TTZ receives the TTZ control LSA with OP for M,
it also migrates to TTZ.
Thus, 
activating the TTZ on one TTZ router 
propagates to every router in the TTZ, which migrates to TTZ.
</t>

<t>
For an edge router of the TTZ,
migrating to work as a TTZ router comprises
generating a router LSA to virtualize the TTZ 
and flooding this LSA to all its neighboring routers in two steps
as described in <xref target="constructing_lsas_for_ttz"/>.
</t>


<t>
In normal operations for migration to TTZ and rollback from TTZ, a
user issues a series of configurations according to certain procedures.  
In an abnormal case, for example, two conflicting configurations are
issued on two TTZ routers in a TTZ at the same time, and a TTZ router
issues an error and logs the error when it detects a conflict.
</t>



<t>
A conflicting configuration may be detected on a router on which the configuration is issued. Thus, some abnormal cases may be prevented.
When a configuration for migration/rollback is issued on a router, the router checks whether it is in a correct sequence of configurations for migration/rollback through using the information it has. For migrating a part of an area to a TTZ, the correct sequence of configurations is in general as follows: 

<list style="hanging">
    <t hangText="1)">configure TTZ on every router in the part of the area to be migrated to TTZ; </t>
    <t hangText="2)">configure on one router in the TTZ to trigger every router in the TTZ to generate and advertise TTZ information for migration; and </t>
    <t hangText="3)">configure on one router in the TTZ to trigger every router in the TTZ to migrate to TTZ.</t>
</list>
</t>

<t>
After receiving a configuration on a router to migrate to TTZ, which is for 3), the router determines whether 2) is performed by checking if it has received/originated TTZ LSAs. If it has not, it issues an error to an operator (generation and advertisement of TTZ information for migration to TTZ is not done yet) and rejects the configuration at this time. 
</t>

<t>
After a router receives a TTZ LSA with OP for M for 3) 
from another router, 
it determines whether 2) is performed by checking if 
it has received/originated TTZ LSAs. 
If it has not, it issues an error and logs the error, and
it does not migrate to TTZ. 
In this case, it does not originate its router LSA for virtualizing the TTZ 
if it is a TTZ edge router.
</t>

<t>
After receiving a configuration on a router to generate and advertise TTZ information, which is for 2), the router determines whether 1) is performed by checking if TTZ is configured on it. If it is not, it issues an error to an operator (TTZ is not configured on it yet) and rejects the configuration at this time. 
</t>

<t>
For rolling back from TTZ, the correct sequence of configurations is below.
<list style="hanging">
    <t hangText="1)">configure on one router in the TTZ to trigger every router in the TTZ to advertise normal LSAs and stop advertising TTZ LSAs; and</t>

    <t hangText="2)">configure on one router in the TTZ to trigger every router in the TTZ to roll back from TTZ.</t>
</list>
</t>

<t>
After receiving a configuration on a router to roll back from TTZ,
which is for 2), the router determines whether 1) is performed by checking if it has received TTZ LSA with OP for N. If it has not, it issues an error to an operator (advertise normal LSAs and stop advertising TTZ LSAs as rolling back from TTZ is not done yet) and 
rejects the configuration at this time. 
</t>

<t>
After a router receives a TTZ LSA with OP for R for 2) 
from another router, 
it determines whether 1) is performed by checking if 
it has received TTZ LSA with OP for N. 
If it has not, it issues an error and logs the error, and
it does not roll back from TTZ. 
</t>

<t>
After receiving a configuration on a router 
to advertise normal LSAs and stop advertising TTZ LSAs for rolling back from TTZ, which is for 1), 
the router checks whether it has any TTZ LSAs. If it does not, it issues an error to an operator (no TTZ to be rolled back) and rejects the configuration at this time. 
</t>


</section>


<section title="Adding a Router into TTZ">
<t>
When a non-TTZ router (say R1) is connected via a P2P link to a migrated TTZ
router (say T1), and there is a normal adjacency between them over the link,
a user can configure TTZ on both ends of the link to add R1 into the TTZ to
which T1 belongs. They TTZ discover each other as described in <xref target="establishing_adjacencies"/>.
</t>

<t>
When a number of non-TTZ routers are connected via a broadcast or NBMA link to a
migrated TTZ router (say T1), and there are normal adjacencies among them, a
user configures TTZ on the connection to the link on every router to add the
non-TTZ routers into the TTZ to which T1 belongs. The DR for the link "forms"
TTZ adjacencies with the other routers connected to the link if they all have
the same TTZ ID configured for the link. This is determined through the
TTZ discovery process described in <xref target="establishing_adjacencies"/>.
</t>


</section>

</section>



<section title="Manageability Considerations">
    <t><xref target="operations"/> ("Operations") outlines the configuration process and deployment scenarios for a TTZ. 

The configurable item is enabling a TTZ on a router and/or an interface on a
   router. The TTZ function may be controlled by a policy module and assigned a suitable user privilege level to enable.

    A suitable model may be required to verify the TTZ status on routers participating in the TTZ, including their role as an internal or edge TTZ router.

   The mechanisms defined in this document do not imply any new liveness
   detection and monitoring requirements in addition to those indicated in <xref target="RFC2328"/>.
</t>

</section>


<section title="Security Considerations">
<t>
A notable beneficial security aspect of TTZ is that the TTZ is enclosed in a single area, and TTZ could be used to mask the internal topology. External routers that are not participating in the TTZ will not be aware of the internal TTZ topology.  

It should be noted that a malicious node could inject TTZ LSAs with the OP field set to M or R, which could trigger the migration into/from a TTZ and may result in the isolation of some routers in the network. Good security practice might reuse the OSPF authentication and other security mechanisms described in <xref target="RFC2328"/> and <xref target="RFC7474"/> to mitigate this type of risk.
</t>
</section>




<section anchor="IANA" title="IANA Considerations">

<t>
Under the registry name "Opaque Link-State Advertisements (LSA) Option Types"
<xref target="RFC5250"/>, IANA has assigned a new Opaque Type registry value for 
TTZ LSA as follows:
<figure>
  <artwork> 
  +====================+===============+=======================+
  |  Registry Value    |  Opaque Type  |    reference          |
  +====================+===============+=======================+
  |         9          |    TTZ LSA    |    This document      |
  +--------------------+---------------+-----------------------+
  </artwork>
</figure>
</t> 


<t>
IANA has created and will maintain a new registry: 
<list style="hanging">
  <t hangText=" o"> OSPFv2 TTZ LSA TLVs</t>
</list>

Initial values for the registry are given below. 
The future assignments are to be made through IETF Review <xref target="RFC5226"/>.
<figure>
 <artwork> 
    Value         OSPFv2 TTZ LSA TLV Name    Definition
    -----         -----------------------    ----------
    0             Reserved
    1             TTZ ID TLV                 see Section 6.2
    2             TTZ Router TLV             see Section 6.3
    3             TTZ Options TLV            see Section 6.4
    4-32767       Unassigned
    32768-65535   Reserved
 </artwork>
</figure>


</t>
</section>

</middle>
<back>

<references title="Normative References">

   <?rfc include="reference.RFC.2119" ?>
   <?rfc include="reference.RFC.2328" ?>  
   <?rfc include="reference.RFC.5250" ?> 
   <?rfc include="reference.RFC.7474" ?> 
   <?rfc include="reference.RFC.4940" ?> 

</references>


<references title="Informative References">

   <?rfc include="reference.RFC.5226"?>

</references>

<section title="Prototype Implementation">

<section title="What Is Implemented and Tested">
<t>
  1. Command-Line Interface (CLI) Commands for TTZ 
</t>

<t>
The CLIs implemented and tested include:

<list style="hanging">
  <t hangText=" o">
    the CLIs of the simpler option for configuring TTZ, and
  </t>
  <t hangText=" o">
    the CLIs for controlling migration to TTZ.
  </t>
</list>

</t>

<t>
  2. Extensions to OSPF Protocols for TTZ
</t>

<t>
All the extensions defined in "Extensions to OSPF Protocols" (<xref target="extensions_to_ospf_protocols"/>)
are implemented and tested
except for rolling back from TTZ.

The testing results illustrate:

<list style="hanging">
  <t hangText=" o">

As seen from the outside, a TTZ is virtualized as its edge routers 
connected to each other.  Any router outside of the TTZ sees the edge 
routers (as normal routers) connecting to each other and to some other 
routers.
  </t>
  <t hangText=" o"> 
The link-state information about the routers and links inside the TTZ is 
contained within the TTZ. 
It is not advertised to any router outside of the TTZ.
  </t>
  <t hangText=" o"> 
TTZ is transparent. 
From a router inside a TTZ, it sees the topology (link state) 
outside of the TTZ.
From a router outside of the TTZ, it sees the topology beyond the TTZ.
The link-state information outside of the TTZ is advertised through 
the TTZ.
  </t>
  <t hangText=" o"> 
TTZ is backward compatible. 
Any router outside of a TTZ does not need to support or know TTZ.
  </t>
</list>
</t>


<t>
  3. Smooth Migration to TTZ
</t>

<t>
The procedures and related protocol extensions for smooth migration to TTZ 
are implemented and tested.
The testing results show:

<list style="hanging">
  <t hangText=" o"> 
A part of an OSPF area is smoothly migrated to a TTZ 
without any routing disruptions. 
The routes on every router are stable 
while the part of the area is being migrated to the TTZ.
  </t>
  <t hangText=" o"> 
Migration to TTZ is very easy to operate.
  </t>
</list>
</t>


<t>
  4. Add a Router to TTZ
</t>
<t>
Adding a router into TTZ is implemented and tested.

The testing results illustrate:

<list style="hanging">
  <t hangText=" o"> 
A router can be easily added into a TTZ to become a TTZ router.
  </t>
  <t hangText=" o"> 
The router added into the TTZ is not seen on any router outside of the TTZ, but it is a part of the TTZ. 
  </t>
</list>

</t>


<t>
  5. Leak TTZ Loopbacks Outside
</t>

<t>
Leaking loopback addresses in a TTZ to routers outside of the TTZ is 
implemented and tested.
The testing results illustrate:

<list style="hanging">
  <t hangText=" o"> 
The loopback addresses inside the TTZ are advertised to the
routers outside of the TTZ.
  </t>
  <t hangText=" o"> 
The loopback addresses are accessible from 
a router outside of the TTZ. 
  </t>
</list>
</t>

</section>

<section title="Implementation Experience">

<t>
The implementation of TTZ
reuses the existing OSPF code along with additional simple logic.

A couple of engineers started to work on implementing the TTZ 
from the middle of June 2014 and finished coding it just before the end of July 2014.
After some testing and bug fixes, it works as expected.
</t>

<t>
In our implementation, the link-state information in a TTZ opaque LSA 
is stored in the same link-state database as the link-state information 
in a normal LSA. 
For each TTZ link in the TTZ opaque LSA, there is an additional flag, 
which is used to differentiate between a TTZ link and a normal link.
</t>

<t>
Before migration to TTZ, every router in the TTZ computes its routing table 
using the normal links. 
After migration to TTZ, every router in the TTZ computes its routing table 
using the TTZ links and normal links. 

In the case where both the TTZ link and the normal link exist, the TTZ link is used.
</t>

</section>
</section>

<section title="Acknowledgements" numbered="no">
<t>
  The authors would like to thank 
  Acee Lindem, Abhay Roy, Christian Hopps, Dean Cheng, 
  Russ White, Tony Przygienda, Wenhu Lu,
  Lin Han, Kiran Makhijani, Padmadevi Pillay Esnault,
  and Yang Yu for their valuable comments on this specification.
</t> 
</section>

<section title="Contributors" numbered="no">

<t>
The following people contributed significantly to the content of 
this document and should be considered co-authors:
<figure>
<artwork> <![CDATA[
     Mehmet Toy
     United States of America
     Email: mehmet.toy@verizon.com      

     Gregory Cauchie
     France
     Email: greg.cauchie@gmail.com      
 
     Anil Kumar SN
     India
     Email: anil.sn@huawei.com

     Ning So
     United States of America
     Email: ningso01@gmail.com

     Lei Liu
     United States of America
     Email: lliu@us.fujitsu.com
]]>
</artwork> 
</figure>
</t>

<t>
We also acknowledge the contribution of the following individuals:
<figure>
<artwork> <![CDATA[
     Veerendranatha Reddy Vallem
     India
     Email: veerendranatharv@huawei.com


     William McCall
     United States of America
     will.mccall@rightside.co
]]>
</artwork> 
</figure>
</t>
</section>

</back>
</rfc>

