<?xml version="1.0" encoding="US-ASCII"?>
<?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<?rfc text-list-symbols="-*+o"?> 

<rfc category="std" number="8415"
     ipr="pre5378Trust200902"
     obsoletes="3315, 3633, 3736, 4242, 7083, 7283, 7550"
     submissionType="IETF" consensus="yes">

  <front>
    <title abbrev="DHCP for IPv6">Dynamic Host Configuration Protocol for IPv6
    (DHCPv6)</title>

    <author fullname="Tomek Mrugalski" initials="T."
            surname="Mrugalski">
      <organization abbrev="ISC">Internet Systems Consortium,
      Inc.</organization>

      <address>
        <postal>
          <street>950 Charter Street</street>

          <city>Redwood City</city>

          <region>CA</region>

          <code>94063</code>

          <country>United States of America</country>
        </postal>

        <email>tomasz.mrugalski@gmail.com</email>
      </address>
    </author>

    <author fullname="Marcin Siodelski" initials="M" surname="Siodelski">
      <organization abbrev="ISC">Internet Systems Consortium,
      Inc.</organization>

      <address>
        <postal>
          <street>950 Charter Street</street>

          <city>Redwood City</city>

          <region>CA</region>

          <code>94063</code>

          <country>United States of America</country>
        </postal>

        <email>msiodelski@gmail.com</email>
      </address>
    </author>

    <author fullname="Bernie Volz" initials="B" surname="Volz">
      <organization abbrev="Cisco">Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>1414 Massachusetts Ave.</street>

          <city>Boxborough</city>

          <region>MA</region>

          <code>01719</code>

          <country>United States of America</country>
        </postal>

        <email>volz@cisco.com</email>
      </address>
    </author>

    <author fullname="Andrew Yourtchenko" initials="A" surname="Yourtchenko">
      <organization abbrev="Cisco">Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>De kleetlaan 6a</street>

          <city>Diegem</city>

          <code>BRABANT 1831</code>

          <country>Belgium</country>
        </postal>

        <email>ayourtch@cisco.com</email>
      </address>
    </author>

    <author fullname="Michael C. Richardson" initials="M."
            surname="Richardson">
      <organization abbrev="SSW">Sandelman Software Works</organization>

      <address>
        <postal>
          <street>470 Dawson Avenue</street>

          <city>Ottawa</city>

          <region>ON</region>

          <code>K1Z 5V7</code>

          <country>Canada</country>
        </postal>

        <email>mcr+ietf@sandelman.ca</email>

        <uri>http://www.sandelman.ca/</uri>
      </address>
    </author>

    <author fullname="Sheng Jiang" initials="S." surname="Jiang">
      <organization abbrev="Huawei">Huawei Technologies Co.,
      Ltd</organization>

      <address>
        <postal>
          <street>Q14, Huawei Campus, No. 156 Beiqing Road</street>

          <city>Hai-Dian District, Beijing</city>
          <code>100095</code>
          <country>China</country>
        </postal>

        <email>jiangsheng@huawei.com</email>
      </address>
    </author>

    <author fullname="Ted Lemon" initials="T" surname="Lemon">
      <organization abbrev="Nibbhaya Consulting">Nibbhaya Consulting</organization>

      <address>
        <postal>
          <street>P.O. Box 958</street>

          <city>Brattleboro</city>

          <region>VT</region>

          <code>05301-0958</code>

          <country>United States of America</country>
        </postal>

        <email>mellon@fugue.com</email>
      </address>
    </author>

    <author fullname="Timothy Winters" initials="T" surname="Winters">
      <organization abbrev="UNH-IOL">University of New Hampshire, Interoperability Lab (UNH-IOL)</organization>

      <address>
        <postal>

          <street/>

          <city>Durham, NH</city>

          <region></region>

          <code></code>

          <country>United States of America</country>
        </postal>

        <email>twinters@iol.unh.edu</email>
      </address>
    </author>

    <date month="November" year="2018"/>

    <keyword>DHCPv6</keyword>
    <keyword>IPv6</keyword>
    <keyword>DHCP</keyword>

    <abstract>
      <t>This document describes the Dynamic Host Configuration Protocol for
      IPv6 (DHCPv6): an extensible mechanism for configuring nodes with
      network configuration parameters, IP addresses, and prefixes. Parameters
      can be provided statelessly, or in combination with stateful assignment
      of one or more IPv6 addresses and/or IPv6 prefixes. DHCPv6 can operate
      either in place of or in addition to stateless address autoconfiguration
      (SLAAC).</t>

      <t>This document updates the text from RFC 3315 (the original DHCPv6
      specification) and incorporates prefix delegation (RFC 3633),
      stateless DHCPv6 (RFC 3736), an option to specify an upper
      bound for how long a client should wait before refreshing information
      (RFC 4242), a mechanism for throttling DHCPv6 clients when DHCPv6
      service is not available (RFC 7083), and relay agent handling of
      unknown messages (RFC 7283). In addition, this document clarifies the
      interactions between models of operation (RFC 7550).
      As such, this document obsoletes RFC 3315, RFC 3633, RFC 3736, RFC 4242,
      RFC 7083, RFC 7283, and RFC 7550.</t>
    </abstract>
  </front>

  <middle>
    <section anchor="intro-and-overview" title="Introduction">

      <t>This document describes DHCP for IPv6 (DHCPv6), a client/server
      protocol that provides managed configuration of devices. The basic
      operation of DHCPv6 provides configuration for clients connected to
      the same link as the server. Relay agent functionality is also
      defined for enabling communication between clients and servers that
      are not on the same link.</t>

      <t>DHCPv6 can provide a device with addresses assigned by a DHCPv6
      server and other configuration information; this data is carried in
      options. DHCPv6 can be extended through the definition of new options
      to carry configuration information not specified in this document.</t>

      <t>DHCPv6 also provides a mechanism for automated delegation of
      IPv6 prefixes using DHCPv6, as originally specified in <xref
      target="RFC3633"/>. Through this mechanism, a delegating router
      can delegate prefixes to requesting routers. Use of this mechanism is
      specified as part of <xref target="RFC7084"/> and by <xref
      target="TR-187"/>.</t>

      <t>DHCP can also be used just to provide other configuration options
      (i.e., no addresses or prefixes). That implies that the
      server does not have to track any state; thus, this mode is called
      "stateless DHCPv6". Mechanisms necessary to support stateless DHCPv6 are
      much smaller than mechanisms needed to support stateful DHCPv6.
      <xref target="RFC3736"/> was written to document just those portions of
      DHCPv6 needed to support DHCPv6 stateless operation.</t>

      <t>The remainder of this introduction summarizes the relationship to the
      previous DHCPv6 standards (see <xref target="previous-dhcp6"/>) and
      clarifies the stance with regard to DHCPv4 (see <xref target="dhcpv4"/>).
      <xref target="Client-Server-Exchanges"/> describes the message exchange
      mechanisms to illustrate DHCP operation rather than provide an exhaustive
      list of all possible interactions, and <xref target="OpModes"/>
      provides an overview of common operational models.
      <xref target="configuration-exchange"/> explains client and server
      operation in detail.</t>

      <section anchor="previous-dhcp6"
               title="Relationship to Previous DHCPv6 Standards">
        <t>The initial specification of DHCPv6 was defined in <xref
        target="RFC3315"/>, and a number of follow-up documents were
        published over the years:</t>

    <t><list style="symbols">
        <t><xref target="RFC3633"/> ("IPv6 Prefix Options for Dynamic Host
        Configuration Protocol (DHCP) version 6")</t>
        <t><xref target="RFC3736"/> ("Stateless Dynamic Host Configuration
        Protocol (DHCP) Service for IPv6")</t>
        <t><xref target="RFC4242"/> ("Information Refresh Time Option for
        Dynamic Host Configuration Protocol for IPv6 (DHCPv6)")</t>
        <t><xref target="RFC7083"/> ("Modification to Default Values of
        SOL_MAX_RT and INF_MAX_RT")</t>
        <t><xref target="RFC7283"/> ("Handling Unknown DHCPv6 Messages")</t>
        <t><xref target="RFC7550"/> ("Issues and Recommendations with Multiple
        Stateful DHCPv6 Options")</t>
      </list></t>

        <t>This document provides a unified, corrected, and cleaned-up
        definition of DHCPv6 that also covers all applicable errata filed
        against older RFCs (see the list in <xref target="ChangeSummary"/>).
        As such, it obsoletes the RFCs listed in the previous paragraph.
        Also, there are a small number of mechanisms that were obsoleted;
        see <xref target="obsolete"/> and <xref target="ChangeSummary"/>.</t>
      </section>

      <section anchor="dhcpv4" title="Relationship to DHCPv4">
        <t>The operational models and relevant configuration information for
        DHCPv4 <xref target="RFC2131"/> <xref target="RFC2132"/> and
        DHCPv6 are sufficiently different that integration between the two
        services is not included in this document. <xref
        target="RFC3315"/> suggested that future work might be to extend
        DHCPv6 to carry IPv4 address and configuration information. However,
        the current consensus of the IETF is that DHCPv4 should be used rather
        than DHCPv6 when conveying IPv4 configuration information to nodes.
        For IPv6-only networks, <xref target="RFC7341"/> describes a
        transport mechanism to carry DHCPv4 messages using the DHCPv6 protocol
        for the dynamic provisioning of IPv4 address and configuration
        information.</t>

        <t>Merging DHCPv4 and DHCPv6 configuration is out of scope for
        this document. <xref target="RFC4477"/> discusses some issues
        and possible strategies for running DHCPv4 and DHCPv6 services
        together. While <xref target="RFC4477"/> is a bit dated, it provides
        a good overview of the issues at hand.</t>
      </section>

    </section>

    <section anchor="requirements" title="Requirements">

      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
      "SHALL&nbsp;NOT", "SHOULD", "SHOULD&nbsp;NOT", "RECOMMENDED",
      "NOT&nbsp;RECOMMENDED", "MAY", and "OPTIONAL" in this document
      are to be interpreted as described in BCP&nbsp;14
      <xref target="RFC2119"/> <xref target="RFC8174"/> when,
      and only when, they appear in all capitals, as shown here.</t>

      <t>This document also makes use of internal conceptual variables to
      describe protocol behavior and external variables that an implementation
      must allow system administrators to change. The specific variable names,
      how their values change, and how their settings influence protocol
      behavior are provided to demonstrate protocol behavior. An
      implementation is not required to have them in the exact form described
      here, as long as its external behavior is consistent with that described
      in this document.</t>
    </section>

    <section anchor="background" title="Background">

      <t><xref target="RFC8200"/> ("Internet Protocol, Version 6 (IPv6)
      Specification") provides the base architecture and design of IPv6. In
      addition to <xref target="RFC8200"/>, related work in IPv6 that an
      implementer would be best served to study includes</t>

    <t><list style="symbols">
      <t><xref target="RFC4291"/> ("IP Version 6 Addressing Architecture")</t>

      <t><xref target="RFC4862"/> ("IPv6 Stateless Address Autoconfiguration")</t>
      <t><xref target="RFC4861"/> ("Neighbor Discovery for IP version 6
      (IPv6)")</t>
    </list></t>
     <t>These specifications enable DHCP to build upon the 
      IPv6 work to provide robust stateful autoconfiguration.</t>

      <t><xref target="RFC4291"/> defines the address scope that can be used
      in an IPv6 implementation and also provides various configuration
      architecture guidelines for network designers of the IPv6 address
      space. Two advantages of IPv6 are that support for multicast is required
      and nodes can create link&nbhy;local addresses during initialization. The
      availability of these features means that a client can use its
      link&nbhy;local address and a well-known multicast address to discover
      and communicate with DHCP servers or relay agents on its link.</t>

      <t><xref target="RFC4862"/> specifies procedures by which a node may
      autoconfigure addresses based on Router Advertisements <xref
      target="RFC4861"/> and the use of a valid lifetime to support
      renumbering of addresses on the Internet. Compatibility with stateless
      address autoconfiguration is a design requirement of DHCP.</t>

      <t>IPv6 Neighbor Discovery <xref target="RFC4861"/> is the
      node discovery protocol in IPv6 that replaces and enhances functions of
      ARP <xref target="RFC0826"/>. To understand IPv6 and stateless address
      autoconfiguration, it is strongly recommended that implementers
      understand IPv6 Neighbor Discovery.</t>

    </section>

    <section anchor="terminology" title="Terminology">

      <t>This section defines terminology specific to IPv6 and DHCP used in
      this document.</t>

      <section title="IPv6 Terminology">

        <t>IPv6 terminology from <xref target="RFC8200"/>, <xref
        target="RFC4291"/>, and  <xref target="RFC4862"/> relevant
        to this specification is included below.</t>

        <t><list hangIndent="26" style="hanging">
            <t hangText="address">An IP-layer identifier for an interface or a
            set of interfaces.</t>

            <t hangText="GUA">Global unicast address (see
            <xref target="RFC4291"/>).</t>

            <t hangText="host">Any node that is not a router.</t>

            <t hangText="IP">Internet Protocol Version 6 (IPv6). The terms
            "IPv4" and "IPv6" are used only in contexts where it is necessary
            to avoid ambiguity.</t>

            <t hangText="interface">A node's attachment to a link.</t>

            <t hangText="link">A communication facility or medium over which
            nodes can communicate at the link layer, i.e., the layer
            immediately below IP. Examples are Ethernet (simple or bridged);
            Point-to-Point Protocol (PPP) and PPP over Ethernet (PPPoE) links;
            and Internet&nbhy;layer (or higher) "tunnels",
            such as tunnels over IPv4 or IPv6 itself.</t>

            <t hangText="link-layer identifier">A link-layer identifier for an
            interface -- for example, IEEE 802 addresses for Ethernet or
            Token Ring network interfaces.</t>

            <t hangText="link-local address">An IPv6 address having a
            link-only scope, indicated by having the prefix (fe80::/10), that
            can be used to reach neighboring nodes attached to the same link.
            Every IPv6 interface on which DHCPv6 can reasonably be useful
            has a link-local address.</t>

            <t hangText="multicast address">An identifier for a set of
            interfaces (typically belonging to different nodes). A packet sent
            to a multicast address is delivered to all interfaces identified
            by that address.</t>

            <t hangText="neighbor">A node attached to the same link.</t>

            <t hangText="node">A device that implements IP.</t>

            <t hangText="packet">An IP header plus payload.</t>

            <t hangText="prefix">The initial bits of an address, or a set
            of&nbsp;IP addresses that share the same initial&nbsp;bits.</t>

            <t hangText="prefix length">The number of bits in a prefix.</t>

            <t hangText="router">A node that forwards IP packets not
            explicitly addressed to itself.</t>

            <t hangText="ULA">Unique local address (see
            <xref target="RFC4193"/>).</t>

            <t hangText="unicast address">An identifier for a single
            interface. A packet sent to a unicast address is delivered to the
            interface identified by that address.</t>
          </list></t>
      </section>

      <section anchor="dhcp-terminology" title="DHCP Terminology">

        <t>Terminology specific to DHCP can be found below.</t>

        <t><list hangIndent="26" style="hanging">
            <t hangText="appropriate to the link">An address is "appropriate
            to the link" when the address is consistent with the DHCP server's
            knowledge of the network topology, prefix assignment, and address
            assignment policies.</t>

            <t hangText="binding">A binding (or client binding) is a group of
            server data records containing the information the server has about
            the addresses or delegated prefixes in an Identity Association
            (IA) or configuration information explicitly assigned to the
            client. Configuration information that has been returned to a
            client through a policy, such as the information returned to all
            clients on the same link, does not require a binding. A binding
            containing information about an IA is indexed by the tuple
            &lt;DUID, IA&nbhy;type, IAID&gt; (where IA-type is the type of
            lease in the IA -- for example, temporary). A binding containing
            configuration information for a client is indexed by
            &lt;DUID&gt;. See below for definitions of DUID, IA, and IAID.</t>

            <t hangText="configuration parameter">An element of the
            configuration information set on the server and delivered to the
            client using DHCP. Such parameters may be used to carry
            information to be used by a node to configure its network
            subsystem and enable communication on a link or internetwork, for
            example.</t>

            <t hangText="container option">An option that encapsulates other
            options (for example, the IA_NA option
            (see <xref target="RFC3315-22.4"/>) may contain IA Address options
            (see <xref target="RFC3315-22.6"/>)).</t>

            <t hangText="delegating router">The router that acts as a DHCP
            server and responds to requests for delegated prefixes. This
            document primarily uses the term "DHCP server" or "server" when
            discussing the "delegating router" functionality of prefix
            delegation (see <xref target="intro-and-overview"/>).</t>

            <t hangText="DHCP">Dynamic Host Configuration Protocol for IPv6.
            The terms "DHCPv4" and "DHCPv6" are used only in contexts where it
            is necessary to avoid ambiguity.</t>

            <t hangText="DHCP client">Also referred to as "client".
            A node that initiates requests on a link to obtain
            configuration parameters from one or more DHCP servers.
            The node may act as a requesting router (see below)
            if it supports prefix delegation.</t>

            <t hangText="DHCP domain">A set of links managed by DHCP and
            operated by a single administrative entity.</t>

            <t hangText="DHCP relay agent">Also referred to as "relay agent".
            A node that acts as an intermediary to deliver DHCP messages
            between clients and servers. In certain configurations,
            there may be more than one relay agent between clients and
            servers, so a relay agent may send DHCP messages to another
            relay agent.</t>

            <t hangText="DHCP server">Also referred to as "server".
            A node that responds to requests from clients.  It may
            or may not be on the same link as the client(s).
            Depending on its capabilities, if it supports prefix delegation
            it may also feature the functionality of a delegating router.</t>

            <t hangText="DUID">A DHCP Unique Identifier for a DHCP
            participant. Each DHCP client and server has exactly one DUID. See
            <xref target="RFC3315-9"/> for details of the ways in which
            a DUID may be constructed.</t>
             
            <t hangText="encapsulated option">A DHCP option that is usually
            only contained in another option. For example, the IA Address
            option is contained in IA_NA or IA_TA options (see
            <xref target="RFC3315-22.5"/>). See Section&nbsp;9 of
            <xref target="RFC7227"/> for a more complete definition.</t>

            <t hangText="IA">Identity Association: a collection of leases
            assigned to a client. Each IA has an associated IAID (see below).
            A client may have more than one IA assigned to it -- for example,
            one for each of its interfaces. Each IA holds one type of
            lease; for example, an identity association for temporary
            addresses (IA_TA) holds temporary addresses, and an identity
            association for prefix delegation (IA_PD) holds delegated
            prefixes. Throughout this document, "IA" is used to refer to
            an identity association without identifying the type
            of a lease in the IA. At the time of writing this document, there
            are three IA types defined: IA_NA, IA_TA, and IA_PD. New IA types
            may be defined in the future.</t>
             
            <t hangText="IA option(s)">At the time of writing this document,
            one or more IA_NA, IA_TA, and/or IA_PD options. New IA types may
            be defined in the future.</t>

            <t hangText="IAID">Identity Association Identifier: an identifier
            for an IA, chosen by the client. Each IA has an IAID, which is
            chosen to be unique among IAIDs for IAs of a specific type that
            belong to that client.</t>

            <t hangText="IA_NA">Identity Association for Non&nbhy;temporary
            Addresses: an IA that carries assigned addresses that are not
            temporary addresses (see "IA_TA"). See <xref
            target="RFC3315-22.4"/> for details on the IA_NA option.</t>

            <t hangText="IA_PD">Identity Association for Prefix Delegation: an
            IA that carries delegated prefixes. 
            See <xref target="IA_PD-option"/> for details on the
            IA_PD option.</t>

            <t hangText="IA_TA">Identity Association for Temporary Addresses:
            an IA that carries temporary addresses (see <xref
            target="RFC4941"/>). See <xref target="RFC3315-22.5"/>
            for details on the IA_TA option.</t>

            <t hangText="lease">A contract by which the server grants the use
            of an address or delegated prefix to the client for a specified
            period of time.</t>

            <t hangText="message">A unit of data carried as the payload of a
            UDP datagram, exchanged among DHCP servers, relay agents, and
            clients.</t>

            <t hangText="Reconfigure key">A key supplied to a client by a
            server. Used to provide security for Reconfigure messages (see
            <xref target="RFC3315-5.3"/> for the list of available message
            types).</t>

            <t hangText="relaying">A DHCP relay agent relays DHCP messages
            between DHCP participants.</t>

            <t hangText="requesting router">The router that acts as a DHCP
            client and is requesting prefix(es) to be assigned. This document
            primarily uses the term "DHCP client" or "client" when
            discussing the "requesting router" functionality of prefix
            delegation (see <xref target="intro-and-overview"/>).</t>

            <t hangText="retransmission">Another attempt to send the same
            DHCP message by a client or server, as a result of not
            receiving a valid response to the previously sent messages.
            The retransmitted message is typically modified prior to sending,
            as required by the DHCP specifications. In particular, the
            client updates the value of the Elapsed Time option in the
            retransmitted message.</t>
             
            <t hangText="RKAP">The Reconfiguration Key Authentication
            Protocol (see <xref target="reconfigure-protocol"/>).</t>

            <t hangText="singleton option">An option that is allowed to appear
            only once as a top-level option or at any encapsulation level.
            Most options are singletons.</t>

            <t hangText="T1">The time interval after which the client is
            expected to contact the server that did the assignment to extend
            (renew) the lifetimes of the addresses assigned (via IA_NA option(s)) and/or
            prefixes delegated (via IA_PD option(s)) to the client. T1 is expressed as
            an absolute value in messages (in seconds), is conveyed within IA
            containers (currently the IA_NA and IA_PD options), and is interpreted as a time
            interval since the packet's reception. The value stored in the T1 field in
            IA options is referred to as the T1 value. The actual time when the
            timer expires is referred to as the T1 time.</t>

            <t hangText="T2">The time interval after which the client is
            expected to contact any available server to extend (rebind) the
            lifetimes of the addresses assigned (via IA_NA option(s)) and/or prefixes
            delegated (via IA_PD option(s)) to the client. T2 is expressed as an absolute value
            in messages (in seconds), is conveyed within IA containers
            (currently the IA_NA and IA_PD options), and is interpreted as a time interval
            since the packet's reception. The value stored in the T2 field in IA options
            is referred to as the T2 value. The actual time when the timer expires
            is referred to as the T2&nbsp;time.</t>

            <t hangText="top-level option">An option conveyed in a DHCP
            message directly, i.e., not encapsulated in any other option, as
            described in Section&nbsp;9 of <xref target="RFC7227"/>.</t>

            <t hangText="transaction ID">An opaque value used to match
            responses with replies initiated by either a client or a
            server.</t>
          </list></t>
      </section>

    </section>

  <section anchor="Client-Server-Exchanges"
           title="Client/Server Exchanges">

     <t>Clients and servers exchange DHCP messages using UDP
     (see <xref target="RFC0768"/> and BCP 145 <xref target="RFC8085"/>).
     The client uses a link-local address or
     addresses determined through other mechanisms for transmitting and
     receiving DHCP messages.</t>

     <t>A DHCP client sends most messages using a reserved, link-scoped
     multicast destination address so that the client need not be
     configured with the address or addresses of DHCP servers.</t>

     <t>To allow a DHCP client to send a message to a DHCP server that is
     not attached to the same link, a DHCP relay agent on the client's link
     will relay messages between the client and server. The operation of
     the relay agent is transparent to the client. The discussion of
     message exchanges in the remainder of this section will omit the
     description of the relaying of messages by relay agents.</t>

     <t>Once the client has determined the address of a server, it may,
     under some circumstances, send messages directly to the server using
     unicast.</t>

      <section anchor="RFC3315-1.2"
               title="Client/Server Exchanges Involving Two Messages">

        <t>When a DHCP client does not need to have a DHCP server assign
        IP addresses or delegated prefixes to it, the client can obtain other
        configuration information such as a
        list of available DNS servers <xref target="RFC3646"/> or 
        NTP servers <xref target="RFC5908"/> through a single message and
        reply exchange with a DHCP server. To obtain other configuration
        information, the client first sends an Information-request message to
        the All_DHCP_Relay_Agents_and_Servers multicast address. Servers
        respond with a Reply message containing the other configuration
        information for the client.</t>
           
        <t>A client may also request the server to expedite address assignment
        and/or prefix delegation by using a two-message
        exchange instead of the normal four-message exchange as discussed
        in the next section. Expedited assignment can be requested by the
        client, and servers may or may not honor the request (see
        Sections&nbsp;<xref target="RFC3315-17.2.1" format="counter"/>
        and <xref target="RFC3315-22.14" format="counter"/>
        for more details and why servers may not honor this request).
        Clients may request this expedited service in environments where it
        is likely that there is only one server available on a link and no
        expectation that a second server would become available, or when
        completing the configuration process as quickly as possible is a
        priority.</t>

        <t>To request the expedited two-message exchange, the client
        sends a Solicit message to the All_DHCP_Relay_Agents_and_Servers multicast address
        requesting the assignment of addresses and/or delegated prefixes and other configuration
        information. This message includes an indication (the Rapid Commit
        option; see <xref target="RFC3315-22.14"/>) that the client is

        willing to accept an immediate Reply message from the server. The
        server that is willing to commit the assignment of addresses and/or
        delegated prefixes to the client immediately responds with a Reply
        message. The configuration information and the addresses and/or
        delegated prefixes in the Reply message are then
        immediately available for use by the client.</t>

        <t>Each address or delegated prefix assigned to the client has associated preferred and
        valid lifetimes specified by the server. To request an extension of
        the lifetimes assigned to an address or delegated prefix, the client sends a Renew message
        to the server. The server sends a Reply message to the client with the
        new lifetimes, allowing the client to continue to use the address or
        delegated prefix without interruption. If the server is unable to extend
        the lifetime of an address or delegated prefix, it indicates this by
        returning the address or delegated prefix with lifetimes of 0. At the same
        time, the server may assign other addresses or delegated prefixes.</t>

        <t>See <xref target="configuration-exchange"/> for descriptions of
        additional two-message exchanges between the client and server.</t>
      </section>

      <section anchor="RFC3315-1.3"
               title="Client/Server Exchanges Involving Four Messages">

        <t>To request the assignment of one or more addresses and/or delegated prefixes, a client
        first locates a DHCP server and then requests the assignment of
        addresses and/or delegated prefixes and other configuration information from the server. The
        client sends a Solicit message to the
        All_DHCP_Relay_Agents_and_Servers multicast address to find available DHCP
        servers. Any server that can meet the client's requirements responds
        with an Advertise message. The client then chooses one of the servers
        and sends a Request message to the server asking for confirmed
        assignment of addresses and/or delegated prefixes and other configuration information. The
        server responds with a Reply message that contains the confirmed
        addresses, delegated prefixes, and configuration.</t>

        <t>As described in the previous section, the client can request an
        extension of the lifetimes assigned to addresses or delegated prefixes
        (this is a two-message exchange).</t>

      </section>

      <section title="Server/Client Exchanges">
          <t>A server that has previously communicated with a client and negotiated
          for the client to listen for Reconfigure messages may send the client
          a Reconfigure message to initiate the client to update its configuration
          by sending an Information-request, Renew, or Rebind message. The client then
          performs the two-message exchange as described earlier. This can be used to
          expedite configuration changes to a client, such as the need to renumber
          a network (see <xref target="RFC6879"/>).
          </t>

      </section>

    </section>

    <section anchor="OpModes" title="Operational Models">
      <t>This section describes some of the current most common DHCP
      operational models. The described models are not mutually exclusive and
      are sometimes used together. For example, a device may start in stateful
      mode to obtain an address and, at a later time when an application is
      started, request additional parameters using stateless mode.</t>

      <t>This document assumes that the DHCP servers and the client,
      communicating with the servers via a specific interface, belong to a
      single provisioning domain.</t>
         
      <t>DHCP may be extended to support additional stateful services that
      may interact with one or more of the models described below. Such
      interaction should be considered and documented as part of any future
      protocol extension.</t>

      <section anchor="OpModes-Stateless" title="Stateless DHCP">
        <t>Stateless DHCP <xref target="RFC3736"/> is used when DHCP is
        not used for obtaining a lease but a node (DHCP client) desires one
        or more DHCP "other configuration" parameters, such as a list of DNS
        recursive name servers or DNS domain search lists <xref
        target="RFC3646"/>. Stateless DHCP may be used when a node initially
        boots or at any time the software on the node requires some missing or
        expired configuration information that is available via DHCP.</t>

        <t>This is the simplest and most basic operation for DHCP and requires
        a client (and a server) to support only two messages --
        Information&nbhy;request and Reply. Note that DHCP servers and
        relay agents typically also need to support the Relay-forward and
        Relay&nbhy;reply messages to accommodate operation when clients and
        servers are not on the same link.</t>
      </section>

      <section anchor="OpModes-NA"
               title="DHCP for Non-temporary Address Assignment">
        <t>This model of operation was the original motivation for DHCP.
        It is appropriate for situations where
        stateless address autoconfiguration alone is insufficient or
        impractical, e.g., because of network policy, additional requirements
        such as dynamic updates to the DNS, or client-specific requirements.</t>

        <t>The model of operation for non-temporary address assignment is as
        follows. The server is provided with prefixes from which it may
        allocate addresses to clients, as well as any related network topology
        information as to which prefixes are present on which links. A client
        requests a non-temporary address to be assigned by the server. The
        server allocates an address or addresses appropriate for the link on
        which the client is connected. The server returns the allocated
        address or addresses to the client.</t>

        <t>Each address has associated preferred and valid lifetimes, which
        constitute an agreement about the length of time over which the
        client is allowed to use the address. A client can request an
        extension of the lifetimes on an address and is required to terminate
        the use of an address if the valid lifetime of the address
        expires.</t>

        <t>Typically, clients request other configuration parameters, such as
        the DNS name server addresses and domain search lists, when requesting
        addresses.</t>
           
        <t>Clients can also request more than one address or set of addresses
        (see Sections&nbsp;<xref target="multiple-addrs" format="counter"/>
        and <xref target="RFC3315-10" format="counter"/>).</t>
      </section>

      <section anchor="OpModes-PD" title="DHCP for Prefix Delegation">

        <t>The prefix delegation mechanism, originally described in <xref
        target="RFC3633"/>, is another stateful mode of operation and
        was originally intended for simple delegation of prefixes from a
        delegating router (DHCP server) to requesting routers (DHCP
        clients). It is appropriate for situations in which the delegating
        router (1)&nbsp;does not have knowledge about the topology of the
        networks to which the requesting router is attached and
        (2)&nbsp;does not require other information aside from the identity of
        the requesting router to choose a prefix for delegation.
        This mechanism is appropriate for use by an ISP to
        delegate a prefix to a subscriber, where the delegated prefix would
        possibly be subnetted and assigned to the links within the
        subscriber's network. <xref target="RFC7084"/> and
        <xref target="RFC7368"/> describe such use in detail.</t>

        <t>The design of this prefix delegation mechanism meets the
        requirements for prefix delegation in <xref
        target="RFC3769"/>.</t>

        <t>While <xref target="RFC3633"/> assumes that the DHCP client
        is a router (hence the use of "requesting router") and that the DHCP
        server is a router (hence the use of "delegating router"), DHCP
        prefix delegation itself does not require that the client forward
        IP packets not addressed to itself and thus does not require
        that the client (or server) be a router as defined in
        <xref target="RFC8200"/>. Also, in many cases (such as tethering
        or hosting virtual machines), hosts are already forwarding IP
        packets and thus are operating as routers as defined in
        <xref target="RFC8200"/>. Therefore, this document mostly replaces
        "requesting router" with "client" and "delegating router" with
        "server".</t>

        <t>The model of operation for prefix delegation is as follows. A
        server is provisioned with prefixes to be delegated to
        clients. A client requests prefix(es) from the
        server, as described in <xref
        target="configuration-exchange"/>. The server chooses
        prefix(es) for delegation and responds with prefix(es) to the
        client. The client is then responsible for the
        delegated prefix(es). For example, the client might assign
        a subnet from a delegated prefix to one of its interfaces and begin
        sending Router Advertisements for the prefix on that link.</t>

        <t>Each prefix has an associated preferred lifetime and
        valid lifetime, which constitute an agreement about the length of time
        over which the client is allowed to use the prefix. A client
        can request an extension of the lifetimes on a delegated prefix and is
        required to terminate the use of a delegated prefix if the valid
        lifetime of the prefix expires.</t>

        <t><xref target="FigISPNetwork"/> illustrates a network
        architecture in which prefix delegation could be used.</t>

        <figure align="center" anchor="FigISPNetwork"
                title="Prefix Delegation Network">
          <artwork align="left"><![CDATA[
                   ______________________         \
                  /                      \         \
                 |    ISP core network    |         \
                  \__________ ___________/           |
                             |                       |
                     +-------+-------+               |
                     |  Aggregation  |               | ISP
                     |    device     |               | network
                     |  (delegating  |               |
                     |    router)    |               |
                     +-------+-------+               |
                             |                      /
                             |Network link to      /
                             |subscriber premises /
                             |
                      +------+------+             \
                      |     CPE     |              \
                      | (requesting |               \
                      |   router)   |                |
                      +----+---+----+                |
                           |   |                     | Subscriber
    ---+-------------+-----+   +-----+------         | network
       |             |               |               |
  +----+-----+ +-----+----+     +----+-----+         |
  |Subscriber| |Subscriber|     |Subscriber|        /
  |    PC    | |    PC    |     |    PC    |       /
  +----------+ +----------+     +----------+      /
        ]]></artwork>
        </figure>

        <t>In this example, the server (delegating router) is configured with a set of
        prefixes to be used for assignment to customers at the time of each
        customer's first connection to the ISP service. The prefix delegation
        process begins when the client (requesting router) requests configuration
        information through DHCP. The DHCP messages from the client
        are received by the server in the aggregation device. When
        the server receives the request, it selects an available
        prefix or prefixes for delegation to the client. The
        server then returns the prefix or prefixes to the
        client.</t>

        <t>The client subnets the delegated prefix and assigns the
        longer prefixes to links in the subscriber's network. In a typical
        scenario based on the network shown in <xref
        target="FigISPNetwork"/>, the client subnets a single
        delegated /48 prefix into /64 prefixes and assigns one /64 prefix to
        each of the links in the subscriber network.</t>

        <t>The prefix delegation options can be used in conjunction with other
        DHCP options carrying other configuration information to the
        client. The client may, in turn, provide DHCP
        service to nodes attached to the internal network. For example, the
        client may obtain the addresses of DNS and NTP servers from
        the ISP server and then pass that configuration
        information on to the subscriber hosts through a DHCP server in the
        client (requesting router).</t>

        <t>If the client uses a delegated prefix to configure addresses on
       interfaces on itself or other nodes behind it, the preferred and
       valid lifetimes of those addresses MUST be no longer than the
       remaining preferred and valid lifetimes, respectively, for the
       delegated prefix at any time. In particular, if the delegated
       prefix or a prefix derived from it is advertised for stateless
       address autoconfiguration <xref target="RFC4862"/>, the advertised
       preferred and valid lifetimes MUST NOT exceed the corresponding
       remaining lifetimes of the delegated prefix.</t>

      </section>

      <section anchor="OpModes-CPE" title="DHCP for Customer Edge Routers">
        <t>The DHCP requirements and network architecture for Customer Edge
        Routers are described in <xref target="RFC7084"/>. This model of
        operation combines address assignment (see <xref
        target="OpModes-NA"/>) and prefix delegation (see <xref
        target="OpModes-PD"/>). In general, this model assumes that a
        single set of transactions between the client and server will assign
        or extend the client's non-temporary addresses and delegated
        prefixes.</t>

      </section>

      <section anchor="OpModes-TA" title="DHCP for Temporary Addresses">
        <t>Temporary addresses were originally introduced to avoid privacy
        concerns with stateless address autoconfiguration, which based
        64&nbsp;bits of the address on the EUI-64
        (see <xref target="RFC4941"/>.  They were added to DHCP to provide
        complementary support when stateful address assignment is used.</t>

        <t>Temporary address assignment works mostly like non-temporary
        address assignment (see <xref target="OpModes-NA"/>); however,
        these addresses are generally intended to be used for a short period
        of time and not to have their lifetimes extended, though they can be
        if required.</t>
      </section>

      <section anchor="multiple-addrs" title="Multiple Addresses and Prefixes">
        <t>DHCP allows a client to receive multiple addresses.
        During typical operation, a client sends one instance
        of an IA_NA option and the server assigns at most one address from
        each prefix assigned to the link to which the client is attached. In
        particular, the server can be configured to serve addresses out
        of multiple prefixes for a given link. This is useful in cases
        such as when a network renumbering event is in progress. In a typical
        deployment, the server will grant one address for each IA_NA
        option (see <xref target="RFC3315-22.4"/>).</t>

        <t>A client can explicitly request multiple addresses by sending
        multiple IA_NA options (and/or IA_TA options; see
        <xref target="RFC3315-22.5"/>). A client can send multiple
        IA_NA (and/or IA_TA) options in its initial transmissions.
        Alternatively, it can send an extra Request message
        with additional new IA_NA (and/or IA_TA) options (or include them
        in a Renew message).</t>

        <t>The same principle also applies to prefix delegation. In
        principle, DHCP allows a client to request new prefixes
        to be delegated by sending additional IA_PD options
        (see <xref target="IA_PD-option"/>). However, a
        typical operator usually prefers to delegate a single, larger
        prefix. In most deployments, it is recommended that the client
        request a larger prefix in its initial transmissions rather than
        request additional prefixes later on.</t>

        <t>The exact behavior of the server (whether to grant additional
        addresses and prefixes or not) is up to the server policy and is
        out of scope for this document.</t>

        <t>For more information on how the server distinguishes between
        IA option instances, see <xref target="RFC3315-10"/>.</t>
      </section>
    </section>

    <section anchor="dhcp-constants" title="DHCP Constants">

      <t>This section describes various program and networking constants used
      by DHCP.</t>

      <section anchor="mutlicastAddr" title="Multicast Addresses">

        <t>DHCP makes use of the following multicast addresses:</t>

        <t><list style="hanging">
            <t hangText="All_DHCP_Relay_Agents_and_Servers (ff02::1:2)">
            <vspace/>A link-scoped multicast address used by a client to
            communicate with neighboring (i.e., on-link) relay agents and
            servers. All servers and relay agents are members of this
            multicast group.</t>

            <t hangText="All_DHCP_Servers (ff05::1:3)">
            <vspace/>A site-scoped multicast address used by a
            relay agent to communicate with servers, either because
            the relay agent wants to send messages to all servers or
            because it does not know the unicast addresses of the servers.
            Note that in order for a relay agent to use this address, it must
            have an address of sufficient scope to be reachable by the
            servers. All servers within the site are members of this multicast
            group on the interfaces that are within the site.</t>
          </list></t>
      </section>

      <section title="UDP Ports">

        <t>Clients listen for DHCP messages on UDP port 546. Servers and relay
        agents listen for DHCP messages on UDP port 547.</t>
      </section>

      <section anchor="RFC3315-5.3" title="DHCP Message Types">

        <t>DHCP defines the following message types. The formats of these
        messages are provided in
        Sections&nbsp;<xref target="RFC3315-6" format="counter"/> and
        <xref target="RFC3315-7" format="counter"/>. 
        Additional message types
        have been defined and may be defined in the future; see
        &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;.
        The numeric encoding for each message type is shown in parentheses.</t>

        <t><list hangIndent="26" style="hanging">
            <t hangText="SOLICIT (1)">A client sends a Solicit message to
            locate servers.</t>

            <t hangText="ADVERTISE (2)">A server sends an Advertise message to
            indicate that it is available for DHCP service, in response to a
            Solicit message received from a client.</t>

            <t hangText="REQUEST (3)">A client sends a Request message to
            request configuration parameters, including addresses and/or
            delegated prefixes, from a specific server.</t>

            <t hangText="CONFIRM (4)">A client sends a Confirm message to any
            available server to determine whether the addresses it was
            assigned are still appropriate to the link to which the client is
            connected.</t>

            <t hangText="RENEW (5)">A client sends a Renew message to the
            server that originally provided the client's leases and
            configuration parameters to extend the lifetimes on the leases
            assigned to the client and to update other configuration
            parameters.</t>

            <t hangText="REBIND (6)">A client sends a Rebind message to any
            available server to extend the lifetimes on the leases assigned
            to the client and to update other configuration parameters; this
            message is sent after a client receives no response to a Renew
            message.</t>

            <t hangText="REPLY (7)">A server sends a Reply message containing
            assigned leases and configuration parameters in response to a
            Solicit, Request, Renew, or Rebind message received from a client. A
            server sends a Reply message containing configuration parameters
            in response to an Information-request message. A server sends a
            Reply message in response to a Confirm message confirming or
            denying that the addresses assigned to the client are appropriate
            to the link to which the client is connected. A server sends a
            Reply message to acknowledge receipt of a Release or Decline
            message.</t>

            <t hangText="RELEASE (8)">A client sends a Release message to the
            server that assigned leases to the client to indicate that the
            client will no longer use one or more of the assigned
            leases.</t>

            <t hangText="DECLINE (9)">A client sends a Decline message to a
            server to indicate that the client has determined that one or more
            addresses assigned by the server are already in use on the link to
            which the client is connected.</t>

            <t hangText="RECONFIGURE (10)">A server sends a Reconfigure
            message to a client to inform the client that the server has new
            or updated configuration parameters and that the client is to
            initiate a Renew&wj;/Reply, Rebind/Reply, or
            Information&nbhy;request/Reply transaction with the server in
            order to receive the updated information.</t>

            <t hangText="INFORMATION-REQUEST (11)">A client sends an
            Information-request message to a server to request configuration
            parameters without the assignment of any leases to the
            client.</t>

            <t hangText="RELAY-FORW (12)">A relay agent sends a Relay-forward
            message to relay messages to servers, either directly or through
            another relay agent. The received message -- either a client
            message or a Relay-forward message from another relay agent -- is
            encapsulated in an option in the Relay-forward message.</t>

            <t hangText="RELAY-REPL (13)">A server sends a Relay-reply message
            to a relay agent containing a message that the relay agent
            delivers to a client. The Relay-reply message may be relayed by
            other relay agents for delivery to the destination relay
            agent.</t>

            <t>The server encapsulates the client message as an option in the
            Relay-reply message, which the relay agent extracts and relays to
            the client.</t>
          </list></t>
      </section>

      <section title="DHCP Option Codes">

        <t>DHCP makes extensive use of options in messages; some of these
        are defined later, in <xref target="RFC3315-22"/>. Additional options
        are defined in other documents or may be defined in the future
        (see <xref target="RFC7227"/> for guidance on new option
        definitions).</t>
        </section>

      <section title="Status Codes">

        <t>DHCP uses status codes to communicate the success or failure of
        operations requested in messages from clients and servers and to
        provide additional information about the specific cause of the failure
        of a message. The specific status codes are defined in <xref
        target="RFC3315-22.13"/>.</t>

        <t>If the Status Code option (see <xref target="RFC3315-22.13"/>) does
        not appear in a message in which the
        option could appear, the status of the message is assumed to be
        Success.</t>
      </section>

      <section anchor="RFC3315-5.5"
               title="Transmission and Retransmission Parameters">

        <t>This section presents a table of values used to describe the
        message transmission behavior of clients and servers. Some of
        the values are adjusted by a randomization factor and backoffs
        (see <xref target="RFC3315-14"/>). Transmissions may also
        be influenced by rate limiting (see <xref target="rate-limit"/>).</t>

<?rfc compact="no"?>
        <texttable anchor="Trans-Parameters-Table"
                   title="Transmission and Retransmission Parameters">
          <ttcol>Parameter</ttcol>

          <ttcol>Default</ttcol>

          <ttcol>Description</ttcol>

          <c>SOL_MAX_DELAY</c>

          <c>1 sec</c>

          <c>Max delay of first Solicit</c>

          <c>SOL_TIMEOUT</c>

          <c>1 sec</c>

          <c>Initial Solicit timeout</c>

          <c>SOL_MAX_RT</c>

          <c>3600 secs</c>

          <c>Max Solicit timeout value</c>

          <c>REQ_TIMEOUT</c>

          <c>1 sec</c>

          <c>Initial Request timeout</c>

          <c>REQ_MAX_RT</c>

          <c>30 secs</c>

          <c>Max Request timeout value</c>

          <c>REQ_MAX_RC</c>

          <c>10</c>

          <c>Max Request retry attempts</c>

          <c>CNF_MAX_DELAY</c>

          <c>1 sec</c>

          <c>Max delay of first Confirm</c>

          <c>CNF_TIMEOUT</c>

          <c>1 sec</c>

          <c>Initial Confirm timeout</c>

          <c>CNF_MAX_RT</c>

          <c>4 secs</c>

          <c>Max Confirm timeout</c>

          <c>CNF_MAX_RD</c>

          <c>10 secs</c>

          <c>Max Confirm duration</c>

          <c>REN_TIMEOUT</c>

          <c>10 secs</c>

          <c>Initial Renew timeout</c>

          <c>REN_MAX_RT</c>

          <c>600 secs</c>

          <c>Max Renew timeout value</c>

          <c>REB_TIMEOUT</c>

          <c>10 secs</c>

          <c>Initial Rebind timeout</c>

          <c>REB_MAX_RT</c>

          <c>600 secs</c>

          <c>Max Rebind timeout value</c>

          <c>INF_MAX_DELAY</c>

          <c>1 sec</c>

          <c>Max delay of first Information-request</c>

          <c>INF_TIMEOUT</c>

          <c>1 sec</c>

          <c>Initial Information-request timeout</c>

          <c>INF_MAX_RT</c>

          <c>3600 secs</c>

          <c>Max Information-request timeout value</c>

          <c>REL_TIMEOUT</c>

          <c>1 sec</c>

          <c>Initial Release timeout</c>

          <c>REL_MAX_RC</c>

          <c>4</c>

          <c>Max Release retry attempts</c>

          <c>DEC_TIMEOUT</c>

          <c>1 sec</c>

          <c>Initial Decline timeout</c>

          <c>DEC_MAX_RC</c>

          <c>4</c>

          <c>Max Decline retry attempts</c>

          <c>REC_TIMEOUT</c>

          <c>2 secs</c>

          <c>Initial Reconfigure timeout</c>

          <c>REC_MAX_RC</c>

          <c>8</c>

          <c>Max Reconfigure attempts</c>

          <c>HOP_COUNT_LIMIT</c>
          <c>8</c>
          <c>Max hop count in a Relay-forward message</c>

          <c>IRT_DEFAULT</c>
          <c>86400 secs (24 hours)</c>
          <c>Default information refresh time</c>

          <c>IRT_MINIMUM</c>

          <c>600 secs</c>

          <c>Min information refresh time</c>

          <c>MAX_WAIT_TIME</c>

          <c>60 secs</c>

          <c>Max required time to wait for a response</c>

        </texttable>
<?rfc compact="yes"?>
      </section>

      <section anchor="RFC3315-5.6"
               title="Representation of Time Values and &quot;Infinity&quot; as a Time Value">
        <t>All time values for lifetimes, T1, and T2 are unsigned 32-bit integers
        and are expressed in units of seconds. The value 0xffffffff is taken to mean
        "infinity" when used as a lifetime (as in <xref target="RFC4861"/>) or a
        value for T1 or T2.</t>

        <t>Setting the valid lifetime of an address or a
        delegated prefix to 0xffffffff ("infinity") amounts to a permanent
        assignment of an address or delegation to a client and should only be
        used in cases where permanent assignments are desired.</t>

        <t>Care should be taken in setting T1 or T2 to 0xffffffff
        ("infinity"). A client will never attempt to extend the lifetimes of
        any addresses in an IA with T1 set to 0xffffffff. A client will never
        attempt to use a Rebind message to locate a different server to extend
        the lifetimes of any addresses in an IA with T2 set to 0xffffffff.</t>
      </section>

    </section>

    <section anchor="RFC3315-6" title="Client/Server Message Formats">

      <t>All DHCP messages sent between clients and servers share an identical
      fixed-format header and a variable-format area for options.</t>

      <t>All values in the message header and in options are in network byte
      order.</t>

      <t>Options are stored serially in the "options" field, with no padding
      between the options. Options are byte-aligned but are not aligned in any
      other way (such as on 2-byte or 4-byte boundaries).</t>

      <t>The following diagram illustrates the format of DHCP messages sent
      between clients and servers:</t>

      <figure align="center" anchor="FigClientServerMsg"
              title="Client/Server Message Format">
        <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    msg-type   |               transaction-id                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                            options                            .
   .                 (variable number and length)                  .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        ]]></artwork>
      </figure>

      <t><list hangIndent="24" style="hanging">
          <t hangText="   msg-type">Identifies the DHCP message type; the
          available message types are listed in <xref
          target="RFC3315-5.3"/>. A 1&nbhy;octet field.</t>

          <t hangText="   transaction-id">The transaction ID for this message
          exchange. A 3&nbhy;octet field.</t>

          <t hangText="   options">Options carried in this message; options
          are described in <xref target="RFC3315-22"/>. A variable-length
          field (4 octets less than the size of the message).</t>
        </list></t>
    </section>

    <section anchor="RFC3315-7" title="Relay Agent/Server Message Formats">

      <t>Relay agents exchange messages with other relay agents and servers
      to relay messages between
      clients and servers that are not connected to the same link.</t>

      <t>All values in the message header and in options are in network byte
      order.</t>

      <t>Options are stored serially in the "options" field, with no padding
      between the options. Options are byte-aligned but are not aligned in any
      other way (such as on 2-byte or 4-byte boundaries).</t>

      <t>There are two relay agent messages (Relay-forward and Relay-reply),
      which share the following format:</t>

      <figure align="center" anchor="FigRelayServerMsg"
              title="Relay Agent/Server Message Format">
        <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    msg-type   |   hop-count   |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   |                                                               |
   |                         link-address                          |
   |                                                               |
   |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   |                                                               |
   |                         peer-address                          |
   |                                                               |
   |                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   .                                                               .
   .            options (variable number and length)   ....        .
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        ]]></artwork>
      </figure>

      <t>The following sections describe the use of the relay agent message
      header.</t>

      <section title="Relay-forward Message">

        <t>The following table defines the use of message fields in a
        Relay&nbhy;forward message.</t>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   msg-type">RELAY-FORW (12). A 1&nbhy;octet field.</t>

            <t hangText="   hop-count">Number of relay agents that
            have already relayed this message. A 1&nbhy;octet field.</t>

            <t hangText="   link-address">An address that may be used by the
            server to identify the link on which the client is located. This
            is typically a globally scoped unicast address
            (i.e., GUA or ULA), but see the discussion
            in <xref target="relaying-from-client"/>. A 16-octet field.</t>

            <t hangText="   peer-address">The address of the client or relay
            agent from which the message to be relayed was received. A
            16-octet field.</t>

            <t hangText="   options">MUST include a Relay Message option
            (see <xref target="RFC3315-22.10"/>); MAY include other
            options, such as the Interface-Id option (see
            <xref target="RFC3315-22.18"/>), added by the relay agent. A
            variable-length field
            (34&nbsp;octets less than the size of the message).</t>
        </list></t>

        <t>See <xref target="addr-assign-ia-na"/> for an explanation of
        how the link-address field is&nbsp;used.</t>

      </section>

      <section title="Relay-reply Message">

        <t>The following table defines the use of message fields in a
        Relay&nbhy;reply message.</t>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   msg-type">RELAY-REPL (13).
            A 1&nbhy;octet field.</t>

            <t hangText="   hop-count">Copied from the Relay-forward
            message. A&nbsp;1&nbhy;octet field.</t>

            <t hangText="   link-address">Copied from the Relay-forward
            message. A&nbsp;16&nbhy;octet field.</t>

            <t hangText="   peer-address">Copied from the Relay-forward
            message. A&nbsp;16&nbhy;octet field.</t>

            <t hangText="   options">MUST include a Relay Message option
            (see <xref target="RFC3315-22.10"/>); MAY include other
            options, such as the Interface-Id option (see
            <xref target="RFC3315-22.18"/>). A variable-length field
            (34&nbsp;octets less than the size of the message).</t>
          </list></t>
      </section>

    </section>

    <section anchor="RFC3315-8" title="Representation and Use of Domain Names">

      <t>So that domain names may be encoded uniformly, a domain name or a
      list of domain names is encoded using the technique described in
      Section&nbsp;3.1 of <xref target="RFC1035"/>. A domain name, or list of
      domain names, in DHCP MUST NOT be stored in compressed form as
      described in Section&nbsp;4.1.4 of <xref target="RFC1035"/>.</t>
    </section>

    <section anchor="RFC3315-9" title="DHCP Unique Identifier (DUID)">

      <t>Each DHCP client and server has a DUID. DHCP servers use DUIDs to
      identify clients for the selection of configuration parameters and in
      the association of IAs with clients. DHCP clients use DUIDs to identify
      a server in messages where a server needs to be identified. See
      Sections&nbsp;<xref target="RFC3315-22.2" format="counter"/> and
      <xref target="RFC3315-22.3" format="counter"/>
      for details regarding the representation of a DUID in a DHCP message.</t>

      <t>Clients and servers MUST treat DUIDs as opaque values and MUST only
      compare DUIDs for equality. Clients and servers SHOULD NOT in any other
      way interpret DUIDs. Clients and servers MUST NOT restrict DUIDs to the
      types defined in this document, as additional DUID types may be defined
      in the future. It should be noted that an attempt to parse a DUID to
      obtain a client's link-layer address is unreliable, as there is no
      guarantee that the client is still using the same link&nbhy;layer
      address as when it generated its DUID. Also, such an attempt will be
      more and more unreliable as more clients adopt privacy measures
      such as those defined in <xref target="RFC7844"/>.
      If this capability is required, it is recommended to rely on the
      Client Link&nbhy;Layer Address option instead
      <xref target="RFC6939"/>.</t>

      <t>The DUID is carried in an option because it may be variable in length
      and because it is not required in all DHCP messages. The DUID is
      designed to be unique across all DHCP clients and servers, and stable
      for any specific client or server.  That is, the DUID used by a
      client or server SHOULD NOT change over time if at all possible; for
      example, a device's DUID should not change as a result of a change in
      the device's network hardware or changes to virtual interfaces (e.g.,
      logical PPP (over Ethernet) interfaces that may come and go in
      Customer Premises Equipment routers). The client
      may change its DUID as specified in <xref target="RFC7844"/>.</t>

      <t>The motivation for having more than one type of DUID is that the DUID
      must be globally unique and must also be easy to generate. The sort of
      globally unique identifier that is easy to generate for any given device
      can differ quite widely. Also, some devices may not contain any
      persistent storage. Retaining a generated DUID in such a device is not
      possible, so the DUID scheme must accommodate such devices.</t>

      <section anchor="RFC3315-9.1" title="DUID Contents">

        <t>A DUID consists of a 2-octet type code represented in network
        byte order, followed by a variable number of octets that make up the
        actual identifier. The length of the DUID (not including the type
        code) is at least 1 octet and at most 128 octets. The following types
        are currently defined:</t>

        <texttable anchor="DUID-Types-Table" title="DUID Types">
          <ttcol>Type</ttcol>

          <ttcol>Description</ttcol>

          <c>1</c>

          <c>Link-layer address plus time</c>

          <c>2</c>

          <c>Vendor-assigned unique ID based on Enterprise Number</c>

          <c>3</c>

          <c>Link-layer address</c>

          <c>4</c>

          <c>Universally Unique Identifier (UUID) <xref target="RFC6355"/></c>
        </texttable>

        <t>Formats for the variable field of the DUID for the first three of the
        above types are shown below. The fourth type, DUID-UUID <xref
        target="RFC6355"/>, can be used in situations where there is a
        UUID stored in a device's firmware settings.</t>
      </section>

      <section title="DUID Based on Link-Layer Address Plus Time (DUID-LLT)">

        <t>This type of DUID consists of a 2-octet type field containing the
        value 1, a 2-octet hardware type code, and 4 octets containing
        a time value, followed by the link-layer address of any one network
        interface that is connected to the DHCP device at the time that the
        DUID is generated. The time value is the time that the DUID is
        generated, represented in seconds since midnight (UTC), January 1,
        2000, modulo 2^32. The hardware type MUST be a valid hardware type
        assigned by IANA; see <xref target="IANA-HARDWARE-TYPES"/>. Both the
        time and the hardware type are stored in network byte order. For
        Ethernet hardware types, the link-layer address is stored in canonical
        form, as described in <xref target="RFC2464"/>.</t>

        <t>The following diagram illustrates the format of a DUID-LLT:</t>

        <figure align="center" anchor="FigDUIDLLT" title="DUID-LLT Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         DUID-Type (1)         |    hardware type (16 bits)    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        time (32 bits)                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .             link-layer address (variable length)              .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t>The choice of network interface can be completely arbitrary, as
        long as that interface provides a globally unique link-layer address
        for the link type; the same DUID-LLT SHOULD be used in configuring
        all network interfaces connected to the device, regardless of which
        interface's link-layer address was used to generate the DUID-LLT.</t>

        <t>Clients and servers using this type of DUID MUST store the DUID-LLT
        in stable storage and MUST continue to use this DUID-LLT even if the
        network interface used to generate the DUID-LLT is removed. Clients
        and servers that do not have any stable storage MUST NOT use this type
        of DUID.</t>

        <t>Clients and servers that use this DUID SHOULD attempt to configure
        the time prior to generating the DUID, if that is possible, and MUST
        use some sort of time source (for example, a real-time clock) in
        generating the DUID, even if that time source could not be configured
        prior to generating the DUID. The use of a time source makes it
        unlikely that two identical DUID-LLTs will be generated if the network
        interface is removed from the client and another client then uses the
        same network interface to generate a DUID-LLT. A collision between two
        DUID-LLTs is very unlikely even if the clocks have not been configured
        prior to generating the DUID.</t>

        <t>This method of DUID generation is recommended for all
        general-purpose computing devices such as desktop computers and laptop
        computers, and also for devices such as printers, routers, and so on,
        that contain some form of writable non-volatile storage.</t>

        <t>It is possible that this algorithm for
        generating a DUID could result in a client identifier collision. A
        DHCP client that generates a DUID-LLT using this mechanism MUST
        provide an administrative interface that replaces the existing DUID
        with a newly generated DUID-LLT.</t>
      </section>

      <section title="DUID Assigned by Vendor Based on Enterprise Number (DUID-EN)">

        <t>The vendor assigns this form of DUID to the device. This DUID
        consists of the 4&nbhy;octet vendor's registered Private Enterprise
        Number as maintained by IANA <xref target="IANA-PEN"/> followed by a
        unique identifier assigned by the vendor. The following diagram
        summarizes the structure of a DUID-EN:</t>

        <figure align="center" anchor="FigDUIDEN" title="DUID-EN Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         DUID-Type (2)         |       enterprise-number       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   enterprise-number (contd)   |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   .                           identifier                          .
   .                       (variable length)                       .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t>The source of the identifier is left up to the vendor defining it,
        but each identifier part of each DUID-EN MUST be unique to the device
        that is using it, and MUST be assigned to the device no later than at
        the first usage and stored in some form of non-volatile storage. This
        typically means being assigned during the manufacturing process
        in the case of physical devices or, in the case of virtual machines,
        when the image is created or booted for the first time. The
        generated DUID SHOULD be recorded in non-erasable storage. The
        enterprise-number is the vendor's registered Private
        Enterprise Number as maintained by IANA <xref target="IANA-PEN"/>. The
        enterprise-number is stored as an unsigned 32&nbhy;bit number.</t>

        <t>An example DUID of this type might look like this:</t>

        <figure align="center" anchor="FigDUIDENExample"
                title="DUID-EN Example">
          <artwork align="left"><![CDATA[
   +---+---+---+---+---+---+---+---+
   | 0 | 2 | 0 | 0 | 0 |  9| 12|192|
   +---+---+---+---+---+---+---+---+
   |132|211| 3 | 0 | 9 | 18|
   +---+---+---+---+---+---+
          ]]></artwork>
        </figure>

        <t>This example includes the 2-octet type of 2 and the Enterprise
        Number (9), followed by 8&nbsp;octets of identifier data
        (0x0CC084D303000912).</t>
      </section>

      <section title="DUID Based on Link-Layer Address (DUID-LL)">

        <t>This type of DUID consists of 2 octets containing a DUID type
        of 3 and a 2-octet network hardware type code, followed by
        the link&nbhy;layer address of any one network interface that is
        permanently connected to the client or server device. For example, a
        node that has a network interface implemented in a chip that is
        unlikely to be removed and used elsewhere could use a DUID-LL.
        The hardware type MUST be a valid hardware type assigned by IANA;
        see <xref target="IANA-HARDWARE-TYPES"/>.
        The hardware type is stored in network byte
        order. The link-layer address is stored in canonical form, as
        described in <xref target="RFC2464"/>. The following diagram
        illustrates the format of a DUID-LL:</t>

        <figure align="center" anchor="FigDUIDLL" title="DUID-LL Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         DUID-Type (3)         |    hardware type (16 bits)    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .             link-layer address (variable length)              .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t>The choice of network interface can be completely arbitrary, as
        long as that interface provides a unique link-layer address and is
        permanently attached to the device on which the DUID-LL is being
        generated. The same DUID-LL SHOULD be used in configuring all network
        interfaces connected to the device, regardless of which interface's
        link-layer address was used to generate the DUID.</t>

        <t>A DUID-LL is recommended for devices that have a permanently
        connected network interface with a link-layer address and do not
        have nonvolatile, writable stable storage. A DUID-LL SHOULD NOT be
        used by DHCP clients or servers that cannot tell whether or not a
        network interface is permanently attached to the device on which the
        DHCP client is running.</t>
      </section>

      <section title="DUID Based on Universally Unique Identifier (DUID-UUID)">
        <t>This type of DUID consists of 16 octets containing a 128-bit
        UUID. <xref target="RFC6355" /> details when to use this type and
        how to pick an appropriate source of the UUID.
        </t>
        <figure align="center" anchor="FigDUIDUUID" title="DUID-UUID Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         DUID-Type (4)         |        UUID (128 bits)        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   |                                                               |
   |                                                               |
   |                                -+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
          ]]></artwork>
        </figure>
      </section>

    </section>

    <section anchor="RFC3315-10" title="Identity Association">

      <t>An Identity Association (IA) is a construct through which a server
      and a client can identify, group, and manage a set of related IPv6
      addresses or delegated prefixes. Each IA consists of an IAID and
      associated configuration information.</t>

      <t>The IAID uniquely identifies the IA and MUST be chosen to be unique
      among the IAIDs for that IA type on the client (e.g., an IA_NA with
      an IAID of 0 and an IA_PD with an IAID of 0 are each considered unique).
      The IAID is chosen by the client. For any given use of an IA by the
      client, the IAID for that IA MUST be consistent across restarts of the
      DHCP client. The client may maintain consistency by either storing the
      IAID in non-volatile storage or using an algorithm that will
      consistently produce the same IAID as long as the configuration of the
      client has not changed. There may be no way for a client to maintain
      consistency of the IAIDs if it does not have non-volatile storage and
      the client's hardware configuration changes. If the client uses only one
      IAID, it can use a well-known value, e.g., zero.</t>

      <t>If the client wishes to obtain a distinctly new address or prefix and
      deprecate the existing one, the client sends a Release message
      to the server for the IAs using the original IAID. The client then
      creates a new IAID, to be used in future messages to obtain leases for
      the new IA.</t>

      <section anchor="RFC3315-10.1"
               title="Identity Associations for Address Assignment">
        <t>A client must associate at least one distinct IA with each of its
        network interfaces for which it is to request the assignment of IPv6
        addresses from a DHCP server. The client uses the IAs assigned to an
        interface to obtain configuration information from a server for that
        interface. Each such IA must be associated with exactly one interface.</t>

        <t>The configuration information in an IA_NA option consists of one or
        more IPv6 addresses along with the T1 and T2 values for the IA. See <xref
        target="RFC3315-22.4"/> for details regarding the representation of an IA_NA in a
        DHCP message.</t>

        <t>The configuration information in an IA_TA option consists of one or more IPv6
        addresses. See <xref target="RFC3315-22.5"/> for details regarding the representation of an
        IA_TA in a DHCP message.</t>

        <t>Each address in an IA has a preferred lifetime and a valid
        lifetime, as defined in <xref target="RFC4862"/>. The lifetimes
        are transmitted from the DHCP server to the client in the IA Address
        option (see <xref target="RFC3315-22.6"/>).
        The lifetimes apply to the use of addresses; see
        Section&nbsp;5.5.4 of <xref target="RFC4862"/>.</t>
      </section>

      <section anchor="RFC3315-10.2"
               title="Identity Associations for Prefix Delegation">
        <t>An IA_PD is different from an IA for address assignment in that it
        does not need to be associated with exactly one interface. One IA_PD
        can be associated with the client, with a set of interfaces,
        or with exactly one interface. A client configured to request
        delegated prefixes must create at
        least one distinct IA_PD. It may associate a distinct IA_PD with each
        of its downstream network interfaces and use that IA_PD to obtain a
        prefix for that interface from the server.</t>

        <t>The configuration information in an IA_PD option consists of one or more
        prefixes along with the T1 and T2 values for the IA_PD. See <xref
        target="IA_PD-option"/> for details regarding the representation of an IA_PD in a
        DHCP message.</t>

        <t>Each delegated prefix in an IA has a preferred lifetime and a valid
        lifetime, as defined in <xref target="RFC4862"/>. The lifetimes
        are transmitted from the DHCP server to the client in the IA Prefix option
        (see <xref target="IAPREFIX-option"/>).
        The lifetimes apply to the use of delegated prefixes; see
        Section&nbsp;5.5.4 of <xref target="RFC4862"/>.</t>
      </section>
    </section>

    <section anchor="RFC3315-11" title="Assignment to an IA">

      <section anchor="addr-assign-ia-na" title="Selecting Addresses for Assignment to an IA_NA">
        <t>A server selects addresses to be assigned to an IA_NA according to
        the address assignment policies determined by the server administrator
        and the specific information the server determines about the client
        from some combination of the following sources:</t>

     <t><list style="symbols">
            <t>The link to which the client is attached. The
            server determines the link as follows:
         <list style="symbols">
                <t>If the server receives the message directly
                from the client and the source address in the IP datagram in
                which the message was received is a link-local address, then
                the client is on the same link to which the interface over
                which the message was received is attached.</t>

                <t>If the server receives the message from a
                forwarding relay agent, then the client is on the same link as
                the one to which the interface, identified by the link-address
                field in the message from the relay agent, is attached.
                According to <xref target="RFC6221"/>, the server MUST
                ignore any link-address field whose value is zero. The
                link-address in this case may come from any of the
                Relay-forward messages encapsulated in the received
                Relay-forward, and in general the most encapsulated
                (closest Relay-forward to the client) has the most
                useful value.</t>

                <t>If the server receives the message directly
                from the client and the source address in the IP datagram in
                which the message was received is not a link-local address,
                then the client is on the link identified by the source
                address in the IP datagram (note that this situation can occur
                only if the server has enabled the use of unicast message
                delivery by the client and the client has sent a message for
                which unicast delivery is allowed).</t>
              </list></t>

            <t>The DUID supplied by the client.</t>

            <t>Other information in options supplied by the
            client, e.g., IA Address options (see <xref target="RFC3315-22.6"/>)
            that include the client's requests for specific addresses.</t>

            <t>Other information in options supplied by the relay
            agent.</t>
          </list></t>

        <t>By default, DHCP server implementations SHOULD NOT generate
        predictable addresses (see Section&nbsp;4.7 of <xref target="RFC7721"/>). Server
        implementers are encouraged to review <xref target="RFC4941"/>,
        <xref target="RFC7824"/>, and <xref target="RFC7707"/> as to
        possible considerations for how to generate addresses.</t>

        <t>A server MUST NOT assign an address that is otherwise reserved for
        some other purpose. For example, a server MUST NOT assign addresses
        that use a reserved IPv6 Interface Identifier <xref target="RFC5453"/>
        <xref target="RFC7136"/> <xref target="IANA-RESERVED-IID"/>.</t>

        <t>See <xref target="RFC7969"/> for a more detailed
        discussion on how servers determine a client's location on the network.</t>
      </section>

      <section title="Assignment of Temporary Addresses">
        <t>A client may request the assignment of temporary addresses (see
        <xref target="RFC4941"/> for the definition of temporary
        addresses). DHCP handling of address assignment is no different for
        temporary addresses.</t>

        <t>Clients ask for temporary addresses, and servers assign them.
        Temporary addresses are carried in the IA_TA option (see <xref
        target="RFC3315-22.5"/>). Each IA_TA option typically contains
        at least one temporary address for each of the prefixes on the link
        to which the client is attached.</t>

        <t>The lifetime of the assigned temporary address is set in the IA
        Address option (see <xref target="RFC3315-22.6"/>) encapsulated in the
        IA_TA option. It is RECOMMENDED to set short lifetimes, typically
        shorter than TEMP_VALID_LIFETIME and TEMP_PREFERRED_LIFETIME (see
        Section&nbsp;5 of <xref target="RFC4941"/>).</t>

        <t>A DHCP server implementation MAY generate temporary addresses,
        referring to the algorithm defined in Section&nbsp;3.2.1 of <xref
        target="RFC4941"/>, with the additional condition that any new
        address is not the same as any assigned address.</t>

        <t>The server MAY update the DNS for a temporary address, as described
        in Section&nbsp;4 of <xref target="RFC4941"/>.</t>

        <t>On the clients, by default, temporary addresses are preferred in
        source address selection, according to Rule 7 in Section&nbsp;5 of
        <xref target="RFC6724"/>. However, this policy can be overridden.</t>

        <t>One of the most important properties of a temporary address is to
        make it difficult to link the address to different actions over time.
        So, it is NOT RECOMMENDED for a client to renew temporary addresses,
        though DHCP provides for such a possibility (see <xref
        target="RFC3315-22.5"/>).</t>
      </section>

      <section title="Assignment of Prefixes for IA_PD">
        <t>The mechanism through which the server selects
        prefix(es) for delegation is not specified in this document. Examples
        of ways in which the server might select prefix(es) for a client
        include static assignment based on subscription to an ISP, dynamic
        assignment from a pool of available prefixes, and selection based on an
        external authority such as a RADIUS server using the
        Framed-IPv6-Prefix option as described in <xref target="RFC3162"/>.</t>
      </section>

    </section>

    <section anchor="RFC3315-13" title="Transmission of Messages by a Client">

      <t>Unless otherwise specified in this document or in a document that
      describes how IPv6 is carried over a specific type of link (for link
      types that do not support multicast), a client sends DHCP messages to
      the All_DHCP_Relay_Agents_and_Servers multicast address.</t>

      <t>DHCP servers SHOULD NOT check to see whether the Layer 2 address
      used was multicast or not, as long as the Layer 3 address was
      correct.</t>

      <t>A client uses multicast to reach all servers or an individual server.
      An individual server is indicated by specifying that server's DUID in a
      Server Identifier option (see <xref target="RFC3315-22.3"/>) in
      the client's message. (All servers will receive this message, but only
      the indicated server will respond.) All servers are indicated when
      this option is not supplied.</t>

      <t>A client may send some messages directly to a server using unicast,
      as described in <xref target="RFC3315-22.12"/>.</t>

      <section anchor="rate-limit" title="Rate Limiting">
        <t>In order to avoid prolonged message bursts that may be caused by
        possible logic loops, a DHCP client MUST limit the rate of DHCP
        messages it transmits or retransmits. One example is that a client obtains an
        address or delegated prefix but does not like the response, so it
        reverts back to the Solicit
        procedure, discovers the same (sole) server, requests an address or delegated prefix, and
        gets the same address or delegated prefix as before (as the server has this previously
        requested lease assigned to this client). This loop can repeat infinitely if
        there is not a quit/stop mechanism. Therefore, a client must not
        initiate transmissions too frequently.</t>

        <t>A recommended method for implementing the rate-limiting function is
        a token bucket (see Appendix&nbsp;A of <xref target="RFC3290"/>), limiting the average rate of transmission to a certain
        number in a certain time interval. This method of bounding burstiness also
        guarantees that the long-term transmission rate will not be exceeded.</t>

        <t>A transmission rate limit SHOULD be configurable. A possible
        default could be 20 packets in 20 seconds.</t>

        <t>For a device that has multiple interfaces, the limit MUST be
        enforced on a per-interface basis.</t>

        <t>Rate limiting of forwarded DHCP messages and server-side messages
        is out of scope for this specification.</t>
      </section>

      <section anchor="t1-t2-0"
               title="Client Behavior when T1 and/or T2 Are 0">
        <t>In certain cases, T1 and/or T2 values may be set to 0. Currently,
        there are three such cases:
             
      <list style="numbers">
        <t>a client received an IA_NA option (see <xref target="RFC3315-22.4"/>) with a zero value</t>
        <t>a client received an IA_PD option (see <xref target="IA_PD-option"/>) with a zero value</t>
        <t>a client received an IA_TA option (see <xref
        target="RFC3315-22.5"/>) (which does not contain T1 and T2 fields and
        these leases are not generally renewed)</t>

      </list>
        This is an indication that the renew and rebind times are left to
        the discretion of the client. However, they are not completely
        discretionary.</t>

        <t>When T1 and/or T2 values are set to 0, the client MUST choose a
        time to avoid packet storms. In particular, it MUST NOT transmit
        immediately. If the client received multiple IA options, it SHOULD
        pick renew and/or rebind transmission times so all IA options are
        handled in one exchange, if possible. The client MUST choose renew
        and rebind times to not violate rate-limiting restrictions as defined
        in <xref target="rate-limit"/>.</t>
      </section>
    </section>

    <section anchor="RFC3315-14"
             title="Reliability of Client-Initiated Message Exchanges">

      <t>DHCP clients are responsible for reliable delivery of messages in the
      client-initiated message exchanges described in <xref
      target="configuration-exchange"/>. If a DHCP client fails to
      receive an expected response from a server, the client must retransmit
      its message according to the retransmission strategy described
      in this section.</t>

      <t>Note that the procedure described in this section is slightly
      modified when used with the Solicit message. The modified procedure is
      described in <xref target="solicit-create-transmit"/>.</t>

      <t>The client begins the message exchange by transmitting a message to
      the server. The message exchange terminates when either
      (1)&nbsp;the client successfully receives the appropriate response or
      responses from a server or servers or (2)&nbsp;the message exchange is
      considered to have failed according to the retransmission mechanism
      described below.</t>

      <t>The client MUST update an "elapsed-time" value within an Elapsed
      Time option (see <xref target="RFC3315-22.9"/>) in the
      retransmitted message. In some cases, the client may also need to modify
      values in IA Address options (see <xref target="RFC3315-22.6"/>) or
      IA Prefix options (see <xref target="IAPREFIX-option"/>) if a valid lifetime for
      any of the client's leases expires before retransmission. Thus, whenever
      this document refers to a "retransmission" of a client's message, it
      refers to both modifying the original message and sending this new message
      instance to the server.</t>

      <t>The client retransmission behavior is controlled and described by the
      following variables: <list hangIndent="11" style="hanging">
          <t hangText="   RT">Retransmission timeout</t>

          <t hangText="   IRT">Initial retransmission time</t>

          <t hangText="   MRC">Maximum retransmission count</t>

          <t hangText="   MRT">Maximum retransmission time</t>

          <t hangText="   MRD">Maximum retransmission duration</t>

          <t hangText="   RAND">Randomization factor</t>
        </list></t>
         
      <t>Specific values for each of these parameters relevant to the
      various messages are given in the subsections of
      <xref target="Client-Behavior"/>, using values defined in
      <xref target="Trans-Parameters-Table"/> in <xref target="RFC3315-5.5"/>.
      The algorithm for RAND is common across all message transmissions.</t>

      <t>With each message transmission or retransmission, the client sets RT
      according to the rules given below. If RT expires before the message
      exchange terminates, the client recomputes RT and retransmits the
      message.</t>

      <t>Each of the computations of a new RT includes a randomization factor
      (RAND), which is a random number chosen with a uniform distribution
      between -0.1 and +0.1. The randomization factor is included to minimize
      synchronization of messages transmitted by DHCP clients.</t>

      <t>The algorithm for choosing a random number does not need to be
      cryptographically sound. The algorithm SHOULD produce a different
      sequence of random numbers from each invocation of the DHCP client.</t>

      <t>RT for the first message transmission is based on IRT:</t>

      <figure>
        <artwork><![CDATA[
   RT = IRT + RAND*IRT
      ]]></artwork>
      </figure>

      <t>RT for each subsequent message transmission is based on the previous
      value of RT:</t>

      <figure>
        <artwork><![CDATA[
   RT = 2*RTprev + RAND*RTprev
      ]]></artwork>
      </figure>

      <t>MRT specifies an upper bound on the value of RT (disregarding the
      randomization added by the use of RAND). If MRT has a value of 0, there
      is no upper limit on the value of RT. Otherwise:</t>

      <figure>
        <artwork><![CDATA[
   if (RT > MRT)
      RT = MRT + RAND*MRT
      ]]></artwork>
      </figure>

      <t>MRC specifies an upper bound on the number of times a client may
      retransmit a message. Unless MRC is zero, the message exchange fails
      once the client has transmitted the message MRC times.</t>

      <t>MRD specifies an upper bound on the length of time a client may
      retransmit a message. Unless MRD is zero, the message exchange fails
      once MRD seconds have elapsed since the client first transmitted the
      message.</t>

      <t>If both MRC and MRD are non-zero, the message exchange fails whenever
      either of the conditions specified in the previous two paragraphs
      is&nbsp;met.</t>

      <t>If both MRC and MRD are zero, the client continues to transmit the
      message until it receives a response.</t>

      <t>A client is not expected to listen for a response during the entire
      RT period and may turn off listening capabilities after waiting at least
      the shorter of RT and MAX_WAIT_TIME due to power consumption saving or
      other reasons. Of course, a client MUST listen for a Reconfigure if it
      has negotiated for its use with the server.</t>

    </section>

    <section anchor="RFC3315-15" title="Message Validation">

      <t>This section describes which options are valid in which kinds of
      message types and explains what to do when a client or server receives
      a message that contains known options that are invalid for that message.
      For example, an IA option is not allowed to appear in an
      Information-request message.</t>

      <t>Clients and servers MAY choose to either (1)&nbsp;extract
      information from such a message if the information is of use to the
      recipient or (2)&nbsp;ignore such a message completely and just
      discard it.</t>

      <t>If a server receives a message that it considers invalid, it
      MAY send a Reply message (or Advertise message, as appropriate) with a
      Server Identifier option (see <xref target="RFC3315-22.3"/>), a Client
      Identifier option (see <xref target="RFC3315-22.2"/>) (if one was
      included in the message), and a Status Code option (see <xref
      target="RFC3315-22.13"/>) with status UnspecFail.</t>

      <t>Clients, relay agents, and servers MUST NOT discard messages that
      contain unknown options (or instances of vendor options with unknown
      enterprise-number values). These should be ignored as if they were not
      present.  This is critical to provide for future extensions of DHCP.</t>

      <t>A server MUST discard any Solicit, Confirm, Rebind, or
      Information&nbhy;request messages it receives with a Layer 3 unicast
      destination address.</t>

      <t>A client or server MUST discard any received DHCP messages
      with an unknown message type.</t>

      <section title="Use of Transaction IDs">

        <t>The "transaction-id" field holds a value used by clients and
        servers to synchronize server responses to client messages. A client
        SHOULD generate a random number that cannot easily be guessed or
        predicted to use as the transaction ID for each new message it sends.
        Note that if a client generates easily predictable transaction
        identifiers, it may become more vulnerable to certain kinds of attacks
        from off-path intruders. A client MUST leave the transaction ID
        unchanged in retransmissions of a message.</t>
      </section>

      <section title="Solicit Message">

        <t>Clients MUST discard any received Solicit messages.</t>

        <t>Servers MUST discard any Solicit messages that do not include a
        Client Identifier option or that do include a Server Identifier
        option.</t>
      </section>

      <section title="Advertise Message">

        <t>Clients MUST discard any received Advertise message that meets any
        of the following conditions:</t>

     <t><list style="symbols">
            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the message does not include a Client Identifier
            option (see <xref target="RFC3315-22.2"/>).</t>

            <t>the contents of the Client Identifier option do
            not match the client's DUID.</t>

            <t>the "transaction-id" field value does not match
            the value the client used in its Solicit message.</t>
          </list></t>

        <t>Servers and relay agents MUST discard any received Advertise
        messages.</t>
      </section>

      <section title="Request Message">

        <t>Clients MUST discard any received Request messages.</t>

        <t>Servers MUST discard any received Request message that meets any of
        the following conditions:</t>

      <t><list style="symbols">
            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the contents of the Server Identifier option do
            not match the server's DUID.</t>

            <t>the message does not include a Client Identifier
            option (see <xref target="RFC3315-22.2"/>).</t>
          </list></t>
      </section>

      <section title="Confirm Message">

        <t>Clients MUST discard any received Confirm messages.</t>

        <t>Servers MUST discard any received Confirm messages that do not
        include a Client Identifier option (see <xref target="RFC3315-22.2"/>) 
        or that do include a Server Identifier option (see
        <xref target="RFC3315-22.3"/>).</t>
      </section>

      <section title="Renew Message">

        <t>Clients MUST discard any received Renew messages.</t>

        <t>Servers MUST discard any received Renew message that meets any of
        the following conditions:</t>

       <t><list style="symbols">
            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the contents of the Server Identifier option do
            not match the server's identifier.</t>

            <t>the message does not include a Client Identifier
            option (see <xref target="RFC3315-22.2"/>).</t>
          </list></t>
      </section>

      <section title="Rebind Message">

        <t>Clients MUST discard any received Rebind messages.</t>

        <t>Servers MUST discard any received Rebind messages that do not
        include a Client Identifier option (see <xref target="RFC3315-22.2"/>)
        or that do include a Server Identifier option (see
        <xref target="RFC3315-22.3"/>).</t>
      </section>

      <section title="Decline Message">

        <t>Clients MUST discard any received Decline messages.</t>

        <t>Servers MUST discard any received Decline message that meets any of
        the following conditions:</t>

     <t><list style="symbols">
            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the contents of the Server Identifier option do
            not match the server's identifier.</t>

            <t>the message does not include a Client Identifier
            option (see <xref target="RFC3315-22.2"/>).</t>
          </list></t>
      </section>

      <section title="Release Message">

        <t>Clients MUST discard any received Release messages.</t>

        <t>Servers MUST discard any received Release message that meets any of
        the following conditions:</t>

      <t><list style="symbols">
            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the contents of the Server Identifier option do
            not match the server's identifier.</t>

            <t>the message does not include a Client Identifier
            option (see <xref target="RFC3315-22.2"/>).</t>
          </list></t>
      </section>

      <section title="Reply Message">

        <t>Clients MUST discard any received Reply message that meets any of
        the following conditions:</t>

    <t><list style="symbols">
            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the "transaction-id" field in the message does not
            match the value used in the original message.</t>
          </list></t>

        <t>If the client included a Client Identifier option (see <xref
        target="RFC3315-22.2"/>) in the original message,
        the Reply message MUST include a
        Client Identifier option, and the contents of the Client Identifier
        option MUST match the DUID of the client.  If the client did not
        include a Client Identifier option in the original message, the Reply
        message MUST NOT include a Client Identifier option.
</t>

        <t>Servers and relay agents MUST discard any received Reply
        messages.</t>
      </section>

      <section title="Reconfigure Message">

        <t>Servers and relay agents MUST discard any received Reconfigure
        messages.</t>

        <t>Clients MUST discard any Reconfigure message that meets any of the
        following conditions:</t>

   <t><list style="symbols">
            <t>the message was not unicast to the client.</t>

            <t>the message does not include a Server Identifier
            option (see <xref target="RFC3315-22.3"/>).</t>

            <t>the message does not include a Client Identifier
            option (see <xref target="RFC3315-22.2"/>) that contains the
            client's DUID.</t>

            <t>the message does not include a Reconfigure Message
            option (see <xref target="RFC3315-22.19"/>).</t>

            <t>the Reconfigure Message option msg-type is not a
            valid value.</t>

            <t>the message does not include authentication (such
            as RKAP; see <xref target="reconfigure-protocol"/>) or fails
            authentication validation.</t>
          </list></t>
      </section>

      <section title="Information-request Message">

        <t>Clients MUST discard any received Information-request messages.</t>

        <t>Servers MUST discard any received Information-request message that
        meets any of the following conditions:</t>

    <t><list style="symbols">
            <t>the message includes a Server Identifier option
            (see <xref target="RFC3315-22.3"/>), and the DUID in the option
            does not match the server's DUID.</t>

            <t>the message includes an IA option.</t>
          </list></t>
      </section>

      <section title="Relay-forward Message">

        <t>Clients MUST discard any received Relay-forward messages.</t>
      </section>

      <section title="Relay-reply Message">

        <t>Clients and servers MUST discard any received Relay-reply
        messages.</t>
      </section>

    </section>

    <section anchor="RFC3315-16" title="Client Source Address and Interface Selection">

      <t>The client's behavior regarding interface selection is different,
      depending on the purpose of the configuration.</t>

      <section anchor="if-addr-sel-addr-assignment"
         title="Source Address and Interface Selection for Address Assignment">

        <t>When a client sends a DHCP message to the
        All_DHCP_Relay_Agents_and_Servers multicast address, it SHOULD send
        the message through the interface for which configuration information
        (including the addresses) is being requested. However, the client MAY
        send the message through another interface if the interface for which
        configuration is being requested is a logical interface without direct
        link attachment or the client is certain that two interfaces are
        attached to the same link.</t>

        <t>When a client sends a DHCP message directly to a server using
        unicast (after receiving the Server Unicast option 
        (see <xref target="RFC3315-22.12"/>) from that server),
        the source address in the header of the IPv6 datagram MUST be an
        address assigned to the interface for which the client is interested
        in obtaining configuration and that is suitable for use by the server
        in responding to the client.</t>
      </section>

      <section title="Source Address and Interface Selection for Prefix Delegation">
        <t>Delegated prefixes are not associated with a particular interface
        in the same way as addresses are for address assignment as mentioned
        in <xref target="if-addr-sel-addr-assignment"/> above.</t>

        <t>When a client sends a DHCP message
        for the purpose of prefix delegation, it SHOULD be sent on the
        interface associated with the upstream router (typically, connected
        to an ISP network); see <xref target="RFC7084"/>. The
        upstream interface is typically determined by configuration. This rule
        applies even in the case where a separate IA_PD is used for each
        downstream interface.</t>

        <t>When a client sends a DHCP message directly to a
        server using unicast (after receiving the Server Unicast
        option (see <xref target="RFC3315-22.12"/>) from that server), the
        source address SHOULD be an address that is from the upstream
        interface and that is suitable for use by the server in
        responding to the client.</t>
      </section>
    </section>

    <section anchor="configuration-exchange"
             title="DHCP Configuration Exchanges">
      <t>A client initiates a message exchange with a server or servers to
      acquire or update configuration information of interest. A client has
      many reasons to initiate the configuration exchange. Some of the
      more common ones are:
      <list style="numbers">
        <t>as part of the operating system configuration/bootstrap process,</t>
        <t>when requested to do so by the application layer
        (through an operating-system-specific API),</t>
        <t>when a Router Advertisement indicates that DHCPv6 is available for
        address configuration (see Section&nbsp;4.2 of
        <xref target="RFC4861"/>),</t>
        <t>as required to extend the lifetime of address(es) and/or
        delegated prefix(es), using Renew and Rebind messages, or</t>
        <t>upon the receipt of a Reconfigure message, when requested to do so
        by a server.</t>
      </list>
      </t>

      <t>The client is responsible for creating IAs and requesting that a
      server assign addresses and/or delegated prefixes to the IAs. The
      client first creates the IAs and assigns IAIDs to them. The client then
      transmits a Solicit message containing the IA options describing the
      IAs. The client MUST NOT be using any of the addresses or delegated
      prefixes for which it tries to obtain the bindings by sending the
      Solicit message. In particular, if the client had some valid bindings
      and has chosen to start the server discovery process to obtain the
      same bindings from a different server, the client MUST stop using the
      addresses and delegated prefixes for the bindings that it had obtained
      from the previous server (see <xref target="RFC3315-18.1.6"/> for
      more details on what "stop using" means in this context) and that it is
      now trying to obtain from a new server.</t>

      <t>A DHCP client that does not need to have a DHCP server assign
      IP addresses or delegated prefixes to it can obtain configuration
      information such as a list of available DNS servers <xref
      target="RFC3646"/> or NTP servers <xref target="RFC5908"/> through a
      single message and reply exchange with a DHCP server.  To obtain
      configuration information, the client first sends an Information-request
      message (see <xref target="RFC3315-18.1.5"/>) to the
      All_DHCP_Relay_Agents_and_Servers multicast address.  Servers respond
      with a Reply message containing the configuration information for the
      client (see <xref target="RFC3315-18.2.5"/>).</t>

      <t>To request the assignment of one or more addresses or delegated
      prefixes, a client first locates a DHCP server and then requests the
      assignment of addresses/prefixes and other configuration information from the
      server. The client does this by sending the Solicit message
      (see <xref target="solicit-create-transmit"/>) to the
      All_DHCP_Relay_Agents_and_Servers multicast address and collecting
      Advertise messages from the servers that respond to the client's
      message; the client then selects a server from which it wants to obtain
      configuration information. This process is referred to as server
      discovery. When the client has selected the server, it sends a Request
      message to that server as described in <xref
      target="request-create-transmit"/>.</t>

      <t>A client willing to perform the Solicit/Reply message
      exchange described in <xref
      target="solicit-create-transmit"/> includes a Rapid
      Commit option (see <xref target="RFC3315-22.14"/>) in its
      Solicit message.</t>

      <t>Servers that can assign addresses or delegated prefixes to the IAs
      respond to the client with an Advertise message or Reply message if the
      client included a Rapid Commit option and the server is configured to
      accept it.</t>

      <t>If the server responds with an Advertise message, the client initiates
      a configuration exchange as described in
      <xref target="request-create-transmit"/>.</t>

      <t>A server may initiate a message exchange with a client by sending a
      Reconfigure message to cause the client to send a Renew, Rebind, or
      Information-request message to refresh its configuration information as
      soon as the Reconfigure message is received by the client.</t>

      <t><xref target="FigMsgFlow"/> shows a timeline diagram of the
      messages exchanged between a client and two servers for the
      typical lifecycle of one or more leases. This starts with the
      four-message Solicit/Advertise/Request&wj;/Reply
      exchange to obtain the lease(s), followed by a two&nbhy;message
      Renew/Reply exchange to extend the lifetime on the lease(s), and then
      ends with a two-message Release/Reply exchange to end the
      client's use of the lease(s).</t>

      <figure align="center" anchor="FigMsgFlow"
              title="Timeline Diagram of the Messages Exchanged between
                     a Client and Two Servers for the Typical Lifecycle
                     of One or More Leases">

        <artwork align="left"><![CDATA[
             Server                          Server
         (not selected)      Client        (selected)

               v               v               v
               |               |               |
               |     Begins initialization     |
               |               |               |
  start of     | _____________/|\_____________ |
  4-message    |/ Solicit      | Solicit      \|
  exchange     |               |               |
           Determines          |          Determines
          configuration        |         configuration
               |               |               |
               |\              |  ____________/|
               | \________     | /Advertise    |
               | Advertise\    |/              |
               |           \   |               |
               |      Collects Advertises      |
               |             \ |               |
               |     Selects configuration     |
               |               |               |
               | _____________/|\_____________ |
               |/ Request      |  Request     \|
               |               |               |
               |               |     Commits configuration
               |               |               |
  end of       |               | _____________/|
  4-message    |               |/ Reply        |
  exchange     |               |               |
               |    Initialization complete    |
               |               |               |
               .               .               .
               .               .               .
               |   T1 (renewal) timer expires  |
               |               |               |
  2-message    | _____________/|\_____________ |
  exchange     |/ Renew        |  Renew       \|
               |               |               |
               |               | Commits extended lease(s)
               |               |               |
               |               | _____________/|
               |               |/ Reply        |
               .               .               .
               .               .               .
               |               |               |
               |      Graceful shutdown        |
               |               |               |
  2-message    | _____________/|\_____________ |
  exchange     |/ Release      |  Release     \|
               |               |               |
               |               |         Discards lease(s)
               |               |               |
               |               | _____________/|
               |               |/ Reply        |
               |               |               |
               v               v               v
        ]]></artwork>
      </figure>

     <section title="A Single Exchange for Multiple IA Options">
         
      <t>This document assumes that a client SHOULD use a single transaction
      for all of the IA options required on an interface; this simplifies
      the client implementation and reduces the potential number of
      transactions required (for the background on this design
      choice, refer to Section&nbsp;4 of <xref target="RFC7550"/>). To facilitate
      a client's use of a single transaction for all IA options, servers
      MUST return the same T1/T2 values for all IA options in a Reply
      (see Sections&nbsp;<xref target="RFC3315-18.2.1" format="counter"/>,
      <xref target="RFC3315-18.2.3" format="counter"/>,
      and <xref target="RFC3315-18.2.4" format="counter"/>) so that the
      client will
      generate a single transaction when renewing or rebinding its leases.
      However, because some servers may not yet conform to this requirement,
      a client MUST be prepared to select appropriate T1/T2 times as
      described in <xref target="RFC3315-18.1.3"/>.</t>
          
     </section>

      <section anchor="Client-Behavior" title="Client Behavior">

        <t>A client uses the Solicit message to discover DHCP servers
        configured to assign leases or return other configuration parameters
        on the link to which the client is attached.</t>

        <t>A client uses Request, Renew, Rebind, Release, and Decline messages
        during the normal lifecycle of addresses and delegated prefixes. When
        a client detects that it may have moved to a new link, it uses
        Confirm if it only has addresses and Rebind if it has delegated
        prefixes (and addresses). It uses Information-request messages when it
        needs configuration information but no addresses and no prefixes.</t>

        <t>When a client requests multiple IA option types or multiple
        instances of the same IA types in a Solicit, Request, Renew, or
        Rebind, it is possible
        that the available server(s) may only be configured to offer a subset
        of them. When possible, the client SHOULD use the best configuration
        available and continue to request the additional IAs in subsequent
        messages. This allows the client to maintain
        a single session and state machine. In practice, especially in the
        case of handling IA_NA and IA_PD requests <xref target="RFC7084"/>,
        this situation should be rare or a result of a temporary operational
        error. Thus, it is more likely that the client will get all
        configuration if it continues, in each subsequent configuration
        exchange, to request all the configuration information it is
        programmed to try to obtain, including any stateful configuration
        options for which no results were returned in previous message
        exchanges.</t>

        <t>Upon receipt of a Reconfigure message from the server, a client
        responds with a Renew, Rebind, or Information-request message as
        indicated by the Reconfigure Message option (see <xref target="RFC3315-22.19"/>).
        The client SHOULD be suspicious of the Reconfigure message (they
        may be faked), and it MUST NOT abandon any resources it might have
        already obtained.
        The client SHOULD treat the Reconfigure message as if the T1 timer
        had expired.  The client will expect the server to send IAs
        and/or other configuration information to the client in a Reply
        message.</t>

        <t>If the client has a source address of sufficient scope that can be
        used by the server as a return address and the client has received a
        Server Unicast option (see <xref target="RFC3315-22.12"/>) from the
        server, the client SHOULD unicast any Request, Renew, Release, and
        Decline messages to the server.</t>


        <t>Use of unicast may avoid delays due to the relaying of messages
            by relay agents, as well as avoid overhead on servers due to
            the delivery of client messages to multiple
            servers. However, requiring the client to relay all DHCP messages
            through a relay agent enables the inclusion of relay agent options
            in all messages sent by the client. The server should enable the
            use of unicast only when relay agent options will not be used.</t>

        <section anchor="solicit-create-transmit"
                 title="Creation and Transmission of Solicit Messages">

          <t>The client sets the "msg-type" field to SOLICIT. The client
          generates a transaction ID and inserts this value in the
          "transaction-id" field.</t>

          <t>The client MUST include a Client Identifier option (see
          <xref target="RFC3315-22.2"/>) to identify
          itself to the server. The client includes IA options for any IAs to
          which it wants the server to assign leases.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>The client uses IA_NA options (see <xref target="RFC3315-22.4"/>)
          to request the assignment of non-temporary addresses, IA_TA options
          (see <xref target="RFC3315-22.5"/>) to request the assignment of
          temporary addresses, and IA_PD options (see
          <xref target="IA_PD-option"/>) to request prefix delegation.
          IA_NA, IA_TA, or IA_PD options, or a combination of all, can
          be included in DHCP messages. In addition, multiple instances of any
          IA option type can be included.</t>

          <t>The client MAY include addresses in IA Address options (see
          <xref target="RFC3315-22.6"/>) encapsulated
          within IA_NA and IA_TA options as hints to the server about the
          addresses for which the client has a preference.</t>

          <t>The client MAY include values in IA Prefix options (see
          <xref target="IAPREFIX-option"/>)
          encapsulated within IA_PD options as hints for the delegated prefix
          and/or prefix length for which the client has a preference. See
          <xref target="RFC3315-18.1.3"/> for more on prefix-length hints.</t>

          <t>The client MUST include an Option Request option (ORO) (see <xref
          target="RFC3315-22.7"/>) to request the SOL_MAX_RT option (see
          <xref target="SOL_MAX_RT_option"/>) and any other options the
          client is interested in receiving. The client MAY additionally
          include instances of those options that are identified in the Option
          Request option, with data values as hints to the server about
          parameter values the client would like to have returned.</t>

          <t>The client includes a Reconfigure Accept option (see <xref
          target="RFC3315-22.20"/>) if the client is willing to accept
          Reconfigure messages from the server.</t>

          <t>The client MUST NOT include any other options in the Solicit
          message, except as specifically allowed in the definition of
          individual options.</t>

          <t>The first Solicit message from the client on the interface SHOULD
          be delayed by a random amount of time between 0 and SOL_MAX_DELAY.
          This random delay helps desynchronize clients that start a DHCP
          session at the same time, such as after recovery from a power
          failure or after a router outage after seeing that DHCP is
          available in Router Advertisement messages (see Section&nbsp;4.2 of
          <xref target="RFC4861"/>).</t>

          <t>The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">SOL_TIMEOUT</t>

              <t hangText="   MRT">SOL_MAX_RT</t>

              <t hangText="   MRC">0</t>

              <t hangText="   MRD">0</t>
            </list></t>

            <t>A client that wishes to use the Rapid Commit two-message exchange
            includes a Rapid Commit option (see <xref target="RFC3315-22.14"/>)
            in its Solicit message.
            The client may receive a number of different replies from
            different servers.  The client will make note of any valid Advertise
            messages that it receives.  The client will discard any Reply
            messages that do not contain the Rapid Commit option.
            </t>
            <t>Upon receipt of a valid Reply with the Rapid Commit option,
            the client processes the message as described in
            <xref target="RFC3315-18.1.8"/>.</t>
            <t>At the end of the first RT period, if no suitable Reply
            messages are received but the client has valid Advertise
            messages, then the client processes the Advertise as
            described in <xref target="RFC3315-17.1.3"/>.</t>

          <t>If the client subsequently receives a valid Reply message that
          includes a Rapid Commit option, it does one of the following:</t>

          <t><list style="symbols">
              <t>processes the Reply message as described in
              <xref target="RFC3315-18.1.8"/> and discards any Reply
              messages received in response to the Request message</t>

              <t>processes any Reply messages received in
              response to the Request message and discards the Reply message
              that includes the Rapid Commit option</t>
            </list></t>

          <t>If the client is waiting for an Advertise message, the mechanism
          described in <xref target="RFC3315-14"/> is modified as follows for
          use in the transmission of Solicit messages. The message exchange is
          not terminated by the receipt of an Advertise before the first RT has
          elapsed. Rather, the client collects valid Advertise messages until
          the first RT has elapsed. Also, the first RT MUST be selected to be
          strictly greater than IRT by choosing RAND to be strictly greater
          than 0.</t>

          <t>A client MUST collect valid Advertise messages for the first
          RT&nbsp;seconds, unless it receives a valid Advertise message with a preference
          value of 255. The preference value is carried in the Preference
          option (see <xref target="RFC3315-22.8"/>). Any valid Advertise that
          does not include a Preference option is considered to have a
          preference value of 0. If the client receives a valid Advertise message
          that includes a Preference option with a preference value of 255,
          the client immediately begins a client-initiated message exchange
          (as described in <xref target="request-create-transmit"/>) by
          sending a Request message to the server from which the Advertise
          message was received. If the client receives a valid Advertise message
          that does not include a Preference option with a preference value of
          255, the client continues to wait until the first RT elapses. If the
          first RT elapses and the client has received a valid Advertise message,
          the client SHOULD continue with a client-initiated message exchange
          by sending a Request message.</t>

          <t>If the client does not receive any valid Advertise messages before the
          first RT has elapsed, it then applies the retransmission mechanism
          described in <xref target="RFC3315-14"/>. The client
          terminates the retransmission process as soon as it receives any
          valid Advertise message, and the client acts on the received Advertise
          message without waiting for any additional Advertise messages.</t>

          <t>A DHCP client SHOULD choose MRC and MRD values of 0. If the DHCP
          client is configured with either MRC or MRD set to a value other
          than 0, it MUST stop trying to configure the interface if the
          message exchange fails. After the DHCP client stops trying to
          configure the interface, it SHOULD restart the reconfiguration
          process after some external event, such as user input, system
          restart, or when the client is attached to a new link.</t>

        </section>

        <section anchor="request-create-transmit"
                 title="Creation and Transmission of Request Messages">

          <t>The client uses a Request message to populate IAs with leases and
          obtain other configuration information. The client includes one or
          more IA options in the Request message. The server then returns
          leases and other information about the IAs to the client in IA
          options in a Reply message.</t>

          <t>The client sets the "msg-type" field to REQUEST.
          The client generates a transaction ID and inserts this value in
          the "transaction-id" field.</t>

          <t>The client MUST include the identifier of the destination server in a
          Server Identifier option (see <xref target="RFC3315-22.3"/>).</t>

          <t>The client MUST include a Client Identifier option (see
          <xref target="RFC3315-22.2"/>) to identify
          itself to the server. The client adds any other appropriate options,
          including one or more IA options.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>The client MUST include an Option Request option (see <xref
          target="RFC3315-22.7"/>) to request the SOL_MAX_RT option (see
          <xref target="SOL_MAX_RT_option"/>) and any other options the
          client is interested in receiving. The client MAY additionally
          include instances of those options that are identified in the Option
          Request option, with data values as hints to the server about
          parameter values the client would like to have returned.</t>

          <t>The client includes a Reconfigure Accept option (see <xref
          target="RFC3315-22.20"/>) if the client is willing to
          accept Reconfigure messages from the server.</t>

          <t>The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">REQ_TIMEOUT</t>

              <t hangText="   MRT">REQ_MAX_RT</t>

              <t hangText="   MRC">REQ_MAX_RC</t>

              <t hangText="   MRD">0</t>
            </list></t>

          <t>If the message exchange fails, the client takes an action based
          on the client's local policy. Examples of actions the client might
          take include the following:</t>

       <t><list style="symbols">
              <t>Select another server from a list of servers
              known to the client -- for example, servers that responded with
              an Advertise message.</t>

              <t>Initiate the server discovery process described
              in <xref target="configuration-exchange"/>.</t>

              <t>Terminate the configuration process and report
              failure.</t>
            </list></t>
        </section>

        <section anchor="RFC3315-18.1.2"
                 title="Creation and Transmission of Confirm Messages">

          <t>The client uses a Confirm message when it has only addresses
          (no delegated prefixes) assigned by a DHCP server to determine if it
          is still connected to the same link when the client detects a
          change in network information as described in <xref target="RFC3315-18.2.12"/>.</t>

          <t>The client sets the "msg-type" field to CONFIRM. The client
          generates a transaction ID and inserts this value in the
          "transaction-id" field.</t>

          <t>The client MUST include a Client Identifier option (see
          <xref target="RFC3315-22.2"/>) to identify itself to the server.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>The client includes IA options for all of the
          IAs assigned to the interface for which the Confirm message is being
          sent. The IA options include all of the addresses the client
          currently has associated with those IAs. The client SHOULD set the
          T1 and T2 fields in any IA_NA options (see
          <xref target="RFC3315-22.4"/>) and the preferred&nbhy;lifetime and
          valid-lifetime fields in the IA Address options (see
          <xref target="RFC3315-22.6"/>) to 0, as the server
          will ignore these fields.</t>

          <t>The first Confirm message from the client on the interface MUST
          be delayed by a random amount of time between 0 and CNF_MAX_DELAY.
          The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">CNF_TIMEOUT</t>

              <t hangText="   MRT">CNF_MAX_RT</t>

              <t hangText="   MRC">0</t>

              <t hangText="   MRD">CNF_MAX_RD</t>
            </list></t>

          <t>If the client receives no responses before the message
          transmission process terminates, as described in <xref
          target="RFC3315-14"/>, the client SHOULD continue to use any
          leases, using the last known lifetimes for those leases,
          and SHOULD continue to use any other previously obtained
          configuration parameters.</t>
        </section>

        <section anchor="RFC3315-18.1.3"
                 title="Creation and Transmission of Renew Messages">

          <t>To extend the preferred and valid lifetimes for the leases
          assigned to the IAs and obtain new addresses or delegated prefixes
          for IAs, the client sends a Renew message to the server from which
          the leases were obtained; the Renew message includes IA options for
          the IAs whose lease lifetimes are to be extended. The client
          includes IA Address options (see <xref target="RFC3315-22.6"/>)
          within IA_NA (see <xref target="RFC3315-22.4"/>) and IA_TA
          (see <xref target="RFC3315-22.5"/>) options for the addresses
          assigned to the IAs. The client includes IA Prefix options
          (see <xref target="IAPREFIX-option"/>) within IA_PD options
          (see <xref target="IA_PD-option"/>) for the delegated prefixes
          assigned to the IAs.</t>

          <t>The server controls the time at which the client should contact the
          server to extend the lifetimes on assigned leases through the T1 and
          T2 values assigned to an IA. However, as the client SHOULD
          renew&wj;/rebind all IAs from the server at the same time, the client
          MUST select T1 and T2 times from all IA options that will
          guarantee that the client initiates transmissions of Renew/Rebind
          messages not later than at the T1/T2 times associated with any of
          the client's bindings (earliest T1/T2).</t>

          <t>At time T1, the client initiates a Renew/Reply message exchange
          to extend the lifetimes on any leases in the IA.</t>

          <t>A client MUST also initiate a Renew/Reply message exchange before
          time T1 if the client's link-local address used in previous
          interactions with the server is no longer valid and it is willing
          to receive Reconfigure messages.</t>

          <t>If T1 or T2 had been set to 0 by the server (for an IA_NA or
          IA_PD) or there are no T1 or T2 times (for an IA_TA) in a previous
          Reply, the client may, at its discretion, send a Renew or Rebind
          message, respectively. The client MUST follow the rules defined
          in <xref target="t1-t2-0"/>.</t>

          <t>The client sets the "msg-type" field to RENEW. The client
          generates a transaction ID and inserts this value in the
          "transaction-id" field.</t>

          <t>The client MUST include a Server Identifier option
          (see <xref target="RFC3315-22.3"/>) in the Renew
          message, identifying the server with which the client most recently
          communicated.</t>

          <t>The client MUST include a Client Identifier option
          (see <xref target="RFC3315-22.2"/>) to identify
          itself to the server. The client adds any appropriate options,
          including one or more IA options.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>For IAs to which leases have been assigned, the client includes a
          corresponding IA option containing an IA Address option for each
          address assigned to the IA and an IA Prefix option for each prefix
          assigned to the IA. The client MUST NOT include addresses and
          prefixes in any IA option that the client did not obtain from the
          server or that are no longer valid (that have a valid lifetime of
          0).</t>

          <t>The client MAY include an IA option for each binding it desires
          but has been unable to obtain. In this case, if the client includes
          the IA_PD option to request prefix delegation, the client MAY
          include the IA Prefix option encapsulated within the IA_PD option,
          with the "IPv6&nbhy;prefix" field set to 0 and the "prefix-length"
          field set to the desired length of the prefix to be delegated. The
          server MAY use this value as a hint for the prefix length. The client
          SHOULD NOT include an IA Prefix option with the
          "IPv6&nbhy;prefix" field set to 0 unless it is supplying a hint for
          the prefix length.</t>

          <t>The client includes an Option Request option
          (see <xref target="RFC3315-22.7"/>) to request the SOL_MAX_RT
          option (see <xref target="SOL_MAX_RT_option"/>) and any other
          options the client is interested in receiving. The client MAY
          include options with data values as hints to the server about
          parameter values the client would like to have returned.</t>

          <t>The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">REN_TIMEOUT</t>

              <t hangText="   MRT">REN_MAX_RT</t>

              <t hangText="   MRC">0</t>

              <t hangText="   MRD">Remaining time until earliest T2</t>
            </list></t>

          <t>The message exchange is terminated when the earliest time T2 is
          reached. While the client is responding to a Reconfigure, the client
          ignores and discards any additional Reconfigure messages it may
          receive.</t>

          <t>The message exchange is terminated when the earliest
          time T2 is reached, at which point the client begins the Rebind
          message exchange (see <xref target="RFC3315-18.1.4"/>).</t>
        </section>

        <section anchor="RFC3315-18.1.4"
                 title="Creation and Transmission of Rebind Messages">

          <t>At time T2 (which will only be reached if the server to which the
          Renew message was sent starting at time T1 has not responded), the
          client initiates a Rebind/Reply message exchange with any available
          server.</t>

          <t>A Rebind is also used to verify delegated prefix bindings but
          with different retransmission parameters as described in
          <xref target="RFC3315-18.1.2"/>.</t>

          <t>The client constructs the Rebind message as described in <xref
          target="RFC3315-18.1.3"/>, with the following differences:</t>

      <t><list style="symbols">
              <t>The client sets the "msg-type" field to
              REBIND.</t>

              <t>The client does not include the Server
              Identifier option (see <xref target="RFC3315-22.3"/>) in
              the Rebind message.</t>
            </list></t>

          <t>The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">REB_TIMEOUT</t>

              <t hangText="   MRT">REB_MAX_RT</t>

              <t hangText="   MRC">0</t>

              <t hangText="   MRD">Remaining time until valid lifetimes of all
              leases in all IAs have expired</t>
            </list></t>

          <t>If all leases for an IA have expired, the client may choose to
          include this IA in subsequent Rebind messages to indicate that the
          client is interested in assignment of the leases to this IA.</t>

          <t>The message exchange is terminated when the valid lifetimes of
          all leases across all IAs have expired, at which time the client
          uses the Solicit message to locate a new DHCP server and sends a
          Request for the expired IAs to the new server. If the terminated
          Rebind exchange was initiated as a result of receiving a Reconfigure
          message, the client ignores and discards the Reconfigure
          message.</t>
        </section>

        <section anchor="RFC3315-18.1.5"
                 title="Creation and Transmission of Information-request Messages">

          <t>The client uses an Information-request message to obtain
          configuration information without having addresses and/or delegated
          prefixes assigned to it.</t>

          <t>The client sets the "msg-type" field to INFORMATION-REQUEST. The
          client generates a transaction ID and inserts this value in the
          "transaction-id" field.</t>

          <t>The client SHOULD include a Client Identifier option
          (see <xref target="RFC3315-22.2"/>) to identify
          itself to the server (however, see
          Section&nbsp;4.3.1 of <xref target="RFC7844"/> for
          reasons why a client may not want to include this option). If the
          client does not include a Client
          Identifier option, the server will not be able to return any
          client&nbhy;specific options to the client, or the server may
          choose not to respond to the message at all.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>The client MUST include an Option Request option (see <xref
          target="RFC3315-22.7"/>) to request the INF_MAX_RT option (see
          <xref target="INF_MAX_RT_option"/>), the Information
          Refresh Time option (see <xref target="RFC4242-Option"/>), and any other options the
          client is interested in receiving. The client MAY include options
          with data values as hints to the server about parameter values the
          client would like to have returned.</t>

          <t>When responding to a Reconfigure, the client includes a Server
          Identifier option (see <xref target="RFC3315-22.3"/>) with the
          identifier from the Reconfigure message
          to which the client is responding.</t>

          <t>The first Information-request message from the client on the
          interface MUST be delayed by a random amount of time between 0 and
          INF_MAX_DELAY. The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">INF_TIMEOUT</t>

              <t hangText="   MRT">INF_MAX_RT</t>

              <t hangText="   MRC">0</t>

              <t hangText="   MRD">0</t>
          </list></t>

        </section>

        <section anchor="RFC3315-18.1.6"
                 title="Creation and Transmission of Release Messages">

          <t>To release one or more leases, a client sends a Release message
          to the server.</t>

          <t>The client sets the "msg-type" field to RELEASE. The client
          generates a transaction ID and places this value in the
          "transaction&nbhy;id" field.</t>

          <t>The client places the identifier of the server that allocated the
          lease(s) in a Server Identifier option
           (see <xref target="RFC3315-22.3"/>).</t>

          <t>The client MUST include a Client Identifier option
          (see <xref target="RFC3315-22.2"/>) to identify
          itself to the server.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>The client includes options containing the IAs
          for the leases it is releasing in the "options" field. The leases to
          be released MUST be included in the IAs. Any leases for the IAs the
          client wishes to continue to use MUST NOT be added to the IAs.</t>

          <t>The client MUST stop using all of the leases being released
          before the client begins the Release message exchange process. For
          an address, this means the address MUST have been removed from the
          interface. For a delegated prefix, this means the prefix MUST have
          been advertised with a Preferred Lifetime and a Valid Lifetime of 0
          in a Router Advertisement message as described in part (e) of
          Section&nbsp;5.5.3 of <xref target="RFC4862"/>; also see
          requirement L-13 in Section&nbsp;4.3 of <xref target="RFC7084"/>.</t>

          <t>The client MUST NOT use any of the addresses it is releasing as
          the source address in the Release message or in any subsequently
          transmitted message.</t>

          <t>Because Release messages may be lost, the client should
          retransmit the Release if no Reply is received. However, there are
          scenarios where the client may not wish to wait for the normal
          retransmission timeout before giving up (e.g., on power down).
          Implementations SHOULD retransmit one or more times but MAY choose
          to terminate the retransmission procedure early.</t>

          <t>The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">REL_TIMEOUT</t>

              <t hangText="   MRT">0</t>

              <t hangText="   MRC">REL_MAX_RC</t>

              <t hangText="   MRD">0</t>
            </list></t>

          <t>If leases are released but the Reply from a DHCP server is lost,
          the client will retransmit the Release message, and the server may
          respond with a Reply indicating a status of NoBinding. Therefore,
          the client does not treat a Reply message with a status of NoBinding
          in a Release message exchange as if it indicates an error.</t>

          <t>Note that if the client fails to release the lease, each lease
          assigned to the IA will be reclaimed by the server when the valid
          lifetime of that lease expires.</t>
        </section>

        <section anchor="RFC3315-18.1.7"
                 title="Creation and Transmission of Decline Messages">

          <t>If a client detects that one or more addresses assigned to it by
          a server are already in use by another node, the client sends a
          Decline message to the server to inform it that the address is
          suspect.</t>

          <t>The Decline message is not used in prefix delegation; thus, the
          client MUST NOT include IA_PD options
          (see <xref target="IA_PD-option"/>) in the Decline message.</t>

          <t>The client sets the "msg-type" field to DECLINE. The client
          generates a transaction ID and places this value in the
          "transaction&nbhy;id" field.</t>

          <t>The client places the identifier of the server that allocated the
          address(es) in a Server Identifier option
          (see <xref target="RFC3315-22.3"/>).</t>

          <t>The client MUST include a Client Identifier option
          (see <xref target="RFC3315-22.2"/>) to identify
          itself to the server.</t>

          <t>The client MUST include an Elapsed Time option (see
          <xref target="RFC3315-22.9"/>) to indicate how long the client has
          been trying to complete the current DHCP message exchange.</t>

          <t>The client includes options containing the IAs
          for the addresses it is declining in the "options" field. The
          addresses to be declined MUST be included in the IAs. Any addresses
          for the IAs the client wishes to continue to use should not be
          added to the IAs.</t>

          <t>The client MUST NOT use any of the addresses it is declining as
          the source address in the Decline message or in any subsequently
          transmitted message.</t>

          <t>The client transmits the message according to <xref
          target="RFC3315-14"/>, using the following parameters: <list
              hangIndent="11" style="hanging">
              <t hangText="   IRT">DEC_TIMEOUT</t>

              <t hangText="   MRT">0</t>

              <t hangText="   MRC">DEC_MAX_RC</t>

              <t hangText="   MRD">0</t>
            </list></t>

          <t>If addresses are declined but the Reply from a DHCP server is
          lost, the client will retransmit the Decline message, and the server
          may respond with a Reply indicating a status of NoBinding.
          Therefore, the client does not treat a Reply message with a status
          of NoBinding in a Decline message exchange as if it indicates an
          error.</t>

          <t>The client SHOULD NOT send a Release message for other bindings
          it may have received just because it sent a Decline message. The
          client SHOULD retain the non-conflicting bindings. The client SHOULD
          treat the failure to acquire a binding (due to the conflict) as
          equivalent to not having received the binding, insofar as how it
          behaves when sending Renew and Rebind messages.</t>
        </section>

        <section anchor="RFC3315-17.1.3" title="Receipt of Advertise Messages">

          <t>Upon receipt of one or more valid Advertise messages, the client
          selects one or more Advertise messages based upon the following
          criteria.</t>

     <t><list style="symbols">
              <t>Those Advertise messages with the highest server
              preference value SHOULD be preferred over all other Advertise
              messages. The client MAY choose a less preferred server if
              that server has a better set of advertised parameters, such as
              the available set of IAs, as well as the set of other
              configuration options advertised.</t>

              <t>Within a group of Advertise messages with the
              same server preference value, a client MAY select those servers
              whose Advertise messages advertise information of interest to
              the client.</t>
          </list></t>

          <t>Once a client has selected Advertise message(s), the client will
          typically store information about each server, such as the server
          preference value, addresses advertised, when the advertisement was
          received, and so on.</t>

          <t>In practice, this means that the client will maintain independent
          per-IA state machines for each selected server.</t>

          <t>If the client needs to select an alternate server in the case
          that a chosen server does not respond, the client chooses the next
          server according to the criteria given above.</t>

          <t>The client MUST process any SOL_MAX_RT option
          (see <xref target="SOL_MAX_RT_option"/>)
          and INF_MAX_RT option (see <xref target="INF_MAX_RT_option"/>) present in an
          Advertise message, even if the message contains a Status Code option
          (see <xref target="RFC3315-22.13"/>) indicating a failure, and the
          Advertise message will be discarded by
          the client. A client SHOULD only update its SOL_MAX_RT and INF_MAX_RT
          values if all received Advertise messages that contained the
          corresponding option specified the same value; otherwise, it should
          use the default value (see <xref target="RFC3315-5.5"/>).</t>

          <t>The client MUST ignore any Advertise message that contains
          no addresses (IA Address options (see <xref target="RFC3315-22.6"/>)
          encapsulated in IA_NA options (see <xref target="RFC3315-22.4"/>) or
          IA_TA options (see <xref target="RFC3315-22.5"/>)) and
          no delegated prefixes (IA Prefix options
          (see <xref target="IAPREFIX-option"/>) encapsulated in IA_PD
          options (see <xref target="IA_PD-option"/>)), with the exception
          that the client:</t>

     <t><list style="symbols">
              <t>MUST process an included SOL_MAX_RT option
              and</t>

              <t>MUST process an included INF_MAX_RT option.</t>
            </list></t>

          <t>A client can record in an activity log or display to the user
          any associated status message(s).</t>

          <t>The client ignoring an Advertise message MUST NOT restart the
          Solicit retransmission timer.</t>

        </section>

        <section anchor="RFC3315-18.1.8" title="Receipt of Reply Messages">

          <t>Upon the receipt of a valid Reply message in response to a
          Solicit with a Rapid Commit option (see <xref target="RFC3315-22.14"/>),
          Request, Confirm, Renew, Rebind, or Information-request message,
          the client extracts the top-level Status Code option
          (see <xref target="RFC3315-22.13"/>) if present.</t>

          <t>The client MUST process any SOL_MAX_RT option
          (see <xref target="SOL_MAX_RT_option"/>) and INF_MAX_RT option
          (see <xref target="INF_MAX_RT_option"/>) present in a
          Reply message, even if the message contains a Status Code option
          indicating a failure.</t>

          <t>If the client receives a Reply message with a status code of
          UnspecFail, the server is indicating that it was unable to process
          the client's message due to an unspecified failure condition. If the
          client retransmits the original message to the same server to retry
          the desired operation, the client MUST limit the rate at which it
          retransmits the message and limit the duration of the time during
          which it retransmits the message (see <xref
          target="rate-limit"/>).</t>

          <t>If the client receives a Reply message with a status code of
          UseMulticast, the client records the receipt of the message and
          sends subsequent messages to the server through the interface on
          which the message was received using multicast. The client resends
          the original message using multicast.</t>

          <t>Otherwise (no status code or another status code), the client
          processes the Reply as described below based on the original message
          for which the Reply was received.</t>

          <t>The client MAY choose to report any status code or message from
          the Status Code option in the Reply message.</t>

          <t>When a client received a configuration option in an earlier
          Reply and then sends a Renew, Rebind, or Information-request and
          the requested option is not present in the Reply, the client
          SHOULD stop using the previously received configuration
          information.  In other words, the client should behave as if
          it never received this configuration option and return to the
          relevant default state.  If there is no viable way to stop using
          the received configuration information, the values
          received/configured from the option MAY persist if there are
          no other sources for that data and they have no external impact.
          For example, a client that previously received a Client FQDN
          option (see <xref target="RFC4704"/>) and used it to set up
          its hostname is allowed to continue
          using it if there is no reasonable way for a node to unset its
          hostname and it has no external impact.  As a counter-example,
          a client that previously received an NTP server address from
          the DHCP server and does not receive it anymore MUST stop
          using the configured NTP server address.  The client
          SHOULD be open to other sources of the same configuration
          information.  This behavior does not apply to any IA options,
          as their processing is described in detail in the next section.</t>

          <t>When a client receives a requested option that has an updated
          value from what was previously received, the client SHOULD make
          use of that updated value as soon as possible for its configuration
          information.</t>

          <section anchor="reply-solicit-request-renew-rebind"
                   title="Reply for Solicit (with Rapid Commit), Request, Renew, or Rebind">
            <t>If the client receives a NotOnLink status from the server in
            response to a Solicit (with a Rapid Commit option;
            see <xref target="RFC3315-22.14"/>) or a Request,
            the client can either reissue the message without specifying any
            addresses or restart the DHCP server discovery process (see <xref
            target="configuration-exchange"/>).</t>

            <t>If the Reply was received in response to a Solicit (with a
            Rapid Commit option), Request, Renew, or Rebind message, the
            client updates the information it has recorded about IAs from the
            IA options contained in the Reply message:</t>

    <t><list style="symbols">
                <t>Calculate T1 and T2 times (based on T1 and T2
                values sent in the packet and the packet reception time), if
                appropriate for the IA type.</t>

                <t>Add any new leases in the IA option to the IA
                as recorded by the client.</t>

                <t>Update lifetimes for any leases in the IA
                option that the client already has recorded in the IA.</t>

                <t>Discard any leases from the IA, as recorded by
                the client, that have a valid lifetime of 0 in the IA Address
                or IA Prefix option.</t>

                <t>Leave unchanged any information about leases
                the client has recorded in the IA but that were not included
                in the IA from the server.</t>
              </list></t>

            <t>If the client can operate with the addresses and/or prefixes
            obtained from the server:</t>

    <t><list style="symbols">
                <t>The client uses the addresses, delegated
                prefixes, and other information from any IAs that do not
                contain a Status Code option with the NoAddrsAvail or
                NoPrefixAvail status code. The client MAY include the IAs for
                which it received the NoAddrsAvail or NoPrefixAvail status
                code, with no addresses or prefixes, in subsequent Renew and
                Rebind messages sent to the server, to retry obtaining the
                addresses or prefixes for these IAs.</t>

                <t>The client MUST perform duplicate address
                detection as per Section&nbsp;5.4 of <xref target="RFC4862"/>,
                which does list some exceptions, on each of the
                received addresses in any IAs on which it has not performed
                duplicate address detection during processing of any of the
                previous Reply messages from the server. The client performs
                the duplicate address detection before using the received
                addresses for any traffic. If any of the addresses are found
                to be in use on the link, the client sends a Decline message
                to the server for those addresses as described in <xref
                target="RFC3315-18.1.7"/>.</t>

                <t>For each assigned address that does not have any
                associated reachability information (see the definition of
                "on&nbhy;link" in Section&nbsp;2.1 of
                <xref target="RFC4861"/>), in order to avoid the
                problems described in <xref target="RFC4943"/>, the client
                MUST NOT assume that any addresses are reachable on-link as a
                result of receiving an IA_NA or IA_TA. Addresses obtained from
                an IA_NA or IA_TA MUST NOT be used to form an implicit prefix
                with a length other than 128.</t>

                <t>For each delegated prefix, the client assigns a
                subnet to each of the links to which the associated interfaces are
                attached.
                <vspace blankLines='1'/>
                When a client subnets a delegated prefix, it must assign
                additional bits to the prefix to generate unique, longer prefixes.
                For example, if the client in <xref target="FigISPNetwork"/> were delegated
                2001:db8:0::/48, it might generate 2001:db8:0:1::/64 and
                2001:db8:0:2::/64 for assignment to the two links in the subscriber
                network.  If the client were delegated 2001:db8:0::/48
                and 2001:db8:5::/48, it might assign 2001:db8:0:1::/64 and
                2001:db8:5:1::/64 to one of the links, and 2001:db8:0:2::/64 and
                2001:db8:5:2::/64 for assignment to the other link.
                <vspace blankLines='1'/>
                If the client uses a delegated prefix to configure addresses on
                interfaces on itself or other nodes behind it, the preferred and
                valid lifetimes of those addresses MUST be no longer than the
                remaining preferred and valid lifetimes, respectively, for the
                delegated prefix at any time.  In particular, if the delegated
                prefix or a prefix derived from it is advertised for stateless
                address autoconfiguration <xref target="RFC4862"/>, the
                advertised preferred and valid lifetimes MUST NOT exceed the
                corresponding remaining lifetimes of the delegated prefix.</t>
              </list></t>

            <t>Management of the specific configuration information is
            detailed in the definition of each option in <xref
            target="RFC3315-22"/>.</t>

            <t>If the Reply message contains any IAs but the client finds no
            usable addresses and/or delegated prefixes in any of these IAs,
            the client may either try another server (perhaps restarting the
            DHCP server discovery process) or use the Information-request
            message to obtain other configuration information only.</t>

            <t>When the client receives a Reply message in response to a Renew
            or Rebind message, the client:</t>

    <t><list style="symbols">
                <t>Sends a Request message to the server that
                responded if any of the IAs in the Reply message contain the
                NoBinding status code. The client places IA options in this
                message for all IAs. The client continues to use other bindings
                for which the server did not return an error.</t>

                <t>Sends a Renew/Rebind if any of the IAs are not
                in the Reply message, but as this likely indicates that the server
                that responded does not support that IA type, sending immediately
                is unlikely to produce a different result. Therefore, the client
                MUST rate-limit its transmissions (see <xref target="rate-limit"/>)
                and MAY just wait for the normal retransmission time (as if the
                Reply message had not been received). The client continues to use
                other bindings for which the server did return information.</t>

                <t>Otherwise accepts the information in the
                IA.</t>
              </list></t>

            <t>Whenever a client restarts the DHCP server discovery process or
            selects an alternate server as described in <xref
            target="RFC3315-17.1.3"/>, the client SHOULD stop using all
            the addresses and delegated prefixes for which it has bindings and
            try to obtain all required leases from the new server. This
            facilitates the client using a single state machine for all
            bindings.</t>
          </section>

          <section anchor="reply-release-decline"
                   title="Reply for Release and Decline">
            <t>When the client receives a valid Reply message in response to a
            Release message, the client considers the Release event completed,
            regardless of the Status Code option
            (see <xref target="RFC3315-22.13"/>) returned by the server.</t>

            <t>When the client receives a valid Reply message in response to a
            Decline message, the client considers the Decline event completed,
            regardless of the Status Code option(s) returned by the
            server.</t>
          </section>

          <section anchor="reply-confirm" title="Reply for Confirm">
            <t>If the client receives
            any Reply messages that indicate a status of Success (explicit or
            implicit), the client can use the addresses in the IA and ignore
            any messages that indicate a NotOnLink status. When the client
            only receives one or more Reply messages with the NotOnLink status in
            response to a Confirm message, the client performs DHCP server
            discovery as described in <xref target="configuration-exchange"/>.</t>
          </section>
             
          <section anchor="reply-inforequest" title="Reply for Information-request">
            <t>Refer to <xref target="RFC4242-Option"/> for details on how the
            Information Refresh Time option (whether or not present in the
            Reply) should be handled by the client.</t>
          </section>

        </section>

        <section title="Receipt of Reconfigure Messages">

          <t>A client receives Reconfigure messages sent to UDP port 546
          on interfaces for which it has acquired configuration information
          through DHCP. These messages may be sent at any time. Since the
          results of a reconfiguration event may affect application-layer
          programs, the client SHOULD log these events and MAY notify these
          programs of the change through an implementation-specific
          interface.</t>

          <t>Upon receipt of a valid Reconfigure message, the client responds
          with a Renew message, a Rebind message, or an
          Information-request message as indicated by the Reconfigure Message
          option (see <xref target="RFC3315-22.19"/>). The
          client ignores the "transaction&nbhy;id" field in the received Reconfigure
          message. While the transaction is in progress, the client discards
          any Reconfigure messages it receives.</t>

          <t>The Reconfigure message acts as a trigger that signals the
          client to complete a successful message exchange. Once the
          client has received a Reconfigure, the client proceeds with the
          message exchange (retransmitting the Renew, Rebind, or
          Information-request message if necessary); the client MUST ignore
          any additional Reconfigure messages until the exchange is
          complete.</t>

          <t>Duplicate messages will be
          ignored because the client will begin the exchange after the
          receipt of the first Reconfigure. Retransmitted messages will
          either (1)&nbsp;trigger the exchange (if the first Reconfigure was
          not received by the client) or (2)&nbsp;be ignored. The server MAY
          discontinue retransmission of Reconfigure messages to the client
          once the server receives the Renew, Rebind, or
          Information&nbhy;request message from the client.</t>

          <t>It might be possible for a duplicate or retransmitted
          Reconfigure to be sufficiently delayed (and delivered out of
          order) that it arrives at the client after the exchange (initiated by
          the original Reconfigure) has been completed. In this case, the
          client would initiate a redundant exchange. The likelihood of
          delayed and out&nbhy;of&nbhy;order delivery is small enough to be
          ignored. The consequence of the redundant exchange is
          inefficiency rather than incorrect operation.</t>
        </section>

        <section anchor="RFC3315-18.2.12" title="Refreshing Configuration Information">
          <t>Whenever a client may have moved to a new link, the
          prefixes&wj;/addresses assigned to the interfaces on that link may no
          longer be appropriate for the link to which the client is attached.
          Examples of times when a client may have moved to a new link
          include the following:</t>

         <t><list style="symbols">
              <t>The client reboots (and has stable storage and
              persistent DHCP state).</t>

              <t>The client is reconnected to a link on which
              it has obtained leases.</t>

              <t>The client returns from sleep mode.</t>

              <t>The client changes access points (e.g., if
              using Wi-Fi technology).</t>

            </list></t>

          <t>When the client detects that it may have moved to a new link and it
          has obtained addresses and no delegated prefixes from a server, the
          client SHOULD initiate a Confirm/Reply message exchange. The client
          includes any IAs assigned to the interface that may have moved to a
          new link, along with the addresses associated with those IAs, in its
          Confirm message. Any responding servers will indicate whether those
          addresses are appropriate for the link to which the client is
          attached with the status in the Reply message it returns to the
          client.</t>

          <t>If the client has any valid delegated prefixes obtained from the
          DHCP server, the client MUST
          initiate a Rebind/Reply message exchange as described in <xref
          target="RFC3315-18.1.4"/>, with the exception that the
          retransmission parameters should be set as for the Confirm message
          (see <xref target="RFC3315-18.1.2"/>). The client includes IA_NAs, IA_TAs, and IA_PDs,
          along with the associated leases, in its Rebind message.</t>
    
          <t>If the client has only obtained network information using Information-request/Reply
          message exchanges, the client MUST initiate an Information-request/Reply message exchange as
          described in <xref target="RFC3315-18.1.5"/>.</t>

          <t>If not associated with one of the above-mentioned conditions, a client SHOULD 
          initiate a Renew/Reply exchange (as if the T1 time expired) as described in
          <xref target="RFC3315-18.1.3"/> or an Information-request/Reply exchange as
          described in <xref target="RFC3315-18.1.5"/> if the client detects a
          significant change regarding the prefixes
          available on the link (when new prefixes are added or existing prefixes are deprecated), as this
          may indicate a configuration change.  However, a client MUST
 rate&nbhy;limit such
          attempts to avoid flooding a server with requests when there are link issues 
          (for example, only doing one of these at most every 30&nbsp;seconds).</t>

          </section>
      </section>

      <section anchor="RFC3315-18.2" title="Server Behavior">

        <t>For this discussion, the server is assumed to have been configured
        in an implementation-specific manner with configurations of interest to
        clients.</t>

        <t>A server sends an Advertise message in response to each valid Solicit
        message it receives to announce the availability of the server to the
        client.</t>

        <t>In most cases, the server will send a Reply in response to
        Request, Confirm, Renew, Rebind, Decline, Release, and Information-request
        messages sent by a client. The server will also send a Reply in
        response to a Solicit with a Rapid Commit option
        (see <xref target="RFC3315-22.14"/>) when the server is
        configured to respond with committed lease assignments.</t>

        <t>These Advertise and Reply messages MUST always contain the
        Server Identifier option (see <xref target="RFC3315-22.3"/>) containing
        the server's DUID and the Client Identifier option
        (see <xref target="RFC3315-22.2"/>) from the
        client message if one was present.</t>

        <t>In most response messages, the server includes options containing
        configuration information for the client. The server must be aware of
        the recommendations on packet sizes and the use of fragmentation
        as discussed in Section&nbsp;5 of <xref target="RFC8200"/>. If the
        client included an Option Request option (see <xref
        target="RFC3315-22.7"/>) in its message, the server includes options
        in the response message containing configuration parameters for all of
        the options identified in the Option Request option that the server has
        been configured to return to the client. The server MAY return
        additional options to the client if it has been configured to do
        so.</t>
           
        <t>Any message sent from a client may arrive at the server
        encapsulated in one or more Relay-forward messages. The server MUST
        use the received message to construct the proper Relay-reply
        message to allow the response to the received message to be
        relayed through the same relay agents (in reverse order) as
        the original client message; see <xref target="RFC3315-20.3"/>
        for more details.
        The server may also need to record this information with each
        client in case it is needed to send a Reconfigure message at a later
        time, unless the server has been configured with addresses that can be
        used to send Reconfigure messages directly to the client (see
        <xref target="reconfigure-transmission"/>). Note that servers
        that support leasequery <xref target="RFC5007"/> also need
        to record this information.</t>

        <t>By sending Reconfigure messages, the server MAY initiate a
        configuration exchange to cause DHCP clients to obtain new addresses,
        prefixes, and other configuration information. For example, an
        administrator may use a server-initiated configuration exchange when
        links in the DHCP domain are to be renumbered or when other
        configuration options are updated, perhaps because servers
        are moved, added, or removed.</t>

        <t>When a client receives a Reconfigure message from the server, the
        client initiates sending a Renew, Rebind, or Information-request message
        as indicated by msg-type in the Reconfigure Message option (see
        <xref target="RFC3315-22.19"/>). The server sends IAs and/or
        other configuration information to the client in a Reply message. The
        server MAY include options containing the IAs and new values for other
        configuration parameters in the Reply message, even if those IAs and
        parameters were not requested in the client's message.</t>

        <section anchor="RFC3315-17.2.1" title="Receipt of Solicit Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Solicit messages received via unicast. Unicast
          transmission of Solicit messages is not allowed, regardless of
          whether the Server Unicast option (see <xref
          target="RFC3315-22.12"/>) is configured or not.</t>

          <t>The server determines the information about the client and its
          location as described in <xref target="RFC3315-11"/> and
          checks its administrative policy about responding to the client. If
          the server is not permitted to respond to the client, the server
          discards the Solicit message. For example, if the administrative
          policy for the server is that it may only respond to a client that
          is willing to accept a Reconfigure message, if the client does not
          include a Reconfigure Accept option (see <xref
          target="RFC3315-22.20"/>) in the Solicit message, the server
          discards the Solicit message.</t>

          <t>If (1) the server is permitted to respond to the client,
          (2)&nbsp;the client has not included a Rapid Commit option (see 
          <xref target="RFC3315-22.14"/>) in the Solicit message, or
          (3)&nbsp;the server has not been configured to respond with
          committed assignments of leases and other resources, the server
          sends an Advertise message to the client as described in
          <xref target="RFC3315-17.2.2"/>.</t>

          <t>If the client has included a Rapid Commit option in the Solicit
          message and the server has been configured to respond with committed
          assignments of leases and other resources, the server responds to the
          Solicit with a Reply message. The server produces the Reply message
          as though it had received a Request message as described in <xref
          target="RFC3315-18.2.1"/>. The server transmits the Reply
          message as described in <xref target="RFC3315-18.2.8"/>.
          The server MUST commit the assignment
          of any addresses and delegated prefixes or other configuration
          information before sending a Reply message to a client. In this case,
          the server includes a Rapid Commit option in the Reply message to
          indicate that the Reply is in response to a Solicit message.</t>

          <t>DISCUSSION:</t>

          <t><list style="empty">
              <t>When using the Solicit/Reply message exchange, the server
              commits the assignment of any leases before sending the Reply
              message. The client can assume that it has been assigned the
              leases in the Reply message and does not need to send a
              Request message for those leases.</t>

              <t>Typically, servers that are configured to use the
              Solicit/Reply message exchange will be deployed so that only one
              server will respond to a Solicit message. If more than one
              server responds, the client will only use the leases from one of
              the servers, while the leases from the other servers will be
              committed to the client but not used by the client.</t>
            </list></t>

        </section>

        <section anchor="RFC3315-18.2.1" title="Receipt of Request Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Request messages received via unicast.</t>

          <t>When the server receives a valid Request message, the server
          creates the bindings for that client according to the server's
          policy and configuration information and records the IAs and other
          information requested by the client.</t>

          <t>The server constructs a Reply message by setting the "msg-type"
          field to REPLY and copying the transaction ID from the Request
          message into the "transaction&nbhy;id" field.</t>

          <t>The server MUST include in the Reply message a
          Server Identifier option
          (see <xref target="RFC3315-22.3"/>) containing the
          server's DUID and the Client Identifier option
          (see <xref target="RFC3315-22.2"/>) from the Request
          message.</t>

          <t>The server examines all IAs in the message from the client.</t>

          <t>For each IA_NA option (see <xref target="RFC3315-22.4"/>) and
          IA_TA option (see <xref target="RFC3315-22.5"/>) in the Request
          message, the server checks if the prefixes of included addresses are appropriate for
          the link to which the client is connected. If any of the prefixes of
          the included addresses are not appropriate for the link to which
          the client is connected, the server MUST return the IA to the client
          with a Status Code option (see <xref target="RFC3315-22.13"/>)
          with the value NotOnLink. If the server
          does not send the NotOnLink status code but it cannot assign any IP
          addresses to an IA, the server MUST return the IA option in the Reply
          message with no addresses in the IA and a Status Code option
          containing status code NoAddrsAvail in the IA.</t>

          <t>For any IA_PD option (see <xref target="IA_PD-option"/>) in the
          Request message to which the server cannot assign any delegated
          prefixes, the server MUST return the IA_PD
          option in the Reply message with no prefixes in the IA_PD and with a
          Status Code option containing status code NoPrefixAvail in the IA_PD.</t>

          <t>The server MAY assign different addresses and/or delegated prefixes
          to an IA than those included within the IA of the client's Request
          message.</t>

          <t>For all IAs to which the server can assign addresses or delegated
          prefixes, the server includes the IAs with addresses (for IA_NAs and
          IA_TAs), prefixes (for IA_PDs), and other configuration parameters
          and records the IA as a new client binding. The server MUST NOT
          include any addresses or delegated prefixes in the IA that the
          server does not assign to the client.</t>

          <t>The T1/T2 times set in each applicable IA option for a Reply MUST
          be the same values across all IAs. The server MUST determine the
          T1/T2 times across all of the applicable client's bindings in the
          Reply. This facilitates the client being able to renew all of the
          bindings at the same time.</t>

          <t>The server SHOULD include a Reconfigure Accept option
          (see <xref target="RFC3315-22.20"/>) if the server
          policy enables the reconfigure mechanism and the client supports it.
          Currently, sending this option in a Reply is technically redundant,
          as the use of the reconfiguration mechanism requires authentication;
          at present, the only defined mechanism is RKAP (see <xref
          target="reconfigure-protocol"/>), and the presence of the
          reconfigure key signals support for the acceptance of Reconfigure
          messages. However, there may be better security mechanisms defined
          in the future that would cause RKAP to not be used anymore.</t>

          <t>The server includes other options containing configuration
          information to be returned to the client as described in <xref
          target="RFC3315-18.2"/>.</t>

          <t>If the server finds that the client has included an IA in the
          Request message for which the server already has a binding that
          associates the IA with the client, the server sends a Reply
          message with existing bindings, possibly with updated lifetimes. The
          server may update the bindings according to its local policies, but
          the server SHOULD generate the response again and not simply
          retransmit previously sent information, even if the
          "transaction&nbhy;id" field value matches a previous transmission.
          The server MUST NOT cache its responses.</t>

          <t>DISCUSSION:</t>

          <t><list style="empty">
          <t>Cached replies are bad because
          lifetimes need to be updated (either decrease the timers by
          the amount of time elapsed since the original transmission
          or keep the lifetime values and update the lease
          information in the server's database). Also, if the message uses any
          security protection (such as the Replay Detection Method (RDM),
          as described in <xref target="replay"/>), its value must be updated.
          Additionally, any digests must be updated. Given all of the above,
          caching replies is far more complex than simply sending the
          same buffer as before, and it is easy to miss some of those
          steps.</t>
        </list></t>

        </section>

        <section title="Receipt of Confirm Messages" anchor="RFC3315-18.2.2">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Confirm messages received via unicast. Unicast
          transmission of Confirm messages is not allowed, regardless of
          whether the Server Unicast option (see <xref
          target="RFC3315-22.12"/>) is configured or not.</t>

          <t>When the server receives a Confirm message, the server determines
          whether the addresses in the Confirm message are appropriate for the
          link to which the client is attached. If all of the addresses in the
          Confirm message pass this test, the server returns a status of
          Success. If any of the addresses do not pass this test, the server
          returns a status of NotOnLink. If the server is unable to perform
          this test (for example, the server does not have information about
          prefixes on the link to which the client is connected) or there
          were no addresses in any of the IAs sent by the client, the server
          MUST&nbsp;NOT send a Reply to the client.</t>

          <t>The server ignores the T1 and T2 fields in the IA options and the
          preferred-lifetime and valid-lifetime fields in the IA Address
          options (see <xref target="RFC3315-22.6"/>).</t>

          <t>The server constructs a Reply message by setting the "msg-type"
          field to REPLY and copying the transaction ID from the Confirm
          message into the "transaction&nbhy;id" field.</t>

          <t>The server MUST include in the Reply message a
          Server Identifier option
          (see <xref target="RFC3315-22.3"/>) containing the
          server's DUID and the Client Identifier option
          (see <xref target="RFC3315-22.2"/>) from the Confirm
          message. The server includes a Status Code
          option (see <xref target="RFC3315-22.13"/>) indicating the
          status of the Confirm message.</t>
        </section>

        <section anchor="RFC3315-18.2.3" title="Receipt of Renew Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Renew messages received via unicast.</t>

          <t>For each IA in the Renew message from a client, the server
          locates the client's binding and verifies that the information in
          the IA from the client matches the information stored for that
          client.</t>

          <t>If the server finds the client entry for the IA, the server sends
          the IA back to the client with new lifetimes and, if applicable,
          T1&wj;/T2 times. If the server is unable to extend the lifetimes of an
          address or delegated prefix in the IA, the server MAY choose not to
          include the IA Address option (see <xref target="RFC3315-22.6"/>) for
          that address or IA Prefix option (see <xref target="IAPREFIX-option"/>)
          for that delegated prefix. If the server chooses to include the IA Address or
          IA Prefix option for such an address or delegated prefix, the server
          SHOULD set T1 and T2 values to the valid lifetime for the IA option unless
          the server also includes other addresses or delegated prefixes that
          the server is able to extend for the IA. Setting T1 and T2
          to values equal to the valid lifetime informs the client that the leases
          associated with said IA will not be extended, so there is no
          point in trying. Also, it avoids generating unnecessary
          traffic as the remaining lifetime approaches 0.</t>

          <t>The server may choose to change the list of addresses or
          delegated prefixes and the lifetimes in IAs that are returned to the
          client.</t>

          <t>If the server finds that any of the addresses in the IA are not
          appropriate for the link to which the client is attached, the server
          returns the address to the client with lifetimes of 0.</t>

          <t>If the server finds that any of the delegated prefixes in the IA
          are not appropriate for the link to which the client is attached,
          the server returns the delegated prefix to the client with lifetimes
          of&nbsp;0.</t>

          <t>For each IA for which the server cannot find a client entry, the
          server has the following choices, depending on the server's policy
          and configuration information:</t>

  <t><list style="symbols">
              <t>If the server is configured to create new
              bindings as a result of processing Renew messages, the server
              SHOULD create a binding and return the IA with assigned
              addresses or delegated prefixes with lifetimes and, if
              applicable, T1/T2 times and other information requested by the
              client. If the client included the IA Prefix option within the
              IA_PD option (see <xref target="IA_PD-option"/>)
              with a zero value in the "IPv6-prefix" field and a
              non-zero value in the "prefix-length" field, the server MAY use
              the "prefix-length" value as a hint for the length of the
              prefixes to be assigned (see <xref target="RFC8168"/>
              for further details on prefix-length hints).</t>

              <t>If the server is configured to create new
              bindings as a result of processing Renew messages but the
              server will not assign any leases to an IA, the server returns
              the IA option containing a Status Code option
              (see <xref target="RFC3315-22.13"/>) with the
              NoAddrsAvail or NoPrefixAvail status code and a status message
              for a user.</t>

              <t>If the server does not support creation of new
              bindings for the client sending a Renew message or if this
              behavior is disabled according to the server's policy or
              configuration information, the server returns the IA option
              containing a Status Code option with the NoBinding status code
              and a status message for a user.</t>
            </list></t>

          <t>The server constructs a Reply message by setting the "msg-type"
          field to REPLY and copying the transaction ID from the Renew message
          into the "transaction-id" field.</t>

          <t>The server MUST include in the Reply message a
          Server Identifier option
          (see <xref target="RFC3315-22.3"/>) containing the
          server's DUID and the Client Identifier option
          (see <xref target="RFC3315-22.2"/>) from the Renew
          message.</t>

          <t>The server includes other options containing configuration
          information to be returned to the client as described in <xref
          target="RFC3315-18.2"/>.</t>

          <t>The server MAY include options containing the IAs and values for
          other configuration parameters, even if those parameters were not
          requested in the Renew message.</t>

          <t>The T1/T2 values set in each applicable IA option for a Reply MUST
          be the same across all IAs. The server MUST determine the
          T1/T2 values across all of the applicable client's bindings in the
          Reply. This facilitates the client being able to renew all of the
          bindings at the same time.</t>
        </section>

        <section anchor="RFC3315-18.2.4" title="Receipt of Rebind Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Rebind messages received via unicast. Unicast
          transmission of Rebind messages is not allowed, regardless of
          whether the Server Unicast option (see <xref
          target="RFC3315-22.12"/>) is configured or not.</t>

          <t>When the server receives a Rebind message that contains an IA
          option from a client, it locates the client's binding and verifies
          that the information in the IA from the client matches the
          information stored for that client.</t>

          <t>If the server finds the client entry for the IA and the server
          determines that the addresses or delegated prefixes in the IA are
          appropriate for the link to which the client's interface is attached
          according to the server's explicit configuration information, the
          server SHOULD send the IA back to the client with new lifetimes and,
          if applicable, T1/T2 values. If the server is unable to extend the
          lifetimes of an address in the IA, the server MAY choose not to
          include the IA Address option (see <xref target="RFC3315-22.6"/>)
          for this address. If the server is
          unable to extend the lifetimes of a delegated prefix in the IA, the
          server MAY choose not to include the IA Prefix option
          (see <xref target="IAPREFIX-option"/>) for this prefix.</t>

          <t>If the server finds that the client entry for the IA and any of
          the addresses or delegated prefixes are no longer appropriate for
          the link to which the client's interface is attached according to
          the server's explicit configuration information, the server returns
          those addresses or delegated prefixes to the client with lifetimes
          of 0.</t>

          <t>If the server cannot find a client entry for the IA, the server
          checks if the IA contains addresses (for IA_NAs and IA_TAs) or
          delegated prefixes (for IA_PDs). The server checks if the addresses
          and delegated prefixes are appropriate for the link to which the
          client's interface is attached according to the server's explicit
          configuration information. For any address that is not appropriate
          for the link to which the client's interface is attached, the server
          MAY include the IA Address option with lifetimes of 0. For any
          delegated prefix that is not appropriate for the link to which the
          client's interface is attached, the server MAY include the IA Prefix
          option with lifetimes of 0. The Reply with lifetimes of 0
          constitutes an explicit notification to the client that the specific
          addresses and delegated prefixes are no longer valid and MUST NOT be
          used by the client. If the server chooses to not include any IAs
          containing IA Address or IA Prefix options with lifetimes of 0 and
          the server does not include any other IAs with leases and/or status
          codes, the server does not send a Reply message. In this situation,
          the server discards the Rebind message.</t>

          <t>Otherwise, for each IA for which the server cannot find a client
          entry, the server has the following choices, depending on the
          server's policy and configuration information:</t>

      <t><list style="symbols">
              <t>If the server is configured to create new
              bindings as a result of processing Rebind messages (also see the
              note below about the Rapid Commit option
              (<xref target="RFC3315-22.14"/>)), the server SHOULD
              create a binding and return the IA with allocated leases with
              lifetimes and, if applicable, T1/T2 values and other information
              requested by the client. The server MUST NOT return any
              addresses or delegated prefixes in the IA that the server does
              not assign to the client.</t>

              <t>If the server is configured to create new
              bindings as a result of processing Rebind messages but the
              server will not assign any leases to an IA, the server returns
              the IA option containing a Status Code option
              (see <xref target="RFC3315-22.13"/>) with the
              NoAddrsAvail or NoPrefixAvail status code and a status message
              for a user.</t>

              <t>If the server does not support creation of new
              bindings for the client sending a Rebind message or if this
              behavior is disabled according to the server's policy or
              configuration information, the server returns the IA option
              containing a Status Code option with the NoBinding status code
              and a status message for a user.</t>
            </list></t>

          <t>When the server creates new bindings for the IA, it is possible
          that other servers also create bindings as a result of receiving the
          same Rebind message; see the "DISCUSSION" text in
          <xref target="RFC3315-22.14"/>. Therefore, the server SHOULD only
          create new bindings during processing of a Rebind message if the
          server is configured to respond with a Reply message to a Solicit
          message containing the Rapid Commit option.</t>

          <t>The server constructs a Reply message by setting the "msg-type"
          field to REPLY and copying the transaction ID from the Rebind
          message into the "transaction-id" field.</t>

          <t>The server MUST include in the Reply message a
          Server Identifier option
          (see <xref target="RFC3315-22.3"/>) containing the
          server's DUID and the Client Identifier option
          (see <xref target="RFC3315-22.2"/>) from the Rebind
          message.</t>

          <t>The server includes other options containing configuration
          information to be returned to the client as described in <xref
          target="RFC3315-18.2"/>.</t>

          <t>The server MAY include options containing the IAs and values for
          other configuration parameters, even if those IAs and parameters
          were not requested in the Rebind message.</t>

          <t>The T1 or T2 values set in each applicable IA option for a Reply
          MUST be the same values across all IAs.  The server MUST determine
          the T1 or T2 values across all of the applicable client's bindings
          in the Reply. This facilitates the client being able to renew all of
          the bindings at the same time.</t>
        </section>

        <section anchor="RFC3315-18.2.5"
                 title="Receipt of Information-request Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Information&nbhy;request messages received via
          unicast.</t>

          <t>When the server receives an Information-request message, the
          client is requesting configuration information that does not include
          the assignment of any leases. The server determines all
          configuration parameters appropriate to the client, based on the
          server configuration policies known to the server.</t>

          <t>The server constructs a Reply message by setting the "msg-type"
          field to REPLY and copying the transaction ID from the
          Information-request message into the "transaction&nbhy;id" field.</t>

          <t>The server MUST include a Server Identifier option
          (see <xref target="RFC3315-22.3"/>) containing the
          server's DUID in the Reply message. If the client included a Client
          Identifier option (see <xref target="RFC3315-22.2"/>) in the
          Information-request message, the server
          copies that option to the Reply message.</t>

          <t>The server includes options containing configuration information
          to be returned to the client as described in <xref
          target="RFC3315-18.2"/>. The server MAY include additional
          options that were not requested by the client in the
          Information-request message.</t>

          <t>If the Information-request message received from the client did
          not include a Client Identifier option, the server SHOULD respond
          with a Reply message containing any configuration parameters that
          are not determined by the client's identity. If the server chooses
          not to respond, the client may continue to retransmit the
          Information&nbhy;request message indefinitely.</t>
        </section>

        <section title="Receipt of Release Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Release messages received via unicast.</t>

          <t>The server constructs a Reply message by setting the "msg-type"
          field to REPLY and copying the transaction ID from the Release
          message into the "transaction&nbhy;id" field.</t>

          <t>Upon the receipt of a valid Release message, the server examines
          the IAs and the leases in the IAs for validity. If the IAs in the
          message are in a binding for the client and the leases in the IAs
          have been assigned by the server to those IAs, the server deletes
          the leases from the IAs and makes the leases available for
          assignment to other clients. The server ignores leases not assigned
          to the IAs, although it may choose to log an error.</t>

          <t>After all the leases have been processed, the server generates a
          Reply message and includes a Status Code option
          (see <xref target="RFC3315-22.13"/>) with the value Success,
          a Server Identifier option (see <xref target="RFC3315-22.3"/>)
          with the server's DUID, and a Client Identifier option (see
          <xref target="RFC3315-22.2"/>) with the client's DUID. For each IA in the Release
          message for which the server has no binding information, the server
          adds an IA option using the IAID from the Release message and
          includes a Status Code option with the value NoBinding in the IA
          option. No other options are included in the IA option.</t>

          <t>A server may choose to retain a record of assigned leases and IAs
          after the lifetimes on the leases have expired to allow the server
          to reassign the previously assigned leases to a client.</t>
        </section>

        <section title="Receipt of Decline Messages">

          <t>See <xref target="use-multicast"/> for details regarding the
          handling of Decline messages received via unicast.</t>

          <t>Upon the receipt of a valid Decline message, the server examines
          the IAs and the addresses in the IAs for validity. If the IAs in the
          message are in a binding for the client and the addresses in the
          IAs have been assigned by the server to those IAs, the server
          deletes the addresses from the IAs. The server ignores addresses not
          assigned to the IAs (though it may choose to log an error if it finds
          such addresses).</t>

          <t>The client has found any addresses in the Decline messages to be
          already in use on its link. Therefore, the server SHOULD mark the
          addresses declined by the client so that those addresses are not
          assigned to other clients and MAY choose to make a notification
          that addresses were declined. Local policy on the server determines
          when the addresses identified in a Decline message may be made
          available for assignment.</t>

          <t>After all the addresses have been processed, the server generates
          a Reply message by setting the "msg-type" field to REPLY and
          copying the transaction ID from the Decline message into the
          "transaction&nbhy;id" field. The client includes a Status Code option
          (see <xref target="RFC3315-22.13"/>) with
          the value Success, a Server Identifier option
          (see <xref target="RFC3315-22.3"/>) with the server's
          DUID, and a Client Identifier option
          (see <xref target="RFC3315-22.2"/>) with the client's DUID. For
          each IA in the Decline message for which the server has no binding
          information, the server adds an IA option using the IAID from the
          Decline message and includes a Status Code option with the value
          NoBinding in the IA option. No other options are included in the IA
          option.</t>
        </section>

        <section anchor="RFC3315-17.2.2"
                 title="Creation of Advertise Messages">

          <t>The server sets the "msg-type" field to ADVERTISE and copies the
          contents of the "transaction&nbhy;id" field from the Solicit message
          received from the client to the Advertise message. The server
          includes its server identifier in a Server Identifier option
          (see <xref target="RFC3315-22.3"/>) and
          copies the Client Identifier option
          (see <xref target="RFC3315-22.2"/>) from the Solicit message into
          the Advertise message.</t>

          <t>The server MAY add a Preference option
          (see <xref target="RFC3315-22.8"/>) to carry the preference
          value for the Advertise message. The server implementation SHOULD
          allow the setting of a server preference value by the administrator.
          The server preference value MUST default to 0 unless otherwise
          configured by the server administrator.</t>

          <t>The server includes a Reconfigure Accept option
          (see <xref target="RFC3315-22.20"/>) if the server
          wants to indicate that it supports the Reconfigure mechanism. This
          information may be used by the client during the server
          selection process.</t>

          <t>The server includes the options the server will return to the client
          in a subsequent Reply message. The information in these options may
          be used by the client in the selection of a server if the client
          receives more than one Advertise message. The server MUST include
          options in the Advertise message containing configuration parameters
          for all of the options identified in the Option Request option
          (see <xref target="RFC3315-22.7"/>) in the Solicit message
          that the server has been configured to return to the client.  If the
          Option Request option includes a container option, the server MUST include all
          the options that are eligible to be encapsulated in the container. The Option
          Request option MAY be used to signal support for a feature even when that option is
          encapsulated, as in the case of the Prefix Exclude option <xref target="RFC6603"/>.
          In this case, special processing is required by the server.
          The server MAY return additional options to the client if it has been
          configured to do so.</t>

          <t>The server MUST include IA options in the Advertise message
          containing any addresses and/or delegated prefixes that would be
          assigned to IAs contained in the Solicit message from the client. If
          the client has included addresses in the IA Address options
          (see <xref target="RFC3315-22.6"/>) in the Solicit message,
          the server MAY use those addresses as hints about the addresses that
          the client would like to receive. If the client has included IA
          Prefix options (see <xref target="IAPREFIX-option"/>),
          the server MAY use the prefix contained
          in the "IPv6&nbhy;prefix" field and/or the prefix length contained in the
          "prefix&nbhy;length" field as hints about the prefixes the client
          would like to receive. If the server is not going to assign an
          address or delegated prefix received as a hint in the Solicit
          message, the server MUST NOT include this address or delegated
          prefix in the Advertise message.</t>

          <t>If the server will not assign any addresses to an IA_NA or IA_TA
          in subsequent Request messages from the client, the server MUST
          include the IA option in the Advertise message with no addresses in that IA
          and a Status Code option (see <xref target="RFC3315-22.13"/>)
          encapsulated in the IA option containing status code NoAddrsAvail.</t>

          <t>If the server will not assign any prefixes to an IA_PD in
          subsequent Request messages from the client, the server MUST
          include the IA_PD option (see <xref target="IA_PD-option"/>)
          in the Advertise message with no prefixes in the IA_PD
          option and a Status Code option encapsulated in the IA_PD containing
          status code NoPrefixAvail.</t>

          <t>Transmission of Advertise messages is described in the next
          section.</t>
        </section>

        <section anchor="RFC3315-18.2.8"
                 title="Transmission of Advertise and Reply Messages">

          <t>If the original message was received directly by the server, the
          server unicasts the Advertise or Reply message directly to the client
          using the address in the source address field from the IP datagram in which
          the original message was received. The Advertise or Reply message MUST
          be unicast through the interface on which the original message was
          received.</t>

          <t>If the original message was received in a Relay-forward message,
          the server constructs a Relay-reply message with the Reply message
          in the payload of a Relay Message option (see <xref
          target="RFC3315-22.10"/>). If the Relay&nbhy;forward messages
          included an Interface-Id option (see <xref target="RFC3315-22.18"/>),
          the server copies that option to
          the Relay-reply message. The server unicasts the Relay-reply message
          directly to the relay agent using the address in the source address
          field from the IP datagram in which the Relay-forward message was
          received. See <xref target="RFC3315-20.3"/> for more details on the
          construction of Relay-reply messages.</t>
        </section>

        <section anchor="reconfigure-transmission"
                 title="Creation and Transmission of Reconfigure Messages">

          <t>The server sets the "msg-type" field to RECONFIGURE and
          sets the "transaction&nbhy;id" field to 0. The server includes a
          Server Identifier option (see <xref target="RFC3315-22.3"/>)
          containing its DUID and a Client Identifier option
          (see <xref target="RFC3315-22.2"/>)
          containing the client's DUID in the Reconfigure message.</t>

          <t>Because of the risk of denial-of-service (DoS) attacks against
          DHCP clients, the use of a security mechanism is mandated in
          Reconfigure messages. The server MUST use DHCP authentication in the
          Reconfigure message (see <xref target="reconfigure-protocol"/>).</t>

          <t>The server MUST include a Reconfigure Message option (see
          <xref target="RFC3315-22.19"/>) to select whether the client
          responds with a Renew message, a Rebind message, or an
          Information-request message.</t>

          <t>The server MUST NOT include any other options in the Reconfigure
          message, except as specifically allowed in the definition of
          individual options.</t>

          <t>A server sends each Reconfigure message to a single DHCP client,
          using an IPv6 unicast address of sufficient scope belonging to the
          DHCP client. If the server does not have an address to which it can
          send the Reconfigure message directly to the client, the server
          uses a Relay-reply message (as described in <xref
          target="RFC3315-20.3"/>) to send the Reconfigure message to a
          relay agent that will relay the message to the client. The server
          may obtain the address of the client (and the appropriate relay
          agent, if required) through the information the server has about
          clients that have been in contact with the server (see
          <xref target="RFC3315-18.2"/>) or through some external agent.</t>

          <t>To reconfigure more than one client, the server unicasts a
          separate message to each client. The server may initiate the
          reconfiguration of multiple clients concurrently; for example, a
          server may send a Reconfigure message to additional clients while
          previous reconfiguration message exchanges are still in
          progress.</t>

          <t>The Reconfigure message causes the client to initiate a
          Renew/Reply, Rebind/Reply, or Information-request/Reply message
          exchange with the server. The server interprets the receipt of a
          Renew, Rebind, or Information-request message (whichever was
          specified in the original Reconfigure message) from the client as
          satisfying the Reconfigure message request.</t>

          <t>When transmitting the Reconfigure message, the server sets
          the retransmission time (RT) to REC_TIMEOUT. If the server does
          not receive a Renew, Rebind, or Information-request message from
          the client before the RT elapses, the server retransmits the
          Reconfigure message, doubles the RT value, and waits again.
          The server continues this process until REC_MAX_RC unsuccessful
          attempts have been made, at which point the server SHOULD abort
          the reconfigure process for that client.</t>

          <t>Default and initial values for REC_TIMEOUT and REC_MAX_RC are
          documented in <xref target="RFC3315-5.5"/>.</t>
        </section>

      </section>

      <section anchor="use-multicast" title="Reception of Unicast Messages">

        <t>Unless otherwise stated in the subsections of
        <xref target="RFC3315-18.2"/> that discuss the receipt of
        specific messages, the server is not supposed to accept
        unicast traffic when it is not explicitly configured to do
        so.  For example, unicast transmission is not allowed for
        Solicit, Confirm, and Rebind messages
        (see Sections&nbsp;<xref target="RFC3315-17.2.1" format="counter"/>,
        <xref target="RFC3315-18.2.2" format="counter"/>, and
        <xref target="RFC3315-18.2.4" format="counter"/>, respectively), 
        even if the Server Unicast option (see <xref target="RFC3315-22.12"/>)
        is configured. For Request, Renew, Information&nbhy;request, Release,
        and Decline messages, it is allowed only if the Server Unicast
        option is configured.</t>

        <t>When the server receives a message via unicast from a client
        to which the server has not sent a Server Unicast option (or is not
        currently configured to do so),
        the server discards that message and responds with an Advertise
        (when responding to a Solicit message) or Reply message (when
        responding to any other messages) containing a Status Code option
        (see <xref target="RFC3315-22.13"/>) with the
        value UseMulticast, a Server Identifier option
        (see <xref target="RFC3315-22.3"/>) containing the
        server's DUID, the Client Identifier option
        (see <xref target="RFC3315-22.2"/>) from the client
        message (if any), and no other options.</t>

      </section>

    </section>

    <section anchor="RFC3315-20" title="Relay Agent Behavior">

      <t>The relay agent SHOULD be configured to use a list of destination
      addresses that includes unicast addresses. The list of destination addresses
      MAY include the All_DHCP_Servers multicast address or other addresses selected by the network
      administrator. If the relay agent has not been explicitly configured, it
      MUST use the All_DHCP_Servers multicast address as the default.</t>

      <t>If the relay agent relays messages to the All_DHCP_Servers multicast
      address or other multicast addresses, it sets the Hop Limit field
      to&nbsp;8.</t>

      <t>If the relay agent receives a message other than Relay-forward and
      Relay-reply and the relay agent does not recognize its message type, it
      MUST forward the message as described in <xref
      target="relaying-from-client"/>.</t>

      <section title="Relaying a Client Message or a Relay-forward Message">

        <t>A relay agent relays both messages from clients and Relay-forward
        messages from other relay agents. When a relay agent receives
        a Relay-forward message, a recognized message type for which it is
        not the intended target, or an unrecognized message type
        <xref target="RFC7283"/>, it constructs a new Relay-forward message. The
        relay agent copies the source address from the header of the IP
        datagram in which the message was received into the peer-address field
        of the Relay-forward message. The relay agent copies the received DHCP
        message (excluding any IP or UDP headers) into a Relay Message option
        (see <xref target="RFC3315-22.10"/>)
        in the new message. The relay agent adds to the Relay-forward message
        any other options it is configured to include.</t>

        <t><xref target="RFC6221"/> defines a Lightweight DHCPv6 Relay
        Agent (LDRA) that allows relay agent information to be inserted by an
        access node that performs a link-layer bridging (i.e., non-routing)
        function.</t>

        <section anchor="relaying-from-client"
                 title="Relaying a Message from a Client">

          <t>If the relay agent received the message to be relayed from a
          client, the relay agent places a globally scoped unicast address
          (i.e., GUA or ULA) from a prefix assigned to the link on which the
          client should be assigned leases into the link-address field. If
          such an address is not available, the relay agent may set the
          link&nbhy;address field to a link-local address from the interface
          on which the original message was received. This is not recommended,
          as it may require that additional information be provided in the
          server configuration. See Section&nbsp;3.2 of
          <xref target="RFC7969"/> for a detailed discussion.</t>

          <t>This address will be used by the server to determine the link
          from which the client should be assigned leases and other
          configuration information.</t>
             
          <t>The hop-count value in the Relay-forward message is set to 0.</t>

          <t>If the relay agent cannot use the address in the link-address
          field to identify the interface through which the response to the
          client will be relayed, the relay agent MUST include an Interface-Id
          option (see <xref target="RFC3315-22.18"/>) in the
          Relay-forward message. The server will include the Interface-Id
          option in its Relay-reply message. The relay agent sets the
          link-address field as described earlier in this subsection,
          regardless of whether the relay agent includes an Interface-Id
          option in the Relay-forward message.</t>
        </section>

        <section title="Relaying a Message from a Relay Agent" anchor="relaying-from-relay-agent">

          <t>If the message received by the relay agent is a Relay-forward
          message and the hop-count value in the message is greater than or
          equal to HOP_COUNT_LIMIT, the relay agent discards the received
          message.</t>

          <t>The relay agent copies the source address from the IP datagram in
          which the message was received into the
          peer&nbhy;address field in the Relay-forward message and sets the
          hop&nbhy;count field to the value of the hop-count field in the
          received message incremented by 1.</t>

          <t>If the source address from the IP datagram header of the received
          message is a globally scoped unicast address (i.e., GUA or ULA),
          the relay agent sets the link-address field to 0; otherwise, the
          relay agent sets the link-address field to a globally scoped unicast
          address (i.e., GUA or ULA) assigned to the interface on which the
          message was received or includes an Interface-Id option (see
          <xref target="RFC3315-22.18"/>) to identify the interface on which
          the message was received.</t>
        </section>

        <section title="Relay Agent Behavior with Prefix Delegation">
          <t>A relay agent forwards messages containing prefix delegation
          options in the same way as it would relay addresses (i.e., per
          Sections&nbsp;<xref target="relaying-from-client" format="counter"/>
          and <xref target="relaying-from-relay-agent" format="counter"/>).</t>

          <t>If a server communicates with a client through a relay agent
          about delegated prefixes, the server may need a protocol or
          other out&nbhy;of&nbhy;band communication to configure routing
          information for delegated prefixes on any router through which the
          client may forward traffic.</t>
        </section>

      </section>

      <section title="Relaying a Relay-reply Message">

        <t>The relay agent processes any options included in the Relay-reply
        message in addition to the Relay Message option
        (see <xref target="RFC3315-22.10"/>).</t>

        <t>The relay agent extracts the message from the Relay Message option
        and relays it to the address contained in the peer-address field of
        the Relay-reply message. Relay agents MUST NOT modify the message.</t>

        <t>If the Relay-reply message includes an Interface-Id option
        (see <xref target="RFC3315-22.18"/>), the
        relay agent relays the message from the server to the client on the
        link identified by the Interface-Id option. Otherwise, if the
        link-address field is not set to 0, the relay agent relays the
        message on the link identified by the link-address field.</t>

        <t>If the relay agent receives a Relay-reply message, it MUST process
        the message as defined above, regardless of the type of message
        encapsulated in the Relay Message option.</t>
      </section>

      <section anchor="RFC3315-20.3"
               title="Construction of Relay-reply Messages">

        <t>A server uses a Relay-reply message to (1) return a response to a
        client if the original message from the client was relayed to the
        server in a Relay-forward message or (2) send a Reconfigure message
        to a client if the server does not have an address it can use to
        send the message directly to the client.</t>

        <t>A response to the client MUST be relayed through the same relay
        agents as the original client message. The server causes this to
        happen by creating a Relay-reply message that includes a Relay Message
        option (see <xref target="RFC3315-22.10"/>)
        containing the message for the next relay agent in the return
        path to the client. The contained Relay-reply message contains another
        Relay Message option to be sent to the next relay agent, and so on.
        The server must record the contents of the peer-address fields in the
        received message so it can construct the appropriate Relay-reply
        message carrying the response from the server.</t>

        <t>For example, if client C sent a message that was relayed by relay
        agent A to relay agent B and then to the server, the server would send
        the following Relay-reply message to relay agent B:</t>

        <figure align="center" anchor="FigRelayExample"
                title="Relay-reply Example">
          <artwork align="left"><![CDATA[
   msg-type:       RELAY-REPL
   hop-count:      1
   link-address:   0
   peer-address:   A
   Relay Message option containing the following:
      msg-type:     RELAY-REPL
      hop-count:    0
      link-address: address from link to which C is attached
      peer-address: C
      Relay Message option: <response from server>
          ]]></artwork>
        </figure>

        <t>When sending a Reconfigure message to a client through a relay
        agent, the server creates a Relay-reply message that includes a Relay
        Message option containing the Reconfigure message for the next relay
        agent in the return path to the client. The server sets the
        peer&nbhy;address field in the Relay-reply message header to the
        address of the client and sets the link-address field as required by
        the relay agent to relay the Reconfigure message to the client. The
        server obtains the addresses of the client and the relay agent through
        prior interaction with the client or through some external
        mechanism.</t>
      </section>

      <section anchor="relay-srv-interaction"
               title="Interaction between Relay Agents and Servers">
        <t>Each time a packet is relayed by a relay agent towards a server, a
        new encapsulation level is added around the packet. Each relay is
        allowed to insert additional options on the encapsulation level it
        added but MUST NOT change anything in the packet being encapsulated. If
        there are multiple relays between a client and a server, multiple
        encapsulations are used. Although it makes packet processing slightly
        more complex, it provides the major advantage of having a clear
        indication as to which relay inserted which option. The response
        packet is expected to travel through the same relays, but in
        reverse order. Each time a response packet is relayed back towards a
        client, one encapsulation level is removed.</t>

        <t>In certain cases, relays can add one or more options. These options
        can be added for several reasons:</t>

        <t><list style="symbols">
        <t> First, relays can provide additional information about the
        client. That source of information is usually more trusted by a
        server administrator, as it comes from the network infrastructure
        rather than the client and cannot be easily spoofed. These options
        can be used by the server to determine its allocation policy.</t>

        <t>Second, a relay may need some information to send a response back to
        the client. Relay agents are expected to be stateless (not retain any
        state after a packet has been processed). A relay agent may include
        the Interface-Id option (see <xref target="RFC3315-22.18"/>), which
        will be echoed back in the response. It can include other options and
        ask the server to echo one or more of the options back in the response.
        These options can then be used by the relay agent to send the response
        back to the client, or for other needs. The client will never see
        these options. See <xref target="RFC4994"/> for details.</t>

        <t>Third, sometimes a relay is the best device to provide values for
        certain options. A relay can insert an option into the packet being
        forwarded to the server and ask the server to pass that option back
        to the client. The client will receive that option. It should be noted
        that the server is the ultimate authority here, and -- depending on
        its configuration -- it may or may not send the option back to the
        client. See <xref target="RFC6422"/> for details.</t>
      </list></t>

        <t>For various reasons, servers may need to retain the
        relay information after the packet processing is completed.
        One is a bulk leasequery mechanism that may ask for all addresses
        and/or prefixes that were assigned via a specific relay. A second is
        for the reconfigure mechanism. The server may choose to not send the
        Reconfigure message directly to the client but rather to send it via
        relays. This particular behavior is considered an implementation
        detail and is out of scope for this document.</t>
      </section>

    </section>

    <section anchor="RFC3315-21" title="Authentication of DHCP Messages">

      <t>This document introduces two security mechanisms for the
      authentication of DHCP messages: (1)&nbsp;authentication (and
      encryption) of messages sent between servers and relay agents using
      IPsec and (2)&nbsp;protection against misconfiguration of a client
      caused by a Reconfigure message sent by a malicious DHCP server.</t>

      <t>The delayed authentication protocol, defined in
      <xref target="RFC3315"/>, has been obsoleted by this document
      (see <xref target="obsolete"/>).</t>

      <section anchor="RFC3315-21.1"
               title="Security of Messages Sent between Servers and Relay Agents">

        <t>Relay agents and servers that exchange messages can use
        IPsec as detailed in <xref target="RFC8213"/>.
        </t>

      </section>

      <section title="Summary of DHCP Authentication">

        <t>Authentication of DHCP messages is accomplished through the use of
        the Authentication option (see <xref target="RFC3315-22.11"/>).
        The authentication information carried in the Authentication option
        can be used to reliably identify the source of a DHCP message and to
        confirm that the contents of the DHCP message have not been tampered
        with.</t>

        <t>The Authentication option provides a framework for multiple
        authentication protocols. One such protocol, RKAP, is defined in <xref
        target="reconfigure-protocol"/>. Other protocols defined in the future
        will be specified in separate documents.</t>

        <t>Any DHCP message MUST NOT include more than one Authentication
        option.</t>

        <t>The protocol field in the Authentication option identifies the
        specific protocol used to generate the authentication information
        carried in the option. The algorithm field identifies a specific
        algorithm within the authentication protocol; for example, the
        algorithm field specifies the hash algorithm used to generate the
        Message Authentication Code (MAC) in the Authentication option. The
        RDM field specifies the type of replay detection used in the
        replay detection field.</t>

      </section>

      <section anchor="replay" title="Replay Detection">

        <t>The RDM field of the Authentication option
        (see <xref target="RFC3315-22.11"/>) determines the type of
        replay detection used in the replay detection field.</t>

        <t>If the RDM field contains 0x00, the replay detection field MUST be
        set to the value of a strictly monotonically increasing 64-bit unsigned
        integer (modulo 2^64). Using this technique can reduce the danger
        of replay attacks. This method MUST be supported by all Authentication
        option protocols. One choice might be to use the 64-bit NTP timestamp
        format <xref target="RFC5905"/>).</t>

        <t>A client that receives a message with the RDM field set to 0x00 MUST
        compare its replay detection field with the previous value sent by
        that same server (based on the Server Identifier option; see
        <xref target="RFC3315-22.3"/>) and only accept the message if the
        received value is greater and record this as the new value. If this
        is the first time a client processes an Authentication option sent by
        a server, the client MUST record the replay detection value and skip
        the replay detection check.</t>

        <t>Servers that support the reconfigure mechanism MUST ensure that
        the replay detection value is retained between restarts. Failing to
        do so may cause clients to refuse Reconfigure messages sent by the
        server, effectively rendering the reconfigure mechanism useless.</t>

      </section>

      <section anchor="reconfigure-protocol"
               title="Reconfiguration Key Authentication Protocol (RKAP)">

        <t>RKAP provides protection against misconfiguration of a client
        caused by a Reconfigure message sent by a malicious DHCP server. In
        this protocol, a DHCP server sends a reconfigure key to the client in
        the initial exchange of DHCP messages. The client records the
        reconfigure key for use in authenticating subsequent Reconfigure
        messages from that server. The server then includes a Hashed Message
        Authentication Code (HMAC) computed from the reconfigure key in
        subsequent Reconfigure messages.</t>

        <t>Both the reconfigure key sent from the server to the client and the
        HMAC in subsequent Reconfigure messages are carried as the
        authentication information in an Authentication option
        (see <xref target="RFC3315-22.11"/>). The format of
        the authentication information is defined in the following
        section.</t>

        <t>RKAP is used (initiated by the server) only
        if the client and server have negotiated to use Reconfigure
        messages.</t>

        <section title="Use of the Authentication Option in RKAP">

          <t>The following fields are set in an Authentication option
          (see <xref target="RFC3315-22.11"/>) for RKAP:
              <list hangIndent="14" style="hanging">
              <t hangText="   protocol">3</t>

              <t hangText="   algorithm">1</t>

              <t hangText="   RDM">0</t>
            </list></t>

          <t>The format of the authentication information for RKAP is:</t>

          <figure align="center" anchor="FigRKAPAuthInfo"
                  title="RKAP Authentication Information">
            <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |                 Value (128 bits)              |
   +-+-+-+-+-+-+-+-+                                               |
   .                                                               .
   .                                                               .
   .                                               +-+-+-+-+-+-+-+-+
   |                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            ]]></artwork>
          </figure>

          <t><list hangIndent="20" style="hanging">
              <t hangText="   Type">Type of data in the Value field carried in
              this option:
              <list hangIndent="8" style="hanging">
                  <t hangText="   1">Reconfigure key value (used in the Reply
                  message).</t>

                  <t hangText="   2">HMAC-MD5 digest of the message (used in
                  the Reconfigure message).</t>
                </list>
              A 1&nbhy;octet field.</t>

              <t hangText="   Value">Data as defined by the Type field. A
              16-octet field.</t>
            </list></t>
        </section>

        <section title="Server Considerations for RKAP">

          <t>The server selects a reconfigure key for a client during the
          Request&wj;/Reply, Solicit/Reply, or Information-request/Reply
          message exchange. The server records the reconfigure key and
          transmits that key to the client in an Authentication option
          (see <xref target="RFC3315-22.11"/>) in the Reply message.</t>

          <t>The reconfigure key is 128 bits long and MUST be a
          cryptographically strong random or pseudorandom number that cannot
          easily be predicted.</t>

          <t>To provide authentication for a Reconfigure message, the server
          selects a replay detection value according to the RDM selected by
          the server and computes an HMAC-MD5 of the Reconfigure message
          using the reconfigure key for the client. The server computes the
          HMAC-MD5 over the entire DHCP Reconfigure message, including the
          Authentication option; the HMAC-MD5 field in the Authentication
          option is set to 0 for the HMAC-MD5 computation. The server
          includes the HMAC-MD5 in the authentication information field in an
          Authentication option included in the Reconfigure message sent to
          the client.</t>
        </section>

        <section title="Client Considerations for RKAP">

          <t>The client will receive a reconfigure key from the server in an
          Authentication option (see <xref target="RFC3315-22.11"/>) in the
          initial Reply message from the server. The client records the
          reconfigure key for use in authenticating subsequent Reconfigure
          messages.</t>

          <t>To authenticate a Reconfigure message, the client computes an
          HMAC&nbhy;MD5 over the Reconfigure message, with zeroes substituted
          for the HMAC-MD5 field, using the reconfigure key received
          from the server. If this computed HMAC-MD5 matches the
          value in the Authentication option, the client accepts the
          Reconfigure message.</t>
        </section>

      </section>

    </section>

    <section anchor="RFC3315-22" title="DHCP Options">

      <t>Options are used to carry additional information and parameters in
      DHCP messages. Every option shares a common base format, as described in
      <xref target="RFC3315-22.1"/>. All values in options are
      represented in network byte order.</t>

      <t>This document describes the DHCP options defined as part of the base
      DHCP specification. Other options may be defined in the future in
      separate documents. See <xref target="RFC7227"/> for guidelines regarding
      the definition of new options. 
      See <xref target="iana"/> for additional information about the
      DHCPv6 "Option Codes" registry maintained by IANA.</t>

      <t>Unless otherwise noted, each option may appear only in the options
      area of a DHCP message and may appear only once. If an option does
      appear multiple times, each instance is considered separate and the data
      areas of the options MUST NOT be concatenated or otherwise combined.</t>

      <t>Options that are allowed to appear only once are called "singleton
      options". The only non-singleton options defined in this document are
      the IA_NA (see <xref target="RFC3315-22.4"/>), IA_TA (see <xref
      target="RFC3315-22.5"/>), Vendor Class (see <xref target="RFC3315-22.16"/>),
      Vendor-specific Information (see <xref target="RFC3315-22.17"/>),
      and IA_PD (see <xref
      target="IA_PD-option"/>) options. Also, IA Address (see <xref
      target="RFC3315-22.6"/>) and IA Prefix (see <xref
      target="IAPREFIX-option"/>) may appear in their respective IA
      options more than once.</t>

      <section anchor="RFC3315-22.1" title="Format of DHCP Options">

        <t>The format of DHCP options is:</t>

        <figure align="center" anchor="FigOptions" title="Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          option-code          |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          option-data                          |
   |                      (option-len octets)                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">An unsigned integer identifying the
            specific option type carried in this option.
            A&nbsp;2&nbhy;octet field.</t>

            <t hangText="   option-len">An unsigned integer giving the length
            of the option-data field in this option in octets. A 2-octet
            field.</t>

            <t hangText="   option-data">The data for the option; the format
            of this data depends on the definition of the option. A
            variable-length field (the length, in octets, is specified by
            option-len).</t>
          </list></t>

        <t>DHCP options are scoped by using encapsulation. Some options
        apply generally to the client, some are specific to an IA, and some
        are specific to the addresses within an IA. These latter two cases are
        discussed in Sections&nbsp;<xref target="RFC3315-22.4"
        format="counter"/>, <xref target="RFC3315-22.5" format="counter"/>,
        and <xref target="RFC3315-22.6" format="counter"/>.</t>

      </section>

      <section anchor="RFC3315-22.2" title="Client Identifier Option">

        <t>The Client Identifier option is used to carry a DUID (see <xref
        target="RFC3315-9"/>) that identifies the client.
        The format of the Client Identifier option is:</t>

        <figure align="center" anchor="FigOption1"
                title="Client Identifier Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_CLIENTID        |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                              DUID                             .
   .                        (variable length)                      .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_CLIENTID (1).</t>

            <t hangText="   option-len">Length of DUID in octets.</t>

            <t hangText="   DUID">The DUID for the client.</t>
          </list></t>
      </section>

      <section anchor="RFC3315-22.3" title="Server Identifier Option">

        <t>The Server Identifier option is used to carry a DUID (see <xref
        target="RFC3315-9"/>) that identifies the server. The format of the
        Server Identifier option is:</t>

        <figure align="center" anchor="FigOption2"
                title="Server Identifier Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_SERVERID        |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                              DUID                             .
   .                        (variable length)                      .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_SERVERID (2).</t>

            <t hangText="   option-len">Length of DUID in octets.</t>

            <t hangText="   DUID">The DUID for the server.</t>
          </list></t>
      </section>

      <section anchor="RFC3315-22.4"
               title="Identity Association for Non-temporary Addresses Option">

        <t>The Identity Association for Non-temporary Addresses (IA_NA)
        option is used to carry an IA_NA, the parameters associated with the
        IA_NA, and the non-temporary addresses associated with the IA_NA.</t>

        <t>Addresses appearing in an IA_NA option are not temporary addresses
        (see <xref target="RFC3315-22.5"/>).</t>

        <t>The format of the IA_NA option is:</t>

        <figure align="center" anchor="FigOption3"
                title="Identity Association for Non-temporary Addresses Option&nbsp;Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          OPTION_IA_NA         |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        IAID (4 octets)                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              T1                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              T2                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                         IA_NA-options                         .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_IA_NA (3).</t>

            <t hangText="   option-len">12 + length of IA_NA-options
            field.</t>

            <t hangText="   IAID">The unique identifier for this IA_NA; the
            IAID must be unique among the identifiers for all of this client's
            IA_NAs. The number space for IA_NA IAIDs is separate from the
            number space for other IA option types (i.e., IA_TA and IA_PD).
            A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   T1">The time interval after which the client should contact the
            server from which the addresses in the IA_NA were obtained to
            extend the lifetimes of the addresses assigned to the IA_NA; T1 is
            a time duration relative to the current time expressed in units of
            seconds. A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   T2">The time interval after which the client should contact any
            available server to extend the lifetimes of the addresses assigned
            to the IA_NA; T2 is a time duration relative to the current time
            expressed in units of seconds. A 4&nbhy;octet field containing
            an unsigned integer.</t>

            <t hangText="   IA_NA-options">Options associated with this
            IA_NA. A variable-length field (12 octets less than the
            value in the option-len field).</t>
          </list></t>

        <t>The IA_NA-options field encapsulates those options that are
        specific to this IA_NA. For example, all of the IA Address options
        (see <xref target="RFC3315-22.6"/>)
        carrying the addresses associated with this IA_NA are in the
        IA_NA-options field.</t>

        <t>Each IA_NA carries one "set" of non-temporary addresses;
        it is up to the server policy to determine how many addresses are
        assigned, but typically at most one address is assigned from each
        prefix assigned to the link to which the client is attached.</t>

        <t>An IA_NA option may only appear in the options area of a DHCP
        message. A DHCP message may contain multiple IA_NA options (though
        each must have a unique IAID).</t>

        <t>The status of any operations involving this IA_NA is indicated in a
        Status Code option (see <xref target="RFC3315-22.13"/>)
        in the IA_NA-options field.</t>

        <t>Note that an IA_NA has no explicit "lifetime" or "lease length" of
        its own. When the valid lifetimes of all of the addresses in an IA_NA
        have expired, the IA_NA can be considered as having expired. T1 and T2
        are included to give servers explicit control over when a client
        recontacts the server about a specific IA_NA.</t>

        <t>In a message sent by a client to a server, the T1 and T2 fields
        SHOULD be set to 0. The server MUST ignore any values in these fields
        in messages received from a client.</t>

        <t>In a message sent by a server to a client, the client MUST use the
        values in the T1 and T2 fields for the T1 and T2 times, unless
        values in those fields are 0. The values in the T1 and T2 fields
        are the number of seconds until T1 and T2 and are calculated since
        reception of the message.</t>
           
        <t>As per <xref target="RFC3315-5.6"/>, the value 0xffffffff is
        taken to mean "infinity" and should be used carefully.</t>

        <t>The server selects the T1 and T2 values to allow the client to
        extend the lifetimes of any addresses in the IA_NA before the
        lifetimes expire, even if the server is unavailable for some short
        period of time. Recommended values for T1 and T2 are 0.5 and 0.8 times
        the shortest preferred lifetime of the addresses in the IA that the
        server is willing to extend, respectively. If the "shortest" preferred
        lifetime is 0xffffffff ("infinity"), the recommended T1 and T2 values
        are also 0xffffffff. If the time at which the addresses in an IA_NA
        are to be renewed is to be left to the discretion of the client, the
        server sets the T1 and T2 values to 0. The client MUST follow the
        rules defined in <xref target="t1-t2-0"/>.</t>

        <t>If a client receives an IA_NA with T1 greater than T2 and both T1
        and T2 are greater than 0, the client discards the IA_NA option and
        processes the remainder of the message as though the server had not
        included the invalid IA_NA option.</t>
      </section>

      <section anchor="RFC3315-22.5"
               title="Identity Association for Temporary Addresses Option">

        <t>The Identity Association for Temporary Addresses (IA_TA) option
        is used to carry an IA_TA, the parameters associated with the IA_TA,
        and the addresses associated with the IA_TA. All of the addresses in
        this option are used by the client as temporary addresses, as defined
        in <xref target="RFC4941"/>. The format of the IA_TA option
        is:</t>

        <figure align="center" anchor="FigOption4"
                title="Identity Association for Temporary Addresses Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          OPTION_IA_TA         |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        IAID (4 octets)                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                         IA_TA-options                         .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_IA_TA (4).</t>

            <t hangText="   option-len">4 + length of IA_TA-options field.</t>

            <t hangText="   IAID">The unique identifier for this IA_TA; the
            IAID must be unique among the identifiers for all of this client's
            IA_TAs. The number space for IA_TA IAIDs is separate from the
            number space for other IA option types (i.e., IA_NA and IA_PD).
            A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   IA_TA-options">Options associated with this
            IA_TA. A variable-length field (4 octets less than the
            value in the option-len field).</t>
          </list></t>

        <t>The IA_TA-options field encapsulates those options that are
        specific to this IA_TA. For example, all of the IA Address options
        (see <xref target="RFC3315-22.6"/>)
        carrying the addresses associated with this IA_TA are in the
        IA_TA-options field.</t>

        <t>Each IA_TA carries one "set" of temporary addresses. It is
        up to the server policy to determine how many addresses are
        assigned.</t>

        <t>An IA_TA option may only appear in the options area of a DHCP
        message. A DHCP message may contain multiple IA_TA options (though
        each must have a unique IAID).</t>

        <t>The status of any operations involving this IA_TA is indicated in a
        Status Code option (see <xref target="RFC3315-22.13"/>)
        in the IA_TA-options field.</t>

        <t>Note that an IA has no explicit "lifetime" or "lease length" of its
        own. When the valid lifetimes of all of the addresses in an IA_TA have
        expired, the IA can be considered as having expired.</t>

        <t>An IA_TA option does not include values for T1 and T2. A client MAY
        request that the valid lifetime on temporary addresses be extended by
        including the addresses in an IA_TA option sent in a Renew or Rebind
        message to a server. For example, a client would request an extension
        on the valid lifetime of a temporary address to allow an application to
        continue to use an established TCP connection. Extending only the
        valid, but not the preferred, lifetime means the address will end up
        in a deprecated state eventually. Existing connections could continue,
        but no new ones would be created using that address.</t>

        <t>The client obtains new temporary addresses by sending an IA_TA
        option with a new IAID to a server. Requesting new temporary addresses
        from the server is the equivalent of generating new temporary
        addresses as described in <xref target="RFC4941"/>. The server
        will generate new temporary addresses and return them to the client.
        The client should request new temporary addresses before the lifetimes
        on the previously assigned addresses expire.</t>

        <t>A server MUST return the same set of temporary addresses for the
        same IA_TA (as identified by the IAID) as long as those addresses are
        still valid. After the lifetimes of the addresses in an IA_TA have
        expired, the IAID may be reused to identify a new IA_TA with new
        temporary addresses.</t>
      </section>

      <section anchor="RFC3315-22.6" title="IA Address Option">

        <t>The IA Address option is used to specify an address associated
        with an IA_NA or an IA_TA. The IA Address option must be encapsulated
        in the IA_NA&nbhy;options field of an IA_NA option
        (see <xref target="RFC3315-22.4"/>) or the IA_TA&nbhy;options field
        of an IA_TA option (see <xref target="RFC3315-22.5"/>).
        The IAaddr&nbhy;options field encapsulates those options that are
        specific to this address.</t>

        <t>The format of the IA Address option is:</t>

        <figure align="center" anchor="FigOption5"
                title="IA Address Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          OPTION_IAADDR        |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                         IPv6-address                          |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      preferred-lifetime                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        valid-lifetime                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                        IAaddr-options                         .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_IAADDR (5).</t>

            <t hangText="   option-len">24 + length of IAaddr-options
            field.</t>

            <t hangText="   IPv6-address">An IPv6 address. A client MUST NOT
            form an implicit prefix with a length other than 128 for this
            address. A&nbsp;16-octet field.</t>

            <t hangText="   preferred-lifetime">The preferred lifetime for the
            address in the option, expressed in units of seconds. A
            4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   valid-lifetime">The valid lifetime for the
            address in the option, expressed in units of seconds. A
            4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   IAaddr-options">Options associated with this
            address. A variable-length field (24 octets less than the
            value in the option-len field).</t>
          </list></t>

        <t>In a message sent by a client to a server, the
        preferred-lifetime and valid-lifetime fields SHOULD be set to 0.
        The server MUST ignore any received values.</t>

        <t>The client SHOULD NOT send the IA Address option with an unspecified
        address (::).</t>

        <t>In a message sent by a server to a client, the client MUST use the
        values in the preferred-lifetime and valid-lifetime fields for the
        preferred and valid lifetimes. The values in these fields are the
        number of seconds remaining in each lifetime.</t>

        <t>The client MUST discard any addresses for which the preferred
        lifetime is greater than the valid lifetime.</t>

        <t>As per <xref target="RFC3315-5.6"/>, if the valid lifetime of an
        address is 0xffffffff, it is taken to mean "infinity" and should be
        used carefully.</t>

        <t>More than one IA Address option can appear in an IA_NA option or an
        IA_TA option.</t>

        <t>The status of any operations involving this IA Address is indicated
        in a Status Code option in the IAaddr-options field, as specified in
        <xref target="RFC3315-22.13"/>.</t>
      </section>

      <section anchor="RFC3315-22.7" title="Option Request Option">

        <t>The Option Request option is used to identify a list of options in
        a message between a client and a server. The format of the Option
        Request option is:</t>

        <figure align="center" anchor="FigOption6"
                title="Option Request Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           OPTION_ORO          |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    requested-option-code-1    |    requested-option-code-2    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="29" style="hanging">
            <t hangText="   option-code">OPTION_ORO (6).</t>

            <t hangText="   option-len">2 * number of requested options.</t>

            <t hangText="   requested-option-code-n">The option code for
            an option requested by the client. Each option code is a
            2&nbhy;octet field containing an unsigned integer.</t>
          </list></t>

        <t>A client MUST include an Option Request option in a Solicit,
        Request, Renew, Rebind, or Information-request message to
        inform the server about options the client wants the server to send to
        the client. For certain message types, some option codes MUST be
        included in the Option Request option; see
        <xref target="option_update_table"/> for details.</t>

        <t>The Option Request option MUST NOT include the
        following options:</t>

     <t><list style="symbols">
        <t>Client Identifier (see <xref target="RFC3315-22.2"/>)</t>
        <t>Server Identifier (see <xref target="RFC3315-22.3"/>)</t>
        <t>IA_NA (see <xref target="RFC3315-22.4"/>)</t>
        <t>IA_TA (see <xref target="RFC3315-22.5"/>)</t>
        <t>IA_PD (see <xref target="IA_PD-option"/>)</t>
        <t>IA Address (see <xref target="RFC3315-22.6"/>)</t>
        <t>IA Prefix (see <xref target="IAPREFIX-option"/>)</t>
        <t>Option Request (this section)</t>
        <t>Elapsed Time (see <xref target="RFC3315-22.9"/>)</t>
        <t>Preference (see <xref target="RFC3315-22.8"/>)</t>
        <t>Relay Message (see <xref target="RFC3315-22.10"/>)</t>
        <t>Authentication (see <xref target="RFC3315-22.11"/>)</t>
        <t>Server Unicast (see <xref target="RFC3315-22.12"/>)</t>
        <t>Status Code (see <xref target="RFC3315-22.13"/>)</t>
        <t>Rapid Commit (see <xref target="RFC3315-22.14"/>)</t>
        <t>User Class (see <xref target="RFC3315-22.15"/>)</t>
        <t>Vendor Class (see <xref target="RFC3315-22.16"/>)</t>
        <t>Interface-Id (see <xref target="RFC3315-22.18"/>)</t>
        <t>Reconfigure Message (see <xref target="RFC3315-22.19"/>)</t>
        <t>Reconfigure Accept (see <xref target="RFC3315-22.20"/>)</t>

      </list></t>

        <t>Other top-level options MUST appear in the Option Request
        option or they will not be sent by the server. Only top-level options
        MAY appear in the Option Request option. Options encapsulated in a
        container option SHOULD NOT appear in an Option Request option; see
        <xref target="RFC7598"/> for an example of container options. However,
        options MAY be defined that specify exceptions to this restriction on
        including encapsulated options in an Option Request option. For
        example, the Option Request option MAY be used to signal support for a
        feature even when that option is encapsulated, as in the case of the
        Prefix Exclude option <xref target="RFC6603"/>. See <xref
        target="option_update_table"/>.
        </t>

      </section>

      <section anchor="RFC3315-22.8" title="Preference Option">

        <t>The Preference option is sent by a server to a client to control
        the selection of a server by the client.</t>

        <t>The format of the Preference option is:</t>

        <figure align="center" anchor="FigOption7"
                title="Preference Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       OPTION_PREFERENCE       |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  pref-value   |
   +-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_PREFERENCE (7).</t>

            <t hangText="   option-len">1.</t>

            <t hangText="   pref-value">The preference value for the server in
            this message. A 1&nbhy;octet unsigned integer.</t>
          </list></t>

        <t>A server MAY include a Preference option in an Advertise message to
        control the selection of a server by the client. See <xref
        target="RFC3315-17.1.3"/> for information regarding the use of the
        Preference option by the client and the interpretation of the
        Preference option data value.</t>
      </section>

      <section anchor="RFC3315-22.9" title="Elapsed Time Option">

        <figure align="center" anchor="FigOption8"
                title="Elapsed Time Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_ELAPSED_TIME      |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          elapsed-time         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_ELAPSED_TIME (8).</t>

            <t hangText="   option-len">2.</t>

            <t hangText="   elapsed-time">The amount of time since the client
            began its current DHCP transaction. This time is expressed in
            hundredths of a second (10^&nbhy;2&nbsp;seconds). A 2-octet field
            containing an unsigned integer.</t>
          </list></t>

        <t>A client MUST include an Elapsed Time option in messages to
        indicate how long the client has been trying to complete a DHCP
        message exchange. The elapsed time is measured from the time at which
        the client sent the first message in the message exchange, and the
        elapsed-time field is set to 0 in the first message in the message
        exchange. Servers and relay agents use the data value in this option
        as input to policy that controls how a server responds to a client
        message. For example, the Elapsed Time option allows a secondary DHCP
        server to respond to a request when a primary server has not answered
        in a reasonable time. The elapsed-time value is a 16-bit
        (2-octet) unsigned integer. The client uses the value 0xffff to
        represent any elapsed-time values greater than the largest time value
        that can be represented in the Elapsed Time option.</t>
      </section>

      <section anchor="RFC3315-22.10" title="Relay Message Option">

        <t>The Relay Message option carries a DHCP message in a Relay-forward
        or Relay-reply message.</t>

        <t>The format of the Relay Message option is:</t>

        <figure align="center" anchor="FigOption9"
                title="Relay Message Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_RELAY_MSG       |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   .                       DHCP-relay-message                      .
   .                                                               .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_RELAY_MSG (9).</t>

            <t hangText="   option-len">Length of DHCP-relay-message field.</t>

            <t hangText="   DHCP-relay-message">In a Relay-forward message,
            the received message, relayed verbatim to the next relay agent or
            server; in a Relay-reply message, the message to be copied and
            relayed to the relay agent or client whose address is in the
            peer-address field of the Relay-reply message. The
            length, in octets, is specified by option-len.</t>
          </list></t>
      </section>

      <section anchor="RFC3315-22.11" title="Authentication Option">

        <t>The Authentication option carries authentication information to
        authenticate the identity and contents of DHCP messages. The use of
        the Authentication option is described in <xref
        target="RFC3315-21"/>. The delayed authentication protocol,
        defined in <xref target="RFC3315"/>, has been obsoleted by this
        document, due to lack of usage (see <xref target="obsolete"/>).
        The format of the Authentication option is:</t>

        <figure align="center" anchor="FigOption11"
                title="Authentication Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          OPTION_AUTH          |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   protocol    |   algorithm   |      RDM      |               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
   |                                                               |
   |          replay detection (64 bits)           +-+-+-+-+-+-+-+-+
   |                                               |               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               |
   .                   authentication information                  .
   .                       (variable length)                       .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="32" style="hanging">
            <t hangText="   option-code">OPTION_AUTH (11).</t>

            <t hangText="   option-len">11 + length of authentication
            information field.</t>

            <t hangText="   protocol">The authentication protocol used in this
            Authentication option. A 1&nbhy;octet unsigned integer.</t>

            <t hangText="   algorithm">The algorithm used in the
            authentication protocol. A 1&nbhy;octet unsigned integer.</t>

            <t hangText="   RDM">The replay detection method used in this
            Authentication option. A 1&nbhy;octet unsigned integer.</t>

            <t hangText="   replay detection">The replay detection information
            for the RDM. A 64-bit (8-octet) field.</t>

            <t hangText="   authentication information">The authentication
            information, as specified by the protocol and algorithm used in
            this Authentication option. A variable-length field (11&nbsp;octets
            less than the value in the option-len field).</t>
          </list></t>
           
          <t>IANA maintains a registry for the protocol, algorithm, and RDM
          values at &lt;https://www.iana.org/assignments/auth-namespaces&gt;.</t>
      </section>

      <section anchor="RFC3315-22.12" title="Server Unicast Option">

        <t>The server sends this option to a client to indicate to the client
        that it is allowed to unicast messages to the server. The format of
        the Server Unicast option is:</t>

        <figure align="center" anchor="FigOption12"
                title="Server Unicast Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          OPTION_UNICAST       |        option-len             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   |                       server-address                          |
   |                                                               |
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_UNICAST (12).</t>

            <t hangText="   option-len">16.</t>

            <t hangText="   server-address">The 128-bit address to
            which the client should send messages delivered using
            unicast.</t>
          </list></t>

        <t>The server specifies in the server-address field the address
        to which the client is to send unicast messages. When a client
        receives this option, where permissible and appropriate the client
        sends messages directly to the server using the address specified
        in the server&nbhy;address field of the option.</t>

        <t>When the server sends a Server Unicast option to the client,
        some messages from the client will not be relayed by relay agents and
        will not include relay agent options from the relay agents. Therefore,
        a server should only send a Server Unicast option to a client when
        relay agents are not sending relay agent options. A DHCP server
        rejects any messages sent inappropriately using unicast to ensure that
        messages are relayed by relay agents when relay agent options are
        in&nbsp;use.</t>

        <t>Details about when the client may send messages to the server using
        unicast are provided in <xref target="configuration-exchange"/>.</t>
      </section>

      <section anchor="RFC3315-22.13" title="Status Code Option">

        <t>This option returns a status indication related to the DHCP message
        or option in which it appears. The format of the Status Code
        option&nbsp;is:</t>

        <figure align="center" anchor="FigOption13"
                title="Status Code Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       OPTION_STATUS_CODE      |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          status-code          |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
   .                                                               .
   .                        status-message                         .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_STATUS_CODE (13).</t>

            <t hangText="   option-len">2 + length of status-message field.</t>

            <t hangText="   status-code">The numeric code for the status
            encoded in this option. A 2-octet field containing
            an unsigned integer.</t>

            <t hangText="   status-message">A UTF-8 encoded 
            <xref target="RFC3629"/> text string
            suitable for display to an end user. MUST&nbsp;NOT be
            null-terminated. A variable-length field (2&nbsp;octets
            less than the value in the option-len field).</t>
          </list></t>

        <t>A Status Code option may appear in the "options" field of a DHCP
        message and/or in the "options" field of another option. If the Status
        Code option does not appear in a message in which the option could
        appear, the status of the message is assumed to be Success.</t>

        <t>The status-code values previously defined by <xref
        target="RFC3315"/> and <xref target="RFC3633"/>&nbsp;are:</t>

<?rfc compact="no"?>   
        <texttable anchor="Status-Code-Table" title="Status Code Definitions">
          <ttcol>Name</ttcol>

          <ttcol align="right">Code</ttcol>

          <ttcol>Description</ttcol>

          <c>Success</c>

          <c>0</c>

          <c>Success.</c>

          <c>UnspecFail</c>

          <c>1</c>

          <c>Failure, reason unspecified; this status code is sent by either a
          client or a server to indicate a failure not explicitly specified in
          this document.</c>

          <c>NoAddrsAvail</c>

          <c>2</c>

          <c>The server has no addresses available to assign to the IA(s).</c>

          <c>NoBinding</c>

          <c>3</c>

          <c>Client record (binding) unavailable.</c>

          <c>NotOnLink</c>

          <c>4</c>

          <c>The prefix for the address is not appropriate for the link to
          which the client is attached.</c>

          <c>UseMulticast</c>

          <c>5</c>

          <c>Sent by a server to a client to force the client to send messages
          to the server using the All_DHCP_Relay_Agents_and_Servers multicast
          address.</c>

          <c>NoPrefixAvail</c>

          <c>6</c>

          <c>The server has no prefixes available to assign to the
          IA_PD(s).</c>
        </texttable>
  <?rfc compact="yes"?>

        <t>See the "Status Codes" registry at 
        &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;
        for the current list of status codes.</t>
      </section>

      <section anchor="RFC3315-22.14" title="Rapid Commit Option">

        <t>The Rapid Commit option is used to signal the use of the
        two-message exchange for address assignment. The format of the Rapid
        Commit option is:</t>

        <figure align="center" anchor="FigOption14"
                title="Rapid Commit Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_RAPID_COMMIT      |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_RAPID_COMMIT (14).</t>

            <t hangText="   option-len">0.</t>
          </list></t>

        <t>A client MAY include this option in a Solicit message if the client
        is prepared to perform the Solicit/Reply message exchange described in
        <xref target="solicit-create-transmit"/>.</t>

        <t>A server MUST include this option in a Reply message sent in
        response to a Solicit message when completing the Solicit/Reply
        message exchange.</t>

        <t>DISCUSSION:</t>

        <t><list style="empty">
            <t>Each server that responds with a Reply to a Solicit that
            includes a Rapid Commit option will commit the leases
            in the Reply message to the client but will not receive any
            confirmation that the client has received the Reply message.
            Therefore, if more than one server responds to a Solicit that
            includes a Rapid Commit option, all but one server will commit
            leases that are not actually used by the client; this could 
            result in incorrect address information in DNS if the DHCP servers
            update DNS <xref target="RFC4704"/>, and responses to
            leasequery requests <xref target="RFC5007"/> may include
            information on leases not in use by the client.</t>

            <t>The problem of unused leases can be minimized by designing
            the DHCP service so that only one server responds to the
            Solicit or by using relatively short lifetimes for newly assigned
            leases.</t>
          </list></t>
      </section>

      <section anchor="RFC3315-22.15" title="User Class Option">

        <t>The User Class option is used by a client to identify the type or
        category of users or applications it represents.</t>

        <t>The format of the User Class option is:</t>

        <figure align="center" anchor="FigOption15"
                title="User Class Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       OPTION_USER_CLASS       |          option-len           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                          user-class-data                      .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_USER_CLASS (15).</t>

            <t hangText="   option-len">Length of user-class-data field.</t>

            <t hangText="   user-class-data">The user classes carried by the
            client. The length, in octets, is specified by option&nbhy;len.</t>
          </list></t>

        <t>The information contained in the data area of this option is
        contained in one or more opaque fields that represent the user class
        or classes of which the client is a member. A server selects
        configuration information for the client based on the classes
        identified in this option. For example, the User Class option can be
        used to configure all clients of people in the accounting department
        with a different printer than clients of people in the marketing
        department. The user class information carried in this option MUST be
        configurable on the client.</t>

        <t>The data area of the User Class option MUST contain one or more
        instances of user-class-data information. Each instance of
        user&nbhy;class-data is formatted as follows:</t>

        <figure align="center" anchor="FigOption15Data"
                title="Format of user-class-data Field">
          <artwork align="left"><![CDATA[
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+
   |        user-class-len         |          opaque-data          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t>The user-class-len field is 2 octets long and specifies the
        length of the opaque user-class-data in network byte order.</t>

        <t>A server interprets the classes identified in this option according
        to its configuration to select the appropriate configuration
        information for the client. A server may use only those user classes
        that it is configured to interpret in selecting configuration
        information for a client and ignore any other user classes. In
        response to a message containing a User Class option, a server may
        include a User Class option containing those classes that were
        successfully interpreted by the server so that the client can be
        informed of the classes interpreted by the server.</t>
      </section>

      <section anchor="RFC3315-22.16" title="Vendor Class Option">

        <t>This option is used by a client to identify the vendor that
        manufactured the hardware on which the client is running. The
        information contained in the data area of this option is contained in
        one or more opaque fields that identify details of the hardware
        configuration. The format of the Vendor Class option is:</t>

        <figure align="center" anchor="FigOption16"
                title="Vendor Class Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_VENDOR_CLASS      |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       enterprise-number                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                       vendor-class-data                       .
   .                             . . .                             .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_VENDOR_CLASS (16).</t>

            <t hangText="   option-len">4 + length of vendor-class-data
            field.</t>

            <t hangText="   enterprise-number">The vendor's registered
            Enterprise Number as maintained by IANA <xref target="IANA-PEN"/>.
            A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   vendor-class-data">The hardware configuration of
            the node on which the client is running. A variable&nbhy;length
            field (4 octets less than the value in the option-len field).</t>
          </list></t>

        <t>The vendor-class-data field is composed of a series of separate
        items, each of which describes some characteristic of the client's
        hardware configuration. Examples of vendor-class-data instances
        might include the version of the operating system the client is
        running or the amount of memory installed on the client.</t>

        <t>Each instance of vendor-class-data is formatted as follows:</t>

        <figure align="center" anchor="FigOption16Data"
                title="Format of vendor-class-data Field">
          <artwork align="left"><![CDATA[
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+
   |       vendor-class-len        |          opaque-data          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-...-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t>The vendor-class-len field is 2 octets long and specifies the
        length of the opaque vendor-class-data in network byte order.</t>

        <t>Servers and clients MUST NOT include more than one instance of
        OPTION_VENDOR_CLASS with the same Enterprise Number. Each instance of
        OPTION_VENDOR_CLASS can carry multiple vendor-class-data instances.</t>
      </section>

      <section anchor="RFC3315-22.17" title="Vendor-specific Information Option">

        <t>This option is used by clients and servers to exchange
        vendor-specific information.</t>

        <t>The format of the Vendor-specific Information option is:</t>

        <figure align="center" anchor="FigOption17"
                title="Vendor-specific Information Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_VENDOR_OPTS       |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       enterprise-number                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                       vendor-option-data                      .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_VENDOR_OPTS (17).</t>

            <t hangText="   option-len">4 + length of vendor-option-data
            field.</t>

            <t hangText="   enterprise-number">The vendor's registered
            Enterprise Number as maintained by IANA <xref target="IANA-PEN"/>.
            A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   vendor-option-data">Vendor options, interpreted by
            vendor-specific code on the clients and servers. A
            variable-length field (4 octets less than the value in the
            option-len field).</t>
          </list></t>

        <t>The definition of the information carried in this option is vendor
        specific. The vendor is indicated in the enterprise-number field. Use
        of vendor-specific information allows enhanced operation, utilizing
        additional features in a vendor's DHCP implementation. A DHCP client
        that does not receive requested vendor-specific information will still
        configure the node's IPv6 stack to be functional.</t>

        <t>The vendor-option-data field MUST be encoded as a sequence of
        code/length/value fields of format identical to the DHCP options
        (see <xref target="RFC3315-22.1"/>). The sub-option codes are defined
        by the vendor identified in the enterprise-number field and are not
        managed by IANA. Each of the sub-options is formatted as follows:</t>

        <figure align="center" anchor="FigOption17Data"
                title="Vendor-specific Options Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          sub-opt-code         |         sub-option-len        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                        sub-option-data                        .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   sub-opt-code">The code for the sub-option. A
            2-octet field.</t>

            <t hangText="   sub-option-len">An unsigned integer giving the length
            of the sub-option-data field in this sub-option in octets. A
            2-octet field.</t>

            <t hangText="   sub-option-data">The data area for the sub-option.
            The length, in octets, is specified by sub&nbhy;option&nbhy;len.
            </t>
          </list></t>

        <t>Multiple instances of the Vendor-specific Information option may
        appear in a DHCP message. Each instance of the option is interpreted
        according to the option codes defined by the vendor identified by the
        Enterprise Number in that option. Servers and clients MUST NOT send
        more than one instance of the Vendor-specific Information option with
        the same Enterprise Number. Each instance of the Vendor-specific
        Information option MAY contain multiple sub-options.</t>

        <t>A client that is interested in receiving a Vendor-specific
        Information option:</t>

        <t><list style="symbols">
            <t>MUST specify the Vendor-specific Information
            option in an Option Request option.</t>

            <t>MAY specify an associated Vendor Class option
            (see <xref target="RFC3315-22.16"/>).</t>

            <t>MAY specify the Vendor-specific Information option
            with appropriate data.</t>
          </list></t>

        <t>Servers only return the Vendor-specific Information options if
        specified in Option Request options from clients and:</t>

        <t><list style="symbols">
            <t>MAY use the Enterprise Numbers in the associated
            Vendor Class options to restrict the set of Enterprise Numbers in
            the Vendor&nbhy;specific Information options returned.</t>

            <t>MAY return all configured Vendor-specific
            Information options.</t>

            <t>MAY use other information in the packet or in its
            configuration to determine which set of Enterprise Numbers in the
            Vendor-specific Information options to return.</t>
          </list></t>
      </section>

      <section anchor="RFC3315-22.18" title="Interface-Id Option">

        <t>The relay agent MAY send the Interface-Id option to identify the
        interface on which the client message was received. If a relay agent
        receives a Relay-reply message with an Interface-Id option, the relay
        agent relays the message to the client through the interface
        identified by the option.</t>

        <t>The format of the Interface-Id option is:</t>

        <figure align="center" anchor="FigOption18"
                title="Interface-Id Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_INTERFACE_ID      |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                         interface-id                          .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_INTERFACE_ID (18).</t>

            <t hangText="   option-len">Length of interface-id field.</t>

            <t hangText="   interface-id">An opaque value of arbitrary length
            generated by the relay agent to identify one of the relay agent's
            interfaces. The length, in octets, is specified by option-len.</t>
          </list></t>

        <t>The server MUST copy the Interface-Id option from the Relay-forward
        message into the Relay-reply message the server sends to the relay
        agent in response to the Relay-forward message. This option MUST NOT
        appear in any message except a Relay-forward or Relay-reply
        message.</t>

        <t>Servers MAY use the interface-id field for parameter assignment
        policies. The interface-id value SHOULD be considered an opaque value,
        with policies based on exact match only; that is, the interface-id
        field SHOULD NOT be internally parsed by the server. The
        interface-id value for an interface SHOULD be stable and remain
        unchanged -- for example, after the relay agent is restarted; if the
        interface-id value changes, a server will not be able to use it
        reliably in parameter assignment policies.</t>
      </section>

      <section anchor="RFC3315-22.19" title="Reconfigure Message Option">

        <t>A server includes a Reconfigure Message option in a Reconfigure
        message to indicate to the client whether the client responds with a
        Renew message, a Rebind message, or an Information-request message.
        The format of the Reconfigure Message option is:</t>

        <figure align="center" anchor="FigOption19"
                title="Reconfigure Message Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_RECONF_MSG        |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    msg-type   |
   +-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_RECONF_MSG (19).</t>

            <t hangText="   option-len">1.</t>

            <t hangText="   msg-type">5 for Renew message,
            6 for Rebind message, 11&nbsp;for Information-request message.
            A 1&nbhy;octet unsigned integer.</t>
          </list></t>

        <t>The Reconfigure Message option can only appear in a Reconfigure
        message.</t>
      </section>

      <section anchor="RFC3315-22.20" title="Reconfigure Accept Option">

        <t>A client uses the Reconfigure Accept option to announce to the
        server whether the client is willing to accept Reconfigure messages,
        and a server uses this option to tell the client whether or not to
        accept Reconfigure messages. In the absence of this option, the
        default behavior is that the client is unwilling to accept 
        Reconfigure messages. The format of the Reconfigure Accept
        option is:</t>

        <figure align="center" anchor="FigOption20"
                title="Reconfigure Accept Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     OPTION_RECONF_ACCEPT      |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_RECONF_ACCEPT (20).</t>

            <t hangText="   option-len">0.</t>
          </list></t>
      </section>

      <section anchor="IA_PD-option"
               title="Identity Association for Prefix Delegation Option">
        <t>The IA_PD option is used to carry a prefix delegation identity
        association, the parameters associated with the IA_PD, and the
        prefixes associated with it. The format of the IA_PD option is:</t>

        <figure align="center" anchor="FigOption25"
                title="Identity Association for Prefix Delegation Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         OPTION_IA_PD          |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         IAID (4 octets)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              T1                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              T2                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   .                                                               .
   .                          IA_PD-options                        .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_IA_PD (25).</t>

            <t hangText="   option-len">12 + length of IA_PD-options
            field.</t>

            <t hangText="   IAID">The unique identifier for this IA_PD; the
            IAID must be unique among the identifiers for all of this
            client's IA_PDs. The number space for IA_PD IAIDs is separate from
            the number space for other IA option types (i.e., IA_NA and IA_TA).
            A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   T1">The time interval after which the client should
            contact the server from which the prefixes in the IA_PD
            were obtained to extend the lifetimes of the prefixes delegated to
            the IA_PD; T1 is a time duration relative to the message reception
            time expressed in units of seconds. A 4&nbhy;octet field containing
            an unsigned integer.</t>

            <t hangText="   T2">The time interval after which the client should
            contact any available server to extend the lifetimes of
            the prefixes assigned to the IA_PD; T2 is a time duration relative
            to the message reception time expressed in units of seconds.
            A 4&nbhy;octet field containing an unsigned integer.</t>

            <t hangText="   IA_PD-options">Options associated with this
            IA_PD. A variable-length field (12 octets less than the
            value in the option-len field).</t>
          </list></t>

        <t>The IA_PD-options field encapsulates those options that are
        specific to this IA_PD. For example, all of the IA Prefix options
        (see <xref target="IAPREFIX-option"/>)
        carrying the prefixes associated with this IA_PD are in the
        IA_PD-options field.</t>

        <t>An IA_PD option may only appear in the options area of a DHCP
        message. A DHCP message may contain multiple IA_PD options (though
        each must have a unique IAID).</t>

        <t>The status of any operations involving this IA_PD is indicated in a
        Status Code option (see <xref target="RFC3315-22.13"/>)
        in the IA_PD-options field.</t>

        <t>Note that an IA_PD has no explicit "lifetime" or "lease length" of
        its own. When the valid lifetimes of all of the prefixes in an IA_PD
        have expired, the IA_PD can be considered as having expired. T1 and T2
        fields are included to give the server explicit control over when a
        client should contact the server about a
        specific IA_PD.</t>

        <t>In a message sent by a client to a server,
        the T1 and T2 fields SHOULD be set to 0. The server MUST
        ignore any values in these fields in messages received from a
        client.</t>

        <t>In a message sent by a server to a client,
        the client MUST use the values in the T1 and T2 fields for
        the T1 and T2 timers, unless values in those fields are 0.
        The values in the T1 and T2 fields are the number of seconds until T1
        and T2.</t>

        <t>The server selects the T1 and T2 times to allow the
        client to extend the lifetimes of any prefixes in the IA_PD
        before the lifetimes expire, even if the server is
        unavailable for some short period of time. Recommended values for T1
        and T2 are 0.5 and 0.8 times the shortest preferred lifetime of the
        prefixes in the IA_PD that the server is willing to extend,
        respectively. If the time at which the prefixes in an IA_PD are to be
        renewed is to be left to the discretion of the client, the
        server sets T1 and T2 to 0. The client MUST
        follow the rules defined in <xref target="t1-t2-0"/>.</t>

        <t>If a client receives an IA_PD with T1 greater than T2
        and both T1 and T2 are greater than 0, the client discards
        the IA_PD option and processes the remainder of the message as though
        the server had not included the IA_PD option.</t>
      </section>

      <section anchor="IAPREFIX-option" title="IA Prefix Option">
        <t>The IA Prefix option is used to specify a prefix
        associated with an IA_PD. The IA Prefix option must be encapsulated
        in the IA_PD&nbhy;options field of an IA_PD option
        (see <xref target="IA_PD-option"/>).</t>

        <figure align="center" anchor="FigOption26"
                title="IA Prefix Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        OPTION_IAPREFIX        |           option-len          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      preferred-lifetime                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        valid-lifetime                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | prefix-length |                                               |
   +-+-+-+-+-+-+-+-+          IPv6-prefix                          |
   |                           (16 octets)                         |
   |                                                               |
   |                                                               |
   |                                                               |
   |               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               |                                               .
   +-+-+-+-+-+-+-+-+                                               .
   .                       IAprefix-options                        .
   .                                                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
            <t hangText="   option-code">OPTION_IAPREFIX (26).</t>

            <t hangText="   option-len">25 + length of IAprefix-options
            field.</t>

            <t hangText="   preferred-lifetime">The preferred
            lifetime for the prefix in the option, expressed in units of
            seconds. A value of 0xffffffff represents "infinity"
            (see <xref target="RFC3315-5.6"/>). A 4&nbhy;octet field
            containing an unsigned integer.</t>

            <t hangText="   valid-lifetime">The valid lifetime for the
            prefix in the option, expressed in units of seconds. A value of
            0xffffffff represents "infinity". A 4&nbhy;octet field
            containing an unsigned integer.</t>

            <t hangText="   prefix-length">Length for this prefix in bits.
            A 1&nbhy;octet unsigned integer.</t>

            <t hangText="   IPv6-prefix">An IPv6 prefix. A 16-octet field.</t>

            <t hangText="   IAprefix-options">Options associated with this
            prefix. A variable-length field (25 octets less than the
            value in the option-len field).</t>
          </list></t>

        <t>In a message sent by a client to a server,
        the preferred-lifetime and valid-lifetime fields SHOULD be set to 0.
        The server MUST ignore any received values in these
        lifetime fields.</t>

        <t>The client SHOULD NOT send an IA Prefix option with 0 in the
        "prefix&nbhy;length" field (and an unspecified value (::) in the
        "IPv6&nbhy;prefix" field). A client MAY send a non-zero value in the
        "prefix-length" field and the unspecified value (::) in the
        "IPv6&nbhy;prefix" field to indicate a preference for the size of the
        prefix to be delegated. See <xref target="RFC8168"/> for
        further details on prefix-length hints.</t>

        <t>The client MUST discard any prefixes for which the preferred
        lifetime is greater than the valid lifetime.</t>

        <t>The values in the preferred-lifetime and valid-lifetime fields
        are the number of seconds remaining in each lifetime. See
        <xref target="reply-solicit-request-renew-rebind"/> for more details
        on how these values are used for delegated prefixes.</t>

        <t>As per <xref target="RFC3315-5.6"/>, the value of 0xffffffff
        for the preferred lifetime or the valid lifetime is taken to mean
        "infinity" and should be used carefully.</t>

        <t>An IA Prefix option may appear only in an IA_PD option. More
        than one IA Prefix option can appear in a single IA_PD option.</t>

        <t>The status of any operations involving this IA Prefix option is
        indicated in a Status Code option (see <xref target="RFC3315-22.13"/>)
        in the IAprefix&nbhy;options field.</t>
      </section>

     <section anchor="RFC4242-Option" title="Information Refresh Time Option">
        <t>This option is requested by clients and returned by servers to
        specify an upper bound for how long a client should wait before
        refreshing information retrieved
        from a DHCP server. It is only used in Reply messages in response to
        Information-request messages. In other messages, there will usually
        be other information that indicates when the client should contact the
        server, e.g., T1/T2 times and lifetimes. This option is useful when
        the configuration parameters change or during a renumbering event, as
        clients running in the stateless mode will be able to update their
        configuration.</t>

        <t>The format of the Information Refresh Time option is:</t>

        <figure align="center" anchor="FigOption32"
                title="Information Refresh Time Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |OPTION_INFORMATION_REFRESH_TIME|         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   information-refresh-time                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="30" style="hanging">
            <t hangText="   option-code">OPTION_INFORMATION_REFRESH_TIME (32).</t>

            <t hangText="   option-len">4.</t>

            <t hangText="   information-refresh-time">Time duration relative to
             the current time, expressed in units of seconds. A 4&nbhy;octet
             field containing an unsigned integer.</t>
          </list></t>

        <t>A DHCP client MUST request this option in the Option Request option
        (see <xref target="RFC3315-22.7"/>) when sending Information-request
        messages. A client MUST NOT request this option in the Option Request
        option in any other messages.</t>

        <t>A server sending a Reply to an Information-request message SHOULD
        include this option if it is requested in the Option Request option
        of the Information-request. The option value MUST NOT be smaller
        than IRT_MINIMUM. This option MUST only appear in the top-level
        options area of Reply messages.</t>

        <t>If the Reply to an Information-request message does not contain this
        option, the client MUST behave as if the option with the value
        IRT_DEFAULT was provided.</t>

        <t>A client MUST use the refresh time IRT_MINIMUM if it receives the
        option with a value less than IRT_MINIMUM.</t>

        <t>As per <xref target="RFC3315-5.6"/>, the value 0xffffffff is taken to
        mean "infinity" and implies that the client should not refresh its
        configuration data without some other trigger (such as detecting
        movement to a new link).</t>

        <t>If a client contacts the server to obtain new data or refresh some
        existing data before the refresh time expires, then it SHOULD also
        refresh all data covered by this option.</t>

        <t>When the client detects that the refresh time has expired, it SHOULD
        try to update its configuration data by sending an
        Information&nbhy;request as specified in
        <xref target="RFC3315-18.1.5"/>, except that the
        client MUST delay sending the first Information-request by a random
        amount of time between 0 and INF_MAX_DELAY.</t>

        <t>A client MAY have a maximum value for the refresh time, where that
        value is used whenever the client receives this option with a value
        higher than the maximum.  This also means that the maximum value is
        used when the received value is "infinity".  A maximum value might
        make the client less vulnerable to attacks based on forged DHCP
        messages.  Without a maximum value, a client may be made to use wrong
        information for a possibly infinite period of time.  There may,
        however, be reasons for having a very long refresh time, so it may be
        useful for this maximum value to be configurable.</t>

      </section>

      <section anchor="SOL_MAX_RT_option" title="SOL_MAX_RT Option">
        <t>A DHCP server sends the SOL_MAX_RT option to a client to override
        the default value of SOL_MAX_RT. The value of SOL_MAX_RT in the option
        replaces the default value defined in <xref
        target="RFC3315-5.5"/>. One use for the SOL_MAX_RT option is to
        set a higher value for SOL_MAX_RT; this reduces the Solicit traffic
        from a client that has not received a response to its Solicit
        messages.</t>

        <t>The format of the SOL_MAX_RT option is:</t>

        <figure align="center" anchor="FigOption82"
                title="SOL_MAX_RT Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_SOL_MAX_RT        |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       SOL_MAX_RT value                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
           <t hangText="   option-code">OPTION_SOL_MAX_RT (82).</t>

           <t hangText="   option-len">4.</t>

           <t hangText="   SOL_MAX_RT value">Overriding value for SOL_MAX_RT
           in seconds; MUST be in this range: 60 &lt;= "value" &lt;= 86400
           (1&nbsp;day). A 4&nbhy;octet field containing an unsigned integer.</t>
        </list></t>

        <t>A DHCP client MUST include the SOL_MAX_RT option code in any Option
        Request option (see <xref target="RFC3315-22.7"/>) it sends in a
        Solicit message.</t>

        <t>The DHCP server MAY include the SOL_MAX_RT option in any response
        it sends to a client that has included the SOL_MAX_RT option code in
        an Option Request option. The SOL_MAX_RT option is sent as a top-level
        option in the message to the client.</t>

        <t>A DHCP client MUST ignore any SOL_MAX_RT option values that are
        less than 60 or more than 86400.</t>

        <t>If a DHCP client receives a message containing a SOL_MAX_RT option
        that has a valid value for SOL_MAX_RT, the client MUST set its
        internal SOL_MAX_RT parameter to the value contained in the SOL_MAX_RT
        option. This value of SOL_MAX_RT is then used by the retransmission
        mechanism defined in Sections&nbsp;<xref target="RFC3315-14"
        format="counter"/> and <xref target="solicit-create-transmit"
        format="counter"/>.</t>

        <t>The purpose of this mechanism is to give network administrators
        a way to avoid excessive DHCP traffic if all DHCP servers
        become unavailable. Therefore, this value is expected
        to be retained for as long as practically possible.</t>

        <t>An updated SOL_MAX_RT value applies only to the network interface on
        which the client received the SOL_MAX_RT option.</t>
      </section>

      <section anchor="INF_MAX_RT_option" title="INF_MAX_RT Option">
        <t>A DHCP server sends the INF_MAX_RT option to a client to override
        the default value of INF_MAX_RT. The value of INF_MAX_RT in the option
        replaces the default value defined in <xref
        target="RFC3315-5.5"/>. One use for the INF_MAX_RT option is to
        set a higher value for INF_MAX_RT; this reduces the
        Information-request traffic from a client that has not received a
        response to its Information-request messages.</t>

        <t>The format of the INF_MAX_RT option is:</t>

        <figure align="center" anchor="FigOption83"
                title="INF_MAX_RT Option Format">
          <artwork align="left">
    <![CDATA[0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      OPTION_INF_MAX_RT        |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       INF_MAX_RT value                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          ]]></artwork>
        </figure>

        <t><list hangIndent="24" style="hanging">
           <t hangText="   option-code">OPTION_INF_MAX_RT (83).</t>

           <t hangText="   option-len">4.</t>

           <t hangText="   INF_MAX_RT value">Overriding value for INF_MAX_RT
           in seconds; MUST be in this range: 60 &lt;= "value" &lt;= 86400
           (1&nbsp;day). A 4&nbhy;octet field containing an unsigned integer.</t>
        </list></t>

        <t>A DHCP client MUST include the INF_MAX_RT option code in any Option
        Request option (see <xref target="RFC3315-22.7"/>) it sends in
        an Information-request message.</t>

        <t>The DHCP server MAY include the INF_MAX_RT option in any response
        it sends to a client that has included the INF_MAX_RT option code in
        an Option Request option. The INF_MAX_RT option is a top-level
        option in the message to the client.</t>

        <t>A DHCP client MUST ignore any INF_MAX_RT option values that are
        less than 60 or more than 86400.</t>

        <t>If a DHCP client receives a message containing an INF_MAX_RT option
        that has a valid value for INF_MAX_RT, the client MUST set its
        internal INF_MAX_RT parameter to the value contained in the INF_MAX_RT
        option. This value of INF_MAX_RT is then used by the retransmission
        mechanism defined in Sections&nbsp;<xref target="RFC3315-14"
        format="counter"/> and <xref target="RFC3315-18.1.5"
        format="counter"/>.</t>

        <t>An updated INF_MAX_RT value applies only to the network interface on
        which the client received the INF_MAX_RT option.</t>
      </section>

    </section>

    <section anchor="security" title="Security Considerations">

      <t>This section discusses security considerations that are not related
      to privacy. See <xref target="privacy"/> for a discussion dedicated to
      privacy.</t>

      <t>The threat to DHCP is inherently an insider threat (assuming a
      properly configured network where DHCP ports are blocked on the
      perimeter gateways of the enterprise). Regardless of the gateway
      configuration, however, the potential attacks by insiders and
      outsiders are the same.</t>
         
      <t>DHCP lacks end-to-end encryption between clients and servers; thus,
      hijacking, tampering, and eavesdropping attacks are all possible
      as a result. Some network environments (discussed below) can be
      secured through various means to minimize these attacks.</t>

      <t>One attack specific to a DHCP client is the establishment of a
      malicious server with the intent of providing incorrect configuration
      information to the client.  The motivation for doing so may be to mount
      a "man in the middle" attack that causes the client to communicate with
      a malicious server instead of a valid server for some service (such as
      DNS or NTP).  The malicious server may also mount a DoS attack
      through misconfiguration of the client; this attack would cause all
      network communication from the client to fail.</t>

      <t>A malicious DHCP server might cause a client to set its SOL_MAX_RT
      and INF_MAX_RT parameters to an unreasonably high value with the
      SOL_MAX_RT (see <xref target="SOL_MAX_RT_option"/>) and INF_MAX_RT
      (see <xref target="INF_MAX_RT_option"/>) options; this may cause
      an undue delay in a client completing its DHCP protocol transaction
      in the case where no other valid response is received.  Assuming that
      the client also receives a response from a valid DHCP server,
      large values for SOL_MAX_RT and INF_MAX_RT will not have any effect.</t>
         
      <t>A malicious server can also send a Server Unicast option (see
      <xref target="RFC3315-22.12"/>) to a client in an Advertise
      message, thus potentially causing the client to bypass relays and
      communicate only with the malicious server for subsequent Request
      and Renew messages.</t>

      <t>Another threat to DHCP clients originates from mistakenly or
      accidentally configured DHCP servers that answer DHCP client requests
      with unintentionally incorrect configuration parameters.</t>

      <t>A DHCP client may also be subject to attack through the receipt of a
      Reconfigure message from a malicious server that causes the client to
      obtain incorrect configuration information from that server.  Note that
      although a client sends its response (Renew, Rebind, or
      Information-request message) through a relay agent and, therefore, that
      response will only be received by servers to which DHCP messages are
      relayed, a malicious server could send a Reconfigure message to a client,
      followed (after an appropriate delay) by a Reply message that would be
      accepted by the client.  Thus, a malicious server that is not on the
      network path between the client and the server may still be able to
      mount a Reconfigure attack on a client.  The use of transaction IDs that
      are cryptographically sound and cannot easily be predicted will also
      reduce the probability that such an attack will be successful.</t>

      <t>Because of the opportunity for attack through the Reconfigure message,
      a DHCP client MUST discard any Reconfigure message that does not include
      authentication or that does not pass the validation process for the
      authentication protocol.</t>

      <t>RKAP, described in
      <xref target="reconfigure-protocol"/>, provides protection against the
      use of a Reconfigure message by a malicious DHCP server to mount a DoS
      or man-in-the-middle attack on a client.  This protocol can be
      compromised by an attacker that can intercept the initial message in
      which the DHCP server sends the key "in plain text" to the client.</t>

      <t>Many of these attacks by rogue servers can be mitigated by making use
      of the mechanisms described in <xref target="RFC7610"/> and <xref
      target="RFC7513"/>.</t>

      <t>The threat specific to a DHCP server is an invalid client masquerading
      as a valid client.  The motivation for this may be for theft of service,
      or to circumvent auditing for any number of nefarious purposes.</t>

      <t>The threat common to both the client and the server is the
      "resource-exhaustion" DoS attack. These attacks typically involve the
      exhaustion of available assigned addresses or delegatable prefixes, or
      the exhaustion of CPU or network bandwidth, and are present any time
      there is a shared resource.  Some forms of these exhaustion attacks
      can be partially mitigated by appropriate server policy, e.g., limiting
      the maximum number of leases any one client can get.</t>

      <t>The messages exchanged between relay agents and servers may be used to
      mount a man-in-the-middle or DoS attack. Communication
      between a server and a relay agent, and communication between relay
      agents, can be authenticated and encrypted through the use of IPsec, as
      described in <xref target="RFC8213"/>.</t>

      <t>However, the use of manually configured pre-shared keys for IPsec
      between relay agents and servers does not defend against replayed DHCP
      messages.  Replayed messages can represent a DoS attack through
      exhaustion of processing resources but not through misconfiguration or
      exhaustion of other resources such as assignable addresses and
      delegatable prefixes.</t>

      <t>Various network environments also offer levels of security if deployed
      as described below.</t>

      <t><list style="symbols">

      <t>In enterprise and factory networks, use of authentication per
      <xref target="IEEE-802.1x"/> can prevent unknown or untrusted clients
      from connecting to the network. However, this does not necessarily
      assure that the connected client will be a good DHCP or network
      actor.</t>

      <t>For wired networks where clients typically are connected to a switch
      port, snooping DHCP multicast (or unicast) traffic becomes difficult, as
      the switches limit the traffic delivered to a port. The client's DHCP
      multicast packets (with destination address fe02::1:2) are only forwarded
      to the DHCP server's (or relay's) switch port -- not all ports. Also, the
      server's (or relay's) unicast replies are only delivered to the target
      client's port -- not all ports.</t>

      <t>In public networks (such as a Wi-Fi network in a coffee shop or
      airport), it is possible for others within radio range to snoop DHCP and
      other traffic. But in these environments, there is very little if
      anything that can be learned from the DHCP traffic itself (either from
      client to server or from server to client) if the privacy considerations
      provided in <xref target="privacy"/> are followed. Even for devices that
      do not follow the privacy considerations, there is little that can
      be learned that would not be available from subsequent communications
      anyway (such as the device's Media Access Control (MAC) address). Also,
      because all clients will typically receive similar configuration details,
      a bad actor that initiates a DHCP request itself can learn much of
      such information. As mentioned above, one threat is that the RKAP key
      for a client can be learned (if the initial
      Solicit/Advertise/Request/Reply exchange is monitored) and trigger a
      premature reconfiguration, but this is relatively easily prevented by
      disallowing direct client-to-client communication on these networks or
      using <xref target="RFC7610"/> and <xref target="RFC7513"/>.</t>
           
           </list></t>

    </section>

    <section anchor="privacy" title="Privacy Considerations">
      <t>For an extended discussion about privacy considerations for the
      client, see <xref target="RFC7824"/>:</t>
      <t><list style="symbols">
        <t>In particular, its Section 3 discusses various identifiers that
        could be misused to track the client.</t>
        <t>Its Section 4 discusses existing mechanisms that may have an
        impact on a client's privacy.</t>
        <t>Finally, its Section 5 discusses potential attack vectors.</t>
      </list></t>

      <t>For recommendations regarding how to address or mitigate those
      issues, see <xref target="RFC7844"/>.</t>

      <t>This specification does not define any allocation strategies for servers.
      Implementers are expected to develop their own algorithm for the server
      to choose a resource out of the available pool. Several possible
      allocation strategies are mentioned in Section&nbsp;4.3 of <xref
      target="RFC7824"/>. Please keep in mind that the list in
      <xref target="RFC7824"/> is not exhaustive; there are certainly other
      possible strategies. Readers are also encouraged to read <xref
      target="RFC7707"/> -- in particular, its Section&nbsp;4.1.2, which
      discusses the problems with certain allocation strategies.</t>

    </section>

    <section anchor="iana" title="IANA Considerations">

      <t>This document does not define any new DHCP name spaces or
      definitions.</t>

      <t>The publication of this document does not change the
      assignment rules for new values for message types, option codes,
      DUID types, or status codes.</t>

      <t>The list of assigned values used in DHCPv6 is available at
      &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;.</t>

      <t>IANA has updated
      &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;
      to add a reference to this document for definitions previously
      created by <xref target="RFC3315"/>, <xref target="RFC3633"/>,
      <xref target="RFC4242"/>, and <xref target="RFC7083"/>.</t>
         
      <t>IANA has added two columns to the DHCPv6 "Option Codes" registry at
      &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;
      to indicate which options are allowed to appear in a client's Option
      Request option
      (see <xref target="RFC3315-22.7"/>) and which options are singleton
      options (only allowed to appear once as a top-level or encapsulated
      option; see Section&nbsp;16 of <xref target="RFC7227"/>).
      <xref target="option_update_table"/> provides the data for the options
      assigned by IANA at the time of writing this document.</t>

<texttable anchor="option_update_table" title="Updated Options">
<ttcol align='right' width="15%">Option</ttcol>
<ttcol align='left' width="35%">Option Name ("OPTION" prefix removed)</ttcol>
<ttcol align='left' width="35%">Client ORO (1)</ttcol>
<ttcol align='left' width="15%">Singleton Option</ttcol>
<c>1</c><c>CLIENTID</c><c>No</c><c>Yes</c>
<c>2</c><c>SERVERID</c><c>No</c><c>Yes</c>
<c>3</c><c>IA_NA</c><c>No</c><c>No</c>
<c>4</c><c>IA_TA</c><c>No</c><c>No</c>
<c>5</c><c>IAADDR</c><c>No</c><c>No</c>
<c>6</c><c>ORO</c><c>No</c><c>Yes</c>
<c>7</c><c>PREFERENCE</c><c>No</c><c>Yes</c>
<c>8</c><c>ELAPSED_TIME</c><c>No</c><c>Yes</c>
<c>9</c><c>RELAY_MSG</c><c>No</c><c>Yes</c>
<c>11</c><c>AUTH</c><c>No</c><c>Yes</c>
<c>12</c><c>UNICAST</c><c>No</c><c>Yes</c>
<c>13</c><c>STATUS_CODE</c><c>No</c><c>Yes</c>
<c>14</c><c>RAPID_COMMIT</c><c>No</c><c>Yes</c>
<c>15</c><c>USER_CLASS</c><c>No</c><c>Yes</c>
<c>16</c><c>VENDOR_CLASS</c><c>No</c><c>No (2)</c>
<c>17</c><c>VENDOR_OPTS</c><c>Optional</c><c>No (2)</c>
<c>18</c><c>INTERFACE_ID</c><c>No</c><c>Yes</c>
<c>19</c><c>RECONF_MSG</c><c>No</c><c>Yes</c>
<c>20</c><c>RECONF_ACCEPT</c><c>No</c><c>Yes</c>
<c>21</c><c>SIP_SERVER_D</c><c>Yes</c><c>Yes</c>
<c>22</c><c>SIP_SERVER_A</c><c>Yes</c><c>Yes</c>
<c>23</c><c>DNS_SERVERS</c><c>Yes</c><c>Yes</c>
<c>24</c><c>DOMAIN_LIST</c><c>Yes</c><c>Yes</c>
<c>25</c><c>IA_PD</c><c>No</c><c>No</c>
<c>26</c><c>IAPREFIX</c><c>No</c><c>No</c>
<c>27</c><c>NIS_SERVERS</c><c>Yes</c><c>Yes</c>
<c>28</c><c>NISP_SERVERS</c><c>Yes</c><c>Yes</c>
<c>29</c><c>NIS_DOMAIN_NAME</c><c>Yes</c><c>Yes</c>
<c>30</c><c>NISP_DOMAIN_NAME</c><c>Yes</c><c>Yes</c>
<c>31</c><c>SNTP_SERVERS</c><c>Yes</c><c>Yes</c>
<c>32</c><c>INFORMATION_REFRESH_TIME</c><c>Required for Information- request</c><c>Yes</c>
<c>33</c><c>BCMCS_SERVER_D</c><c>Yes</c><c>Yes</c>
<c>34</c><c>BCMCS_SERVER_A</c><c>Yes</c><c>Yes</c>
<c>36</c><c>GEOCONF_CIVIC</c><c>Yes</c><c>Yes</c>
<c>37</c><c>REMOTE_ID</c><c>No</c><c>Yes</c>
<c>38</c><c>SUBSCRIBER_ID</c><c>No</c><c>Yes</c>
<c>39</c><c>CLIENT_FQDN</c><c>Yes</c><c>Yes</c>
<c>40</c><c>PANA_AGENT</c><c>Yes</c><c>Yes</c>
<c>41</c><c>NEW_POSIX_TIMEZONE</c><c>Yes</c><c>Yes</c>
<c>42</c><c>NEW_TZDB_TIMEZONE</c><c>Yes</c><c>Yes</c>
<c>43</c><c>ERO</c><c>No</c><c>Yes</c>
<c>44</c><c>LQ_QUERY</c><c>No</c><c>Yes</c>
<c>45</c><c>CLIENT_DATA</c><c>No</c><c>Yes</c>
<c>46</c><c>CLT_TIME</c><c>No</c><c>Yes</c>
<c>47</c><c>LQ_RELAY_DATA</c><c>No</c><c>Yes</c>
<c>48</c><c>LQ_CLIENT_LINK</c><c>No</c><c>Yes</c>
<c>49</c><c>MIP6_HNIDF</c><c>Yes</c><c>Yes</c>
<c>50</c><c>MIP6_VDINF</c><c>Yes</c><c>Yes</c>
<c>51</c><c>V6_LOST</c><c>Yes</c><c>Yes</c>
<c>52</c><c>CAPWAP_AC_V6</c><c>Yes</c><c>Yes</c>
<c>53</c><c>RELAY_ID</c><c>No</c><c>Yes</c>
<c>54</c><c>IPv6_Address-MoS</c><c>Yes</c><c>Yes</c>
<c>55</c><c>IPv6_FQDN-MoS</c><c>Yes</c><c>Yes</c>
<c>56</c><c>NTP_SERVER</c><c>Yes</c><c>Yes</c>
<c>57</c><c>V6_ACCESS_DOMAIN</c><c>Yes</c><c>Yes</c>
<c>58</c><c>SIP_UA_CS_LIST</c><c>Yes</c><c>Yes</c>
<c>59</c><c>OPT_BOOTFILE_URL</c><c>Yes</c><c>Yes</c>
<c>60</c><c>OPT_BOOTFILE_PARAM</c><c>Yes</c><c>Yes</c>
<c>61</c><c>CLIENT_ARCH_TYPE</c><c>No</c><c>Yes</c>
<c>62</c><c>NII</c><c>Yes</c><c>Yes</c>
<c>63</c><c>GEOLOCATION</c><c>Yes</c><c>Yes</c>
<c>64</c><c>AFTR_NAME</c><c>Yes</c><c>Yes</c>
<c>65</c><c>ERP_LOCAL_DOMAIN_NAME</c><c>Yes</c><c>Yes</c>
<c>66</c><c>RSOO</c><c>No</c><c>Yes</c>
<c>67</c><c>PD_EXCLUDE</c><c>Yes</c><c>Yes</c>
<c>68</c><c>VSS</c><c>No</c><c>Yes</c>
<c>69</c><c>MIP6_IDINF</c><c>Yes</c><c>Yes</c>
<c>70</c><c>MIP6_UDINF</c><c>Yes</c><c>Yes</c>
<c>71</c><c>MIP6_HNP</c><c>Yes</c><c>Yes</c>
<c>72</c><c>MIP6_HAA</c><c>Yes</c><c>Yes</c>
<c>73</c><c>MIP6_HAF</c><c>Yes</c><c>Yes</c>
<c>74</c><c>RDNSS_SELECTION</c><c>Yes</c><c>No</c>
<c>75</c><c>KRB_PRINCIPAL_NAME</c><c>Yes</c><c>Yes</c>
<c>76</c><c>KRB_REALM_NAME</c><c>Yes</c><c>Yes</c>
<c>77</c><c>KRB_DEFAULT_REALM_NAME</c><c>Yes</c><c>Yes</c>
<c>78</c><c>KRB_KDC</c><c>Yes</c><c>Yes</c>
<c>79</c><c>CLIENT_LINKLAYER_ADDR</c><c>No</c><c>Yes</c>
<c>80</c><c>LINK_ADDRESS</c><c>No</c><c>Yes</c>
<c>81</c><c>RADIUS</c><c>No</c><c>Yes</c>
<c>82</c><c>SOL_MAX_RT</c><c>Required for Solicit</c><c>Yes</c>
<c>83</c><c>INF_MAX_RT</c><c>Required for Information- request</c><c>Yes</c>
<c>84</c><c>ADDRSEL</c><c>Yes</c><c>Yes</c>
<c>85</c><c>ADDRSEL_TABLE</c><c>Yes</c><c>Yes</c>
<c>86</c><c>V6_PCP_SERVER</c><c>Yes</c><c>No</c>
<c>87</c><c>DHCPV4_MSG</c><c>No</c><c>Yes</c>
<c>88</c><c>DHCP4_O_DHCP6_SERVER</c><c>Yes</c><c>Yes</c>
<c>89</c><c>S46_RULE</c><c>No</c><c>No (3)</c>
<c>90</c><c>S46_BR</c><c>No</c><c>No</c>
<c>91</c><c>S46_DMR</c><c>No</c><c>Yes</c>
<c>92</c><c>S46_V4V6BIND</c><c>No</c><c>Yes</c>
<c>93</c><c>S46_PORTPARAMS</c><c>No</c><c>Yes</c>
<c>94</c><c>S46_CONT_MAPE</c><c>Yes</c><c>No</c>
<c>95</c><c>S46_CONT_MAPT</c><c>Yes</c><c>Yes</c>
<c>96</c><c>S46_CONT_LW</c><c>Yes</c><c>Yes</c>
<c>97</c><c>4RD</c><c>Yes</c><c>Yes</c>
<c>98</c><c>4RD_MAP_RULE</c><c>Yes</c><c>Yes</c>
<c>99</c><c>4RD_NON_MAP_RULE</c><c>Yes</c><c>Yes</c>
<c>100</c><c>LQ_BASE_TIME</c><c>No</c><c>Yes</c>
<c>101</c><c>LQ_START_TIME</c><c>No</c><c>Yes</c>
<c>102</c><c>LQ_END_TIME</c><c>No</c><c>Yes</c>
<c>103</c><c>DHCP Captive-Portal</c><c>Yes</c><c>Yes</c>
<c>104</c><c>MPL_PARAMETERS</c><c>Yes</c><c>No</c>
<c>105</c><c>ANI_ATT</c><c>No</c><c>Yes</c>
<c>106</c><c>ANI_NETWORK_NAME</c><c>No</c><c>Yes</c>
<c>107</c><c>ANI_AP_NAME</c><c>No</c><c>Yes</c>
<c>108</c><c>ANI_AP_BSSID</c><c>No</c><c>Yes</c>
<c>109</c><c>ANI_OPERATOR_ID</c><c>No</c><c>Yes</c>
<c>110</c><c>ANI_OPERATOR_REALM</c><c>No</c><c>Yes</c>
<c>111</c><c>S46_PRIORITY</c><c>Yes</c><c>Yes</c>
<c>112</c><c>MUD_URL_V6</c><c>No</c><c>Yes</c>
<c>113</c><c>V6_PREFIX64</c><c>Yes</c><c>No</c>
<c>114</c><c>F_BINDING_STATUS</c><c>No</c><c>Yes</c>
<c>115</c><c>F_CONNECT_FLAGS</c><c>No</c><c>Yes</c>
<c>116</c><c>F_DNS_REMOVAL_INFO</c><c>No</c><c>Yes</c>
<c>117</c><c>F_DNS_HOST_NAME</c><c>No</c><c>Yes</c>
<c>118</c><c>F_DNS_ZONE_NAME</c><c>No</c><c>Yes</c>
<c>119</c><c>F_DNS_FLAGS</c><c>No</c><c>Yes</c>
<c>120</c><c>F_EXPIRATION_TIME</c><c>No</c><c>Yes</c>
<c>121</c><c>F_MAX_UNACKED_BNDUPD</c><c>No</c><c>Yes</c>
<c>122</c><c>F_MCLT</c><c>No</c><c>Yes</c>
<c>123</c><c>F_PARTNER_LIFETIME</c><c>No</c><c>Yes</c>
<c>124</c><c>F_PARTNER_LIFETIME_SENT</c><c>No</c><c>Yes</c>
<c>125</c><c>F_PARTNER_DOWN_TIME</c><c>No</c><c>Yes</c>
<c>126</c><c>F_PARTNER_RAW_CLT_TIME</c><c>No</c><c>Yes</c>
<c>127</c><c>F_PROTOCOL_VERSION</c><c>No</c><c>Yes</c>
<c>128</c><c>F_KEEPALIVE_TIME</c><c>No</c><c>Yes</c>
<c>129</c><c>F_RECONFIGURE_DATA</c><c>No</c><c>Yes</c>
<c>130</c><c>F_RELATIONSHIP_NAME</c><c>No</c><c>Yes</c>
<c>131</c><c>F_SERVER_FLAGS</c><c>No</c><c>Yes</c>
<c>132</c><c>F_SERVER_STATE</c><c>No</c><c>Yes</c>
<c>133</c><c>F_START_TIME_OF_STATE</c><c>No</c><c>Yes</c>
<c>134</c><c>F_STATE_EXPIRATION_TIME</c><c>No</c><c>Yes</c>
<c>135</c><c>RELAY_PORT</c><c>No</c><c>Yes</c>     
<c>143</c><c>IPv6_Address-ANDSF</c><c>Yes</c><c>Yes</c>
</texttable>

<t>Notes for <xref target="option_update_table"/>:
<list style="format (%d)">
    <t>In the "Client ORO" column, a "Yes" for an option means that the
     client includes this option code in the Option Request option
     (see <xref target="RFC3315-22.7"/>) if it desires that configuration
     information, and a "No" means that the option MUST NOT be included
     (and servers SHOULD silently ignore that option code if it appears in a
     client's Option Request option).</t>

    <t> For each Enterprise Number, there MUST only be a single instance.</t>

    <t> See <xref target="RFC7598"/> for details.</t>
</list></t>
         
      <t>IANA has corrected the range of possible status codes
      in the "Status Codes" table at 
      &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;
      by replacing 23-255 (as Unassigned) with 23-65535 (the codes are
      16-bit unsigned integers).</t>

      <t>IANA has updated the All_DHCP_Relay_Agents_and_Servers
      (ff02::1:2) and All_DHCP_Servers (ff05::1:3)
      table entries in the "IPv6 Multicast Address Space Registry" at
      &lt;https://www.iana.org/assignments/ipv6&nbhy;multicast-addresses&gt;
      to reference this document instead of <xref target="RFC3315"/>.</t>

      <t>IANA has added an "Obsolete" annotation in the "DHCPv6 Delayed
      Authentication" entry in the "Authentication Suboption (value 8) -
      Protocol identifier values" registry at
      &lt;https://www.iana.org/assignments/bootp-dhcp-parameters&gt; and
      has added an "Obsolete" annotation in the "Delayed Authentication"
      entry in the "Protocol Name Space Values" registry at
      &lt;https://www.iana.org/assignments/auth-namespaces&gt;. IANA has
      also updated these pages to reference this document
      instead of <xref target="RFC3315"/>.
      </t>
         
      <t>IANA has added a reference to this document for the
      RDM value of 0 to the "RDM Name Space Values" registry at
      &lt;https://www.iana.org/assignments/auth-namespaces&gt;.
      </t>
         
      <t>IANA has updated the "Service Name and Transport
      Protocol Port Number Registry" at
      &lt;https://www.iana.org/assignments/service&nbhy;names&nbhy;port&nbhy;numbers&gt; as
      follows:</t>

<figure><artwork><![CDATA[
         546/udp      This document
         547/udp      This document
         547/tcp      [RFC5460]
         647/tcp      [RFC8156]
]]></artwork></figure>
    </section>

    <section anchor="obsolete" title="Obsoleted Mechanisms">
      <t>This specification is mostly a corrected and cleaned-up version
      of the original specification -- <xref target="RFC3315"/> -- along with
      numerous additions from later RFCs. However, there are a small number of
      mechanisms that were not widely deployed, were underspecified, or
      had other operational issues. Those mechanisms are now
      considered deprecated. Legacy implementations MAY support them, but
      implementations conformant to this document MUST NOT rely on them.</t>

      <t>The following mechanisms are now obsolete:</t>

      <t><list style="hanging">
      <t hangText="Delayed authentication.">
      This mechanism was underspecified and 
      presented a significant operational burden. As a result, after
      10&nbsp;years its adoption was extremely limited at best.</t>

      <t hangText="Lifetime hints sent by a client.">
      Clients used to be allowed to send
      lifetime values as hints. This mechanism was not widely implemented, and
      there were known misimplementations that sent the remaining lifetimes
      rather than total desired lifetimes. That in turn was sometimes
      misunderstood by servers as a request for ever&nbhy;decreasing lease
      lifetimes, which caused issues when values started approaching zero.
      Clients now SHOULD set lifetimes to 0 in IA Address and IA Prefix
      options, and servers MUST ignore any requested lifetime value.</t>

      <t hangText="T1/T2 hints sent by a client.">
      These had issues similar to those for the lifetime hints.
      Clients now SHOULD set the T1/T2 values to 0 in IA_NA and
      IA_PD options, and servers MUST ignore any T1/T2 values
      supplied by a client.</t>
    </list></t>

    </section>

  </middle>

  <back>
    <references title="Normative References">

      <?rfc include='reference.RFC.0768'?>
      <?rfc include='reference.RFC.1035'?>
      <?rfc include='reference.RFC.2119'?>
      <?rfc include='reference.RFC.4291'?>
      <?rfc include='reference.RFC.4861'?>
      <?rfc include='reference.RFC.4862'?>
      <?rfc include='reference.RFC.6221'?>
      <?rfc include='reference.RFC.6355'?>
      <?rfc include='reference.RFC.7227'?>
      <?rfc include='reference.RFC.7283'?>
      <?rfc include='reference.RFC.8085'?>
      <?rfc include='reference.RFC.8174'?>
      <?rfc include='reference.RFC.8200'?>
      <?rfc include='reference.RFC.8213'?>

    </references>

    <references title="Informative References">

      <reference anchor="IANA-PEN" target="https://www.iana.org/assignments/enterprise-numbers">
        <front>
          <title>Private Enterprise Numbers</title>
          <author>
            <organization>IANA</organization>
          </author>
          <date />
        </front>
      </reference>

      <reference anchor="IANA-RESERVED-IID" target="https://www.iana.org/assignments/ipv6-interface-ids">
        <front>
          <title>Reserved IPv6 Interface Identifiers</title>
          <author>
            <organization>IANA</organization>
          </author>
          <date />
        </front>
      </reference>
         
      <reference anchor="IANA-HARDWARE-TYPES" target="https://www.iana.org/assignments/arp-parameters">
        <front>
          <title>Hardware Types</title>
          <author>
            <organization>IANA</organization>
          </author>
          <date />
        </front>
      </reference>

      <?rfc include='reference.RFC.0826'?>

      <?rfc include='reference.RFC.2131'?>
      <?rfc include='reference.RFC.2132'?>
      <?rfc include='reference.RFC.2464'?>

      <?rfc include='reference.RFC.3162'?>
      <?rfc include='reference.RFC.3290'?>
      <?rfc include='reference.RFC.3629'?>
      <?rfc include='reference.RFC.3315'?>
      <?rfc include='reference.RFC.3633'?>
      <?rfc include='reference.RFC.3646'?>
      <?rfc include='reference.RFC.3736'?>
      <?rfc include='reference.RFC.3769'?>

      <?rfc include='reference.RFC.5908'?>
      <?rfc include='reference.RFC.4193'?>
      <?rfc include='reference.RFC.4242'?>
      <?rfc include='reference.RFC.4477'?>
      <?rfc include='reference.RFC.4704'?>
      <?rfc include='reference.RFC.4941'?>
      <?rfc include='reference.RFC.4943'?>
      <?rfc include='reference.RFC.4994'?>

      <?rfc include='reference.RFC.5007'?>
      <?rfc include='reference.RFC.5453'?>
      <?rfc include='reference.RFC.5460'?>
      <?rfc include='reference.RFC.5905'?>

      <?rfc include='reference.RFC.6422'?>
      <?rfc include='reference.RFC.6603'?>
      <?rfc include='reference.RFC.6724'?>
      <?rfc include='reference.RFC.6879'?>
      <?rfc include='reference.RFC.6939'?>

      <?rfc include='reference.RFC.7083'?>
      <?rfc include='reference.RFC.7084'?>
      <?rfc include='reference.RFC.7136'?>
      <?rfc include='reference.RFC.7341'?>
      <?rfc include='reference.RFC.7368'?>
      <?rfc include='reference.RFC.7513'?>
      <?rfc include='reference.RFC.7550'?>
      <?rfc include='reference.RFC.7598'?>
      <?rfc include='reference.RFC.7610'?>
      <?rfc include='reference.RFC.7707'?>
      <?rfc include='reference.RFC.7721'?>
      <?rfc include='reference.RFC.7824'?>
      <?rfc include='reference.RFC.7844'?>
      <?rfc include='reference.RFC.7969'?>

      <?rfc include='reference.RFC.8156'?>
      <?rfc include='reference.RFC.8168'?>

      <reference anchor="TR-187"
                 target="https://www.broadband-forum.org/technical/download/TR-187_Issue-2.pdf">
        <front>
          <title>TR-187 - IPv6 for PPP Broadband Access</title>
          <author>
            <organization>Broadband Forum</organization>
          </author>

          <date year="2013" month="February" />
        </front>
      </reference>
         
      <reference anchor="IEEE-802.1x"
             target="https://ieeexplore.ieee.org/servlet/opac?punumber=5409757">
        <front>
          <title>IEEE Standard for Local and metropolitan area networks--Port-Based Network Access Control</title>
          <author>
            <organization>IEEE</organization>
          </author>
<!-- <date year="2010" month="February" /> -->
        <date/>
        </front>
        <seriesInfo name="IEEE" value="802.1X-2010"/>
        <seriesInfo name="DOI" value="10.1109/IEEESTD.2010.5409813"/>
      </reference>

    </references>

    <section anchor="ChangeSummary" title="Summary of Changes">

      <t>This appendix provides a summary of the significant changes made
      to this updated DHCPv6 specification.</t>

      <t><list style="numbers">
<t>The Introduction (<xref target="intro-and-overview"/>) was reorganized and
updated. In particular, the client/server message exchanges were moved into
a new (and expanded) section on their own (see 
<xref target="Client-Server-Exchanges"/>).</t>

<t>New sections were added to discuss the relationship to previous
DHCPv6 documents and also to DHCPv4.</t>

<t>Sections <xref target="requirements" format="counter"/> ("Requirements")
and <xref target="background" format="counter"/> ("Background") had
very minor edits.</t>

<t><xref target="terminology"/> ("Terminology") had minor edits.</t>

<t><xref target="dhcp-terminology"/> ("DHCP Terminology") was expanded to
incorporate definitions from RFC 3633, add T1/T2 definitions, 
add definitions useful in describing combined address assignment and
prefix delegation operations, and improve some existing definitions.</t>

<t><xref target="Client-Server-Exchanges"/> ("Client/Server Exchanges") was
added from material previously in Section&nbsp;1 of RFC&nbsp;3315
("Introduction and Overview") and was expanded.</t>

<t><xref target="OpModes"/> ("Operational Models") is new.  It provides
information on the kinds of DHCP clients and how they operate.</t>

<t><xref target="dhcp-constants"/> ("DHCP Constants") was primarily updated
to add constants from RFC 4242 and RFC 7083. Note that the default
HOP_COUNT_LIMIT value was reduced from 32 to 8.</t>

<t>Sections <xref target="RFC3315-6" format="counter"/>
("Client/Server Message Formats"),
<xref target="RFC3315-7" format="counter"/>
("Relay Agent/Server Message Formats"),
and <xref target="RFC3315-8" format="counter"/>
("Representation and Use of Domain Names")
had only very minor changes.</t>

<t><xref target="RFC3315-9"/> ("DHCP Unique Identifier (DUID)") now
discourages, rather than disallows, a server to parse the DUID;
now includes some information on the DUID-UUID (RFC 6355); and
had other minor edits.</t>

<t><xref target="RFC3315-10"/> ("Identity Association") was expanded to better
explain the concept and to also include prefix delegation.</t>

<t><xref target="RFC3315-11"/> ("Assignment to an IA") incorporates material
from two sections (11 and 12) of RFC 3315 and also includes a section on
prefix delegation.</t>

<t><xref target="RFC3315-13"/> ("Transmission of Messages by a Client") was
expanded to include rate limiting by clients and how clients should handle T1
or T2 values of 0.</t>

<t><xref target="RFC3315-14"/> ("Reliability of Client-Initiated Message
Exchanges") was expanded to clarify that the Elapsed Time option
must be updated in retransmitted messages and that a client is not required to
listen for DHCP traffic for the entire retransmission period.</t>

<t><xref target="RFC3315-15"/> ("Message Validation") had minor edits.</t>

<t><xref target="RFC3315-16"/> ("Client Source Address and Interface
Selection") was expanded to include prefix delegation.</t>

<t><xref target="configuration-exchange"/> ("DHCP Configuration Exchanges")
consolidates what used to be in the following sections in RFC 3315:
"DHCP Server Solicitation" (Section 17),
"DHCP Client-Initiated Configuration Exchange" (Section 18), and
"DHCP Server-Initiated Configuration Exchange" (Section 19).
This material was reorganized and enhanced, and it incorporates prefix
delegation from RFC 3633 and other changes from RFC 4242, RFC 7083, and
RFC 7550. A few changes of note:

     <list style="letters">
               <t>The Option Request option is no longer optional for some
               messages (Solicit and Information-request), as RFC 7083 requires
               clients to request SOL_MAX_RT or INF_MAX_RT options.</t>
               <t>The Reconfigure message should no longer contain
               IA_NA&wj;/IA_PD, ORO, or other options to indicate to the
               client what was reconfigured. The client should request
               everything it needs in the response to the Reconfigure.</t>
               <t>The lifetime and T1/T2 hints should not be sent by a client
               (it should send values of 0 in these fields), and any
               non&nbhy;zero values should be ignored by the server.</t>
               <t>Clarified that a server may return different addresses
               in the Reply than requested by a client in the Request message.
               Also clarified that a server must not include addresses that it
               will not assign.</t>
             </list>

    Also, <xref target="RFC3315-18.2.12"/> ("Refreshing Configuration
    Information") was added to indicate use cases for when a client should try
    to refresh network information.</t>

<t><xref target="RFC3315-20"/> ("Relay Agent Behavior") incorporates
RFC&nbsp;7283 and had minor edits. A new section, "Interaction between
Relay Agents and Servers" (<xref target="relay-srv-interaction"/>),
was added.</t>

<t><xref target="RFC3315-21"/> ("Authentication of DHCP Messages") includes
significant changes: IPsec materials were mostly removed and replaced
with a reference to RFC&nbsp;8213, and the delayed authentication protocol
has been obsoleted (see <xref target="obsolete"/>).
Note that RKAP is still considered current.</t>

<t><xref target="RFC3315-22"/> ("DHCP Options") was expanded to incorporate
OPTION_IA_PD and OPTION_IAPREFIX from RFC 3633, the Information Refresh Time
option (OPTION_INFORMATION_REFRESH_TIME) from RFC&nbsp;4242, and the
SOL_MAX_RT and INF_MAX_RT options from RFC&nbsp;7083. Some additional
edits were made to clarify option handling, such as which options
should not be in an Option Request option.</t>

<t>The security considerations (<xref target="security"/>) were updated to
expand the discussion of security threats and include material from the
incorporated documents, primarily RFC 3633.</t>

<t>New privacy considerations were added (<xref target="privacy"/>) to
account for privacy issues.</t>

<t><xref target="iana"/> ("IANA Considerations") was rewritten to reflect
the changes requested for this document, as other documents have already
made the message, option, DUID, and status code assignments and
this document does not add any new assignments.</t>

<t><xref target="obsolete"/> ("Obsoleted Mechanisms") is a new section
that documents the mechanisms obsoleted by this specification.</t>

<t>Appendices <xref target="RFC3315-A" format="counter"/>
("Appearance of Options in Message Types") and
<xref target="RFC3315-B" format="counter"/> ("Appearance of Options in the
"options" Field of DHCP Options") were updated to reflect the incorporated
options from RFC 3633, RFC 4242, and RFC 7083.</t>

<t>Where appropriate, informative references have been added to
provide further background and guidance throughout the document (as
can be noted by the vast increase in references).</t>
           
<t>Changes were made to incorporate the following errata for
RFC&nbsp;3315: Erratum IDs 294, 295, 1373, 1815, 2471, 2472, 2509, 2928, 3577,
5450; RFC&nbsp;3633: Erratum IDs 248, 2468, 2469, 2470, 3736; and
RFC&nbsp;3736: Erratum ID 3796. Note that Erratum ID 1880 for RFC&nbsp;3633
no longer applies, as servers (delegating routers) ignore received
T1/T2 hints (see (C) in item 17 above).</t>

<t>General changes to other IPv6 specifications, such as removing
the use of site-local unicast addresses and adding unique local addresses,
were made to the document.</t>
   
<t>It should be noted that this document does not refer to all DHCPv6
functionality and specifications. Readers of this specification should
visit &lt;https://www.iana.org/assignments/dhcpv6-parameters&gt;
and &lt;https://datatracker.ietf.org/wg/dhc/&gt; to learn of the
RFCs that define DHCPv6 messages, options, status&nbsp;codes, and more.</t>
     </list></t>
    </section>

    <section anchor="RFC3315-A" title="Appearance of Options in Message Types">
      <t>The following tables indicate with a "*" the options that are allowed
      in each DHCP message type.</t>
         
      <t>These tables are informational. If they conflict with text earlier
      in this document, that text should be considered authoritative.</t>

      <figure>
        <artwork><![CDATA[
        Client Server IA_NA/                  Elap. Relay       Server
          ID     ID   IA_TA IA_PD  ORO   Pref Time   Msg. Auth. Unicast
Solicit   *             *     *     *           *
Advert.   *      *      *     *           *
Request   *      *      *     *     *           *
Confirm   *             *                       *
Renew     *      *      *     *     *           *
Rebind    *             *     *     *           *
Decline   *      *      *     *                 *
Release   *      *      *     *                 *
Reply     *      *      *     *                             *     *
Reconf.   *      *                                          *
Inform.   * (see note)              *           *
R-forw.                                               *
R-repl.                                               *
]]></artwork>
      </figure>

      <t>NOTE: The Server Identifier option
      (see <xref target="RFC3315-22.3"/>) is
      only included in Information-request messages that are sent in
      response to a Reconfigure (see <xref target="RFC3315-18.1.5"/>).</t>

      <figure>
       <artwork><![CDATA[
                                                               Info
        Status  Rap. User  Vendor Vendor Inter. Recon. Recon. Refresh
         Code  Comm. Class Class  Spec.    ID    Msg.  Accept  Time
Solicit          *     *     *      *                    *
Advert.   *            *     *      *                    *
Request                *     *      *                    *
Confirm                *     *      *
Renew                  *     *      *                    *
Rebind                 *     *      *                    *
Decline                *     *      *
Release                *     *      *
Reply     *      *     *     *      *                    *        *
Reconf.                                           *
Inform.                *     *      *                    *
R-forw.                             *      *
R-repl.                             *      *
]]></artwork>
      </figure>
         
      <figure>
        <artwork><![CDATA[
        SOL_MAX_RT  INF_MAX_RT
Solicit 
Advert.    *
Request
Confirm
Renew
Rebind
Decline
Release
Reply      *           *
Reconf.
Inform.
R-forw.
R-repl.
]]></artwork>
      </figure>         

    </section>

    <section anchor="RFC3315-B"
             title="Appearance of Options in the &quot;options&quot; Field of DHCP Options">

      <t>The following table indicates with a "*" where options defined in
      this document can appear as top-level options or can be encapsulated
      in other options defined in this document. Other RFCs may define
      additional situations where options defined in this document are
      encapsulated in other options.</t>
         
      <t>This table is informational. If it conflicts with text earlier in
      this document, that text should be considered authoritative.</t>

      <figure>
        <artwork><![CDATA[
                Top-    IA_NA/                        RELAY-  RELAY-
                Level   IA_TA  IAADDR IA_PD  IAPREFIX FORW    REPL
Client ID          *
Server ID          *
IA_NA/IA_TA        *
IAADDR                     *
IA_PD              *
IAPREFIX                                 *
ORO                *
Preference         *
Elapsed Time       *
Relay Message                                            *       *
Authentic.         *
Server Uni.        *
Status Code        *       *             *
Rapid Comm.        *
User Class         *
Vendor Class       *
Vendor Info.       *                                     *       *
Interf. ID                                               *       *
Reconf. MSG.       *
Reconf. Accept     *
Info Refresh Time  *
SOL_MAX_RT         *
INF_MAX_RT         *
]]></artwork>
      </figure>

      <t>Notes: Options asterisked in the "Top-Level" column appear in the
      "options" field of client messages (see <xref target="RFC3315-6"/>). Options
      asterisked in the "RELAY-FORW" and "RELAY-REPL" columns appear in the
      "options" field of the Relay-forward and Relay-reply messages
      (see <xref target="RFC3315-7"/>).</t>
    </section>

    <section title="Acknowledgments" numbered="no">

      <t>This document is merely a refinement of earlier work by the
      authors of the following documents and would not be possible without
      their original work:</t>

      <t><list style="symbols">
      <t>RFC 3315 (Ralph Droms, Jim Bound, Bernie Volz, Ted Lemon, Charles
      Perkins, and Mike Carney)</t>

      <t>RFC 3633 (Ole Troan and Ralph Droms)</t>

      <t>RFC 3736 (Ralph Droms)</t>

      <t>RFC 4242 (Stig Venaas, Tim Chown, and Bernie Volz)</t>

      <t>RFC 7083 (Ralph Droms)</t>

      <t>RFC 7283 (Yong Cui, Qi Sun, and Ted Lemon)</t>

      <t>RFC 7550 (Ole Troan, Bernie Volz, and Marcin Siodelski)</t>
   </list></t>

      <t>A number of additional people have contributed to identifying issues
      with RFC 3315 and RFC 3633 and proposed resolutions to these issues as
      reflected in this document (listed here in no particular order):
      Ole Troan, Robert Marks, Leaf Yeh, Michelle Cotton, Pablo Armando,
      John Brzozowski, Suresh Krishnan, Hideshi Enokihara, Alexandru Petrescu,
      Yukiyo Akisada, Tatuya Jinmei, Fred Templin, and Christian Huitema.</t>

      <t>We also thank the following, not otherwise acknowledged and in no
      particular order, for their review comments: Jeremy Reed, Francis Dupont,
      Lorenzo Colitti, Tianxiang Li, Ian Farrer, Yogendra Pal,
      Kim Kinnear, Shawn Routhier, Michayla Newcombe, Alissa Cooper,
      Allison Mankin, Adam Roach, Kyle Rose, Elwyn Davies, Eric Rescorla,
      Ben Campbell, Warren Kumari, and Kathleen Moriarty.</t>

      <t>Also, special thanks to Ralph Droms for answering many questions
      related to the original RFC 3315 and RFC 3633 work and for shepherding
      this document through the IETF process.</t>
    </section>

  </back>

</rfc>
