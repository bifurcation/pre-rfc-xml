<?xml version="1.0" encoding="US-ASCII"?><?rfc toc="yes"?>
<?rfc compact="yes"?>
<?rfc tocdepth="6"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc autobreaks="no"?>
<?rfc subcompact="no"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<rfc number="8585" category="info" submissionType="IETF" consensus="yes"
     ipr="trust200902">


  <front>
    <title abbrev="Requirements for IPv6 CE to Support IPv4aaS">Requirements
    for IPv6
    Customer Edge Routers to Support IPv4-as-a-Service</title>

    <author fullname="Jordi Palet Martinez" initials="J" surname="Palet Martinez">
      <organization>The IPv6 Company</organization>

      <address>
        <postal>
          <street>Molino de la Navata, 75</street>

          <city>La Navata - Galapagar</city>

          <region>Madrid</region>

          <code>28420</code>

          <country>Spain</country>
        </postal>

        <email>jordi.palet@theipv6company.com</email>

        <uri>http://www.theipv6company.com/</uri>
      </address>
    </author>


    <author fullname="Hans M.-H. Liu" initials="H" surname="M.-H. Liu">
      <organization>D-Link Systems, Inc.</organization>

      <address>
        <postal>
          <street>17595 Mount Herrmann St.</street>

          <city>Fountain Valley</city>

          <region>California</region>

          <code>92708</code>

          <country>United States of America</country>
        </postal>

        <email>hans.liu@dlinkcorp.com</email>

        <uri>https://www.dlink.com/</uri>
      </address>
    </author>

    <author fullname="Masanobu Kawashima" initials="M" surname="Kawashima">
      <organization>NEC Platforms, Ltd.</organization>

      <address>
        <postal>
          <street>2-3, Kanda-Tsukasamachi</street>

          <city>Chiyoda-ku</city>

          <region>Tokyo</region>

          <code>101-8532</code>

          <country>Japan</country>
        </postal>

        <email>kawashimam@vx.jp.nec.com</email>

        <uri>https://www.necplatforms.co.jp/en/</uri>
      </address>
    </author>

    <date month="May" year="2019"/>

    <workgroup>IPv6 Operations (v6ops)</workgroup>

    <keyword>IPv6 transition, CE requirements, IPv4aaS</keyword>



    <abstract>


      <t>This document specifies the IPv4 service continuity requirements 
      for IPv6 Customer Edge (CE) routers
      that are provided either by the service provider or 
      by vendors who sell through the retail market.</t>

      <t>Specifically, this document extends the basic requirements for 
      IPv6 CE routers as described in RFC 7084 to allow the provisioning of 
      IPv6 transition services for the support of IPv4-as-a-Service (IPv4aaS) 
      by means of new transition mechanisms. The document only covers IPv4aaS,
      i.e., transition technologies for delivering IPv4 in 
      IPv6-only access networks.  
      IPv4aaS is necessary because there aren't sufficient IPv4 addresses
      available for 
      every possible customer/device. However, devices or applications in the
      customer 
      Local Area Networks (LANs) may be IPv4-only or IPv6-only and still need
      to communicate 
      with IPv4-only services on the Internet.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction" anchor="intro">
      <t>This document defines IPv4 service continuity features over an
      IPv6-only network for residential or small office routers (referred to
      as "IPv6 Transition CE Routers") in order to establish an industry
      baseline for transition features to be implemented on such routers.</t>

      <t>These routers rely upon requirements for IPv6 CE routers defined in 
      <xref target="RFC7084"/>. The scope of 
      this document is to ensure IPv4 service continuity support for devices 
      in the LAN side. 

      This ensures that remote IPv4-only services continue to be accessible,
      for both IPv4-only and IPv6-only applications and devices, located in
      the LAN side behind an IPv6 Transition CE Router connected to an
      IPv6-only access network.  These ISP access networks are typically
      referred to as Wide Area Networks (WANs), even if they may be
      metropolitan or regional in some cases.  <xref target="architecture"/>
      presents a simplified view of this architecture.</t>

        <figure align="center" anchor="architecture"
                title="Simplified Typical IPv6-Only Access Network">
          <artwork align="left"><![CDATA[
           +------------+   +------------+   \
           | IPv4-only  |   | IPv4/IPv6  |    \
           |   Remote   |   |   Remote   |     |
           |    Host    |   |    Host    |     | Internet
           +--------+---+   +---+--------+     |
                    |           |             /
                    |           |            /
                  +-+-----------+-+               \
                  |   Service     |                \
                  |   Provider    |                 \
                  |    Router     |                  | Service
                  +-------+-------+                  | Provider
                          | IPv6-only                | Network
                          | Customer                /
                          | Internet Connection    /
                          |                       /     
                   +------+--------+                    \
                   |     IPv6      |                     \
                   | Transition CE |                      \
                   |    Router     |                       |
                   +---+-------+---+                       |
         LAN A       |       |       LAN B                 | End-User
   -+----------------+-     -+-----+-------------+-        | Network(s)
    |                              |             |         |
+---+------+                  +----+-----+ +-----+----+    |
| IPv6-only|                  | IPv4-only| |IPv4/IPv6 |   /
|   Host   |                  |   Host   | |   Host   |  /
+----------+                  +----------+ +----------+ /
            ]]></artwork>
        </figure>

      <t>This document covers a set of IP transition techniques required when
      ISPs 
      have, or want to have, an IPv6-only access network. This is a common
      situation 
      when sufficient IPv4 addresses are no longer available for every
      possible 
      customer and device, which causes IPv4 addresses to become prohibitively
      expensive. 
      This, in turn, may result in service providers provisioning IPv6-only
      WAN access. 
      At the same time, they need to ensure that both IPv4-only and IPv6-only
      devices 
      and applications in the customer networks can still reach IPv4-only 
      devices and applications on the Internet.</t>

      <t>This document specifies the IPv4 service continuity mechanisms 
      to be supported by an IPv6 
      Transition CE Router and relevant provisioning or configuration
      information 
      differences from <xref target="RFC7084"/>.</t>
      
      <t>This document is not a recommendation for service providers to use
      any specific 
      transition mechanism.</t>
      

      <t>Automatic provisioning of more complex
      topology than a single router with multiple LAN interfaces may be
      handled by 
      means of the Home Networking Control Protocol (HNCP) <xref
      target="RFC7788"/>, 
      which is out of the scope of this document.</t>

      <t>Since it is impossible to know prior to sale which transition
      mechanism a 
      device will need over its lifetime, an IPv6 Transition CE Router 
      intended for the retail market MUST support all the IPv4aaS transition
      mechanisms 
      listed in this document. Service providers that specify feature sets for 
      the IPv6 Transition CE Router may define a different set of features
      from
      those included in this document, for example, features that support only
      some 
      of the transition mechanisms enumerated in this document.</t>

      <t>Appendices <xref target="appA"
      format="counter"/> and <xref target="appB" format="counter"/> contain a
      complete description of the usage scenarios and end-user network
      architecture, respectively. These appendices, along with 
      <xref target="RFC7084"/>, will facilitate a clearer 
      understanding of this document.</t>

      <section title="Requirements Language">


        <t>
    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
    NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
    "MAY", and "OPTIONAL" in this document are to be interpreted as
    described in BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>

      </section>
    </section>

    <section title="Terminology">
      <t>This document uses the same terms as in <xref target="RFC7084"/>, 
      with minor clarifications.</t>

      <t>"IPv4aaS" stands for "IPv4-as-a-Service", meaning transition
      technologies 
      for delivering IPv4 in IPv6-only connectivity.</t>

      <t>The term "IPv6 transition Customer Edge Router with IPv4aaS" 
      (shortened as "IPv6 Transition CE Router") is defined 
      as an IPv6 Customer Edge Router that provides features for the 
      delivery of IPv4 services over an IPv6-only WAN network, 
      including IPv6-IPv4 communications.</t>

      <t>The term "WAN Interface" as used in this document is defined as an 
      IPv6 Transition CE Router attachment to an IPv6-only link used to
      provide 
      connectivity to a service provider network, including link
      Internet-layer 
      (or higher layers) tunnels, such as IPv4-in-IPv6 tunnels.</t>
    </section>


    <section title="Requirements">
        <t>The IPv6 Transition CE Router MUST comply with <xref
	target="RFC7084"/> 
        ("Basic Requirements for IPv6 Customer Edge Routers"). This document
	adds 
        new requirements, as described in the following subsections.</t>


      <section title="LAN-Side Configuration">
        <t>A new LAN requirement is added, which is, in fact, common in
	regular 
        IPv6 Transition CE Routers, and is required by most of the 
        transition mechanisms: 
        <list style="format L-%d:">
        
	  <t>The IPv6 Transition CE Router MUST implement a DNS proxy as
	  described 
	  in <xref target="RFC5625"/> ("DNS Proxy Implementation
	  Guidelines").</t>
	</list></t>   
      </section>

    
      <section title="Transition Technologies Support for IPv4 Service
	      Continuity (IPv4-as-a-Service)">
	<t>The main target of this document is the support of IPv6-only WAN 
	access. To enable legacy IPv4 functionality, this document also
	includes 
	the support of IPv4-only devices and applications in the customer
	LANs, 
	as well as IPv4-only services on the Internet. Thus, both IPv4-only 
	and IPv6-only devices in the customer-side LANs of the IPv6 
	Transition CE Router are able to reach the IPv4-only services.</t>

<t>Note that this document only configures IPv4aaS in the IPv6 Transition CE
Router itself; it does not forward such information to devices attached to the
LANs. Thus, the WAN configuration and availability of native IPv4 or IPv4aaS
are transparent for the devices attached to the LANs.</t>

<t>This document takes no position on simultaneous operation of one or several 
transition mechanisms and/or native IPv4.</t>

        <t>In order to seamlessly provide IPv4 service continuity in the
	customer LANs 
        and allow automated IPv6 transition mechanism provisioning, the
	following 
        general transition requirements are defined.</t>

        <t>General transition requirements:
        <list style="format TRANS-%d:">

	  <t>The IPv6 Transition CE Router MUST support the DHCPv6 S46
	  priority 
	  options described in <xref target="RFC8026"/> ("Unified IPv4-in-IPv6 
	  Softwire Customer Premises Equipment (CPE): A DHCPv6-Based 
	  Prioritization Mechanism").</t>

	  <t>The IPv6 Transition CE Router MUST have a
	  GUI and either a CLI or API (or both) to
	  manually enable/disable each of the supported
	  transition mechanisms.</t>

	  <t>If an IPv6 Transition CE Router supports more than one LAN
	  subnet, 
	  the IPv6 Transition CE Router MUST allow appropriate subnetting and 
	  configuration of the address space among several interfaces. 
	  In some transition mechanisms, this may require differentiating 
	  mappings/translations on a per-interface basis.</t>

	</list></t>

        <t>In order to allow the service provider to disable all the
	transition 
        mechanisms and/or choose the most convenient one, the IPv6 Transition 
        CE Router MUST follow the following configuration steps:
        <list style="format CONFIG-%d:">

	  <t>Request the relevant configuration options for each 
	  supported transition mechanisms, which MUST remain 
	  disabled at this step.</t>

	  <t>Following the steps in Section 1.4 of <xref
	  target="RFC8026"/>, MUST check 
	  for a valid match in OPTION_S46_PRIORITY, which allows 
	  enabling/disabling a transition mechanism.</t>

<t>Keep disabled all the transition mechanisms if no match 
is found between the priority list and the candidate 
list, unless a NAT64 <xref target="RFC6146"/> prefix has been 
configured, in which case, 464XLAT <xref target="RFC6877"/> MUST be
enabled.</t>

        </list></t>

	<t>Because 464XLAT has no DHCPv6 configuration options, it
	can't currently be included in the OPTION_S46_PRIORITY. In the future, 
	an update of <xref target="RFC8026"/> or a NAT64 DHCPv6 configuration 
	option may enable it. Meanwhile, if an operator provides 464XLAT, 
	it needs to ensure that OPTION_S46_PRIORITY is not sent for any other 
	transition mechanism to the relevant customers.</t>

	<t>The following subsections describe the requirements for supporting  
	each one of the transition mechanisms. An IPv6 Transition CE Router 
	intended for the retail market MUST support all of them.</t>

        <section title="464XLAT">
          <t>464XLAT <xref target="RFC6877"/> is a technique 
          to provide IPv4 service over an IPv6-only access network 
          without encapsulation. This architecture assumes a 
          Stateful NAT64 <xref target="RFC6146"/> function 
          deployed at the service provider or a third-party network.</t>

          <t>The IPv6 Transition CE Router MUST support customer-side
	    translator (CLAT) functionality <xref target="RFC6877"/>
          if intended for the retail market. 
          If 464XLAT is supported, it MUST be implemented according to 
          <xref target="RFC6877"/>. 
          The following IPv6 Transition CE Router requirements also apply.</t>

          <t>464XLAT requirements: <list style="format 464XLAT-%d:">


              <t>Unless a dedicated /64 prefix has been acquired, either 
              by using DHCPv6-PD (Dynamic Host 
              Configuration Protocol for IPv6 Prefix Delegation) or by 
              alternative means, the IPv6 Transition CE Router MUST 
              perform IPv4 Network Address Translation (NAT) on 
              IPv4 traffic translated using the CLAT.</t>

              <t>The IPv6 Transition CE Router SHOULD support IGD-PCP IWF
              <xref target="RFC6970"/> ("Universal Plug and Play (UPnP)
              Internet Gateway Device - Port Control Protocol Interworking
              Function (IGD-PCP IWF)").</t>

              <t>If the Port Control Protocol (PCP) <xref target="RFC6887"/>
	      is implemented, 
              the IPv6 Transition CE Router MUST also implement <xref
	      target="RFC7291"/> 
              ("DHCP Options for the Port Control Protocol (PCP)"). Following
	      <xref target="RFC6887"/>, 
              if no PCP server is configured, the IPv6 Transition CE Router
	      MAY verify 
              if the default gateway or the NAT64 is the PCP server. The IPv6 
              Transition CE Router MUST use plain IPv6 mode (i.e., not
	      IPv4-in-IPv6 
              encapsulation) to send PCP requests to the server.</t>

              <t>The IPv6 Transition CE Router MUST implement <xref
	      target="RFC7050"/> 
              ("Discovery of the IPv6 Prefix Used for IPv6 Address Synthesis") 
              in order to discover the provider-side translator (PLAT)
	      translation IPv4 and IPv6 
              prefix(es)/suffix(es).</t>
              
              <t>If PCP is implemented, the IPv6 Transition CE Router MUST
	      follow <xref target="RFC7225"/> 
              ("Discovering NAT64 IPv6 Prefixes Using the Port Control
	            Protocol (PCP)") in order to 
              learn the PLAT-side translation IPv4 and IPv6
	      prefix(es)/suffix(es) 
              used by an upstream PCP-controlled NAT64 device.</t>

              <t>If the network provides several choices for the
	      discovery/learning 
              of the NAT64 prefix, the priority to use one or the other MUST
	      follow 
              this order: 1) <xref target="RFC7225"/> and 2) <xref
	      target="RFC7050"/>.</t>

            </list></t>

          <t>The NAT64 prefix could be discovered by means of the method
	    defined in <xref target="RFC7050"/> 
          only if the service provider uses DNS64 <xref target="RFC6147"/>. 
          It may be the case that the service provider does not use or does
	  not trust 
          DNS64 <xref target="RFC6147"/> because the DNS configuration at the
	  CE 
          (or hosts behind the CE) can be modified by the customer. In that
	  case, 
          the service provider may opt to configure the NAT64 prefix by means 
          of the option defined in <xref target="RFC7225"/>. This can also be
	    used if the service 
          provider uses DNS64 <xref target="RFC6147"/>.</t>

        </section>

        <section title="Dual-Stack Lite (DS-Lite)">
          <t>DS-Lite <xref target="RFC6333"/> enables 
          continued support for IPv4 services. DS&nbhy;Lite enables a
	  broadband
          service provider to share IPv4 addresses among customers by
          combining two well-known technologies: IP in IP (IPv4-in-IPv6) and
          Network Address Translation (NAT). It is expected that DS&nbhy;Lite
          traffic is forwarded over the IPv6 Transition CE Router's native
	  IPv6 
          WAN interface and not encapsulated in another tunnel.</t>

          <t>The IPv6 Transition CE Router MUST implement DS-Lite B4
	  functionality 
          <xref target="RFC6333"/> if intended for the retail market. 
          If DS-Lite is supported, it MUST be implemented 
          according to <xref target="RFC6333"/>. 
          The following IPv6 Transition CE Router requirements also apply.</t>

          <t>DS-Lite requirements: <list style="format DSLITE-%d:">
              <t>The IPv6 Transition CE Router MUST support configuration of
	      DS-Lite via the 
                 DS-Lite DHCPv6 option <xref target="RFC6334"/> 
                 ("Dynamic Host Configuration Protocol for IPv6 (DHCPv6)
		  Option for Dual-Stack Lite"). 
                 The IPv6 Transition CE Router MAY use other mechanisms to
		 configure 
                 DS-Lite parameters. Such mechanisms are outside the scope 
                 of this document.</t>

              <t>The IPv6 Transition CE Router SHOULD support IGD-PCP IWF
	      <xref target="RFC6970"/>.</t>

              <t>If PCP <xref target="RFC6887"/> is implemented, the IPv6
              Transition CE Router SHOULD implement <xref
              target="RFC7291"/>. If PCP <xref target="RFC6887"/> is
              implemented and a PCP server is not configured, the IPv6
              Transition CE Router MUST assume, by default, that the Address
              Family Transition Router (AFTR, commonly called "CGN" -
              Carrier-Grade NAT) is the PCP server. The IPv6 Transition CE
              Router MUST use plain IPv6 mode (i.e., not IPv4-in-IPv6
              encapsulation) to send PCP requests to the server. The term
              "default" above is to be interpreted as pertaining to a
              configuration as applied by a vendor prior to the administrator
              changing it for its initial activation.</t>

              <t>The IPv6 Transition CE Router MUST NOT perform IPv4 Network
              Address Translation (NAT) on IPv4 traffic encapsulated using
              DS-Lite <xref target="RFC6333"/>.</t>
            </list></t>
        </section>
 
         <section title="Lightweight 4over6 (lw4o6)">
          <t>lw4o6 <xref target="RFC7596"/> specifies an extension to DS-Lite
          that moves the NAPT function from the DS-Lite tunnel concentrator to
	  the 
          tunnel client located in the IPv6 Transition CE Router, removing the 
          requirement for an AFTR (CGN) function in the tunnel concentrator 
          and reducing the amount of centralized state.</t>

          <t>The IPv6 Transition CE Router MUST implement lwB4 functionality 
          <xref target="RFC7596"/> if intended for the retail market. 
          If DS-Lite is implemented, lw4o6 SHOULD be implemented as well. If
	  lw4o6 
          is supported, it MUST be implemented according to <xref
	  target="RFC7596"/>. 
          The following IPv6 Transition CE Router requirements also apply.</t>

          <t>lw4o6 requirements: <list style="format LW4O6-%d:">
          <t>The IPv6 Transition CE Router MUST support configuration of 
            lw4o6 via the lw4o6 DHCPv6 options <xref target="RFC7598"/>
	    ("DHCPv6 Options 
            for Configuration of Softwire Address and Port-Mapped Clients"). 
            The IPv6 Transition CE Router MAY use other mechanisms to
	    configure 
            lw4o6 parameters. Such mechanisms are outside the scope 
            of this document.</t>

            <t>The IPv6 Transition CE Router MUST support the
	    DHCPv4-over-DHCPv6 
            (DHCP 4o6) transport described in <xref target="RFC7341"/> 
            ("DHCPv4-over-DHCPv6 (DHCP 4o6) Transport").</t>

            <t>The IPv6 Transition CE Router MAY support Dynamic Allocation of 
            Shared IPv4 Addresses as described in <xref target="RFC7618"/> 
            ("Dynamic Allocation of Shared IPv4 Addresses").</t>
          </list></t>
         </section>


        <section title="MAP-E">
          <t>Mapping of Address and Port with Encapsulation (MAP-E) <xref
          target="RFC7597"/> is a mechanism for transporting IPv4 packets
          across an IPv6 network using IP encapsulation. MAP-E includes an
	  algorithmic mechanism for mapping between IPv6 and IPv4
          addresses.</t>

          <t>The IPv6 Transition CE Router MUST support MAP-E CE functionality 
          <xref target="RFC7597"/> if intended for the retail market. 
          If MAP-E is supported, it MUST be implemented according to 
          <xref target="RFC7597"/>. The following IPv6 Transition CE Router
	  requirements also apply.</t>

          <t>MAP-E requirements: <list style="format MAPE-%d:">
            <t>The IPv6 Transition CE Router MUST support configuration of
	    MAP-E 
            via the MAP-E DHCPv6 options <xref target="RFC7598"/>. 
            The IPv6 Transition CE Router MAY use other mechanisms to
	    configure 
            MAP-E parameters. Such mechanisms are outside the scope 
            of this document.</t>
 
            <t>The IPv6 Transition CE Router MAY support Dynamic Allocation of 
            Shared IPv4 Addresses as described in <xref target="RFC7618"/>.</t>
          </list></t>
        </section>

        <section title="MAP-T">
          <t>MAP-T <xref target="RFC7599"/> is a mechanism similar to MAP-E, 
          differing from it in that MAP-T uses IPv4-IPv6 translation, instead
	  of 
          encapsulation, as the form of IPv6 domain transport.</t>

          <t>The IPv6 Transition CE Router MUST support MAP-T CE functionality 
          <xref target="RFC7599"/> if intended for the retail market. 
          If MAP-T is supported, it MUST be implemented according to 
          <xref target="RFC7599"/>. The following IPv6 Transition CE Router
	  requirements 
          also apply.</t>

          <t>MAP-T requirements: <list style="format MAPT-%d:">
            <t>The IPv6 Transition CE Router MUST support configuration of
            MAP-T via the MAP-T DHCPv6 options <xref target="RFC7598"/>. The
            IPv6 Transition CE Router MAY use other mechanisms to configure
            MAP-T parameters. Such mechanisms are outside the scope of this
            document.</t>

            <t>The IPv6 Transition CE Router MAY support Dynamic Allocation of 
            Shared IPv4 Addresses as described in <xref target="RFC7618"/>.</t>
          </list></t>
        </section>

      </section>
    </section>

      <section title="IPv4 Multicast Support">
        <t>Existing IPv4 deployments support IPv4 multicast for services such
	as 
        IPTV. In the transition phase, it is expected that multicast services 
        will still be provided using IPv4 to the customer LANs.</t>


        <t>If the IPv6 Transition CE Router supports delivery of IPv4
	multicast 
        services, then it MUST support <xref target="RFC8114"/> ("Delivery of
	IPv4 Multicast 
        Services to IPv4 Clients over an IPv6 Multicast Network") and 
        <xref target="RFC8115"/> ("DHCPv6 Option for IPv4-Embedded Multicast
	and Unicast IPv6 
        Prefixes").</t>
      </section>

      <section title="UPnP Support">
        <t>If the UPnP WANIPConnection:2 service <xref
	target="UPnP-WANIPC"/><xref target="OCF-IGD"></xref>
        is enabled on a CE router, but cannot be associated with an IPv4
        interface established by an IPv4aaS mechanism or cannot determine
        which ports are available, an AddPortMapping() or AddAnyPortMapping()
        action MUST be rejected with error code 729
        ("ConflictWithOtherMechanisms"). Port availability could be determined
        through PCP or access to a configured port set (if the IPv4aaS
        mechanism limits the available ports).</t>

        <t>An AddPortMapping() request for a port that is not available 
        MUST result in "ConflictInMappingEntry".</t>

        <t>An AddAnyPortMapping() request for a port that is not available 
        SHOULD result in a successful mapping with an alternative 
        "NewReservedPort" value from within the configured port set range 
        or as assigned by PCP as per Section 5.6.1 of <xref
	target="RFC6970"/>.</t>

        <t>Note that IGD:1 and its WANIPConnection:1 service have been 
        deprecated by OCF (Open Connectivity Foundation) <xref
	target="OCF-IGD"/>.</t>

      </section>

      <section title="Comparison to RFC 7084">
        <t>This document doesn't include support for 6rd <xref
	target="RFC5969"/> 
        because it is an IPv6-in-IPv4 tunneling.</t>

        <t>Regarding DS-LITE <xref target="RFC6333"/>, this document includes
	slightly 
        different requirements related to the support of PCP <xref
	target="RFC6887"/>, 
        IGD&nbhy;PCP IWF <xref target="RFC6970"/>, and the prioritization of
	the 
        transition mechanisms, including dual-stack.</t>
      </section>

    <section title="Code Considerations">
      <t>At the time of this writing, one of the apparent main issues for
      vendors with regard to including new functionalities, such as support
      for new
      transition mechanisms, is the lack of space in the flash (or equivalent)
      memory. However, it has been confirmed from existing open-source
      implementations (e.g., OpenWRT/LEDE, Linux, and VPP) that adding the
      support for the new transition mechanisms requires around 10-12 KBs
      because most of the code base is shared among several transition
      mechanisms, which are already supported by <xref target="RFC7084"/>. A
      single data plane is common to all of them, which typically means, in
      popular CEs already in the market <xref target="OpenWRT"/>, the new
      required code is only about 0.15% of the total existing code size.</t>
      
      <t>In general, the new requirements don't have extra cost in terms of 
      RAM memory, nor other hardware requirements such as more powerful CPUs,
      if 
      compared to the cost of NAT44 code. Thus, existing hardware should be
      able to support 
      all of them with minimal impact.</t>

      <t>The other issue seems to be the cost of developing the code for those
      new 
      functionalities. However, at the time of writing this document, it has
      been 
      confirmed that there are several open-source versions of the required
      code for 
      supporting all the new transition mechanisms, and several vendors
      already 
      have implementations and provided them to ISPs. Therefore, the
      development cost is negligible,
      and only integration and testing cost may become an issue.</t>

      <t>Finally, in some cases, operators supporting several transition
      mechanisms may need to consider training costs for staff in all the
      techniques for the operation and management of these mechanisms, even if
      the costs are not directly caused by supporting this document but
      because of business decisions.</t>
    </section>

      <section title="Security Considerations">
        <t>The IPv6 Transition CE Router must comply with the Security
	Considerations 
        in <xref target="RFC7084"/> as well as those for
        each transition mechanism implemented by the IPv6 Transition CE
	Router.</t>

        <t>As described in the Security Considerations of <xref
        target="RFC8026"/> and <xref target="RFC8415"/>, there are generic
        DHCP security issues, which, in the case of this document, mean that
        malicious nodes may alter the priority of the transition
        mechanisms.</t>

        <t>Access network architecture for securing DHCP within the access
	network 
        is out of scope for this document. Securing DHCP in the LAN is also
	not in scope. 
        DHCP packets MUST NOT be forwarded between LAN and WAN interfaces of
	an 
        IPv6 Transition CE Router.</t>
      </section>

      <section title="IANA Considerations">
        <t>This document has no IANA actions.</t>

      </section>

  
    </middle>

  <back>
  
    <references title="Normative References">
<?rfc include="reference.RFC.2119" ?>
<?rfc include="reference.RFC.5625" ?>
<?rfc include="reference.RFC.5969" ?>
<?rfc include="reference.RFC.6146" ?>
<?rfc include="reference.RFC.6147" ?>
<?rfc include="reference.RFC.6333" ?>
<?rfc include="reference.RFC.6334" ?>
<?rfc include="reference.RFC.6877" ?>
<?rfc include="reference.RFC.6887" ?>
<?rfc include="reference.RFC.6970" ?>
<?rfc include="reference.RFC.7050" ?>
<?rfc include="reference.RFC.7084" ?>
<?rfc include="reference.RFC.7225" ?>
<?rfc include="reference.RFC.7291" ?>
<?rfc include="reference.RFC.7341" ?>
<?rfc include="reference.RFC.7596" ?>
<?rfc include="reference.RFC.7597" ?>
<?rfc include="reference.RFC.7598" ?>
<?rfc include="reference.RFC.7599" ?>
<?rfc include="reference.RFC.7618" ?>
<?rfc include="reference.RFC.8026" ?>
<?rfc include="reference.RFC.8114" ?>
<?rfc include="reference.RFC.8115" ?>
<?rfc include="reference.RFC.8174" ?>
<?rfc include="reference.RFC.8415" ?>

    </references>

    <references title="Informative References">
<?rfc include="reference.RFC.7788" ?>

      <reference anchor="UPnP-WANIPC" target="http://upnp.org/specs/gw/UPnP-gw-WANIPConnection-v2-Service.pdf">
        <front>
          <title>WANIPConnection:2 Service</title>

          <author>
            <organization>UPnP Forum</organization>
          </author>

          <date month="September" year="2010" />
        </front>
      </reference>
        
      <reference anchor="UPnP-IGD" target="http://upnp.org/specs/gw/UPnP-gw-InternetGatewayDevice-v2-Device.pdf">
        <front>
          <title>InternetGatewayDevice:2 Device Template Version 1.01</title>

          <author>
            <organization>UPnP Forum</organization>
          </author>

          <date month="December" year="2010" />
        </front>
      </reference>

      <reference anchor="OCF-IGD" target="https://openconnectivity.org/developer/specifications/upnp-resources/upnp/internet-gateway-device-igd-v-2-0">
        <front>
          <title>Internet Gateway Device (IGD) V 2.0</title>

          <author>
            <organization>Open Connectivity Foundation</organization>
          </author>

          <date month="March" year="2015" />
        </front>
      </reference>

      <reference anchor="IPv6Survey"
		 target="https://indico.uknof.org.uk/event/41/contribution/5/material/slides/0.pdf">
        <front>
          <title>Best Current Operational Practice for operators: IPv6 Prefix
	    Assignment for end-customers -- persistent vs non-persistent and
	    what
	      size to choose</title>

          <author fullname="Jordi Palet Martinez" initials="J" surname="Palet Martinez">
            <organization>The IPv6 Company</organization>
          </author>

          <date month="January" year="2018" />
        </front>
      </reference>

      <reference anchor="OpenWRT" target="https://openwrt.org/packages/start">
        <front>
          <title>Packages</title>

          <author>
            <organization>OpenWRT</organization>
          </author>

          <date />
        </front>
      </reference>

    </references>


    <section title="Usage Scenarios" anchor="appA">

      <t>The situation of ongoing IPv6 deployment 
      and a lack of IPv4 addresses is not happening at the same pace in every
      country
      and even within every country for every ISP. For different technical,
      financial, 
      commercial/marketing, and socio-economic reasons, each network is
      transitioning 
      at their own pace; the global transition timings cannot be reliably
      estimated.</t>

      <t>Different studies (for example, <xref target="IPv6Survey"/>) 
      also show that IPv6 deployment is a changing situation. In a 
      single country, not all operators will necessarily provide IPv6
      support. 
      Consumers may also switch ISPs and use the same IPv6 Transition CE
      Router 
      with either an ISP that provides IPv4-only or an ISP that provides IPv6
      with IPv4aaS.</t>
      
      <t>So, to cover all those evolving situations, an IPv6 Transition CE
      Router 
      is required, at least from the perspective of transition support.</t>

<t>Moreover, because some services and service providers will remain 
IPv4-only for an undetermined period of time, IPv4 service continuity 
is required. Thus, there is a need for CEs to support IPv4aaS
indefinitely.</t>

<t>Based on these premises, this document ensures that the IPv6 
Transition CE Router allows the continued transition from networks 
that today may provide access with dual-stack or IPv6-in-IPv4 (as 
described in <xref target="RFC7084"/>) to networks that provide IPv6-only
access with 
IPv4aaS.</t>

    <t>Considering that situation and different possible usage cases, the 
    IPv6 Transition CE Router described in this document is expected to be 
    used in residential/household; small office, home office (SOHO);
    and small/medium enterprise (SME). Common usage is any kind of Internet 
    access (web, email, streaming, online gaming, etc.), and more advanced 
    requirements include inbound connections (IP cameras, web, DNS, email,
    VPN, etc.).</t>

    <t>The above is not intended to be a comprehensive list of all the
    possible usage cases, just an overview. In fact, combinations of the above
    usages are also possible, along with situations where the same CE is used
    at different times in different scenarios or even with different IPv4aaSes
    at different service providers.</t>

    <t>The mechanisms for allowing inbound connections are naturally available 
    in any IPv6 router when using IPv6 Global Unicast Addresses (GUAs),
    unless they are blocked by firewall rules, which may require some manual 
    configuration.</t>
     
    <t>However, in the case of IPv4aaS, because of the usage of private IPv4
    addresses and NAT and depending on the specific transition mechanism,
    inbound connections typically require some degree of more complex manual
    configuration, such as setting up a DMZ, setting up virtual servers, or
    setting up port/protocol forwarding. In general, IPv4 CE Routers already
    provide a GUI, CLI, or API to manually configure them, or provide the
    possibility to set up the CE in bridge mode, so another Router behind the
    original CE, takes care of inbound connections. The requirements for that
    support are out of the scope of this document.</t>

       
    <t>Who provides the IPv6 Transition CE Router is not relevant. In most
    cases, the service provider is responsible for
    provisioning/managing, at least on the WAN side. Commonly, the user 
    has access to configure the LAN interfaces, firewall, DMZ, and many other 
    features. However, in many cases, the user must supply or 
    may replace the IPv6 Transition CE Router. This underscores the importance
    of  
    the IPv6 Transition CE Routers fulfilling the requirements 
    defined in this document.</t>
      

    <t>The IPv6 Transition CE Router described in this document is not
    intended 
    for usage in other scenarios, such as large enterprises, data centers, 
    content providers, etc. Even if the documented requirements meet 
    their needs, they may have additional requirements, which are out of 
    the scope of this document.</t>
      
  </section>

    <section title="End-User Network Architecture" anchor="appB">

        <t>An end-user network will likely support both IPv4 and IPv6 
        (see <xref target="intro"/> and <xref target="appA"/>). It is
        not expected that end users will change their existing network
        topology with the introduction of IPv6. There are some differences in
        how IPv6 works and is provisioned; these differences have implications
        for the network architecture.</t>
        
        <t>A typical IPv4 end-user network consists of a "plug and play"
	router with 
        NAT functionality and a single link upstream, connected to the service 
        provider network.</t>
        
        <t>From the perspective of an IPv4 user behind an IPv6 Transition CE
	Router, this doesn't change.</t>

        <t>However, while a typical IPv4 NAT deployment, by default, blocks
        all incoming connections and may allow opening of ports using a
        Universal Plug and Play Internet Gateway Device (UPnP IGD) <xref
        target="UPnP-IGD"></xref><xref target="OCF-IGD"></xref> or some other
        firewall control protocol, in the case of an IPv6-only access and
        IPv4aaS, that may not be feasible depending on specific transition
        mechanism details. PCP <xref target="RFC6887"/> may be an alternative
        solution.</t>

        <t>Another consequence of using IPv4 private address space in the
	end-user
        network is that it provides stable addressing; that is, it doesn't
	change, 
        even when you change service providers, and the addresses are always
        usable even when the WAN interface is down or the customer edge router
        has not yet been provisioned. In the case of IPv6-only access, 
        private IPv4 addresses are also available if the IPv4aaS transition 
        mechanism keeps running the NAT interface towards the LAN side when
	the 
        WAN interface is down.</t>

	<t>More advanced routers support dynamic routing (which learns routes 
	from other routers), and advanced end users can build arbitrary,
	complex 
	networks using manual configuration of address prefixes combined with
	a 
	dynamic routing protocol. Once again, this is true for both IPv4 and
	IPv6.</t>

        <t>In general, the end-user network architecture for IPv6 should
	provide
        equivalent or better capabilities and functionality than the current
        IPv4 architecture.</t>

        <t>The end-user network is a stub network in the sense that is not
	providing 
        transit to other external networks. However, HNCP <xref
	target="RFC7788"/> 
        allows support for automatic  provisioning of downstream routers. 
        <xref target="sp_architecture"/> illustrates the model topology for
	the end-user network.</t>

        <figure align="center" anchor="sp_architecture"
                title="Example of a Typical End-User Network">
          <artwork align="left"><![CDATA[
                  +---------------+               \
                  |   Service     |                \
                  |   Provider    |                 \
                  |    Router     |                  | Service
                  +-------+-------+                  | Provider
                          | IPv6-only                | Network
                          | Customer                /
                          | Internet Connection    /
                          |                       / 
                   +------+--------+                    \
                   |     IPv6      |                     \
                   | Transition CE |                      \
                   |    Router     |                       |
                   +---+-------+---+                       |
       Network A       |       |   Network B               | 
   -+----------------+-+-     -+---+-------------+-        |
    |                |             |             |         |
+---+------+         |        +----+-----+ +-----+----+    |
|   IPv6   |         |        |   IPv4   | |IPv4/IPv6 |    |
|   Host   |         |        |   Host   | |   Host   |    |
+----------+         |        +----------+ +----------+    | End-User
                     |                                     | Network(s)
              +------+--------+                            |
              |     IPv6      |                            |
              |    Router     |                            |
              +------+--------+                            |
       Network C     |                                     |
   -+-------------+--+-                                    |
    |             |                                        |
+---+------+ +----+-----+                                  |
|   IPv6   | |   IPv6   |                                 /
|   Host   | |   Host   |                                /
+----------+ +----------+                               /
            ]]></artwork>
        </figure>

        <t>This architecture describes the:<list style="symbols">
            <t>Basic capabilities of the IPv6 Transition CE Router</t>

            <t>Provisioning of the WAN interface connecting to the service
            provider</t>

            <t>Provisioning of the LAN interfaces</t>
          </list></t>

        <t>The IPv6 Transition CE Router may be manually configured in an
	arbitrary
        topology with a dynamic routing protocol or HNCP 
        <xref target="RFC7788"/>. Automatic provisioning and configuration 
        are described for a single IPv6 Transition CE Router only.</t>

      </section>

    <section anchor="Acknowledgements" title="Acknowledgements" numbered="no">
      <t>Thanks to Mikael Abrahamsson, Fred Baker, Mohamed Boucadair, Brian
      Carpenter, Lorenzo Colitti, Alejandro D'Egidio, Ian Farrer, Lee Howard,
      Richard Patterson, Barbara Stark, Ole Troan, and James Woodyatt for
      their
      review and comments in this and/or previous draft versions of this
      document. Thanks also
      for the Last Call reviews by Dan Romascanu (OPS-DIR);
       Christian Huitema (SEC-DIR); Daniele Ceccarelli (RTG-DIR);
      Martin Stiemerling (TSV-ART); Matthew Miller (Gen-ART); and Alissa
      Cooper,
      Benjamin Kaduk, Suresh Krishnan, Ben Campbell, Spencer Dawkins, Mirja
      Kuhlewind, and Adam Roach (all IESG).</t>
    </section>

  </back>
</rfc>
