<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc rfcedstyle="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="std" ipr="pre5378Trust200902" number="6049">
  <front>
    <title abbrev="Spatial Composition">Spatial Composition of Metrics</title>

    <author fullname="Al Morton" initials="A." surname="Morton">
      <organization>AT&amp;T Labs</organization>

      <address>
        <postal>
          <street>200 Laurel Avenue South</street>

          <city>Middletown</city>

          <region>NJ</region>

          <code>07748</code>

          <country>USA</country>
        </postal>

        <phone>+1 732 420 1571</phone>

        <facsimile>+1 732 368 1192</facsimile>

        <email>acmorton@att.com</email>

        <uri>http://home.comcast.net/~acmacm/</uri>
      </address>
    </author>

    <author fullname="Stephan Emile" initials="E." surname="Stephan">
      <organization>France Telecom Orange</organization>

      <address>
        <postal>
          <street>2 avenue Pierre Marzin</street>

          <city>Lannion</city>

          <region></region>

          <code>F-22307</code>

          <country>France</country>
        </postal>

        <email>emile.stephan@orange-ftgroup.com</email>
      </address>
    </author>

    <date month="December" year="2010" />

    <abstract>
      <t>This memo utilizes IP performance metrics that are applicable to both
      complete paths and sub-paths, and it defines relationships to compose a
      complete path metric from the sub-path metrics with some accuracy with
      regard to the actual metrics.  This is called "spatial composition" in
      RFC 2330.  The memo refers to the framework for metric composition, and
      provides background and motivation for combining metrics to derive
      others.  The descriptions of several composed metrics and statistics
      follow.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>The IP Performance Metrics (IPPM) framework <xref
      target="RFC2330"></xref> describes two forms of metric composition:
      spatial and temporal.  The composition framework <xref
      target="RFC5835"></xref> expands and further qualifies these original
      forms into three categories.  This memo describes spatial composition,
      one of the categories of metrics under the umbrella of the composition
      framework.</t>

      <t>Spatial composition encompasses the definition of performance metrics
      that are applicable to a complete path, based on metrics collected on
      various sub-paths.</t>

      <t>The main purpose of this memo is to define the deterministic
      functions that yield the complete path metrics using metrics of the
      sub-paths.  The effectiveness of such metrics is dependent on their
      usefulness in analysis and applicability with practical measurement
      methods.</t>

      <t>The relationships may involve conjecture, and <xref
      target="RFC2330"></xref> lists four points that the metric definitions
      should include: <list style="symbols">
          <t>the specific conjecture applied to the metric and assumptions of
          the statistical model of the process being measured (if any; see
          <xref target="RFC2330"></xref>, Section 12),</t>

          <t>a justification of the practical utility of the composition in
          terms of making accurate measurements of the metric on the path,</t>

          <t>a justification of the usefulness of the composition in terms of
          making analysis of the path using A-frame concepts more effective,
          and</t>

          <t>an analysis of how the conjecture could be incorrect.</t>
        </list>Also, <xref target="RFC2330"></xref> gives an example using the
      conjecture that the delay of a path is very nearly the sum of the delays
      of the exchanges and clouds of the corresponding path digest.  This
      example is particularly relevant to those who wish to assess the
      performance of an inter-domain path without direct measurement, and the
      performance estimate of the complete path is related to the measured
      results for various sub-paths instead.</t>

      <t>Approximate functions between the sub-path and complete path metrics
      are useful, with knowledge of the circumstances where the relationships
      are/are not applicable.  For example, we would not expect that delay
      singletons from each sub-path would sum to produce an accurate estimate
      of a delay singleton for the complete path (unless all the delays were
      essentially constant -- very unlikely).  However, other delay statistics
      (based on a reasonable sample size) may have a sufficiently large set of
      circumstances where they are applicable.</t>

      <section title="Motivation">
        <t>One-way metrics defined in other RFCs (such as <xref
        target="RFC2679"></xref> and <xref target="RFC2680"></xref>) all
        assume that the measurement can be practically carried out between the
        source and the destination of interest.  Sometimes there are reasons
        that the measurement cannot be executed from the source to the
        destination.  For instance, the measurement path may cross several
        independent domains that have conflicting policies, measurement tools
        and methods, and measurement time assignment.  The solution then may be
        the composition of several sub-path measurements.  This means each
        domain performs the one-way measurement on a sub-path between two
        nodes that are involved in the complete path, following its own
        policy, using its own measurement tools and methods, and using its own
        measurement timing.  Under the appropriate conditions, one can combine
        the sub-path one-way metric results to estimate the complete path
        one-way measurement metric with some degree of accuracy.</t>
      </section>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119">RFC 2119</xref>.</t>

        <t>In this memo, the characters "&lt;=" should be read as "less than
        or equal to" and "&gt;=" as "greater than or equal to".</t>
      </section>
    </section>

    <section title="Scope and Application">
      <t></t>

      <section title="Scope of Work">
        <t>For the primary IP Performance Metrics RFCs for loss <xref
        target="RFC2680"></xref>, delay <xref target="RFC2679"></xref>, and
        delay variation <xref target="RFC3393"></xref>, this memo gives a set
        of metrics that can be composed from the same or similar sub-path
        metrics.  This means that the composition function may utilize: <list
            style="symbols">
            <t>the same metric for each sub-path;</t>

            <t>multiple metrics for each sub-path (possibly one that is the
            same as the complete path metric);</t>

            <t>a single sub-path metric that is different from the complete
            path metric;</t>

            <t>different measurement techniques like active <xref
            target="RFC2330"></xref>, <xref target="RFC3432"></xref> and
            passive <xref target="RFC5474"></xref>.</t>
          </list>We note a possibility: using a complete path metric and all
        but one sub-path metric to infer the performance of the missing
        sub-path, especially when the "last" sub-path metric is missing.
        However, such de-composition calculations, and the corresponding set
        of issues they raise, are beyond the scope of this memo.</t>
      </section>

      <section title="Application">
        <t>The composition framework <xref target="RFC5835" /> requires the
        specification of the applicable circumstances for each metric.  In
        particular, each section addresses whether the metric:</t>

        <list style="symbols">
          <t>Requires the same test packets to traverse all sub-paths or may
          use similar packets sent and collected separately in each
          sub&nbhy;path.</t>

          <t>Requires homogeneity of measurement methodologies or can allow a
          degree of flexibility (e.g., active, active spatial
          division <xref target="RFC5644"></xref>, or passive methods produce
          the "same" metric).  Also, the applicable sending streams will be
          specified, such as Poisson, Periodic, or both.</t>

          <t>Needs information or access that will only be available within an
          operator's domain, or is applicable to inter-domain composition.</t>

          <t>Requires synchronized measurement start and stop times in all
          sub&nbhy;paths or largely overlapping measurement intervals, or no
          timing requirements.</t>

          <t>Requires the assumption of sub-path independence with regard to
          the metric being defined/composed or other assumptions.</t>

          <t>Has known sources of inaccuracy/error and identifies the
          sources.</t>
        </list>
      </section>

      <section title="Incomplete Information">
        <t>In practice, when measurements cannot be initiated on a sub-path
        (and perhaps the measurement system gives up during the test
        interval), then there will not be a value for the sub-path reported,
        and the entire test result SHOULD be recorded as "undefined".  This
        case should be distinguished from the case where the measurement
        system continued to send packets throughout the test interval, but all
        were declared lost.</t>

        <t>When a composed metric requires measurements from sub-paths A, B,
        and C, and one or more of the sub-path results are undefined, then the
        composed metric SHOULD also be recorded as undefined.</t>
      </section>
    </section>

    <section anchor="common"
             title="Common Specifications for Composed Metrics">
      <t>To reduce the redundant information presented in the detailed metrics
      sections that follow, this section presents the specifications that are
      common to two or more metrics.  The section is organized using the same
      subsections as the individual metrics, to simplify comparisons.</t>

      <t>Also, the index variables are represented as follows:</t>

      <t><list style="symbols">
          <t>m = index for packets sent.</t>

          <t>n = index for packets received.</t>

          <t>s = index for involved sub-paths.</t>
        </list></t>

      <section title="Name: Type-P">
        <t>All metrics use the "Type-P" convention as described in <xref
        target="RFC2330"></xref>.  The rest of the name is unique to each
        metric.</t>

        <section anchor="common-params" title="Metric Parameters">
          <t><list style="symbols">
              <t>Src, the IP address of a host.</t>

              <t>Dst, the IP address of a host.</t>

              <t>T, a time (start of test interval).</t>

              <t>Tf, a time (end of test interval).</t>

              <t>lambda, a rate in reciprocal seconds (for Poisson
              Streams).</t>

              <t>incT, the nominal duration of inter-packet interval, first
              bit to first bit (for Periodic Streams).</t>

              <t>dT, the duration of the allowed interval for Periodic Stream
              sample start times.</t>

              <t>T0, a time that MUST be selected at random from the interval
              [T,&nbsp;T&nbsp;+ dT] to start generating packets and taking
              measurements (for Periodic Streams).</t>

              <t>TstampSrc, the wire time of the packet as measured at MP(Src)
              (measurement point at the source).</t>

              <t>TstampDst, the wire time of the packet as measured at
              MP(Dst), assigned to packets that arrive within a "reasonable"
              time.</t>

              <t>Tmax, a maximum waiting time for packets at the destination,
              set sufficiently long to disambiguate packets with long delays
              from packets that are discarded (lost); thus, the distribution
              of delay is not truncated.</t>

              <t>M, the total number of packets sent between T0 and Tf.</t>

              <t>N, the total number of packets received at Dst (sent between
              T0 and Tf).</t>

              <t>S, the number of sub-paths involved in the complete Src-Dst
              path.</t>

              <t>Type-P, as defined in <xref target="RFC2330"></xref>, which
              includes any field that may affect a packet's treatment as it
              traverses the network.</t>
            </list>In metric names, the term "&lt;Sample&gt;" is intended to
          be replaced by the name of the method used to define a sample of
          values of parameter TstampSrc.  This can be done in several ways,
          including:<list style="numbers">
              <t>Poisson: a pseudo-random Poisson process of rate lambda,
              whose values fall between T and Tf.  The time interval between
              successive values of TstampSrc will then average 1/lambda, as
              per <xref target="RFC2330"></xref>.</t>

              <t>Periodic: a Periodic stream process with pseudo-random start
              time T0 between T and dT, and nominal inter-packet interval
              incT, as per <xref target="RFC3432"></xref>.</t>
            </list></t>
        </section>

        <section title="Definition and Metric Units">
          <t>This section is unique for every metric.</t>
        </section>

        <section title="Discussion and Other Details">
          <t>This section is unique for every metric.</t>
        </section>

        <section title="Statistic">
          <t>This section is unique for every metric.</t>
        </section>

        <section title="Composition Function">
          <t>This section is unique for every metric.</t>
        </section>

        <section title="Statement of Conjecture and Assumptions">
          <t>This section is unique for each metric.  The term "ground truth"
          is frequently used in these sections and is defined in Section 4.7
          of <xref target="RFC5835"></xref>.</t>
        </section>

        <section title="Justification of the Composition Function">
          <t>It is sometimes impractical to conduct active measurements
          between every Src-Dst pair.  Since the full mesh of N measurement
          points grows as N x N, the scope of measurement may be limited by
          testing resources.</t>

          <t>There may be varying limitations on active testing in different
          parts of the network.  For example, it may not be possible to collect
          the desired sample size in each test interval when access link speed
          is limited, because of the potential for measurement traffic to
          degrade the user traffic performance.  The conditions on a low-speed
          access link may be understood well enough to permit use of a small
          sample size/rate, while a larger sample size/rate may be used on
          other sub&nbhy;paths.</t>

          <t>Also, since measurement operations have a real monetary cost,
          there is value in re-using measurements where they are applicable,
          rather than launching new measurements for every possible
          source-destination pair.</t>
        </section>

        <section title="Sources of Deviation from the Ground Truth">
          <section title="Sub-Path List Differs from Complete Path">
            <t>The measurement packets, each having source and destination
            addresses intended for collection at edges of the sub-path, may
            take a different specific path through the network equipment and
            links when compared to packets with the source and destination
            addresses of the complete path.  Example sources of parallel paths
            include Equal Cost Multi-Path and parallel (or bundled) links.
            Therefore, the performance estimated from the composition of
            sub-path measurements may differ from the performance experienced
            by packets on the complete path.  Multiple measurements employing
            sufficient sub-path address pairs might produce bounds on the
            extent of this error.</t>

            <t>We also note the possibility of re-routing during a measurement
            interval, as it may affect the correspondence between packets
            traversing the complete path and the sub-paths that were
            "involved" prior to the re-route.</t>
          </section>

          <section title="Sub-Path Contains Extra Network Elements">
            <t>Related to the case of an alternate path described above is the
            case where elements in the measured path are unique to measurement
            system connectivity.  For example, a measurement system may use a
            dedicated link to a LAN switch, and packets on the complete path
            do not traverse that link.  The performance of such a dedicated
            link would be measured continuously, and its contribution to the
            sub-path metrics SHOULD be minimized as a source of error.</t>
          </section>

          <section title="Sub-Paths Have Incomplete Coverage">
            <t>Measurements of sub-path performance may not cover all the
            network elements on the complete path.  For example, the network
            exchange points might be excluded unless a cooperative measurement
            is conducted.  In this example, test packets on the previous
            sub-path are received just before the exchange point, and test
            packets on the next sub-path are injected just after the same
            exchange point.  Clearly, the set of sub-path measurements SHOULD
            cover all critical network elements in the complete path.</t>
          </section>

          <section title="Absence of Route">
            <t>At a specific point in time, no viable route exists between the
            complete path source and destination.  The routes selected for one
            or more sub-paths therefore differ from the complete path.
            Consequently, spatial composition may produce finite estimation of
            a ground truth metric (see Section 4.7 of <xref
            target="RFC5835"></xref>) between a source and a destination, even
            when the route between them is undefined.</t>
          </section>
        </section>

        <section title="Specific Cases where the Conjecture Might Fail">
          <t>This section is unique for most metrics (see the metric-specific
          sections).</t>

          <t>For delay-related metrics, one-way delay always depends on packet
          size and link capacity, since it is measured in <xref
          target="RFC2679"></xref> from first bit to last bit.  If the size of
          an IP packet changes on its route (due to encapsulation), this can
          influence delay performance.  However, the main error source may be
          the additional processing associated with encapsulation and
          encryption/decryption if not experienced or accounted for in
          sub-path measurements.</t>

          <t>Fragmentation is a major issue for composition accuracy, since
          all metrics require all fragments to arrive before proceeding, and
          fragmented complete path performance is likely to be different from
          performance with non-fragmented packets and composed metrics based
          on non-fragmented sub-path measurements.</t>

          <t>Highly manipulated routing can cause measurement error if not
          expected and compensated for.  For example, policy-based MPLS routing
          could modify the class of service for the sub-paths and complete
          path.</t>
        </section>

        <section title="Application of Measurement Methodology">
          <list style="symbols">
            <t>The methodology SHOULD use similar packets sent and collected
            separately in each sub-path, where "similar" in this case means
            that Type-P contains as many equal attributes as possible, while
            recognizing that there will be differences.  Note that Type-P
            includes stream characteristics (e.g., Poisson, Periodic).</t>

            <t>The methodology allows a degree of flexibility regarding test
            stream generation (e.g., active or passive methods can produce an
            equivalent result, but the lack of control over the source,
            timing, and correlation of passive measurements is much more
            challenging).</t>

            <t>Poisson and/or Periodic streams are RECOMMENDED.</t>

            <t>The methodology applies to both inter-domain and intra-domain
            composition.</t>

            <t>The methodology SHOULD have synchronized measurement time
            intervals in all sub-paths, but largely overlapping intervals MAY
            suffice.</t>

            <t>Assumption of sub-path independence with regard to the metric
            being defined/composed is REQUIRED.</t>
          </list>
        </section>
      </section>
    </section>

    <section title="One-Way Delay Composed Metrics and Statistics">
      <t></t>

      <section title="Name: Type-P-Finite-One-way-Delay-&lt;Sample&gt;-Stream">
        <t>This metric is a necessary element of delay composition metrics,
        and its definition does not formally exist elsewhere in IPPM
        literature.</t>

        <section title="Metric Parameters">
          <t>See the common parameters section (<xref
          target="common-params"></xref>).</t>
        </section>

        <section title="Definition and Metric Units">
          <t>Using the parameters above, we obtain the value of the
          Type-P-One-way-Delay singleton as per <xref target="RFC2679" />.</t>

          <t>For each packet "[i]" that has a finite one-way delay (in other
          words, excluding packets that have undefined one-way delay):</t>

          <t>Type-P-Finite-One-way-Delay-&lt;Sample&gt;-Stream[i] =</t>

          <list style="empty">
            <t>FiniteDelay[i] = TstampDst - TstampSrc</t>
          </list>

          <t>This metric is measured in units of time in seconds, expressed in
          sufficiently low resolution to convey meaningful quantitative
          information.  For example, resolution of microseconds is usually
          sufficient.</t>
        </section>

        <section anchor="fin-1-way-delay-disc"
                 title="Discussion and Other Details">
          <t>The &ldquo;Type-P-Finite-One-way-Delay&rdquo; metric permits
          calculation of the sample mean statistic.  This resolves the problem
          of including lost packets in the sample (whose delay is undefined)
          and the issue with the informal assignment of infinite delay to lost
          packets (practical systems can only assign some very large
          value).</t>

          <t>The Finite-One-way-Delay approach handles the problem of lost
          packets by reducing the event space.  We consider conditional
          statistics, and estimate the mean one-way delay conditioned on the
          event that all packets in the sample arrive at the destination
          (within the specified waiting time, Tmax).  This offers a way to make
          some valid statements about one-way delay, at the same time avoiding
          events with undefined outcomes.  This approach is derived from the
          treatment of lost packets in <xref target="RFC3393"></xref>, and is
          similar to <xref target="Y.1540"></xref>.</t>
        </section>

        <section title="Statistic">
          <t>All statistics defined in <xref target="RFC2679"></xref> are
          applicable to the finite one-way delay, and additional metrics are
          possible, such as the mean (see below).</t>
        </section>
      </section>

      <section title="Name: Type-P-Finite-Composite-One-way-Delay-Mean">
        <t>This section describes a statistic based on the
        Type-P-Finite-One-way-Delay-&lt;Sample&gt;-Stream metric.</t>

        <section title="Metric Parameters">
          <t>See the common parameters section (<xref
          target="common-params"></xref>).</t>
        </section>

        <section title="Definition and Metric Units of the Mean Statistic">
          <t>We define<figure>
              <preamble>Type-P-Finite-One-way-Delay-Mean =</preamble>

              <artwork align="center"><![CDATA[
                    N
                   ---
              1    \
  MeanDelay = - *   >   (FiniteDelay [n])
              N    /
                   ---
                  n = 1]]></artwork>

              <postamble></postamble>
            </figure></t>

          <t>where all packets n = 1 through N have finite singleton
          delays.</t>

          <t>This metric is measured in units of time in seconds, expressed in
          sufficiently fine resolution to convey meaningful quantitative
          information.  For example, resolution of microseconds is usually
          sufficient.</t>
        </section>

        <section title="Discussion and Other Details">
          <t>The Type-P-Finite-One-way-Delay-Mean metric requires the
          conditional delay distribution described in <xref
          target="fin-1-way-delay-disc"></xref>.</t>
        </section>

        <section title="Statistic">
          <t>This metric, a mean, does not require additional statistics.</t>
        </section>

        <section title="Composition Function: Sum of Means">
          <t>The Type-P-Finite-Composite-One-way-Delay-Mean, or CompMeanDelay,
          for the complete source to destination path can be calculated from
          the sum of the mean delays of all of its S constituent
          sub-paths.</t>

          <t>Then the<figure>
              <preamble>Type-P-Finite-Composite-One-way-Delay-Mean
              =</preamble>

              <artwork align="center"><![CDATA[
                    S
                   ---
                   \
  CompMeanDelay =   >   (MeanDelay [s])
                   /
                   ---
                  s = 1]]></artwork>

              <postamble></postamble>
            </figure></t>

          <t>where sub-paths s = 1 to S are involved in the complete path.</t>
        </section>

        <section title="Statement of Conjecture and Assumptions">
          <t>The mean of a sufficiently large stream of packets measured on
          each sub-path during the interval [T,&nbsp;Tf] will be
          representative of the ground truth mean of the delay distribution
          (and the distributions themselves are sufficiently independent),
          such that the means may be added to produce an estimate of the
          complete path mean delay.</t>

          <t>It is assumed that the one-way delay distributions of the
          sub-paths and the complete path are continuous.  The mean of
          multi-modal distributions has the unfortunate property that such a
          value may never occur.</t>
        </section>

        <section title="Justification of the Composition Function">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Sources of Deviation from the Ground Truth">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Specific Cases where the Conjecture Might Fail">
          <t>If any of the sub-path distributions are multi-modal, then the
          measured means may not be stable, and in this case the mean will not
          be a particularly useful statistic when describing the delay
          distribution of the complete path.</t>

          <t>The mean may not be a sufficiently robust statistic to produce a
          reliable estimate, or to be useful even if it can be measured.</t>

          <t>If a link contributing non-negligible delay is erroneously
          included or excluded, the composition will be in error.</t>
        </section>

        <section title="Application of Measurement Methodology">
          <t>The requirements of the common section (<xref
          target="common"></xref>) apply here as well.</t>
        </section>
      </section>

      <section title="Name: Type-P-Finite-Composite-One-way-Delay-Minimum">
        <t>This section describes a statistic based on the
        Type-P-Finite-One-way-Delay-&lt;Sample&gt;-Stream metric, and the
        composed metric based on that statistic.</t>

        <section title="Metric Parameters">
          <t>See the common parameters section (<xref
          target="common-params"></xref>).</t>
        </section>

        <section title="Definition and Metric Units of the Minimum Statistic">
          <t>We define<figure>
              <preamble>Type-P-Finite-One-way-Delay-Minimum =</preamble>

              <artwork align="center"><![CDATA[
MinDelay = (FiniteDelay [j]) 

such that for some index, j, where 1 <= j <= N
FiniteDelay[j] <= FiniteDelay[n] for all n 
]]></artwork>

              <postamble></postamble>
            </figure></t>

          <t>where all packets n = 1 through N have finite singleton
          delays.</t>

          <t>This metric is measured in units of time in seconds, expressed in
          sufficiently fine resolution to convey meaningful quantitative
          information.  For example, resolution of microseconds is usually
          sufficient.</t>
        </section>

        <section title="Discussion and Other Details">
          <t>The Type-P-Finite-One-way-Delay-Minimum metric requires the
          conditional delay distribution described in <xref
          target="fin-1-way-delay-disc"></xref>.</t>
        </section>

        <section title="Statistic">
          <t>This metric, a minimum, does not require additional
          statistics.</t>
        </section>

        <section title="Composition Function: Sum of Minima">
          <t>The Type-P-Finite-Composite-One-way-Delay-Minimum, or
          CompMinDelay, for the complete source to destination path can be
          calculated from the sum of the minimum delays of all of its S
          constituent sub-paths.</t>

          <t>Then the<figure>
              <preamble>Type-P-Finite-Composite-One-way-Delay-Minimum
              =</preamble>

              <artwork align="center"><![CDATA[
                    S
                   ---
                   \
  CompMinDelay =    >  (MinDelay [s])
                   /
                   ---
                  s = 1]]></artwork>

              <postamble></postamble>
            </figure></t>
        </section>

        <section title="Statement of Conjecture and Assumptions">
          <t>The minimum of a sufficiently large stream of packets measured on
          each sub-path during the interval [T, Tf] will be representative of
          the ground truth minimum of the delay distribution (and the
          distributions themselves are sufficiently independent), such that
          the minima may be added to produce an estimate of the complete path
          minimum delay.</t>

          <t>It is assumed that the one-way delay distributions of the
          sub-paths and the complete path are continuous.</t>
        </section>

        <section title="Justification of the Composition Function">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Sources of Deviation from the Ground Truth">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Specific Cases where the Conjecture Might Fail">
          <t>If the routing on any of the sub-paths is not stable, then the
          measured minimum may not be stable.  In this case the composite
          minimum would tend to produce an estimate for the complete path that
          may be too low for the current path.</t>
        </section>

        <section title="Application of Measurement Methodology">
          <t>The requirements of the common section (<xref
          target="common"></xref>) apply here as well.</t>
        </section>
      </section>
    </section>

    <section title="Loss Metrics and Statistics">
      <t></t>

      <section title="Type-P-Composite-One-way-Packet-Loss-Empirical-Probability">
        <t></t>

        <section title="Metric Parameters">
          <t>See the common parameters section (<xref
          target="common-params"></xref>).</t>
        </section>

        <section anchor="comp-1-way-pkt-loss-def"
                 title="Definition and Metric Units">
          <t>Using the parameters above, we obtain the value of the
          Type-P-One-way-Packet-Loss singleton and stream as per <xref
          target="RFC2680"></xref>.</t>

          <t>We obtain a sequence of pairs with elements as follows: <list
              style="symbols">
              <t>TstampSrc, as above.</t>

              <t>L, either zero or one, where L = 1 indicates loss and L = 0
              indicates arrival at the destination within TstampSrc +
              Tmax.</t>
            </list></t>
        </section>

        <section title="Discussion and Other Details">
          <t>None.</t>
        </section>

        <section title="Statistic: Type-P-One-way-Packet-Loss-Empirical-Probability">
          <t>Given the stream parameter M, the number of packets sent, we can
          define the Empirical Probability of Loss Statistic (Ep), consistent
          with average loss in <xref target="RFC2680"></xref>, as
          follows:<figure>
              <preamble>Type-P-One-way-Packet-Loss-Empirical-Probability
              =</preamble>

              <artwork align="center"><![CDATA[
             M
            ---
       1    \
  Ep = - *   >  (L[m])
       M    /
            ---
           m = 1]]></artwork>

              <postamble></postamble>
            </figure></t>

          <t>where all packets m = 1 through M have a value for L.</t>
        </section>

        <section title="Composition Function: Composition of Empirical Probabilities">
          <t>The Type-P-One-way-Composite-Packet-Loss-Empirical-Probability,
          or CompEp, for the complete source to destination path can be
          calculated by combining the Ep of all of its constituent sub-paths
          (Ep1, Ep2, Ep3, ... Epn) as</t>

          <t><figure>
              <preamble>Type-P-Composite-One-way-Packet-Loss-Empirical-Probability
              =</preamble>

              <artwork align="center"><![CDATA[
CompEp = 1 - {(1 - Ep1) x (1 - Ep2) x (1 - Ep3) x ... x (1 - EpS)}]]></artwork>

              <postamble></postamble>
            </figure></t>

          <t>If any Eps is undefined in a particular measurement interval,
          possibly because a measurement system failed to report a value, then
          any CompEp that uses sub-path s for that measurement interval is
          undefined.</t>
        </section>

        <section title="Statement of Conjecture and Assumptions">
          <t>The empirical probability of loss calculated on a sufficiently
          large stream of packets measured on each sub-path during the
          interval [T,&nbsp;Tf] will be representative of the ground truth
          empirical loss probability (and the probabilities themselves are
          sufficiently independent), such that the sub-path probabilities may
          be combined to produce an estimate of the complete path empirical
          loss probability.</t>
        </section>

        <section title="Justification of the Composition Function">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Sources of Deviation from the Ground Truth">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Specific Cases where the Conjecture Might Fail">
          <t>A concern for loss measurements combined in this way is that root
          causes may be correlated to some degree.</t>

          <t>For example, if the links of different networks follow the same
          physical route, then a single catastrophic event like a fire in a
          tunnel could cause an outage or congestion on remaining paths in
          multiple networks.  Here it is important to ensure that measurements
          before the event and after the event are not combined to estimate
          the composite performance.</t>

          <t>Or, when traffic volumes rise due to the rapid spread of an
          email-borne worm, loss due to queue overflow in one network may help
          another network to carry its traffic without loss.</t>
        </section>

        <section title="Application of Measurement Methodology">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>
      </section>
    </section>

    <section title="Delay Variation Metrics and Statistics">
      <t></t>

      <section title="Name: Type-P-One-way-pdv-refmin-&lt;Sample&gt;-Stream">
        <t>This packet delay variation (PDV) metric is a necessary element of
        Composed Delay Variation metrics, and its definition does not formally
        exist elsewhere in IPPM literature (with the exception of <xref
        target="RFC5481"></xref>).</t>

        <section title="Metric Parameters">
          <t>In addition to the parameters of <xref
          target="common-params"></xref>:<list style="symbols">
              <t>TstampSrc[i], the wire time of packet[i] as measured at
              MP(Src) (measurement point at the source).</t>

              <t>TstampDst[i], the wire time of packet[i] as measured at
              MP(Dst), assigned to packets that arrive within a "reasonable"
              time.</t>

              <t>B, a packet length in bits.</t>

              <t>F, a selection function unambiguously defining the packets
              from the stream that are selected for the packet-pair
              computation of this metric.  F(current packet), the first packet
              of the pair, MUST have a valid Type-P-Finite-One-way-Delay less
              than Tmax (in other words, excluding packets that have undefined
              one-way delay) and MUST have been transmitted during the
              interval [T, Tf].  The second packet in the pair, F(min_delay
              packet) MUST be the packet with the minimum valid value of
              Type-P-Finite-One-way-Delay for the stream, in addition to the
              criteria for F(current packet).  If multiple packets have equal
              minimum Type-P-Finite-One-way-Delay values, then the value for
              the earliest arriving packet SHOULD be used.</t>

              <t>MinDelay, the Type-P-Finite-One-way-Delay value for
              F(min_delay packet) given above.</t>

              <t>N, the number of packets received at the destination that
              meet the F(current packet) criteria.</t>
            </list></t>
        </section>

        <section title="Definition and Metric Units">
          <t>Using the definition above in <xref
          target="comp-1-way-pkt-loss-def" />, we obtain the value of
          Type-P-Finite-One-way-Delay-&lt;Sample&gt;-Stream[n], the singleton
          for each packet[i] in the stream (a.k.a.&nbsp;FiniteDelay[i]).</t>

          <t>For each packet[n] that meets the F(first packet) criteria given
          above: Type-P-One-way-pdv-refmin-&lt;Sample&gt;-Stream[n] =</t>

          <list style="empty">
            <t>PDV[n] = FiniteDelay[n] &ndash; MinDelay</t>
          </list>

          <t>where PDV[i] is in units of time in seconds, expressed in
          sufficiently fine resolution to convey meaningful quantitative
          information.  For example, resolution of microseconds is usually
          sufficient.</t>
        </section>

        <section title="Discussion and Other Details">
          <t>This metric produces a sample of delay variation normalized to
          the minimum delay of the sample.  The resulting delay variation
          distribution is independent of the sending sequence (although
          specific FiniteDelay values within the distribution may be
          correlated, depending on various stream parameters such as packet
          spacing).  This metric is equivalent to the IP Packet Delay Variation
          parameter defined in <xref target="Y.1540"></xref>.</t>
        </section>

        <section title="Statistics: Mean, Variance, Skewness, Quantile">
          <t>We define the mean PDV as follows (where all packets n = 1
          through N have a value for PDV[n]):</t>

          <figure>
            <preamble>Type-P-One-way-pdv-refmin-Mean = MeanPDV =</preamble>

            <artwork align="center"><![CDATA[
      N
     ---
1    \
- *   >   (PDV[n])
N    /
     ---
    n = 1]]></artwork>

            <postamble></postamble>
          </figure>

          <t>We define the variance of PDV as follows:</t>

          <figure>
            <preamble>Type-P-One-way-pdv-refmin-Variance = VarPDV =</preamble>

            <artwork align="center"><![CDATA[
          N
         ---
   1     \                      2
-------   >   (PDV[n] - MeanPDV)
(N - 1)  /
         ---
        n = 1]]></artwork>

            <postamble></postamble>
          </figure>

          <t></t>

          <t>We define the skewness of PDV as follows:</t>

          <figure>
            <preamble>Type-P-One-way-pdv-refmin-Skewness = SkewPDV
            =</preamble>

            <artwork align="center"><![CDATA[
     N
    ---                        3
    \     /                  \
     >   |  PDV[n] - MeanPDV  |
    /     \                  /
    ---
   n = 1
-----------------------------------
    /                         \
   |                  ( 3/2 )  |
    \ (N - 1) * VarPDV        /]]></artwork>

            <postamble></postamble>
          </figure>

          <t>(See Appendix X of <xref target="Y.1541"></xref> for additional
          background information.)</t>

          <t>We define the quantile of the PDV sample as the value
          where the specified fraction of singletons is less than the given
          value.</t>
        </section>

        <section title="Composition Functions">
          <t>This section gives two alternative composition functions.  The
          objective is to estimate a quantile of the complete path delay
          variation distribution.  The composed quantile will be estimated
          using information from the sub-path delay variation
          distributions.</t>

          <section title="Approximate Convolution">
            <t>The Type-P-Finite-One-way-Delay-&lt;Sample&gt;-Stream samples
            from each sub-path are summarized as a histogram with 1&nbhy;ms
            bins representing the one-way delay distribution.</t>

            <t>From <xref target="STATS"></xref>, the distribution of the sum
            of independent random variables can be derived using the
            relation:</t>

            <t><figure>
                <preamble>Type-P-Composite-One-way-pdv-refmin-quantile-a
                =</preamble>

                <artwork align="left"><![CDATA[
                     .  .
                    /  /
P(X + Y + Z <= a) = |  | P(X <= a - y - z) * P(Y = y) * P(Z = z) dy dz
                    /  /
                   `  `
                   z  y]]></artwork>

                <postamble></postamble>
              </figure></t>

            <t>Note that dy and dz indicate partial integration above, and
            that y and z are the integration variables.  Also, the probability
            of an outcome is indicated by the symbol P(outcome), where X, Y,
            and Z are random variables representing the delay variation
            distributions of the sub-paths of the complete path (in this case,
            there are three sub-paths), and "a" is the quantile of
            interest.</t>

            <t>This relation can be used to compose a quantile of interest for
            the complete path from the sub-path delay distributions.  The
            histograms with 1&nbhy;ms bins are discrete approximations of the
            delay distributions.</t>
          </section>

          <section title="Normal Power Approximation (NPA)">
            <t>Type-P-One-way-Composite-pdv-refmin-NPA for the complete source
            to destination path can be calculated by combining the statistics
            of all the constituent sub-paths in the process described in <xref
            target="Y.1541"></xref>, Clause 8 and Appendix X.</t>
          </section>
        </section>

        <section title="Statement of Conjecture and Assumptions">
          <t>The delay distribution of a sufficiently large stream of packets
          measured on each sub-path during the interval [T, Tf] will be
          sufficiently stationary, and the sub-path distributions themselves
          are sufficiently independent, so that summary information describing
          the sub-path distributions can be combined to estimate the delay
          distribution of the complete path.</t>

          <t>It is assumed that the one-way delay distributions of the
          sub-paths and the complete path are continuous.</t>
        </section>

        <section title="Justification of the Composition Function">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>

        <section title="Sources of Deviation from the Ground Truth">
          <t>In addition to the common deviations, a few additional sources
          exist here.  For one, very tight distributions with ranges on the
          order of a few milliseconds are not accurately represented by a
          histogram with 1&nbhy;ms bins.  This size was chosen assuming an
          implicit requirement on accuracy: errors of a few milliseconds are
          acceptable when assessing a composed distribution quantile.</t>

          <t>Also, summary statistics cannot describe the subtleties of an
          empirical distribution exactly, especially when the distribution is
          very different from a classical form.  Any procedure that uses these
          statistics alone may incur error.</t>
        </section>

        <section title="Specific Cases where the Conjecture Might Fail">
          <t>If the delay distributions of the sub-paths are somehow
          correlated, then neither of these composition functions will be
          reliable estimators of the complete path distribution.</t>

          <t>In practice, sub-path delay distributions with extreme outliers
          have increased the error of the composed metric estimate.</t>
        </section>

        <section title="Application of Measurement Methodology">
          <t>See the common section (<xref target="common"></xref>).</t>
        </section>
      </section>
    </section>

    <section title="Security Considerations">
      <t></t>

      <section title="Denial-of-Service Attacks">
        <t>This metric requires a stream of packets sent from one host
        (source) to another host (destination) through intervening networks.
        This method could be abused for denial-of-service attacks directed at
        the destination and/or the intervening network(s).</t>

        <t>Administrators of source, destination, and intervening networks
        should establish bilateral or multilateral agreements regarding the
        timing, size, and frequency of collection of sample metrics.  Use of
        this method in excess of the terms agreed upon between the
        participants may be cause for immediate rejection or discarding of
        packets, or other escalation procedures defined between the affected
        parties.</t>
      </section>

      <section title="User Data Confidentiality">
        <t>Active use of this method generates packets for a sample, rather
        than taking samples based on user data, and does not threaten user
        data confidentiality.  Passive measurement MUST restrict attention to
        the headers of interest.  Since user payloads may be temporarily stored
        for length analysis, suitable precautions MUST be taken to keep this
        information safe and confidential.  In most cases, a hashing function
        will produce a value suitable for payload comparisons.</t>
      </section>

      <section title="Interference with the Metrics">
        <t>It may be possible to identify that a certain packet or stream of
        packets is part of a sample.  With that knowledge at the destination
        and/or the intervening networks, it is possible to change the
        processing of the packets (e.g., increasing or decreasing delay),
        which may distort the measured performance.  It may also be possible to
        generate additional packets that appear to be part of the sample
        metric.  These additional packets are likely to perturb the results of
        the sample measurement.</t>

        <t>To discourage the kind of interference mentioned above, packet
        interference checks, such as cryptographic hash, may be used.</t>
      </section>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>Metrics defined in the IETF are typically registered in the IANA IPPM
      Metrics Registry as described in the initial version of the registry
      <xref target="RFC4148"></xref>.</t>

      <t>IANA has registered the following metrics in the
      IANA-IPPM-METRICS-REGISTRY-MIB:</t>

      <t><figure>
          <preamble></preamble>

          <artwork><![CDATA[   ietfFiniteOneWayDelayStream OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Finite-One-way-Delay-Stream"
      REFERENCE "RFC 6049, Section 4.1."
      ::= { ianaIppmMetrics 71 } 
      

   ietfFiniteOneWayDelayMean OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Finite-One-way-Delay-Mean"
      REFERENCE "RFC 6049, Section 4.2.2."
      ::= { ianaIppmMetrics 72 }


   ietfCompositeOneWayDelayMean OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Finite-Composite-One-way-Delay-Mean"
      REFERENCE "RFC 6049, Section 4.2.5."
      ::= { ianaIppmMetrics 73 } 


   ietfFiniteOneWayDelayMinimum OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Finite-One-way-Delay-Minimum"
      REFERENCE "RFC 6049, Section 4.3.2."
      ::= { ianaIppmMetrics 74 }


   ietfCompositeOneWayDelayMinimum OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Finite-Composite-One-way-Delay-Minimum"
      REFERENCE "RFC 6049, Section 4.3.5."
      ::= { ianaIppmMetrics 75 }


   ietfOneWayPktLossEmpiricProb OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-One-way-Packet-Loss-Empirical-Probability"
      REFERENCE "RFC 6049, Section 5.1.4"
      ::= { ianaIppmMetrics 76 }


   ietfCompositeOneWayPktLossEmpiricProb OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Composite-One-way-Packet-Loss-Empirical-Probability"
      REFERENCE "RFC 6049, Section 5.1.5."
      ::= { ianaIppmMetrics 77 }

 
   ietfOneWayPdvRefminStream OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-One-way-pdv-refmin-Stream"
      REFERENCE "RFC 6049, Section 6.1."
      ::= { ianaIppmMetrics 78 }


   ietfOneWayPdvRefminMean OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-One-way-pdv-refmin-Mean"
      REFERENCE "RFC 6049, Section 6.1.4."
      ::= { ianaIppmMetrics 79 }


   ietfOneWayPdvRefminVariance OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-One-way-pdv-refmin-Variance"
      REFERENCE "RFC 6049, Section 6.1.4."
      ::= { ianaIppmMetrics 80 }

 
   ietfOneWayPdvRefminSkewness OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-One-way-pdv-refmin-Skewness"
      REFERENCE "RFC 6049, Section 6.1.4."
      ::= { ianaIppmMetrics 81 }


   ietfCompositeOneWayPdvRefminQtil OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-Composite-One-way-pdv-refmin-quantile-a"
      REFERENCE "RFC 6049, Section 6.1.5.1."
      ::= { ianaIppmMetrics 82 }


   ietfCompositeOneWayPdvRefminNPA OBJECT-IDENTITY
      STATUS current
      DESCRIPTION
         "Type-P-One-way-Composite-pdv-refmin-NPA"
      REFERENCE "RFC 6049, Section 6.1.5.2."
      ::= { ianaIppmMetrics 83 }

]]></artwork>

          <postamble></postamble>
        </figure></t>
    </section>

    <section title="Contributors and Acknowledgements">
      <t>The following people have contributed useful ideas, suggestions, or
      the text of sections that have been incorporated into this memo:</t>

      <t>- Phil Chimento &lt;vze275m9@verizon.net&gt;</t>

      <t>- Reza Fardid &lt;RFardid@cariden.com&gt;</t>

      <t>- Roman Krzanowski &lt;roman.krzanowski@verizon.com&gt;</t>

      <t>- Maurizio Molina &lt;maurizio.molina@dante.org.uk&gt;</t>

      <t>- Lei Liang &lt;L.Liang@surrey.ac.uk&gt;</t>

      <t>- Dave Hoeflin &lt;dhoeflin@att.com&gt;</t>

      <t>A long time ago, in a galaxy far, far away (Minneapolis), Will Leland
      suggested the simple and elegant Type-P-Finite-One-way-Delay concept.
      Thanks Will.</t>

      <t>Yaakov Stein and Donald McLachlan also provided useful comments along
      the way.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include='reference.RFC.5835'?>

      <?rfc include="reference.RFC.2119"?>

      <?rfc include="reference.RFC.2330"?>

      <?rfc include="reference.RFC.2679"?>

      <?rfc include='reference.RFC.2680'?>

      <?rfc include='reference.RFC.3393'?>

      <?rfc include='reference.RFC.3432'?>

      <?rfc include='reference.RFC.4148'?>
    </references>

    <references title="Informative References">
      <reference anchor="Y.1540">
        <front>
          <title>Internet protocol data communication service - IP packet
          transfer and availability performance parameters</title>

          <author fullname="" surname="ITU-T Recommendation Y.1540">
            <organization></organization>
          </author>

          <date month="November" year="2007" />
        </front>
      </reference>

      <reference anchor="Y.1541">
        <front>
          <title>Network Performance Objectives for IP-based Services</title>

          <author fullname="" surname="ITU-T Recommendation Y.1541">
            <organization></organization>
          </author>

          <date month="February" year="2006" />
        </front>
      </reference>

      <reference anchor="STATS">
        <front>
          <title>Introduction to the Theory of Statistics, 3rd Edition</title>

          <author fullname="Alexander Mood" initials="A." surname="Mood">
            <organization></organization>
          </author>

          <author fullname="Franklin Graybill" initials="F."
                  surname="Graybill">
            <organization></organization>
          </author>

          <author fullname="Duane Boes" initials="D." surname="Boes">
            <organization></organization>
          </author>

          <date year="1974" />
        </front>

        <seriesInfo name="McGraw-Hill," value="New York, NY" />
      </reference>

      <?rfc include='reference.RFC.5474'?>

      <?rfc include='reference.RFC.5481'?>
      <?rfc include='reference.RFC.5644'?>
    </references>
  </back>
</rfc>
