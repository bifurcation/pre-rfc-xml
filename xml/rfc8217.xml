<?xml version="1.0" encoding="US-ASCII"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.40 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC3261 SYSTEM "reference.RFC.3261.xml">
<!ENTITY RFC5234 SYSTEM "reference.RFC.5234.xml">
<!ENTITY RFC2119 SYSTEM "reference.RFC.2119.xml">
<!ENTITY RFC8174 SYSTEM "reference.RFC.8174.xml">
<!ENTITY RFC3515 SYSTEM "reference.RFC.3515.xml">
<!ENTITY RFC3892 SYSTEM "reference.RFC.3892.xml">
<!ENTITY RFC4508 SYSTEM "reference.RFC.4508.xml">
<!ENTITY RFC5360 SYSTEM "reference.RFC.5360.xml">
<!ENTITY RFC3325 SYSTEM "reference.RFC.3325.xml">
<!ENTITY RFC5002 SYSTEM "reference.RFC.5002.xml">
<!ENTITY RFC5318 SYSTEM "reference.RFC.5318.xml">
<!ENTITY RFC5502 SYSTEM "reference.RFC.5502.xml">
]>

   <?rfc toc="yes" ?>  
   <?rfc symrefs="yes" ?>
   <?rfc sortrefs="yes"?>
   <?rfc compact="yes" ?>
   <?rfc subcompact="no" ?>

<rfc number="8217" category="std" submissionType="IETF" consensus="yes"
  ipr="trust200902" updates="3261, 3325, 3515, 3892, 4508, 5002, 5318, 5360, 5502">

  <front>
    <title abbrev="name-addr Clarifications">Clarifications for When to Use the name-addr Production in SIP Messages</title>

    <author initials="R." surname="Sparks" fullname="Robert Sparks">
      <organization>Oracle</organization>
      <address>
        <email>rjsparks@nostrum.com</email>
      </address>
    </author>

    <date year="2017" month="August" />

    
    <abstract>


<t>RFC 3261 constrained several SIP header fields whose grammar contains 
the "name-addr / addr-spec" alternative to use name-addr when certain
characters appear. Unfortunately, it expressed the constraints with
prose copied into each header field definition, and at least one
header field was missed. Further, the constraint has not been 
copied into documents defining extension headers whose grammar 
contains the alternative.</t>

<t>This document updates RFC 3261 to state the constraint generically and
clarifies that the constraint applies to all SIP header fields where there is a
choice between using name-addr or addr-spec. It also updates the RFCs that
define extension SIP header fields using the alternative to clarify that the
constraint applies (RFCs 3325, 3515, 3892, 4508, 5002, 5318, 5360, and 5502).</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t><xref target="RFC3261"/> defines several header fields that contain URIs to allow
both a form that contains the bare URI (addr-spec) and one that provides
a name and the URI (name-addr). This subset, taken from the ABNF <xref target="RFC5234"/> 
specified in <xref target="RFC3261"/>, shows the relevant part of the definition of the 
syntax of the "From" header field:</t>

<figure><artwork><![CDATA[
  From        =  ( "From" / "f" ) HCOLON from-spec
  from-spec   =  ( name-addr / addr-spec )
                 *( SEMI from-param )
  name-addr      =  [ display-name ] LAQUOT addr-spec RAQUOT
  addr-spec      =  SIP-URI / SIPS-URI / absoluteURI
]]></artwork></figure>

<t>The prose in Section 20.20 of <xref target="RFC3261"/>, which discusses the "From"
header field, constrains how the production may be used by saying:</t>

<figure><artwork><![CDATA[
   Even if the "display-name" is empty, the "name-addr" form 
   MUST be used if the "addr-spec" contains a comma, question 
   mark, or semicolon.
]]></artwork></figure>

<t>Section 20.39 of <xref target="RFC3261"/>, which discusses the "To" header field, contains no such
constraining text.</t>

<t>This constraint is specified slightly differently, but with the same intent,
in the introduction to Section 20 of <xref target="RFC3261"/>:</t>

<figure><artwork><![CDATA[
  The Contact, From, and To header fields contain a URI.  If the URI
  contains a comma, question mark or semicolon, the URI MUST be
  enclosed in angle brackets (< and >). 
]]></artwork></figure>

<t>Unfortunately, this can be read to only apply to the Contact, From, and To
header fields, making it necessary to provide the constraint explicitly
in the prose discussing any other header field using the name-addr or 
addr-spec alternative.</t>

<t>As extension header fields were standardized, the specifications sometimes
failed to include the constraint. Many errata have been entered to correct
this omission. When the constraint has been included, the requirement to use
the name-addr form has not been consistently stated.
</t>

<t>This memo updates the specifications of SIP and its extensions to clarify that
the constraint to use the name-addr form applies anywhere there is a choice
between the name-addr and addr-spec production rules in the grammar for SIP
header fields.</t>

<t>It is important to note that a message formed without honoring the constraint
will still be syntactically valid, but it would very likely be interpreted
differently.  The characters after the comma, question mark, or semicolon will,
in most cases, be interpreted as header field parameters or additional header
field values as discussed in Section 7.3.1 of <xref target="RFC3261"/>. (An exception
is the degenerate case of a URL like sip:10.0.0.1,@10.0.0.0 where it is
possible to parse the comma via the 'user' production).</t>

</section>
<section anchor="terminology" title="Terminology">

<t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they
appear in all capitals, as shown here.</t>

</section>
<section anchor="updates-to-rfc3261" title="Updates to RFC 3261">

<t>This text from introduction to Section 20 of <xref target="RFC3261"/>:</t>

<figure><artwork><![CDATA[
  The Contact, From, and To header fields contain a URI.  If the URI
  contains a comma, question mark or semicolon, the URI MUST be
  enclosed in angle brackets (< and >).  Any URI parameters are
  contained within these brackets.  If the URI is not enclosed in 
  angle brackets, any semicolon-delimited parameters are 
  header-parameters, not URI parameters. 
]]></artwork></figure>

<t>is replaced with:</t>

<figure><artwork><![CDATA[
  When constructing the value of any SIP header field whose grammar
  allows choosing between name-addr and addr-spec, such as those
  that use the form '(name-addr / addr-spec)', the addr-spec form
  MUST NOT be used if its value would contain a comma, semicolon,
  or question mark.

  When a URI appears in such a header field, any URI parameters MUST
  be contained within angle brackets (< and >).  If the URI is not 
  enclosed in angle brackets, any semicolon-delimited parameters are 
  header-parameters, not URI parameters.

  The header fields defined in this specification that allow this
  choice are "To", "From", "Contact", and "Reply-To". 
]]></artwork></figure>

</section>
<section anchor="updates-to-rfcs-defining-sip-extension-header-fields" title="Updates to RFCs Defining SIP Extension Header Fields">

<t>The following Standards Track RFCs:
<xref target="RFC3515"/>, <xref target="RFC3892"/>, <xref target="RFC4508"/>, and <xref target="RFC5360"/></t>

<t>and the following Informational RFCs:
<xref target="RFC3325"/>, <xref target="RFC5002"/>, <xref target="RFC5318"/>, and <xref target="RFC5502"/></t>

<t>are updated to include:</t>

<figure><artwork><![CDATA[
   This RFC contains the definition of one or more SIP header fields
   that allow choosing between addr-spec and name-addr when
   constructing header field values. As specified in RFC 8217,
   the "addr-spec" form MUST NOT be used if its value would contain
   a comma, semicolon, or question mark.
]]></artwork></figure>

<t>The status of these RFCs remains unchanged. In particular the status of the
Informational RFCs remains Informational.</t>

</section>
<section anchor="iana-considerations" title="IANA Considerations">

<t>This document does not require any IANA actions.</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

<t>The updates specified in this memo clarify a constraint on the grammar for
producing SIP messages. It introduces no new security considerations. One
pre-existing consideration is worth reiterating: messages produced without
honoring the constraint will very likely be misinterpreted by the receiving
element.</t>

</section>

  </middle>

  <back>

    <references title='Normative References'>

&RFC3261;
&RFC5234;
&RFC2119;
&RFC8174;
&RFC3515;
&RFC3892;
&RFC4508;
&RFC5360;
&RFC3325;
&RFC5002;
&RFC5318;
&RFC5502;


    </references>

<section anchor="acknowledgments" title="Acknowledgments">

<t>Brett Tate identified this issue in several extension documents, submitted
several corresponding errata, and drove the discussion that led to this memo.
Substantive comments leading to this text were provided by Paul Kyzivat,
Gonzalo Camarillo, Dale Worley, and Yehoshua Gev.</t>

</section>



  </back>

<!-- ##markdown-source:
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
GwAA

-->

</rfc>

