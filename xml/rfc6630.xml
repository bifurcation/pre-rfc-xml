<?xml version="1.0" encoding="US-ASCII"?>
<?xml-stylesheet type='text/xsl' href='http://xml.resource.org/authoring/rfc2629.xslt' ?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc5296 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5296.xml">
<!ENTITY rfc3588 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3588.xml">
<!ENTITY rfc3748 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3748.xml">
<!ENTITY rfc5836 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5836.xml">
<!ENTITY rfc3315 PUBLIC ""
	 "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3315.xml">
<!ENTITY rfc5295 PUBLIC ""
	 "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5295.xml">
<!ENTITY rfc2104 PUBLIC ""
	 "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2104.xml">
<!ENTITY rfc4868 PUBLIC ""
	 "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4868.xml">
<!ENTITY rfc5890 PUBLIC ""
	 "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5890.xml">
<!ENTITY rfc4962 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4962.xml">
<!ENTITY rfc5226 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml">
<!ENTITY rfc4282 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4282.xml">
]>

<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<?rfc rfcedstyle="yes"?>
<?rfc tocindent="yes"?>

<rfc number="6630" category="std" submissionType="IETF" ipr="trust200902">
  <front>

    <title abbrev="ERP/AAK">EAP Re-authentication Protocol Extensions
    for&nbsp;Authenticated&nbsp;Anticipatory&nbsp;Keying&nbsp;(ERP/AAK)</title>

    <author fullname="Zhen Cao" initials="Z." surname="Cao">
      <organization>China Mobile</organization>

      <address>
        <postal>
          <street>53A Xibianmennei Ave., Xuanwu District</street>

          <city>Beijing</city>

          <region>Beijing</region>

          <code>100053</code>

          <country>P.R. China</country>
        </postal>

        <email>zehn.cao@gmail.com</email>
      </address>
    </author>

    <author fullname="Hui Deng" initials="H." surname="Deng">
      <organization>China Mobile</organization>

      <address>
        <postal>
          <street>53A Xibianmennei Ave., Xuanwu District</street>

          <city>Beijing</city>

          <region>Beijing</region>

          <code>100053</code>

          <country>P.R. China</country>
        </postal>

        <email>denghui02@gmail.com</email>
      </address>
    </author>

    <author fullname="Qin Wu" initials="Q." surname="Wu">
      <organization>Huawei</organization>

      <address>
        <postal>
          <street>Floor 12, HuiHong Mansion, No. 91 BaiXia Rd.</street>

          <city>Nanjing</city>

          <region>Jiangsu</region>

          <code>210001</code>

          <country>P.R. China</country>
        </postal>

        <phone>+86 25 56623633</phone>

        <email>sunseawq@huawei.com</email>
      </address>
    </author>

    <author role="editor" fullname="Glen Zorn" initials="G." surname="Zorn">
      <organization>Network Zen</organization>

      <address>
        <postal>
          <street>227/358 Thanon Sanphawut</street>

          <city>Bang Na</city>

          <region>Bangkok</region>

          <code>10260</code>

          <country>Thailand</country>
        </postal>

        <phone>+66 (0) 87-040-4617</phone>

        <email>glenzorn@gmail.com</email>
      </address>
    </author>

    <date month="May" year="2012"/>

<keyword>ERP, AAK, EAP, Early-authentication</keyword>

    <abstract>
      <t>The Extensible Authentication Protocol (EAP) is a generic framework
      supporting multiple types of authentication methods. </t>
<t> The EAP Re-authentication Protocol (ERP) specifies
      extensions to EAP and the EAP keying hierarchy to support an EAP
      method-independent protocol for efficient re-authentication between the
      peer and an EAP re-authentication server through any authenticator.
      </t>
<t> 
      Authenticated Anticipatory Keying (AAK) is a
      method by which cryptographic keying material may be established upon
      one or more Candidate Attachment Points (CAPs) prior to handover. AAK
      uses the AAA infrastructure for key transport. </t>
<t>
      This document specifies the extensions necessary to enable AAK support
      in ERP.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>The Extensible Authentication Protocol (EAP) <xref
      target="RFC3748"></xref> is a generic framework supporting multiple
      types of authentication methods. In systems where EAP is used for
      authentication, it is desirable not to repeat the entire EAP exchange
      with another authenticator. The EAP Re-authentication Protocol (ERP)
      <xref target="RFC5296"></xref> specifies extensions to EAP and the EAP
      keying hierarchy to support an EAP method-independent protocol for
      efficient re-authentication between the EAP re-authentication peer and
      an EAP re-authentication server through any authenticator. The
      re-authentication server may be in the home network or in the local
      network to which the mobile host (i.e., the EAP re-authentication peer) is
      connecting. </t>

<t> Authenticated Anticipatory Keying
      (AAK) <xref target="RFC5836"></xref> is a method by which cryptographic
      keying material may be established upon one or more
      Candidate Attachment Points (CAPs) prior to handover. AAK utilizes the AAA infrastructure
      for key transport. </t>
<t> This document specifies the
      extensions necessary to enable AAK support in ERP.</t>
    </section>

    <section title="Terminology">
      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in 
        <xref target="RFC2119"></xref>.</t>
      </section>

      <section title="Acronyms">
        <t>The following acronyms are used in this document; see the
        references for more details. 


			<list hangIndent="4" style="hanging">
				<t hangText="AAA">
					<vspace blankLines="0"/>
					Authentication, Authorization, and Accounting
					<xref target="RFC3588"></xref>
				</t>

				<t hangText="CAP">
					<vspace blankLines="0"/>
					Candidate Attachment Point <xref target="RFC5836"></xref>
				</t>

  <t hangText="DSRK">
   	<vspace blankLines="0"/>
Domain-Specific Root Key <xref target="RFC5295"/></t>

				<t hangText="EA">
					<vspace blankLines="0"/>
					Abbreviation for "ERP/AAK"
				</t>

				<t hangText="EA Peer">
					<vspace blankLines="0"/>
					 An EAP peer that supports the ERP/AAK. Note
					that all references to "peer" in this document imply an EA peer,
					unless specifically noted otherwise.
				</t>


  <t hangText="NAI">
   	<vspace blankLines="0"/>
    Network Access Identifier <xref target="RFC4282"/></t>
  <t hangText="pMSK">
   	<vspace blankLines="0"/>
   pre-established Master Session Key</t>
  <t hangText="pRK">
   	<vspace blankLines="0"/>
    pre-established Root Key</t>
  <t hangText="rIK">
   	<vspace blankLines="0"/>
    re-authentication Integrity Key <xref target="RFC5296"/></t>
  <t hangText="rRK">
   	<vspace blankLines="0"/>
    re-authentication Root Key <xref target="RFC5296"/></t>


				<t hangText="SAP">
					<vspace blankLines="0"/>
					Serving Attachment
					Point <xref
					target="RFC5836"></xref>
				</t>
          </list>
         </t>
      </section>
    </section>

    <section title="ERP/AAK Description">
      <t>ERP/AAK is intended to allow (upon request
      by the peer) the establishment of cryptographic
      keying materials on a single Candidate Attachment Point prior to the
      arrival of the peer at the Candidate Access Network (CAN).
      </t>
<t>
      In this document, ERP/AAK support
      by the peer is assumed. Also, it is assumed that the peer has previously
      completed full EAP authentication and that either the peer or the SAP knows the
      identities of neighboring attachment points. Note that the behavior of
      a peer that does not support the ERP-AAK scheme defined in this
      specification is out of the scope of this document.
      <xref target="fig_1"></xref> shows the general protocol exchange by which the
      keying material is established on the CAP. 

<?rfc needLines="31"?>
<figure align="center" anchor="fig_1" title="ERP/AAK Exchange"> <artwork>     
+------+         +-----+        +-----+          +-----------+
| Peer |         | SAP |        | CAP |          | EA Server |
+--+---+         +--+--+        +--+--+          +-----+-----+
   |                |              |                   |
a. | [EAP-Initiate/ |              |                   |
   | Re-auth-start  |              |                   |
   | (E flag)]      |              |                   |
   |&lt;---------------|              |                   |
   |                |              |                   |
b. | EAP-Initiate/  |              |                   |
   | Re-auth        |              |                   |
   | (E flag)       |              |                   |
   |---------------&gt;|              |                   |
c. |                | AAA(EAP-Initiate/Re-auth(E flag))| 
   |                |---------------------------------&gt;|
   |                |              |         +---------+---------+
   |                |              |         | CA authorized &amp;   |
d. |                |              |         |  and EA Keying    |
   |                |              |         |   Distribution    |
   |                |              |         +---------+---------+
   |                |              |                   |
   |                |              |                   |
f. |                | AAA (EAP-Finish/Re-auth(E flag)) |
   |                |&lt;---------------------------------|
g. | EAP-Finish/    |              |                   |
   | Re-auth(E flag)|              |                   |
   |&lt;---------------|              |                   |
   |                |              |                   |
</artwork>
        </figure>


<figure align="center" anchor="fig_2"
          title="Key Distribution for ERP/AAK">
          <artwork>
+-----------+               +---------+
|           |               |         |
| EA Server |               |   CAP   |
|           |               |         |
+-----|-----+               +----|----+
      |                          |
      |                          |
      |    AAA Request (pMSK)    |
   e.1|-------------------------&gt;|
      |                          |
      |                          |
      |                          |
      |  AAA Response (Success)  |
   e.2|&lt;-------------------------|
      |                          |
      |                          |
      |                          |
</artwork>
        </figure>
       ERP/AAK reuses the packet format defined by ERP, but
      specifies a new flag to differentiate EAP early authentication from EAP
      re-authentication.
  The peer initiates ERP/AAK without an external trigger, 
  or initiates ERP/AAK in response to an
  EAP-Initiate/Re-Auth-Start message from the SAP.
</t>

<t>In the latter case, the SAP MAY send the identity of one or more
      Candidate Attachment Points to which the
      SAP is adjacent to the peer in the EAP-Initiate/Re-auth-Start message
      (see step a in <xref target="fig_1"/>). 
      The peer SHOULD override the identity of
      CAP(s) carried in
 the EAP-Initiate/Re-auth-Start message by sending
      EAP-Initiate/Re-auth with the E flag set if it knows to which CAP 
      it will move. If the EAP-Initiate/ Re-auth-Start packet is
      not supported by the peer, it MUST be silently discarded. 
      </t>
<t>
      If the peer initiates ERP/AAK, the peer MAY send an
      early-authentication request message (EAP-Initiate/Re-auth with the E
      flag set) containing the keyName-NAI, the CAP-Identifier, rIK, and
      sequence number (see step b in <xref target="fig_1"/>). 
      The realm in the keyName-NAI
      field is used to locate the peer's ERP/AAK server. The CAP-Identifier
      is used to identify the CAP. 

The re-authentication Integrity Key (rIK) is defined by Narayanan
      &amp; Dondeti in <xref target="RFC5296"/>
      and is used to
      protect the integrity of the message. The sequence number is used for
      replay protection. </t>

<t>The SAP SHOULD verify the
      integrity of this message at step b. If this verification fails, the SAP
      MUST send an EAP-Finish/Re-auth message with the Result flag set to '1'
      (Failure).
      If the verification succeeds, the SAP SHOULD encapsulate the
      early-authentication message into a AAA message and send it to the
      peer's ERP/AAK server in the realm indicated in the keyName-NAI field
      (see step c in <xref target="fig_1"/>). 
      </t>
<t>
      Upon receiving the
      message, the ERP/AAK server MUST first use the keyName indicated in the
      keyName-NAI to look up the rIK and check the integrity and
      freshness of the message. Then, the ERP/AAK server MUST verify the
      identity of the peer by checking the username portion of the
      KeyName-NAI. If any of the checks fail, the server MUST send an
early-authentication finish message (EAP-Finish/Re-auth with E flag set) with
      the Result flag set to '1'. 

      Next, the server MUST authorize the CAP
      specified in the CAP-Identifier TLV. 
      In the success case, the server MUST
      derive a pMSK from the pRK for the CAP carried in the 
      CAP-Identifier field using the sequence number associated with
      CAP-Identifier as an input to the key derivation. (see step d in <xref target="fig_1"/>).
      </t>
<t>
      Then, the ERP/AAK server MUST transport the
      pMSK to the authorized CAP via AAA (see <xref target="AAA"></xref>) as
      illustrated above (see steps e.1 and e.2 in <xref target="fig_2"/>). 
      Note that key
      distribution in <xref target="fig_2"/>
      is one part of step d in <xref target="fig_1"/>.
      </t>
<t>Finally, in response to the
      EAP-Initiate/Re-auth message, the ERP/AAK server SHOULD send the
      early-authentication finish message (EAP-&nbhy;Finish/Re&nbhy;auth with E flag
      set) containing the identity of the authorized CAP to the peer via the
      SAP along with the lifetime of the pMSK.
      If the peer also
      requests the rRK Lifetime, the ERP/AAK server SHOULD send
      the rRK Lifetime in the EAP-Finish/Re-auth message (see steps f and g in <xref target="fig_1"/>).
</t>

    </section>

    <section title="ERP/AAK Key Hierarchy">
      <t>ERP/AAK uses a key hierarchy similar to that
      of ERP. 
      The ERP/AAK pre-established Root Key (pRK) is derived from
      either the EMSK or the DSRK as specified below (see <xref target="key-derivation"/>). In general, the pRK
      is derived from the EMSK if the peer is located in the home AAA
      realm and derived from the DSRK if the peer is in a visited
      realm. The DSRK is delivered from the EAP server to the ERP/AAK server
      as specified in <xref target="KEYTRAN"></xref>. If
      the peer has previously been authenticated by means of ERP or ERP/AAK,
      the DSRK SHOULD be directly reused. <figure align="center" anchor="KH1"
          title="ERP/AAK Root Key Derivation">
          <artwork>
    DSRK    EMSK
     |       |
 +---+---+---+---+
 |              
pRK            ...
</artwork>
        </figure>

Similarly, the pre-established Master Session Key (pMSK) is
      derived from the pRK. The pMSK is established for the CAP when the peer
      early authenticates to the network. The hierarchy relationship is
      illustrated <xref target="KH2"></xref>, below.
<figure align="center"
          anchor="KH2" title="ERP/AAK Key Hierarchy">
          <artwork>
         pRK
          |
 +--------+--------+
 |                
 pMSK             ...
</artwork>
        </figure></t>

      <section anchor="key-derivation" title="Derivation of the pRK and pMSK">
        <t>The rRK is derived as specified in <xref
        target="RFC5295"></xref>.</t>

        <t>pRK = KDF (K, S), where<list>
            <t>K = EMSK or K = DSRK and</t>

            <t>S = pRK Label | "\0" | length</t>
          </list></t>

        <t>The pRK Label is an IANA-assigned 8-bit ASCII string:<list>
            <t>EAP Early-Authentication Root Key@ietf.org</t>
          </list></t>

        <t>assigned from the "User
   Specific Root Keys (USRK) Key Labels" name space in accordance with Salowey, et al.&nbsp;<xref target="RFC5295"></xref>. The KDF and algorithm agility for the
        KDF are also defined in RFC 5295. The KDF algorithm is indicated in the cryptosuite
        field or list of cryptosuites TLV payload as specified in
   Sections <xref target="sec_Initiate" format="counter"/> and <xref target="sec_Finish" format="counter"/>.</t>

        <t>The pMSK uses the same KDF as pRK and is derived as follows:</t>

        <t>pMSK = KDF (K, S), where<list>
            <t>K = pRK and</t>

            <t>S = pMSK label | "\0" | SEQ | length</t>
          </list></t>

        <t>The pMSK label is the 8-bit ASCII string:<list>
            <t>EAP Early-Authentication Master Session Key@ietf.org</t>
          </list></t>

        <t>The length field refers to the length of the pMSK 
        in octets encoded as specified in RFC 5295. SEQ is sent by either
        the peer or the server in the ERP/AAK message using the SEQ field or the 
        Sequence number TLV. It is encoded as a 16-bit number as specified in Sections <xref target="sec_Initiate" format="counter"/> and <xref target="sec_Finish" format="counter"/>.</t>
      </section>
    </section>

    <section title="Packet and TLV Extension">
      <t>This section describes the packet and TLV extensions for the ERP/AAK
      exchange.</t>

      <section title="EAP-Initiate/Re-auth-Start Packet and TLV Extension">
        <t><xref target="StartPacket"></xref> shows the new parameters
        contained in the EAP-Initiate/Re-auth-Start packet defined in <xref
        target="RFC5296"></xref>.</t>



        <figure align="center" anchor="StartPacket"
title="EAP-Initiate/Re-auth-Start Extension">
          <artwork>   
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |E| Reserved    |     1 or more TVs or TLVs     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
        </figure>

        <t>Flags</t>

        <t>'E' - The E flag is used to indicate early authentication. This
        field MUST be set to '1' if early authentication is in use,
        and it MUST be
        set to '0' otherwise.</t>

        <t>The rest of the 7 bits (Reserved) MUST be set to 0 and ignored on
        reception.</t>

        <t>Type/Values (TVs) and TLVs</t>

        <t>CAP-Identifier: Carried in a TLV payload. The format is identical
        to that of a DiameterIdentity <xref target="RFC3588"></xref>. It is
        used by the SAP to advertise the identity of the CAP to the peer.
        Exactly one CAP&nbhy;Identifier TLV MAY be included in the
        EAP-Initiate/Re-auth-Start packet if the SAP has performed CAP
        discovery.</t>

        <t>If the EAP-Initiate/Re-auth-Start packet is not supported by the
        peer, it SHOULD be discarded silently.</t>
      </section>

      <section anchor="sec_Initiate"
               title="EAP-Initiate/Re-auth Packet and TLV Extension">
        <t><xref target="ReauthPacket"></xref> illustrates the new
        parameters contained in the EAP&nbhy;Initiate/Re&nbhy;auth packet defined in
        <xref target="RFC5296"></xref>.</t>

        <figure align="center" anchor="ReauthPacket"
title="EAP-Initiate/Re-auth Extension">
          <artwork>   
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|x|L|E|Resved |             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite  |         Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
        </figure>

        <t>Flags</t>

        <t>'x' - The x flag is reserved. It MUST be ignored on receipt.</t>
        
        <t>'L' - As defined in Section 5.3.2 of <xref target="RFC5296"></xref>, this
        bit is used to request the key lifetimes from the server.</t>

        <t>'E' - The E flag is used to indicate early authentication.</t>

        <t>The first bit(R) and final 4 bits (Resved) MUST be set to 0 and ignored on
        reception.</t>

        <t>SEQ</t>

        <t>As defined in Section 5.3.2 of <xref target="RFC5296"></xref>, this
        field is 16-bit sequence number and used for replay protection.</t>

        <t>TVs and TLVs</t>

        <t>keyName-NAI: As defined in <xref target="RFC5296"></xref>,
        this is carried in a TLV payload. The Type is 1. The NAI is variable
        in length, not exceeding 253 octets. The username part of the NAI is
        the EMSKname used to identify the peer. The realm part of the NAI is
        the peer's home domain name if the peer communicates with the home EA
        server or the domain to which the peer is currently attached (i.e.,
        local domain name) if the peer communicates with a local EA server.
        The SAP knows whether the KeyName-NAI carries the local domain name by
        comparing the domain name carried in the KeyName-NAI with the local domain
        name that is associated with the SAP.
        Exactly one keyName&nbhy;NAI attribute SHALL be present in an
        EAP&nbhy;Initiate/Re&nbhy;auth packet and the realm part of it SHOULD follow
        the use of internationalized domain names defined in <xref
        target="RFC5890"></xref>.</t>

        <t>CAP-Identifier: Carried in a TLV payload. The Type is
        11. This field is used to indicate the Fully Qualified Domain
        Name (FQDN) of a CAP. The value
        field MUST be encoded as specified in Section 8 of <xref
        target="RFC3315"></xref>. Exactly one instance of the
        CAP-Identifier TLV MUST be present in the ERP/AAK-Key TLV.</t>

        <t>Sequence number: The Type is 7. The value field
        is a 16-bit field and used in the derivation of the pMSK for a CAP.</t>

        <t>Cryptosuite</t>

        <t>This field indicates the integrity algorithm used for ERP/AAK. Key
        lengths and output lengths are either indicated or obvious from the
        cryptosuite name, e.g., HMAC-SHA256-128 denotes Hashed Message Authentication Code (HMAC) computed using
        the SHA-256 function <xref target="RFC4868"></xref>  with 256-bit
        key length and the output truncated to 128 bits <xref
        target="RFC2104"></xref>. We specify some cryptosuites below: <list
            hangIndent="5" style="hanging">
            <t hangText="0-1">RESERVED</t>

            <t hangText="2">HMAC-SHA256-128</t>

            <t hangText="3">HMAC-SHA256-256</t>
          </list></t>

        <t>HMAC-SHA256-128 is REQUIRED to implement, and it
        SHOULD be enabled in the default configuration.</t>

        <t>Authentication Tag</t>

        <t>This field contains an integrity checksum over the ERP/AAK packet
        from the first bit of the Code field to the last bit of the Cryptosuite field,
        excluding the
        Authentication Tag field itself. The value field is calculated using
        the integrity algorithm indicated in the Cryptosuite field and rIK
        specified in <xref target="RFC5296"></xref> as the secret key. The
        length of the field is indicated by the Cryptosuite.</t>

        <t>The peer uses the Authentication Tag to determine the validity of the
        EAP-Finish/Re-auth message from the server.</t>

        <t>If the message doesn't pass verification or the Authentication Tag is
        not included in the message, the message SHOULD be discarded
        silently.</t>

        <t>If the EAP-Initiate/Re-auth packet is not supported by the SAP, it
        SHOULD be discarded silently. The peer MUST maintain retransmission
        timers for reliable transport of the EAP-Initiate/Re-auth message. If
        there is no response to the EAP-Initiate/Re-auth message from the
        server after the necessary number of retransmissions (see <xref
        target="LLC"></xref>), the peer MUST assume that ERP/AAK is not
        supported by the SAP.</t>
      </section>

      <section anchor="sec_Finish" title="EAP-Finish/Re-auth Packet and TLV Extension">
        <t><xref target="FinishPacket"></xref> shows the new parameters
        contained in the EAP-Finish/Re-auth packet defined in <xref
        target="RFC5296"></xref>. 

<figure align="center" anchor="FinishPacket" title="EAP-Finish/Re-auth Extension">
<artwork>   
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|x|L|E|Resved |             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite  |         Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
          </figure></t>

        <t>Flags</t>
        
        <t>'R' - As defined in Section 5.3.3 of <xref target="RFC5296"></xref>, this
        bit is used as the Result flag. This field MUST be set
        to '1' to indicate success, and it MUST be set to '0' otherwise.</t>

        <t>'x' - The x flag is reserved. It MUST be ignored on receipt.</t>
        
        <t>'L' - As defined in Section 5.3.3 of <xref target="RFC5296"></xref>, this
        bit is used to request the key lifetimes from the server.</t>

        <t>'E' - The E flag is used to indicate early authentication.</t>

        <t>The final 4 bits (Resved) MUST be set to 0 and ignored on
        reception.</t>

        <t>SEQ</t>

        <t>As defined in Section 5.3.3 of <xref target="RFC5296"></xref>, this
        field is a 16-bit sequence number and is used for replay protection.</t>

        <t>TVs and TLVs</t>

        <t>keyName-NAI: As defined in <xref target="RFC5296"></xref>,
        this is carried in a TLV payload. The Type is 1. The NAI is variable
        in length, not exceeding 253 octets. Exactly one keyName-NAI attribute
        SHALL be present in an EAP-Finish/Re-auth packet.</t>

        <t>ERP/AAK-Key: Carried in a TLV payload for the key container. The
        Type is 8. Exactly one ERP/AAK-key SHALL be present in an
        EAP&nbhy;Finish/Re&nbhy;auth packet. <figure>
            <artwork>
ERP/AAK-Key ::= 
     { sub-TLV: CAP-Identifier }
     { sub-TLV: pMSK Lifetime }
     { sub-TLV: pRK Lifetime }
     { sub-TLV: Cryptosuites }
</artwork>
          </figure> <list style="hanging">
            <t hangText="CAP-Identifier"><vspace blankLines="0" />Carried in a
            sub-TLV payload. The Type is 11 (less than 128). This field is
            used to indicate the identifier of the candidate authenticator.
            The value field MUST be encoded as specified in Section 8 of <xref target="RFC3315"></xref>. At least one instance
            of the CAP-Identifier TLV MUST be present in the ERP/AAK-Key
            TLV.</t>

            <t hangText="pMSK Lifetime"><vspace blankLines="0" />Carried in a
            sub-TLV payload of the EAP-Finish/Re-auth message. The Type is 10.
            The value field is an unsigned 32-bit field and contains the
            lifetime of the pMSK in seconds. This value is calculated by the
            server after performing the pRK Lifetime computation upon receiving the
            EAP-Initiate/Re-auth message. The rIK SHOULD share the same
            lifetime as the pMSK.
            If the 'L' flag is set, the pMSK Lifetime
            attribute MUST be present.</t>

            <t hangText="pRK Lifetime"><vspace blankLines="0" />Carried in a
            sub-TLV payload of EAP-Finish/Re-auth message. The Type is 9.
            The value field is an unsigned 32-bit field and contains the
            lifetime of the pRK in seconds. This value is calculated by the
            server before performing the pMSK Lifetime computation upon receiving a
            EAP-Initiate/Re-auth message. If the 'L' flag is set, the
            pRK Lifetime attribute MUST be present.</t>

            <t hangText="List of Cryptosuites"><vspace blankLines="0" />
            Carried in a sub-TLV payload. The Type is 5 <xref
            target="RFC5296"></xref>. The value field contains a list of
            cryptosuites (at least one cryptosuite SHOULD be included), each 1
            octet in length. The allowed cryptosuite values are as specified
            in <xref target="sec_Initiate"></xref>. The server SHOULD include
            this attribute if the cryptosuite used in the EAP&nbhy;Initiate/Re&nbhy;auth
            message was not acceptable and the message is being rejected. The
            server MAY include this attribute in other cases. The server MAY
            use this attribute to signal its cryptographic
            algorithm capabilities to the peer.</t>
          </list></t>

        <t>Cryptosuite</t>

        <t>This field indicates the integrity algorithm and PRF used for ERP/
        AAK. HMAC-SHA256-128 is REQUIRED to implement, and it SHOULD be enabled
        in the default configuration. Key lengths and output lengths are
        either indicated or obvious from the cryptosuite name.</t>

        <t>Authentication Tag</t>

        <t>This field contains the integrity checksum over the ERP/AAK packet
        from the first bit of the Code field to the last bit of the Cryptosuite field,
        excluding the
        Authentication Tag field itself. The value field is calculated using
        the integrity algorithm indicated in the Cryptosuite field and the rIK
        <xref target="RFC5296"></xref> as the integrity key. The length of the
        field is indicated by the corresponding Cryptosuite.</t>

        <t>The peer uses the authentication tag to determine the validity of the
        EAP-Finish/Re-auth message from a server.</t>

        <t>If the message doesn't pass verification or the authentication tag is
        not included in the message, the message SHOULD be discarded
        silently.</t>

        <t>If the EAP-Initiate/Re-auth packet is not supported by the SAP, it
        is discarded silently. The peer MUST maintain retransmission timers
        for reliable transport of the EAP-Initiate/Re-auth message. If there is no
        response to the EAP-Initiate/Re-auth message from the server after the
        necessary number of retransmissions (see <xref target="LLC"></xref>), the peer
        MUST assume that ERP/AAK is not supported by the SAP.</t>
      </section>

      <section title="TV and TLV Attributes">
        <t>With the exception of the rRK Lifetime and rMSK Lifetime TV
        payloads, the attributes specified in Section
        5.3.4 of <xref target="RFC5296" /> also apply to this document. In this document, new
        attributes that may be present in the EAP-Initiate and EAP-Finish
        messages are defined as below: <list style="symbols">
            <t>Sequence number: This is a TV payload. The Type is 7.</t>

            <t>ERP/AAK-Key: This is a TLV payload. The Type is 8.</t>

            <t>pRK Lifetime: This is a TV payload. The Type is 9.</t>

            <t>pMSK Lifetime: This is a TV payload. The Type is 10.</t>
            
            <t>CAP-Identifier: This is a TLV payload. The Type is 11.</t>
          </list></t>


      </section>
    </section>

    <section anchor="LLC" title="Lower-Layer Considerations">
      <t>Similar to ERP, some lower-layer specifications may need to be
      revised to support ERP/AAK; refer to Section
      6 of <xref target="RFC5296"/> for additional guidance.</t>
    </section>

    <section anchor="AAA" title="AAA Transport Considerations">
      <t>The AAA transport of ERP/AAK messages is the same as that of the
      ERP message <xref target="RFC5296"></xref>. In addition, this document
      requires AAA transport of the ERP/AAK keying materials delivered by the
      ERP/AAK server to the CAP. Hence, a new AAA message for the ERP/AAK
      application should be specified to transport the keying materials.</t>
    </section>

    <section title="Security Considerations">
      <t>This section provides an analysis of the protocol in accordance with
      the AAA key management requirements specified in <xref
      target="RFC4962"></xref>.</t>


      <t><list style="symbols">
          <t>Cryptographic algorithm independence: ERP-AAK satisfies this
          requirement. The algorithm chosen by the peer for calculating the
          authentication tag is indicated in the EAP-Initiate/Re-auth message.
          If the chosen algorithm is unacceptable, the EAP server returns an
          EAP-Finish/Re-auth message with a Failure indication.</t>

          <t>Strong, fresh session keys: ERP-AAK results in the derivation of
          strong, fresh keys that are unique for the given CAP. A pMSK is
          always derived on demand when the peer requires a key with a new
          CAP. The derivation ensures that the compromise of one pMSK does not
          result in the compromise of a different pMSK at any time.</t>

          <t>Limit key scope: The scope of all the keys derived by ERP-AAK is
          well defined. The pRK is used to derive the pMSK for the CAP.
          Different sequence numbers for each CAP MUST be used to derive a
          unique pMSK.</t>

          <t>Replay detection mechanism: For replay protection,
          a sequence number associated with the pMSK is used. The
          peer increments the sequence number by one after it sends an ERP/AAK
          message. The server sets the expected sequence number to the
          received sequence number plus one after verifying the validity of
          the received message, and it responds to the message.</t>

          <t>Authenticate all parties: The EAP Re-authentication Protocol provides
          mutual authentication of the peer and the server. The peer and SAP
          are authenticated via ERP. The CAP is authenticated and trusted by
          the SAP.</t>

          <t>Peer and authenticator authorization: The peer and authenticator
          demonstrate possession of the same keying material without disclosing
          it, as part of the lower-layer secure authentication protocol.</t>

          <t>Keying material confidentiality: The peer and the server derive
          the keys independently using parameters known to each entity.</t>

          <t>Uniquely named keys: All keys produced within the ERP context can
          be referred to uniquely as specified in this document.</t>

          <t>Prevent the domino effect: Different sequence numbers for each
          CAP MUST be used to derive the unique pMSK so that the compromise of one
          pMSK does not hurt any other CAP.</t>

          <t>Bind key to its context: The pMSKs are bound to the context in
          which the sequence numbers are transmitted.</t>

          <t>Confidentiality of identity: This is the same as with ERP <xref target="RFC5296"></xref>.</t>

          <t>Authorization restriction: All the keys derived are limited in
          lifetime by that of the parent key or by server policy. Any
          domain-specific keys are further restricted to be used only in the
          domain for which the keys are derived. Any other restrictions of
          session keys may be imposed by the specific lower layer and are out
          of scope for this specification.</t>
        </list></t>
    </section>

    <section title="IANA Considerations">

      <t>IANA has assigned five TLVs from the registry of
      EAP Initiate and Finish Attributes maintained at
      http://www.iana.org/assignments/eap-numbers/ with the following numbers: <list
          style="symbols">
          <t>Sequence number: This is a TV payload. The Type is 7.</t
>
          <t>ERP/AAK-Key: This is a TLV payload. The Type is 8.</t>

          <t>pRK Lifetime: This is a TLV payload. The Type is 9.</t>

          <t>pMSK Lifetime: This is a TLV payload. The Type is 10.</t>
          
          <t>CAP-Identifier: This is a TLV payload. The Type is 11.</t>
        </list></t>

      <t>This document reuses the cryptosuites that were created for
      "Re&nbhy;authentication Cryptosuites" in <xref target="RFC5296"></xref>.</t>

      <t>Further, IANA has added a new label in the "User
      Specific Root Keys (USRK) Key Labels" sub-registry of the "Extended Master Session Key
      (EMSK) Parameters" registry, as follows: <list>
          <t>EAP Early-Authentication Root Key@ietf.org</t>
        </list></t>
        
     <t>A new registry for the flags in the
     EAP Initiate/Re-auth-Start message called the 
     "EAP Initiate/Re-auth-Start Flags" has been created and a 
     new flag (E) has been assigned as follows: <list>
          <t>(E) 0x80 </t>
        </list></t>

     <t>The rest of the values in the 8-bit field are reserved.  New values
     can be assigned by Standards Action or IESG Approval <xref target="RFC5226" />.</t>

     <t>A new registry for the flags in the EAP
     Initiate/Re-auth message called the "EAP Initiate/Re-auth Flags" has also been created.
     The following flags are reserved: <list>
          <t>(R) 0x80 <xref target="RFC5296"/> </t>
          <t>(B) 0x40 <xref target="RFC5296"/> </t>
          <t>(L) 0x20 <xref target="RFC5296"/> </t>
        </list></t>

     <t>This document assigns a new flag (E) as follows: <list>
          <t>(E) 0x10 </t>
        </list></t>

     <t>The rest of the values in the 8-bit field are reserved.  New values
     can be assigned by Standards Action or IESG Approval.</t>

     <t>Further, this document creates a new registry for the flags in the
     EAP Finish/Re-auth message called the "EAP Finish/Re-auth
     Flags".  The following values are assigned. <list>
         <t>(R) 0x80 <xref target="RFC5296"/> </t>
         <t>(B) 0x40 <xref target="RFC5296"/> </t>
         <t>(L) 0x20 <xref target="RFC5296"/> </t>
       </list></t>

     <t> This document assigns a new flag (E) as follows: <list>
         <t> (E) 0x10 </t>
       </list></t>

    <t> The rest of the values in the 8-bit field are reserved.  New values
    can be assigned by Standards Action or IESG approval. </t>

    </section>

    <section title="Acknowledgements">
      <t>In writing this document, Yungui Wang contributed to early versions
      of this document and we have received reviews from many experts in the
      IETF, including Tom Taylor, Tena Zou, Tim Polk, Tan Zhang, Semyon
      Mizikovsky, Stephen Farrell, Radia Perlman, Miguel A. Garcia, and Sujing Zhou. We apologize if we miss some of
      those who have helped us.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      &rfc2119;

      &rfc5296;

&rfc3315;

&rfc4282;

&rfc5295;

&rfc5226;

    </references>

    <references title="Informative References">
      &rfc5836;
&rfc2104;

&rfc4868;

&rfc5890;

<reference anchor='KEYTRAN'>
<front>
<title>Diameter Attribute-Value Pairs for Cryptographic Key Transport</title>

<author initials='G' surname='Zorn' fullname='Glen Zorn'>
    <organization />
</author>

<author initials='W' surname='Wu' fullname='Wenson Wu'>
    <organization />
</author>

<author initials='V' surname='Cakulev' fullname='Violeta Cakulev'>
    <organization />
</author>

<date month='August' day='18' year='2011' />

<abstract><t>Some Authentication, Authorization, and Accounting (AAA) applications require the transport of cryptographic keying material.  This document specifies a set of Attribute-Value Pairs (AVPs) providing native Diameter support of cryptographic key delivery.</t></abstract>

</front>

<seriesInfo name='Work in' value='Progress'/>

</reference>

      &rfc3588;

      &rfc3748;

      &rfc4962;
    </references>
  </back>
</rfc>
