<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM 'rfc2629.dtd'[
<!ENTITY RFC2119 SYSTEM "reference.RFC.2119.xml">
<!ENTITY RFC3411 SYSTEM "reference.RFC.3411.xml">
<!ENTITY RFC3561 SYSTEM "reference.RFC.3561.xml">
<!ENTITY RFC3748 SYSTEM "reference.RFC.3748.xml">
<!ENTITY RFC4279 SYSTEM "reference.RFC.4279.xml">
<!ENTITY RFC4492 SYSTEM "reference.RFC.4492.xml">
<!ENTITY RFC4868 SYSTEM "reference.RFC.4868.xml">
<!ENTITY RFC4944 SYSTEM "reference.RFC.4944.xml">
<!ENTITY RFC5116 SYSTEM "reference.RFC.5116.xml">
<!ENTITY RFC5191 SYSTEM "reference.RFC.5191.xml">
<!ENTITY RFC5216 SYSTEM "reference.RFC.5216.xml">
<!ENTITY RFC5246 SYSTEM "reference.RFC.5246.xml">
<!ENTITY RFC5288 SYSTEM "reference.RFC.5288.xml">
<!ENTITY RFC5289 SYSTEM "reference.RFC.5289.xml">
<!ENTITY RFC5487 SYSTEM "reference.RFC.5487.xml">
<!ENTITY RFC5548 SYSTEM "reference.RFC.5548.xml">
<!ENTITY RFC5673 SYSTEM "reference.RFC.5673.xml">
<!ENTITY RFC5826 SYSTEM "reference.RFC.5826.xml">
<!ENTITY RFC5867 SYSTEM "reference.RFC.5867.xml">
<!ENTITY RFC5889 SYSTEM "reference.RFC.5889.xml">
<!ENTITY RFC6282 SYSTEM "reference.RFC.6282.xml">
<!ENTITY RFC6345 SYSTEM "reference.RFC.6345.xml">
<!ENTITY RFC6550 SYSTEM "reference.RFC.6550.xml">
<!ENTITY RFC6551 SYSTEM "reference.RFC.6551.xml">
<!ENTITY RFC6554 SYSTEM "reference.RFC.6554.xml">
<!ENTITY RFC6655 SYSTEM "reference.RFC.6655.xml">
<!ENTITY RFC6786 SYSTEM "reference.RFC.6786.xml">
<!ENTITY RFC6997 SYSTEM "reference.RFC.6997.xml">
<!ENTITY RFC6998 SYSTEM "reference.RFC.6998.xml">
<!ENTITY RFC7102 SYSTEM "reference.RFC.7102.xml">
<!ENTITY RFC7228 SYSTEM "reference.RFC.7228.xml">
<!ENTITY RFC7251 SYSTEM "reference.RFC.7251.xml">
<!ENTITY RFC7296 SYSTEM "reference.RFC.7296.xml">
<!ENTITY RFC7390 SYSTEM "reference.RFC.7390.xml">
<!ENTITY RFC7416 SYSTEM "reference.RFC.7416.xml">
<!ENTITY RFC7428 SYSTEM "reference.RFC.7428.xml">
<!ENTITY RFC6552 SYSTEM "reference.RFC.6552.xml">
]>

<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="no"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>

<rfc category="std" number="7733" ipr="trust200902" submissionType="IETF"
     consensus="yes">


  <front>
    <title abbrev="RPL in Home and Building">Applicability Statement:
 The Use of the Routing Protocol
 for&nbsp;Low&nbhy;Power&nbsp;and&nbsp;Lossy&nbsp;Networks (RPL) Protocol
 Suite in&nbsp;Home&nbsp;Automation&nbsp;and&nbsp;Building&nbsp;Control</title>

    <author fullname="Anders Brandt" initials="A." surname="Brandt">
      <organization>Sigma Designs</organization>
      <address>
        <email>anders_Brandt@sigmadesigns.com</email>
      </address>
    </author>

    <author fullname="Emmanuel Baccelli" initials="E." surname="Baccelli">
      <organization>INRIA</organization>
      <address>
        <email>Emmanuel.Baccelli@inria.fr</email>
      </address>
    </author>

    <author fullname="Robert Cragie" initials="R." surname="Cragie">
      <organization>ARM Ltd.</organization>
      <address>
        <postal>
          <street>110 Fulbourn Road</street>
          <city>Cambridge</city>
          <code>CB1 9NJ</code>
          <country>United Kingdom</country>
        </postal>
        <email>robert.cragie@arm.com</email>
      </address>
    </author>

    <author fullname="Peter van der Stok" initials="P." surname="van der Stok">
      <organization>Consultant</organization>
      <address>
        <email>consultancy@vanderstok.org</email>
      </address>
    </author>

    <date month="February" year="2016"/>

    <keyword>sensor network</keyword>
    <keyword>ad hoc network</keyword>
    <keyword>routing</keyword>
    <keyword>RPL</keyword>
    <keyword>applicability</keyword>
    <keyword>building control</keyword>
    <keyword>home automation</keyword>
    <keyword>IP networks</keyword>

    <abstract>
      <t>The purpose of this document is to provide guidance in the selection
      and use of protocols from the Routing Protocol for Low-Power and Lossy
      Networks (RPL) protocol suite to implement the features required for
      control in building and home environments.</t>

    </abstract>
  </front>

  <middle>
    <section anchor="cid1" title="Introduction">
      <t>The primary purpose of this document is to give guidance in the use
      of the Routing Protocol for Low-Power and Lossy Networks (RPL) protocol
      suite in two application domains:</t>

      <t><list style="symbols">
        <t>Home automation</t>
        <t>Building automation</t>
      </list></t>

      <t>The guidance is based on the features required by the requirements
      documents "Home Automation Routing Requirements in Low-Power and Lossy
      Networks" <xref target="RFC5826"/> and "Building Automation Routing
      Requirements in Low-Power and Lossy Networks" <xref target="RFC5867"/>,
      respectively. The Advanced Metering Infrastructure is also considered
      where appropriate. The applicability domains distinguish themselves in
      the way they are operated, their performance requirements, and the most
      likely network structures. An abstract set of distinct communication
      paradigms is then used to frame the applicability domains.</t>

      <t>Home automation and building automation application domains share a
      substantial number of properties:</t>

      <t><list style="symbols">
        <t>In both domains, the network can be disconnected from the ISP and
        must still continue to provide control to the occupants of the
        home or building. Routing needs to be possible independent of the
        existence of a border router.</t>

        <t>Both domains are subject to unreliable links but require instant
        and very reliable reactions. This has an impact on routing because
        of timeliness and multipath routing.</t>

      </list></t>
      <t>The differences between the two application domains mostly appear in
      commissioning, maintenance, and the user interface, which do not
      typically affect routing. Therefore, the focus of this applicability
      document is on reliability, timeliness, and local routing.</t>

      <t>It should be noted that adherence to the guidance in this
      document does not necessarily guarantee fully interoperable
      solutions in home automation networks and building control
      networks and that additional rigorous and managed programs will
      be needed to ensure interoperability.</t>


      <section title="Relationship to Other Documents">
        <t>The Routing Over Low power and Lossy networks (ROLL) working group
        has specified a set of routing protocols for Low-Power and Lossy
        Networks (LLNs) <xref target="RFC6550"/>. This applicability text
        describes a subset of those protocols and the conditions under which
        the subset is appropriate, and it provides recommendations and
        requirements for the accompanying parameter value ranges.</t>

        <t>In addition, <xref target ="RFC6997"/> was written
        specifically as an extension to core RPL <xref target ="RFC6550"/>
        and provides a solution for reactive discovery of point-to-point
        routes in LLNs. The present applicability document
        provides recommendations and requirements for the accompanying
        parameter value ranges.</t>

        <t><xref target="RFC7416"/> describes a common set of security
        threats. The applicability statements provided in
        <xref target="applic-statements"/> of this document complement
        <xref target="RFC7416"/> by describing preferred security settings
        and solutions within the applicability statement conditions. This
        applicability statement recommends lighter-weight security solutions
        appropriate for home and building environments and indicates why these
        solutions are appropriate.</t>

      </section>
   
      <section title="Terminology">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119"/>.</t>

        <t>Additionally, this document uses terminology from <xref
        target="RFC6997"/>, <xref target="RFC7731"/>, <xref
        target="RFC7102"/>, <xref target="IEEE802.15.4"/>, and <xref
        target="RFC6550"/>.</t>

      </section>

      <section title="Required Reading">
        <t>Applicable requirements are described in <xref target="RFC5826"/>
        and <xref target="RFC5867"/>. A survey of the application field is
        described in <xref target="BC-Survey"/>.</t>

      </section>

      <section title="Requirements That Are Out of Scope">
        <t>The considered network diameter is limited to a maximum diameter
        of 10 hops and a typical diameter of five hops; this captures
        the most common cases in home automation and building control
        networks.</t>

        <t>This document does not consider the applicability of RPL-related
        specifications for urban and industrial applications
        <xref target="RFC5548"/> <xref target="RFC5673"/>, which may
        exhibit significantly larger network diameters.</t>

      </section>
    </section>

    <section title="Deployment Scenario">
      <t>The use of communications networks in buildings is essential to
      satisfy energy-saving regulations. Environmental conditions of
      buildings can be adapted to suit the comfort of the individuals
      present inside. Consequently, when no one is present, energy
      consumption can be reduced. Cost is the main driving factor
      behind deployment of wireless networking in buildings, especially
      in the case of retrofitting, where wireless connectivity saves
      costs incurred due to cabling and building modifications.</t>

      <t>A typical home automation network is comprised of less than
      100&nbsp;nodes. Large building deployments may span
      10,000&nbsp;nodes, but to ensure uninterrupted service of light
      and air conditioning systems in individual zones of the building,
      nodes are typically organized in subnetworks. Each subnetwork in
      a building automation deployment typically contains tens to
      hundreds of nodes and, for critical operations, may operate
      independently from the other subnetworks.</t>

      <t>The main purpose of the home or building automation network is to
      provide control over light and heating/cooling resources. User
      intervention via wall controllers is combined with movement, light and
      temperature sensors to enable automatic adjustment of window blinds,
      reduction of room temperature, etc. In general, the sensors and
      actuators in a home or building typically have fixed physical locations
      and will remain in the same home or building automation network.</t>

      <t>People expect an immediate and reliable response to their presence or
      actions. For example, a light not switching on after entry into a room
      may lead to confusion and a profound dissatisfaction with the lighting
      product.</t>

      <t>Monitoring of functional correctness is at least as important as
      timely responses. Devices typically communicate their status regularly
      and send alarm messages to notify users or implementers that a
      malfunction of controlled equipment or a controlled network has
      occurred.</t>

      <t>In building control, the infrastructure of the building management
      network can be shared with security/access, Internet Protocol (IP)
      telephony, and fire/alarm networks. This approach has a positive
      impact on the operation and cost of the network; however, care
      should be taken to ensure that the availability of the building
      management network does not become compromised beyond the ability of
      critical functions to perform adequately.</t>

      <t>In homes, the entertainment network for audio/video streaming and
      gaming has different requirements, where the most important requirement
      is the need for high bandwidth not typically needed for home or building
      control. It is therefore expected that the entertainment network in the
      home will mostly be separate from the control network, as this will
      also lessen the impact on the availability of the control network.</t>

      <section title="Network Topologies">
        <t>In general, the home automation network or building control network
        consists of wired and wireless subnetworks. In large buildings in
        particular, the wireless subnetworks can be connected to an IP
        backbone network where all infrastructure services (e.g.,
        Domain Name System (DNS), automation servers) are located.</t>

        <t>The wireless subnetwork can be configured according to any of the
        following topologies:</t>

        <t><list style="symbols">
          <t>A stand-alone network of 10-100 nodes without a border router.
          This typically occurs in the home with a stand-alone control
          network, in low&nbhy;cost buildings, and during installation of
          high&nbhy;end control systems in buildings.</t>

          <t>A connected network with one border router. This configuration
          will happen in homes where home appliances are controlled from
          outside the home, possibly via a smart phone, and in many building
          control scenarios.</t>

          <t>A connected network with multiple border routers. This will
          typically happen in installations of large buildings.</t>

        </list></t>
        <t>Many of the nodes are battery powered and may be sleeping nodes
        that wake up according to clock signals or external events.</t>

        <t>In a building control network, for a large installation with
        multiple border routers, subnetworks often overlap both
        geographically and from a wireless coverage perspective. Due to
        two purposes of the network -- (i) direct control and
        (ii) monitoring -- there may exist two types of routing
        topologies in a given subnetwork: (i) a tree-shaped collection
        of routes spanning from a central building controller via the
        border router, on to destination nodes in the subnetwork,
        and (ii) a flat, undirected collection of intra&nbhy;network
        routes between functionally related nodes in the subnetwork.</t>

        <t>The majority of nodes in home and building automation networks are
        typically Class&nbsp;0 devices <xref target="RFC7228"/>, such as
        individual wall switches. Only a few nodes (such as multi-purpose
        remote controls) are more expensive Class&nbsp;1 devices, which can
        afford more memory capacity.</t>

      </section>

      <section title="Traffic Characteristics">
        <t>Traffic may enter the network originating from a central
        controller, or it may originate from an intra-network node.
        The majority of traffic is of a lightweight point-to-point
        control style, e.g., Put&nbhy;Ack or Get&nbhy;Response. There are,
        however, exceptions. Bulk data transfer is used for firmware
        updates and logging, where firmware updates enter the network
        and logs leave the network. Group communication is used for
        service discovery or to control groups of nodes, such as
        light fixtures.</t>

        <t>Often, there is a direct physical relationship between a
        controlling sensor and the controlled equipment. For example,
        the temperature sensor and room controller are located in the
        same room, sharing the same climate conditions. Consequently,
        the bulk of senders and receivers are separated by a distance
        that allows one&nbhy;hop direct path communication. A graph of
        the communication will show several fully connected subsets of
        nodes. However, due to interference, multipath fading,
        reflection, and other transmission mechanisms, the one&nbhy;hop
        direct path may be temporarily disconnected. For reliability
        purposes, it is therefore essential that alternative n&nbhy;hop
        communication routes exist for quick error recovery.
        (See <xref target="com-fail"/> for motivation.)</t>

        <t> Looking over time periods of a day, the networks are very
        lightly loaded. However, bursts of traffic can be generated by,
        for example, incessant pushing of the button of a remote control,
        the occurrence of a defect, and other unforeseen events. Under
        those conditions, the timeliness must nevertheless be maintained.
        Therefore, measures are necessary to remove any unnecessary
        traffic. Short routes are preferred. Long multi-hop routes via the
        border router should be avoided whenever possible.</t>

        <t>Group communication is essential for lighting control. For example,
        once the presence of a person is detected in a given room, lighting
        control applies to that room only, and no other lights should be
        dimmed or switched on/off. In many cases, this means that a multicast
        message with a one&nbhy;hop and two&nbhy;hop radius would suffice
        to control the required lights. The same argument holds for
        Heating, Ventilating, and Air Conditioning (HVAC) and other
        climate-control devices. To reduce network load, it is advisable
        that messages to the lights in a room are not distributed any
        further in the mesh than necessary, based on intended receivers.</t>

        <t><xref target="Office-Light"/> provides an example of an
        office space, and <xref target="OccuSwitch"/> describes the
        current use of wireless lighting control products.</t>

        <section anchor="SEC_General" title="General">
          <t>Although air conditioning and other environmental-control
          applications may accept response delays of tens of seconds or
          longer, alarm and light control applications may be regarded as soft
          real&nbhy;time systems. A slight delay is acceptable, but the
          perceived quality of service degrades significantly if response
          times exceed 250&nbsp;ms. If the light does not turn on at
          short notice, a user may activate the controls again, thus
          causing a sequence of commands such as Light{on,off,on,off,...}
          or Volume{up,up,up,up,up,...}. In addition, the repetitive
          sending of commands creates an unnecessary loading of the
          network, which in turn increases the poor responsiveness of
          the network.</t>

        </section>

        <section title="Source-Sink (SS) Communication Paradigm">
          <t>This paradigm translates to many sources sending messages to the
          same sink, sometimes reachable via the border router. As such,
          Source&nbhy;Sink (SS) traffic can be present in home and building
          networks. The traffic may be generated by environmental sensors
          (often present in a wireless subnetwork) that push periodic
          readings to a central server. The readings may be used for pure
          logging or, more often, processed to adjust light, heating, and
          ventilation. Alarm sensors may also generate SS&nbhy;style
          traffic. The central server in a home automation network will
          be connected mostly to a wired network segment of the home
          network, although it is likely that cloud services will also be
          used. The central server in a building automation network may be
          connected to a backbone or placed outside the building.</t>

          <t>With regard to message latency, most SS transmissions can
          tolerate worst-case delays measured in tens of seconds. Fire
          detectors, however, represent an exception; for example, special
          provisions with respect to the location of the fire detectors and
          smoke dampers need to be put in place to meet stringent delay
          requirements that are measured in seconds.</t>

        </section>

        <section anchor="SEC_PubSubCommunication"
         title="Publish-Subscribe (PS, or Pub/Sub) Communication Paradigm">
          <t>This paradigm translates to a number of devices expressing their
          interest in a service provided by a server device. For example, a
          server device can be a sensor delivering temperature readings on the
          basis of delivery criteria, like changes in acquisition value or age
          of the latest acquisition. In building automation networks, this
          paradigm may be closely related to the SS paradigm, given that
          servers, which are connected to the backbone or outside the
          building, can subscribe to data collectors that are present at
          strategic places in the building automation network. The use of PS
          will probably differ significantly from installation to
          installation.</t>

        </section>

        <section anchor="SEC_PeerToPeerCommunication"
         title="Peer-to-Peer (P2P) Communication Paradigm">
          <t> This paradigm translates to a device transferring data to
          another device often connected to the same subnetwork.
          Peer-to-Peer (P2P) traffic is a common traffic type in home
          automation networks. Most building automation networks rely on
          P2P traffic as described in the next paragraph. Other
          building automation networks rely on P2P control traffic
          between controls and a local controller box for advanced
          group control. A local controller box can be further connected
          to service control boxes, thus generating more SS or PS
          traffic.</t>

          <t>P2P traffic is typically generated by remote controls and wall
          controllers that push Control Messages directly to light or heat
          sources. P2P traffic has a stringent requirement for low latency,
          since P2P traffic often carries application messages that are
          invoked by humans. As mentioned in <xref target="SEC_General"/>,
          application messages should be delivered within a few hundred
          milliseconds, even when connections fail momentarily.</t>

        </section>

        <section title="Peer-to-Multipeer (P2MP) Communication Paradigm">
          <t> This paradigm translates to a device sending a message as many
          times as there are destination devices. Peer-to-Multipeer (P2MP)
          traffic is common in home and building automation networks.
          Often, a thermostat in a living room responds to temperature
          changes by sending temperature acquisitions to several fans
          and valves consecutively. This paradigm is also closely related
          to the PS paradigm in the case where a single server device has
          multiple subscribers.</t>

        </section>

        <section title="Additional Considerations: Duocast and N-Cast">
          <t>This paradigm translates to a device sending a message to many
          destinations in one network transfer invocation. Multicast is
          well suited for lighting where a presence sensor sends a presence
          message to a set of lighting devices. Multicast increases the
          probability that the message is delivered within strict time
          constraints. The recommended multicast algorithm (e.g., <xref
          target="RFC7731"/>) provides a mechanism for delivering messages
          to all intended destinations.</t>

        </section>

        <section title="RPL Applicability per Communication Paradigm">
          <t> In the case of the SS paradigm applied to a wireless subnetwork
          to a server reachable via a border router, the use of RPL <xref
          target="RFC6550"/> in non-storing mode is appropriate. Given the low
          resources of the devices, source routing will be used from the
          border router to the destination in the wireless subnetwork for
          messages generated outside the mesh network. No specific timing
          constraints are associated with the SS&nbhy;type messages, so
          network repair does not violate the operational constraints.
          When no SS traffic takes place, it is good practice to load
          only RPL code that enables the P2P mode of operation
          <xref target="RFC6997"/> to reduce the code size and satisfy
          memory requirements.</t>

          <t>To assure responsiveness, P2P-RPL <xref target="RFC6997"/> is
          required for all P2P and P2MP traffic taking place between nodes
          within a wireless subnetwork (excluding the border router).
          Source and destination devices are typically physically close,
          based on room layout. Consequently, most P2P and P2MP traffic is
          one&nbhy;hop or two&nbhy;hop traffic.
          <xref target="RPL_shortcomings"/> identifies shortcomings of
          using RPL for this type of communication; these shortcomings
          are counteracted through the use of P2P&nbhy;RPL.
          <xref target="com-fail"/> explains why reliability measures
          such as multipath routing are necessary even when one&nbhy;hop
          communication dominates.</t>

          <t>Examples of additional advantages of P2P-RPL for home and
          building automation networks are as follows:</t>

          <t><list style="symbols">
            <t>Individual wall switches are typically inexpensive
            Class&nbsp;0 devices <xref target="RFC7228"/> with extremely
            low memory capacities. Multi-purpose remote controls for use
            in a home environment typically have more memory, but such
            devices are asleep when there is no user activity. P2P&nbhy;RPL
            reactive discovery allows a node to wake up and find new routes
            within a few seconds, while memory-constrained nodes only
            have to keep routes to relevant targets.</t>

            <t>The reactive discovery features of P2P-RPL ensure that
            commands are normally delivered within the 250&nbsp;ms time
            window. When connectivity needs to be restored, discovery
            is typically completed within seconds. In most cases, an
            alternative route (a route that was discovered earlier)
            will work and route rediscovery is not necessary.</t>

            <t>Broadcast storms typically associated with route discovery
            for the Ad&nbsp;hoc On&nbhy;Demand Distance Vector
            (AODV) <xref target="RFC3561"/> are less disruptive for
            P2P&nbhy;RPL. P2P&nbhy;RPL has a "Stop" bit, which is
            set by the target of a route discovery to notify all other nodes
            that no more Destination-Oriented Directed Acyclic Graph (DODAG)
            Information Object (DIO) messages should be forwarded for this
            temporary DAG. Something that looks like a broadcast storm may
            happen when no target is responding; however, in this case, the
            Trickle suppression mechanism kicks in, limiting the number
            of DIO forwards in dense networks.</t>

          </list></t>
          <t>Due to the limited memory of the majority of devices,
          P2P&nbhy;RPL SHOULD be deployed with source routing in
          non&nbhy;storing mode, as explained in
          <xref target="sec-storing"/>.</t> 

          <t>Multicast with the Multicast Protocol for Low-Power and Lossy
          Networks (MPL) <xref target="RFC7731"/> is preferably deployed for
          N-cast over the wireless network. Configuration constraints that are
          necessary to meet reliability and timeliness with MPL are discussed
          in <xref target="sec-multicast"/>.</t>

        </section>
      </section>

      <section anchor="L2-app" title="Layer 2 Applicability">
        <t>This document applies to <xref target="IEEE802.15.4"/> and <xref
        target="G.9959"/>, which are adapted to IPv6 by the adaptation layers
        <xref target="RFC4944"/> and <xref target="RFC7428"/>. Other
        Layer 2 technologies, accompanied by an "IP-over-Foo"
        specification, are also relevant, provided there is no frame size
        issue and there are link&nbhy;layer acknowledgements.</t>

        <t>The above-mentioned adaptation layers leverage on the
        compression capabilities of <xref target="RFC6554"/> and <xref
        target="RFC6282"/>. Header compression allows small IP packets to
        fit into a single Layer 2 frame, even when source routing is
        used. A network diameter limited to five hops helps to achieve
        this, even while using source routing.</t>

        <t>Dropped packets are often experienced in the targeted
        environments. Internet Control Message Protocol (ICMP), User
        Datagram Protocol (UDP), and even Transmission Control Protocol
        (TCP) flows may benefit from link&nbhy;layer unicast
        acknowledgements and retransmissions. Link&nbhy;layer unicast
        acknowledgements SHOULD be enabled when
        <xref target="IEEE802.15.4"/> or <xref target="G.9959"/> is used
        with RPL and P2P&nbhy;RPL.</t>

      </section>
    </section>

    <section title="Using RPL to Meet Functional Requirements">
      <t>Several features required by <xref target="RFC5826"/> and
      <xref target="RFC5867"/> challenge the P2P paths provided by RPL.
      <xref target="RPL_shortcomings"/> reviews these challenges. In
      some cases, a node may need to spontaneously initiate the
      discovery of a path towards a desired destination that is neither
      the root of a DAG nor a destination originating
      Destination Advertisement Object (DAO) signaling. Furthermore,
      P2P paths provided by RPL are not satisfactory in all cases
      because they involve too many intermediate nodes before reaching
      the destination.</t>

      <t>P2P-RPL <xref target="RFC6997"/> SHOULD be used in home automation
      and building control networks, as traffic of a point-to-point style
      is substantial and route repair needs to be completed within
      seconds. P2P&nbhy;RPL provides a reactive mechanism for quick,
      efficient, and root-independent route discovery/repair. The use
      of P2P&nbhy;RPL furthermore allows data traffic to avoid having to
      go through a central region around the root of the tree and
      drastically reduces path length <xref target="SOFT11"/>
      <xref target="INTEROP12"/>. These characteristics are desirable
      in home and building automation networks because they substantially
      decrease unnecessary network congestion around the root of the tree.</t>

      <t> When more reliability is required, P2P-RPL enables the
      establishment of multiple independent paths. For one&nbhy;hop
      destinations, this means that one one&nbhy;hop communication and a
      second two&nbhy;hop communication take place via a neighboring node.
      Such a pair of redundant communication paths can be achieved by
      using MPL, where the source is an MPL Forwarder while a second
      MPL Forwarder is one&nbsp;hop away from both the source and the
      destination node. When the source multicasts the message, it may be
      received by both the destination and the second MPL Forwarder. The
      second MPL Forwarder forwards the message to the destination, thus
      providing two routes from sender to destination.</t>

      <t>To provide more reliability with multiple paths, P2P&nbhy;RPL
      can maintain two independent P2P source routes per destination, at
      the source. Good practice is to use the paths alternately to assess
      their existence. When one P2P path has failed (possibly only
      temporarily), as described in <xref target="com-fail"/>, the
      alternative P2P path can be used without discarding the failed
      path. The failed P2P path, unless proven to work again, can be
      safely discarded after a timeout (typically 15&nbsp;minutes). A
      new route discovery is done when the number of P2P paths is exhausted
      due to persistent link failures.</t>

    </section>

    <section title="RPL Profile">
      <t>P2P-RPL SHOULD be used in home automation and building control
      networks. Its reactive discovery allows for low application response
      times, even when on-the-fly route repair is needed. Non-storing mode
      SHOULD be used to reduce memory consumption in repeaters with
      constrained memory when source routing is used.</t>


      <section title="RPL Features">
        <t> An important constraint on the application of RPL is the presence
        of sleeping nodes.</t>

        <t>For example, in a stand-alone network, the master node (or
        coordinator) providing the logical Layer 2 identifier and unique node
        identifiers to connected nodes may be a remote control that returns
        to sleep once new nodes have been added. Due to the absence of the
        border router, there may be no global routable prefixes at
        all. Likewise, there may be no authoritative always-on root node,
        since there is no border router to host this function.</t>

        <t>In a network with a border router and many sleeping nodes, there
        may be battery-powered sensors and wall controllers configured to
        contact other nodes in response to events and then return to
        sleep. Such nodes may never detect the announcement of new prefixes
        via multicast.</t>

        <t>In each of the above-mentioned constrained deployments, a
        link&nbhy;layer node (e.g., coordinator or master) SHOULD assume
        the role of an authoritative root node, transmitting unicast
        Router Advertisement (RA) messages with a Unique Local Address (ULA)
        prefix information option to nodes during the joining process to
        prepare the nodes for a later operational phase, where a
        border router is added.</t>

        <t>A border router SHOULD be designed to be aware of sleeping nodes in
        order to support the distribution of updated global prefixes to such
        sleeping nodes.</t>


        <section title="RPL Instances">
          <t>When operating P2P-RPL on a stand-alone basis, there is no
          authoritative root node maintaining a permanent RPL DODAG. A
          node MUST be able to join at least one RPL Instance, as a new,
          temporary instance is created during each P2P&nbhy;RPL route
          discovery operation. A node MAY be designed to join multiple
          RPL Instances.</t>

        </section>

        <section anchor="sec-storing" title="Storing vs. Non-Storing Mode">
          <t>Non-storing mode MUST be used to cope with the extremely
          constrained memory of a majority of nodes in the network (such as
          individual light switches).</t>

        </section>

        <section title="DAO Policy">
          <t>Nodes send DAO messages to establish downward paths from the
          root to themselves. In order to minimize the power consumption
          overhead associated with path discovery, DAO messages are not
          acknowledged in networks composed of battery-operated field
          devices. The DAO messages build up a source route because the
          nodes MUST be in non&nbhy;storing mode.</t>

          <t>If devices in LLNs participate in multiple RPL Instances and
          DODAGs, both the RPLInstance ID and the DODAGID SHOULD be included
          in the&nbsp;DAO.</t>

        </section>

        <section title="Path Metrics">
          <t>Expected Transmission Count (ETX) is the RECOMMENDED
          metric. <xref target="RFC6551"/> provides other options.</t>

          <t> Packets from asymmetric and/or unstable links SHOULD be deleted
          at Layer&nbsp;2.</t>

        </section>

        <section title="Objective Function">
          <t>Objective Function Zero (OF0) <xref target="RFC6552"/> MUST be
          the Objective Function. Other Objective Functions MAY be used
          when dictated by circumstances.</t>

        </section>

        <section title="DODAG Repair">
          <t>Since P2P-RPL only creates DODAGs on a temporary basis during
          route repair or route discovery, there is no need to repair
          DODAGs.</t>

          <t>For SS traffic, local repair is sufficient. The accompanying
          process is known as "poisoning" and is described in
          Section&nbsp;8.2.2.5 of <xref target="RFC6550"/>. Given that
          the majority of nodes in the building do not physically move
          around, creating new DODAGs should not happen frequently.</t>

        </section>

        <section anchor="sec-multicast" title="Multicast">
          <t>Commercial lighting deployments may have a need for multicast
          to distribute commands to a group of lights in a timely
          fashion. Several mechanisms exist for achieving such functionality;
          <xref target="RFC7731"/> is the RECOMMENDED protocol for home and
          building deployments. This section relies heavily on the conclusions
          of <xref target="RT-MPL"/>.</t>

          <t>At reception of a packet, the MPL Forwarder starts a series of
          consecutive Trickle timer intervals, where the first interval has a
          minimum size of Imin. Each consecutive interval is twice as long as
          the former, with a maximum value of Imax. There is a maximum number
          of intervals given by max_expiration. For each interval of length I,
          a time t is randomly chosen in the period [I/2, I]. For a given
          packet, p, MPL counts the number of times it receives p during the
          period [0, t] in a counter c. At time t, MPL rebroadcasts p when
          c&nbsp;&lt;&nbsp;k, where k is a predefined constant with a
          value k &gt; 0.</t>

          <t>The density of forwarders and the frequency of message
          generation are important aspects to obtain timeliness during
          control operations. A high frequency of message generation can
          be expected when a remote-control button is incessantly
          pressed or when alarm situations arise.</t>

          <t>Guaranteeing timeliness is intimately related to the density
          of the MPL routers. In ideal circumstances, the message is
          propagated as a single wave through the network, such that
          the maximum delay is related to the number of hops times the
          smallest repetition interval of MPL. Each forwarder that
          receives the message passes the message on to the next hop by
          repeating the message. When several copies of a message reach
          the forwarder, it is specified that the copy need not be
          repeated. Repetition of the message can be inhibited by a small
          value of k. To assure timeliness, the chosen value of k should be
          high enough to make sure that messages are repeated at the
          first arrival of the message in the forwarder. However, a network
          that is too dense leads to a saturation of the medium that can only
          be prevented by selecting a low value of k. Consequently, timeliness
          is assured by choosing a relatively high value of k but assuring at
          the same time a low enough density of forwarders to reduce the risk
          of medium saturation. Depending on the reliability of the network
          links, it is advisable to configure the density of the network
          such that at least two forwarders per hop repeat messages to
          the same set of destinations.</t>

          <t>There are no rules about selecting forwarders for MPL. In
          buildings with central management tools, the forwarders can be
          selected, but at the time of this writing it is not possible
          to automatically configure the forwarder topology in the home.</t>

        </section>

        <section title="Security">
          <t>RPL MAY use unsecured RPL messages to reduce message size. If
          there is a single node that uses unsecured RPL messages, link-layer
          security MUST be used on all nodes. Therefore, all RPL messages MUST
          be secured using:</t>

          <t><list style="symbols">
            <t>RPL message security, or</t>
            <t>Link-layer security, or</t>
            <t>Both RPL message security and link-layer security</t>
          </list></t>
          <t>A symmetric key is used to secure a RPL message using either RPL
          message security or link-layer security. The symmetric key MUST be
          distributed or established in a secure fashion. There may be more
          than one symmetric key in use by any node at any one time. The same
          symmetric key MUST NOT be used for both RPL message security and
          link-layer security between two peer nodes.</t>

          <section title="Symmetric Key Distribution" anchor="SYM">
            <t>The scope of symmetric key distribution MUST be no greater than
            the network itself, i.e., a group key. This document describes what
            needs to be implemented to meet this requirement. The scope of
            symmetric key distribution MAY be smaller than the network -- for
            example:</t>

            <t><list style="symbols">
              <t>A pairwise symmetric key between two peers.</t>
              <t>A group key shared between a subset of nodes in the
              network.</t>

            </list></t>
          </section>
          <section anchor="sec-symkey-dist"
           title="Symmetric Key Distribution Mechanism">
            <t>The authentication mechanism as described in
            Section&nbsp;6.9 of <xref target="ZigBeeIP"/> SHALL be used
            to securely distribute a network-wide symmetric key.</t>

            <t>The purpose of the authentication procedure is to provide
            mutual authentication resulting in:</t>

            <t><list style="symbols">
              <t>Preventing untrusted nodes without appropriate credentials
              from joining the trusted network.</t>

              <t>Preventing trusted nodes with appropriate credentials from
              joining an untrusted network.</t>

            </list></t>
            <t>There is an Authentication Server, which is responsible for
            authenticating the nodes on the network. If the authentication is
            successful, the Authentication Server sends the network security
            material to the joining node through the Protocol for
            Carrying Authentication for Network Access (PANA) <xref
            target="RFC5191"/> <xref target="RFC6345"/>. The joining node
            becomes a full participating node in the network and is able to
            apply Layer 2 security to RPL messages using the distributed
            network key.</t>

            <t>The joining node does not initially have access to the network
            security material. Therefore, it is not able to apply
            Layer 2 security to the packets exchanged during the
            authentication process. The enforcement point rules at the
            edge of the network ensure that the packets involved in PANA
            authentication are processed even though they are unsecured at
            the Medium Access Control (MAC) layer. The rules also ensure
            that any other incoming traffic that is not secured at the
            MAC layer is discarded and is not forwarded.</t>

            <section title="Authentication Stack" anchor="AUTH">
            <t>Authentication can be viewed as a protocol stack as a layer
            encapsulates the layers above it.

            <list style="symbols">
              <t>Transport Layer Security (TLS) <xref target="RFC5246"/>
              MUST be used at the highest layer of the authentication
              stack and carries the authentication exchange. There is
              one cipher suite based on a Pre&nbhy;Shared Key (PSK)
              <xref target="RFC6655"/> and one cipher suite based on
              Elliptic Curve Cryptography (ECC) <xref target="RFC7251"/>.</t>

              <t>Extensible Authentication Protocol-TLS (EAP&nbhy;TLS)
              <xref target="RFC5216"/> MUST be used at the next layer
              to carry the TLS records for the authentication protocol.</t>

              <t>EAP <xref target="RFC3748"/> MUST be used to provide
              the mechanisms for mutual authentication. EAP requires a
              way to transport EAP packets between the joining node and
              the node on which the Authentication Server resides.
              These nodes are not necessarily in radio range of each
              other, so it is necessary to have multi-hop support in
              the EAP transport method. PANA <xref target="RFC5191"/>
              <xref target="RFC6345"/>, which operates over UDP, MUST be
              used for this purpose. <xref target="RFC3748"/> specifies
              the derivation of a session key using the EAP key
              hierarchy; only the EAP Master Session Key shall be
              derived, as <xref target="RFC5191"/> specifies that it is
              used to set up keys for PANA authentication and encryption.</t>

              <t>PANA <xref target="RFC5191"/> and a PANA relay <xref
              target="RFC6345"/> MUST be used at the next layer:

              <list style="symbols">
                <t>The joining node MUST act as the PANA Client (PaC).</t>

                <t>The parent edge router node MUST act as a PANA Relay
                Element (PRE) according to <xref target="RFC6345"/>,
                unless it is also the Authentication Server. All
                routers at the edge of the network MUST be capable of
                functioning in the PRE role.</t>

                <t>The Authentication Server node MUST act as the PANA
                Authentication Agent (PAA). The Authentication Server
                MUST be able to handle packets relayed according
                to <xref target="RFC6345"/>.</t>

              </list></t>
            </list></t>
            <t>This network authentication process uses link-local IPv6
            addresses for transport between the new node and its parent. If
            the parent is not the Authentication Server, it MUST then relay
            packets from the joining node to the Authentication Server and
            vice versa, using the PANA relay mechanism
            <xref target="RFC6345"/>. The joining node MUST use a
            link&nbhy;local address based on its EUI&nbhy;64 as the
            source address for initial PANA authentication message
            exchanges.</t>

          </section>
          <section title="Applicability Statements" anchor="applic-statements">
            <t>The following applicability statements describe the
            relationship between the various specifications.</t>

            <section title="Applicability Statement for PSK TLS">
              <t><xref target="RFC6655"/> contains Authenticated Encryption
              with Associated Data (AEAD) TLS cipher suites that
              are very similar to <xref target="RFC5487"/>, whose AEAD
              part is detailed in <xref target="RFC5116"/>.
              <xref target="RFC5487"/> references both
              <xref target="RFC5288"/> and the original PSK cipher suite
              document <xref target="RFC4279"/>, which references
              RFC&nbsp;2246, which was eventually replaced by
              <xref target="RFC5246"/>, which defines the
              TLS&nbsp;1.2 messages.</t>

            </section>
            <section title="Applicability Statement for ECC TLS">
              <t><xref target="RFC7251"/> contains AEAD TLS cipher suites
              that are very similar to <xref target="RFC5289"/>, whose
              AEAD part is detailed in <xref target="RFC5116"/>.
              <xref target="RFC5289"/> references the original ECC
              cipher suite document <xref target="RFC4492"/>, which
              references RFC&nbsp;2246, which was eventually replaced by
              <xref target="RFC5246"/>, which defines the
              TLS&nbsp;1.2 messages.</t>

            </section>
            <section title="Applicability Statement for EAP-TLS and PANA">
              <t><xref target="RFC5216"/> specifies how <xref
              target="RFC3748"/> is used to package <xref target="RFC5246"/>
              TLS records into EAP packets. <xref target="RFC5191"/> provides
              transportation for the EAP packets and the network-wide key
              carried in an encrypted Attribute-Value Pair (AVP) as
              specified in <xref target="RFC6786"/>. The proposed
              Pseudorandom Function (PRF) and authentication (AUTH) hashes
              based on SHA&nbhy;256 are represented as specified in
              <xref target="RFC7296"/> and detailed in
              <xref target="RFC4868"/>.</t>

            </section>
          </section>
          <section title="Security Using RPL Message Security">
            <t>If RPL is used with secured messages <xref target="RFC6550"/>,
            the following RPL security parameter values SHOULD be used:

            <list style="symbols">
              <t>Counter is Time (T) flag = 0: Do not use the timestamp in the
              Counter field. Counters based on timestamps are typically more
              applicable to industrial networks, where strict timing
              synchronization between nodes is often implemented. Home and
              building networks typically do not implement such strict timing
              synchronization; therefore, a monotonically increasing counter
              is more appropriate.</t>

              <t>Algorithm = 0: Use Counter with the Cipher Block
              Chaining Message Authentication Code (CBC-MAC Mode) (CCM)
              with AES-128. This is the
              only assigned mode at present.</t>

              <t>Key Identifier Mode (KIM) = 10: Use a group key, Key Source
              present, and Key Index present. Given the relatively confined
              perimeter of a home or building network, a group key is usually
              sufficient to protect RPL messages sent between nodes. The use
              of the Key Source field allows multiple group keys to be used
              within the network.</t>

              <t>Security Level (LVL) = 0: Use MAC-32. This is recommended,
              as integrity protection for RPL messages is the basic
              requirement. Encryption is unlikely to be necessary, given
              the relatively non&nbhy;confidential nature of RPL message
              payloads.</t>

            </list></t>
            </section>
          </section>
        </section>

        <section title="P2P Communications">
          <t><xref target="RFC6997"/> MUST be used to accommodate P2P traffic,
          which is typically substantial in home and building automation
          networks.</t>

        </section>

        <section title="IPv6 Address Configuration">
          <t>Assigned IP addresses MUST be routable and unique within the
          routing domain <xref target="RFC5889"/>.</t>

        </section>
      </section>

      <section title="Layer 2 Features">
        <t>No particular requirements exist for Layer 2, except for those
        cited in the "IP-over-Foo" RFCs (see <xref target="L2-app"/>).</t>


      <section title="Specifics about Layer 2">
          <t>Not applicable</t>
        </section>

        <section title="Services Provided at Layer 2">
          <t>Not applicable</t>
        </section>

        <section title="IPv6 over Low-Power Wireless Personal Area Network (6LoWPAN) Options Assumed">
          <t>Not applicable</t>
        </section>

        <section title="Mesh Link Establishment (MLE) and Other Things">
          <t>Not applicable</t>
        </section>
      </section>

      <section title="Recommended Configuration Defaults and Ranges">
        <t>The following sections describe the recommended parameter values
        for P2P&nbhy;RPL and Trickle. </t>

        <section title="Trickle Parameters">
          <t>Trickle is used to distribute network parameter values to all
          nodes without stringent time restrictions. The recommended Trickle
          parameter values are:

          <list style="symbols">
            <t>DIOIntervalMin 4, which translates to 16 ms</t>
            <t>DIOIntervalDoublings 14</t>
            <t>DIORedundancyConstant 1</t>
          </list></t>

          <t>When a node sends a changed DIO, this is an inconsistency and
          forces the receiving node to respond within Imin. So, when
          something happens that affects the DIO, the change is ideally
          communicated to a node that is n&nbsp;hops away, within
          n times Imin. Often, depending on the node density, packets
          are lost or are not sent, leading to larger delays.</t>

          <t>In general, we can expect DIO changes to propagate within
          1 to 3&nbsp;seconds within the envisaged networks.</t>

          <t>When nothing happens, the DIO sending interval increases to
          4.37&nbsp;minutes, thus drastically reducing the network load.
          When a node does not receive DIO messages for more than
          10&nbsp;minutes, it can safely conclude that the connection with
          other nodes has been lost.</t>

        </section>

        <section title ="Other Parameters">
          <t> This section discusses the P2P-RPL parameters.</t>
          <t>P2P-RPL <xref target="RFC6997"/> provides the features requested
          by <xref target="RFC5826"/> and <xref target="RFC5867"/>.
          P2P&nbhy;RPL uses a subset of the frame formats and features
          defined for RPL <xref target="RFC6550"/> but may be combined
          with RPL frame flows in advanced deployments.</t>

          <t>The recommended parameter values for P2P-RPL are:
          <list style="symbols">
            <t>MinHopRankIncrease 1</t>
            <t>MaxRankIncrease 0</t>
            <t>MaxRank 6</t>
            <t>Objective Function: OF0</t>
          </list></t>
        </section>
      </section>
    </section>

    <section title="MPL Profile">
      <t>MPL is used to distribute values to groups of devices. Using MPL,
      based on the Trickle algorithm, timeliness should also be guaranteed. A
      deadline of 200 ms needs to be met when human action is followed by an
      immediately observable action such as switching on lights. The deadline
      needs to be met in a building where the number of hops from seed to
      destination varies between 1 and 10.</t>


      <section title="Recommended Configuration Defaults and Ranges">
        <section title="Real-Time Optimizations">
          <t>When the network is heavily loaded, MAC delays contribute
          significantly to the end-to-end delays when MPL intervals between
          10 and 100&nbsp;ms are used to meet the 200&nbsp;ms deadline. It is
          possible to set the number of buffers in the MAC to 1 and set
          the number of back&nbhy;off repetitions to 1. The number of
          MPL repetitions compensates for the reduced probability of
          transmission per MAC invocation <xref target="RT-MPL"/>.</t>

          <t>In addition, end-to-end delays and message losses are reduced
          by adding a real-time layer between MPL and MAC to throw away the
          earliest messages (exploiting the MPL message numbering) and favor
          the most recent ones.</t>

        </section>

        <section title="Trickle Parameters">
          <t>This section proposes values for the Trickle parameters used by
          MPL for the distribution of packets that need to meet a 200&nbsp;ms
          deadline. The probability of meeting the deadline is increased by
          (1) choosing a small Imin value, (2) reducing the number of MPL
          intervals, thus reducing the load, and (3) reducing the number of
          MPL Forwarders to also reduce the load.</t>

          <t>The consequence of this approach is that the value of k can be
          larger than 1 because network load reduction is already guaranteed
          by the network configuration.</t>

          <t>Under the condition that the density of MPL repeaters can be
          limited, it is possible to choose low MPL repeat intervals (Imin)
          connected to k values such that k > 1. The minimum value of k is
          related to:

          <list style="symbols">
            <t>The value of Imin. The length of Imin determines the number
            of packets that can be received within the listening period of
            Imin.</t>

            <t>The number of repeaters receiving the broadcast message from
            the same forwarder or seed. These repeaters repeat within the
            same Imin interval, thus increasing the c counter.</t>

          </list></t>
          <t>Within the first MPL interval, a limited number, q, of
          messages can be transmitted. Assuming a 3 ms transmission
          interval, q is given by q&nbsp;=&nbsp;Imin / 3. Assuming that
          at most q message copies can reach a given forwarder within
          the first repeat interval of length Imin, the related MPL
          parameter values are suggested in the following sections.</t>


          <section title="Imin">
            <t>The recommended value is Imin = 10 to 50 ms.</t>

            <t>When the chosen Imin value is much smaller, the
            interference between the copies leads to significant losses,
            given that q is much smaller than the number of repeated
            packets. With much larger intervals, the probability that
            the deadline will be met decreases with increasing hop count.</t>

          </section>

          <section title="Imax">
            <t>The recommended value is Imax = 100 to 400 ms. </t>
            <t>The value of Imax is less important than the value of
            max_expiration. Given an Imin value of 10 ms, the third
            MPL interval has a value of 10 * 2 * 2 = 40 ms. When Imin
            has a value of 40 ms, the third interval has a value of 160 ms.
            Given that more than three intervals are unnecessary,
            Imax does not contribute much to performance.</t>

          </section>
        </section>

        <section title="Other Parameters">
          <t>Other parameters are the k parameter and the max_expiration
          parameter.</t>

          <t>k &gt; q (see condition above). Under this condition, and for
          a small Imin value, a value of k = 2 or k = 3 is usually
          sufficient to minimize the losses of packets in the first
          repeat interval.</t>

          <t>max_expiration = 2 - 4. Higher values lead to more network load
          while generating copies that will probably not meet their
          deadline.</t>

        </section>
      </section>
    </section>

    <section title="Manageability Considerations">
      <t>At this time, it is not clear how homenets will be managed.
      Consequently, it is not clear which tools will be used and which
      parameters must be visible for management.</t>

      <t>In building control, management is mandatory. It is expected that
      installations will be managed using the set of currently available
      tools (including IETF tools like Management Information Base (MIB)
      modules, Network Configuration Protocol (NETCONF) modules,
      Dynamic Host Configuration Protocol (DHCP), and others), with large
      differences between the ways an installation is managed.</t>

    </section>

    <section anchor="SEC-CON" title="Security Considerations">
      <t>This section refers to the security considerations of <xref
      target="RFC6997"/>, <xref target="RFC6550"/>, and
      <xref target="RFC7731"/>, as well as some attacks
      and countermeasures as discussed in
      Sections&nbsp;6 and 7, respectively, of <xref target="RFC7416"/>.</t>

      <t>Communications network security is based on providing integrity
      protection and encryption to messages. This can be applied at various
      layers in the network protocol stack, based on using various
      credentials and a network identity.</t>

      <t>The credentials that are relevant in the case of RPL are (i) the
      credential used at the link layer in the case where
      link&nbhy;layer security is applied (see <xref target="SEC-LINK"/>) or
      (ii) the credential used for securing RPL messages. In both cases,
      the assumption is that the credential is a shared key. Therefore,
      there MUST be a mechanism in place that allows secure distribution of
      a shared key and configuration of a network identity. Both MAY be
      done using (i)&nbsp;pre&nbhy;installation using an out-of-band method,
      (ii)&nbsp;secure delivery when a device is introduced into the
      network, or (iii)&nbsp;secure delivery by a trusted neighboring
      device, as described in <xref target="SYM"/>. The shared key MUST be
      stored in a secure fashion that will make it difficult to be read
      by an unauthorized party.</t>

      <t>This document mandates that a Layer 2 mechanism be used during
      initial and incremental deployment. Please see the following
      sections.</t>

      <section anchor="SEC-LINK"
       title="Security Considerations during Initial Deployment">
        <t>Wireless mesh networks are typically secured at the link layer in
        order to prevent unauthorized parties from accessing the information
        exchanged over the links. It is a basic practice to create a network
        of nodes that share the same keys for link&nbhy;layer security and
        exclude nodes sending unsecured messages. With per-message data origin
        authentication, it is possible to prevent unauthorized nodes
        from joining the mesh.</t>

        <t>At initial deployment, the network is secured by consecutively
        securing nodes at the link layer, thus building a network of secured
        nodes. <xref target="sec-symkey-dist" /> describes a mechanism for
        building a network of secured nodes.</t>

        <t>This document does not specify a multicast security
        solution. Networks deployed with this specification will depend upon
        Layer 2 security to prevent outsiders from sending multicast
        traffic. It is recognized that this does not protect this control
        traffic from impersonation by already-trusted devices. This is an
        area for a future specification.</t>

        <t>For building control, an installer will use an installation tool
        that establishes a secure communication path with the joining node. It
        is recognized that the recommendations for initial deployment as
        discussed in this section do not cover all building requirements,
        such as selecting -- independent of network topology -- the node to
        be secured.</t>

        <t> It is expected that a set of protocol combinations will evolve
        within currently existing alliances of building control
        manufacturers. Each set satisfies the installation requirements of
        installers, operators, and manufacturers of building control networks
        in a given installation context, e.g., lighting deployment in
        offices, HVAC installation, incremental addition of equipment in
        homes, and others.</t>

        <t>In the home, nodes can be visually inspected by the home owner.
        Also, a simple procedure, e.g., pushing buttons simultaneously on
        an already-secured device and an unsecured joining device, is
        usually sufficient to ensure that the unsecured joining device
        is authenticated securely, configured securely, and paired
        appropriately.</t>

        <t>This recommendation is in line with the countermeasures described
        in Section&nbsp;7.1 of <xref target="RFC7416"/>.</t>

      </section>

      <section anchor="SEC-DIST"
       title="Security Considerations during Incremental Deployment">
        <t>Once a network is operational, new nodes need to be added, or nodes
        fail and need to be replaced. When a new node needs to be added to the
        network, the new node is added to the network via an assisting node
        in the manner described in <xref target="SEC-LINK"/>.</t>

        <t> On detection of a compromised node, all trusted nodes need to
        have their symmetric keys that are known to be shared with the
        compromised node rekeyed, and the trusted network is built up
        as described in <xref target="SEC-LINK"/>.</t>

      </section>

      <section title="Security Considerations for P2P Implementations">

        <t>Refer to the security considerations of <xref target="RFC6997"/>.
        </t>

      </section>

      <section title="MPL Routing">
        <t>The routing of MPL is determined by the enabling of the interfaces
        for specified multicast addresses. The specification of these
        addresses can be done via a Constrained Application Protocol (CoAP)
        application as specified in <xref target="RFC7390"/>. An alternative
        is the creation of an MPL MIB and the use of the
        Simple Network Management Protocol (SNMPv3) <xref target="RFC3411"/>
        or equivalent techniques to specify the multicast addresses in the
        MIB. For secure dissemination of MPL packets, Layer 2
        security SHOULD be used, and the configuration of multicast
        addresses as described in this section MUST be secure.</t>

      </section>

      <section title="RPL Security Features">
        <t>This section refers to the structure of
        Section&nbsp;8 ("RPL Security Features") of <xref target="RFC7416"/>.
        <xref target="RFC7416"/> provides a thorough analysis of security
        threats and proposed countermeasures relevant to RPL
        and&nbsp;MPL.</t>

        <t>In accordance with Section&nbsp;8.1 ("Confidentiality Features")
        of <xref target="RFC7416"/>, RPL message security implements payload
        protection, as explained in <xref target="SEC-CON"/> of this
        document. The attributes for key length and lifetime of the keys
        depend on operational conditions, maintenance, and installation
        procedures.</t>

        <t>Sections <xref target="SEC-LINK" format="counter"/>
        and <xref target="SEC-DIST" format="counter"/> of this
        document recommend link-layer security to assure integrity in
        accordance with Section&nbsp;8.2 ("Integrity Features") of
        <xref target="RFC7416"/>.</t>

        <t>The provision of multiple paths recommended in
        Section&nbsp;8.3 ("Availability Features") of <xref target="RFC7416"/>
        is also recommended from a reliability point of view. Randomly
        choosing paths MAY be supported.</t>

        <t>A mechanism for key management, as discussed in
        Section&nbsp;8.4 ("Key Management") of <xref target="RFC7416"/>,
        is provided in <xref target="sec-symkey-dist" /> of this
        document.</t>
      </section>
    </section>

    <section title="Other Related Protocols">
      <t>Application and transport protocols used in home and building
      automation domains are expected to mostly consist of CoAP over UDP,
      or equivalents. Typically, UDP is used for IP transport to keep down
      the application response time and bandwidth overhead. CoAP is used
      at the application layer to reduce memory footprint and bandwidth
      requirements.</t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      &RFC2119;
      &RFC3748;
      &RFC4279;
      &RFC4492;
      &RFC4868;
      &RFC4944;
      &RFC5116;
      &RFC5191;
      &RFC5216;
      &RFC5246;
      &RFC5288;
      &RFC5289;
      &RFC5487;
      &RFC5548;
      &RFC5673;
      &RFC5826;
      &RFC5867;
      &RFC6282;
      &RFC6345;
      &RFC6550;
      &RFC6551;
      &RFC6554;
      &RFC6655;
      &RFC6786;
      &RFC6997;
      &RFC6998;
      &RFC7102;
      &RFC7251;
      &RFC7296;
      &RFC7416;

<!-- draft-ietf-roll-trickle-mcast (RFC 7731) -->
<reference anchor='RFC7731' target="http://www.rfc-editor.org/info/rfc7731">
<front>
<title>Multicast Protocol for Low-Power and Lossy Networks (MPL)</title>
<author initials='J' surname='Hui' fullname='Jonathan Hui'>
    <organization />
</author>
<author initials='R' surname='Kelsey' fullname='Richard Kelsey'>
    <organization />
</author>
<date month='February' year='2016' />
</front>
<seriesInfo name='RFC' value='7731' />
<seriesInfo name="DOI" value="10.17487/RFC7731"/>
</reference>

  <reference anchor="IEEE802.15.4"
    target="http://ieeexplore.ieee.org/servlet/opac?punumber=6012485">
  <front>
  <title>IEEE Standard for Local and metropolitan area networks--Part 15.4:
 Low-Rate Wireless Personal Area Networks (LR-WPANs)</title>
  <author>
   <organization>IEEE</organization>
  </author>
  <date />
  </front>
  <seriesInfo name='IEEE' value='802.15.4' />
  <seriesInfo name='DOI' value='10.1109/ieeestd.2011.6012487' />
  </reference>

  <reference anchor="G.9959" target="http://www.itu.int/rec/T-REC-G.9959">
    <front>
      <title>Short range narrow-band digital radiocommunication
transceivers - PHY, MAC, SAR and LLC layer specifications</title>
          <author>
           <organization abbrev='ITU-T'>
            International Telecommunication Union
           </organization>
          </author>
          <date month="January" year="2015"/>
         </front>
        <seriesInfo name="ITU-T Recommendation" value="G.9959"/>
      </reference>
    </references>

    <references title="Informative References">
      &RFC3411;
      &RFC3561;
      &RFC5889;
      &RFC6552;
      &RFC7228;
      &RFC7390;
      &RFC7428;

      <reference anchor="SOFT11">
        <front>
          <title>The P2P-RPL Routing Protocol for IPv6 Sensor Networks:
            Testbed Experiments</title>
          <author fullname="E. Baccelli" initials="E." surname="Baccelli"/>
          <author fullname="M. Philipp" initials="M." surname="Philipp"/>
          <author fullname="M.Goyal" initials="M." surname="Goyal"/>
          <date day="8" month="September" year="2011"/>
        </front>
        <seriesInfo name="Proceedings of the 19th Annual" value="Conference on
Software Telecommunications and Computer Networks, Split, Croatia"/>
      </reference>

      <reference anchor="INTEROP12">
        <front>
          <title>Report on P2P-RPL Interoperability Testing</title>
          <author fullname="M. Philipp" initials="M." surname="Philipp"/>
          <author fullname="E. Baccelli" initials="E." surname="Baccelli"/>
          <author fullname="A. Brandt" initials="A." surname="Brandt"/>
          <author fullname="H. Valev" initials="H." surname="Valev"/>
          <author fullname="J. Buron" initials="J." surname="Buron"/>
          <date day="20" month="January" year="2012"/>
        </front>
        <seriesInfo name="INRIA Research Report" value="RR-7864"/>
      </reference>

      <reference anchor="RT-MPL" target="http://www.vanderstok.org/papers/Real-time-MPL.pdf">
        <front>
          <title>Real-Time multicast for wireless mesh networks using
            MPL</title>
          <author fullname="P. van der Stok" initials="P." surname="van der
           Stok"/>
          <date month="April" year="2014"/>
        </front>
        <seriesInfo name="White" value="paper"/>
      </reference>

      <reference anchor="OccuSwitch"
         target="http://www.philipslightingcontrols.com/assets/cms/uploads/files/osw/MK_OSWNETBROC_5.pdf">
        <front>
          <title>OccuSwitch Wireless (brochure)</title>
          <author fullname="Philips lighting Electronics">
           <organization>Philips lighting Electronics</organization>
          </author>
          <date month="May" year="2012"/>
        </front>
      </reference>

      <reference anchor="Office-Light"
 target="http://www.daintree.net/wp-content/uploads/2014/02/clanton_lighting_control_report_0411.pdf">
        <front>
          <title>Wireless Lighting Control - A Life Cycle Cost Evaluation of
Multiple Lighting Control Strategies </title>
          <author fullname="Clanton and Associates, Inc.">
            <organization>Clanton and Associates, Inc.</organization>
          </author>
          <date month="February" year="2014"/>
        </front>
      </reference>

      <reference anchor="RTN2011">
        <front>
          <title>Real-time routing for low-latency 802.15.4 control
            networks</title>
          <author fullname="K. Holtman" initials="K." surname="Holtman"/>
          <author fullname="P. van der Stok" initials="P."
 surname="van der Stok"/>
          <date day="5" month="July" year="2011"/>
        </front>
        <seriesInfo name="23rd Euromicro Conference on Real-Time Systems,"
 value="Porto, Portugal"/>
      </reference>

      <reference anchor="MEAS">
        <front>
          <title>Connectivity loss in large scale IEEE 802.15.4 network</title>
          <author fullname="K. Holtman" initials="K." surname="Holtman"/>
          <date month="November" year="2013"/>
        </front>
        <seriesInfo name="Private" value="Communication"/>
      </reference>

      <reference anchor="BC-Survey">
        <front>
          <title>Communication Systems for Building Automation and
            Control</title>
          <author fullname="Wolfgang Kastner" initials="W." surname="Kastner"/>
          <author fullname="Georg Neugschwandtner" initials="G."
 surname="Neugschwandtner"/>
          <author fullname="Stefan Soucek" initials="S." surname="Soucek"/>
          <author fullname="Michael Newmann" initials="H.M." surname="Newmann"/>
          <date day="6" month="June" year="2005"/>
        </front>
        <seriesInfo name="Proceedings of the IEEE," value="Vol. 93, No. 6"/>
        <seriesInfo name="DOI" value="10.1109/JPROC.2005.849726"/>
      </reference>

      <reference anchor="ZigBeeIP" target="http://www.zigbee.org/">
        <front>
          <title>ZigBee IP specification</title>
          <author fullname="ZigBee Alliance">
            <organization>ZigBee Alliance</organization>
          </author>
          <date month="March" year="2014"/>
        </front>
        <seriesInfo name="ZigBee document" value="095023r34"/>
      </reference>

    </references>

    <section anchor="RPL_shortcomings" title="RPL Shortcomings in Home and
Building Deployments">

      <section title="Risk of Undesirable Long P2P Routes">
        <t>The DAG, being a tree structure, is formed from a root. If nodes
        residing in different branches need to communicate internally,
        DAG mechanisms provided in RPL <xref target="RFC6550"/> will
        propagate traffic towards the root, potentially all the way to
        the root, and down along another branch <xref target="RFC6998"/>.
        In a typical example, two nodes could reach each other via only
        two router nodes, but in some unfortunate cases, RPL may send
        traffic three hops up and three hops down again. This leads to
        several undesirable phenomena, as described in the following
        sections.</t>

        <section title="Traffic Concentration at the Root">
          <t>If many P2P data flows have to move up towards the root to get
          down again in another branch, there is an increased risk of
          congestion the nearer to the root of the DAG the data flows. Due to
          the broadcast nature of radio frequency (RF) systems, any child
          node of the root is not only directing RF power downwards in
          its sub&nbhy;tree but just as much upwards towards the root,
          potentially jamming other MP2P traffic leaving the tree or
          preventing the root of the DAG from sending P2MP traffic into
          the DAG because the listen-before-talk link-layer protection
          kicks in.</t>

        </section>

        <section title="Excessive Battery Consumption in Source Nodes">
          <t>Battery-powered nodes originating P2P traffic depend on the route
          length. Long routes cause source nodes to stay awake for longer
          periods before returning to sleep. Thus, a longer route translates
          proportionally (more or less) into higher battery consumption.</t>

        </section>
      </section>

      <section title="Risk of Delayed Route Repair">
        <t>The RPL DAG mechanism uses DIO and DAO messages to monitor the
        health of the DAG. On rare occasions, changed radio conditions may
        render routes unusable just after a destination node has returned a
        DAO indicating that the destination is reachable. Given enough time,
        the next Trickle timer-controlled DIO/DAO update will eventually
        repair the broken routes; however, this may not occur in a timely
        manner appropriate to the application. In an apparently stable DAG,
        Trickle&nbsp;timer dynamics may reduce the update rate to a few times
        every hour. If a user issues an actuator command, e.g., light on in
        the time interval between the time that the last DAO message was
        issued the destination module and the time that one of the parents
        sends the next DIO, the destination cannot be reached. There is no
        mechanism in RPL to initiate the restoration of connectivity in a
        reactive fashion. The consequence is a broken service in home and
        building applications.</t>

        <section title="Broken Service">
          <t>Experience from the telecom industry shows that if the voice
          delay exceeds 250&nbsp;ms, users start getting confused,
          frustrated, and/or annoyed. In the same way, if the light
          does not turn on within the same period of time, a home control
          user will activate the controls again, causing a sequence of
          commands such as Light{on,off,off,on,off,...} or
          Volume{up,up,up,up,up,...}. &nbsp;Whether the outcome is nothing
          or some unintended response, this is unacceptable. A controlling
          system must be able to restore connectivity to recover from the
          error situation. Waiting for an unknown period of time is not
          an option. Although this issue was identified during the P2P
          analysis, it applies just as well to application scenarios
          where an IP application outside the LLN controls actuators,
          lights, etc.</t>

        </section>
      </section>
    </section>

    <section anchor="com-fail" title="Communication Failures">
      <t>Measurements of connectivity between neighboring nodes are
      discussed in <xref target="RTN2011"/> and <xref target="MEAS"/>.</t>

      <t>The work is motivated by the measurements in literature that affirm
      that the range of an antenna is not circle symmetric but that the signal
      strength of a given level follows an intricate pattern around the
      antenna, and there may be holes within the area delineated by
      a polar plot. It is reported that communication is not symmetric:
      reception of messages from node A by node B does not imply reception of
      messages from node B by node A. The quality of the signal fluctuates
      over time, and also the height of the antenna within a room can have
      consequences for the range. As a function of the distance from the
      source, three regions are generally recognized: (1) a clear region
      with excellent signal quality, (2) a region with fluctuating signal
      quality, and (3) a region without reception. Installation of meshes
      with neighbors in the clear region is not sufficient, as described
      below.</t>

      <t><xref target="RTN2011"/> extends existing work by:</t>
      <t><list style="symbols">
        <t>Observations over periods of at least a week,</t>
        <t>Testing links that are in the clear region,</t>
        <t>Observation in an office building during working hours, and</t>
        <t>Concentrating on one-hop and two-hop routes.</t>
      </list></t>
      <t>Eight nodes were distributed over a surface of 30 square meters. All nodes are
      at a one&nbhy;hop distance from each other, and all are situated
      in each other's clear region. Each node sends messages to each of its
      neighbors and repeats the message until it arrives. The latency of
      the message was measured over periods of at least a week. It was
      noticed that latencies longer than a second occurred without any
      apparent reason, but only during working days and never during
      the weekends. Bad periods could last for minutes. By sending
      messages via two paths -- (1) a one&nbhy;hop path directly and
      (2) a two&nbhy;hop path via a randomly chosen neighbor -- the
      probability of delays larger than 100&nbsp;ms decreased
      significantly.</t>

      <t>The conclusion is that even for one&nbhy;hop communication between
      not&nbhy;too-distant "line of sight" nodes, there are periods of low
      reception in which communication deadlines of 200&nbsp;ms are
      exceeded. It pays to send a second message over a two&nbhy;hop path to
      increase the reliability of timely message transfer.</t>

      <t><xref target="MEAS"/> confirms that temporary bad reception by close
      neighbors can occur within other types of areas. Nodes were installed
      on the ceiling in a grid with a distance of 30-50&nbsp;cm between
      them.  Two&nbsp;hundred nodes were distributed over an area of
      10&nbsp;m&nbsp;x&nbsp;5&nbsp;m. It clearly transpired that with
      increasing distance the probability of reception decreased. At the
      same time, a few nodes furthest away from the sender had a high
      probability of message reception, while some close neighbors of
      the sender did not receive messages. The patterns of nodes
      experiencing good reception evolved over time.</t>

      <t>The conclusion here is that even for direct neighbors reception
      can temporarily be bad for periods of several minutes. For reliable
      and timely communication, it is imperative to have at least two
      communication paths available (e.g., two&nbhy;hop paths next to
      the one&nbhy;hop path for direct neighbors).</t>

    </section>

    <section title="Acknowledgements" numbered="no">
      <t>This document reflects discussions and remarks from several
      individuals, including (in alphabetical order) Stephen Farrell,
      Mukul Goyal, Sandeep Kumar, Jerry Martocci, Catherine Meadows,
      Yoshihiro Ohba, Charles Perkins, Yvonne-Anne Pignolet,
      Michael Richardson, Ines Robles, Zach Shelby, and
      Meral Sherazipour.</t>
    </section>

  </back>
</rfc>
