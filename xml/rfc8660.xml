<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE rfc SYSTEM "rfc2629-xhtml.ent">

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" submissionType="IETF" consensus="true" number="8660" category="std" ipr="trust200902" obsoletes="" updates="" xml:lang="en" sortRefs="true" symRefs="true" tocInclude="true" version="3" docName="draft-ietf-spring-segment-routing-mpls-22">
  <!-- xml2rfc v2v3 conversion 2.27.0 -->
  <!-- Generated by id2xml 1.4.4 on 2019-06-12T17:23:43Z -->
  <front>
    <title>Segment Routing with the MPLS Data Plane</title>
    <seriesInfo name="RFC" value="8660"/>
    <author fullname="Ahmed Bashandy" initials="A." role="editor" surname="Bashandy">
      <organization>Arrcus</organization>
      <address>
        <email>abashandy.ietf@gmail.com</email>
      </address>
    </author>
    <author fullname="Clarence Filsfils" initials="C." role="editor" surname="Filsfils">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>Brussels</street>
          <street>Belgium</street>
        </postal>
        <email>cfilsfil@cisco.com</email>
      </address>
    </author>
    <author fullname="Stefano Previdi" initials="S." surname="Previdi">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>Italy</street>
        </postal>
        <email>stefano@previdi.net</email>
      </address>
    </author>
    <author fullname="Bruno Decraene" initials="B." surname="Decraene">
      <organization>Orange</organization>
      <address>
        <postal>
          <street>France</street>
        </postal>
        <email>bruno.decraene@orange.com</email>
      </address>
    </author>
    <author fullname="Stephane Litkowski" initials="S." surname="Litkowski">
      <organization>Orange</organization>
      <address>
        <postal>
          <street>France</street>
        </postal>
        <email>stephane.litkowski@orange.com</email>
      </address>
    </author>
    <author fullname="Rob Shakir" initials="R." surname="Shakir">
      <organization>Google</organization>
      <address>
        <postal>
          <street>United States of America</street>
        </postal>
        <email>robjs@google.com</email>
      </address>
    </author>
    <date month="October" year="2019"/>


    <abstract>
      <t>
   Segment Routing (SR) leverages the source routing paradigm.  A node
   steers a packet through a controlled set of instructions, called
   segments, by prepending the packet with an SR header.  In the MPLS
   data plane, the SR header is instantiated through a label stack. This
   document specifies the forwarding behavior to allow instantiating SR
   over the MPLS data plane (SR-MPLS).</t>
    </abstract>
  </front>
  <middle>
    <section anchor="convert-section-1" numbered="true" toc="default">
      <name>Introduction</name>
      <t>
   The Segment Routing architecture <xref target="RFC8402" format="default"/> can be directly applied to
   the MPLS architecture with no change in the MPLS forwarding plane.
   This document specifies forwarding-plane behavior to allow
   Segment Routing to operate on top of the MPLS data plane (SR-MPLS). This
   document does not address control-plane behavior. Control-plane
   behavior is specified in other documents such as <xref target="RFC8665" format="default"/>, <xref target="RFC8666" format="default"/>, and <xref target="RFC8667" format="default"/>.</t>
      <t>
   The Segment Routing problem statement is described in <xref target="RFC7855" format="default"/>.</t>
      <t>
   Coexistence of SR over the MPLS forwarding plane with LDP <xref target="RFC5036" format="default"/> is
   specified in <xref target="RFC8661" format="default"/>.</t>
      <t>
   Policy routing and traffic engineering using Segment Routing can be
   found in <xref target="I-D.ietf-spring-segment-routing-policy" format="default"/>.</t>
      <section anchor="convert-section-1.1" numbered="true" toc="default">
        <name>Requirements Language</name>
        <t>
       The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL
    NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCPÂ 14 <xref target="RFC2119" format="default"/> <xref target="RFC8174" format="default"/> 
    when, and only when, they appear in all capitals, as shown here.</t>
      </section>
    </section>
    <section anchor="convert-section-2" numbered="true" toc="default">
      <name>MPLS Instantiation of Segment Routing</name>
      <t>
   MPLS instantiation of Segment Routing fits in the MPLS architecture
   as defined in <xref target="RFC3031" format="default"/> from both a control-plane and forwarding-plane
   perspective:</t>
      <ul spacing="normal">
        <li>From a control-plane perspective, <xref target="RFC3031" format="default"/> does not mandate a
      single signaling protocol.  Segment Routing makes use of various
      control-plane protocols such as link-state IGPs <xref target="RFC8665" format="default"/> <xref target="RFC8666" format="default"/> <xref target="RFC8667" format="default"/>.
      The flooding mechanisms of link-state IGPs fit very well with
      label stacking on the ingress. A future control-layer protocol and/or
      policy/configuration can be used to specify the label stack.</li>
      <li>From a forwarding-plane perspective, Segment Routing does not
      require any change to the forwarding plane because Segment IDs
      (SIDs) are instantiated as MPLS labels, and the Segment Routing
      header is instantiated as a stack of MPLS labels.</li>
      </ul>
      <t>
   We call the "MPLS Control Plane Client (MCC)" any control-plane entity
   installing forwarding entries in the MPLS data plane. Local
   configuration and policies applied on a router are examples of MCCs.</t>
      <t>

   In order to have a node segment reach the node, a network operator
   <bcp14>SHOULD</bcp14> configure at least one node segment per routing instance,
   topology, or algorithm. Otherwise, the node is not reachable within
   the routing instance, within the topology, 
   or along the routing algorithm, which restricts 
   its ability to be used by an SR Policy and as a 
   Topology Independent Loop-Free Alternate (TI-LFA).</t>
      <section anchor="convert-section-2.1" numbered="true" toc="default">
        <name>Multiple Forwarding Behaviors for the Same Prefix</name>
        <t>
   The SR architecture does not prohibit having more than one SID for
   the same prefix. In fact, by allowing multiple SIDs for the same
   prefix, it is possible to have different forwarding behaviors (such
   as different paths, different ECMP and Unequal-Cost Multipath (UCMP) behaviors, etc.) for the
   same destination.</t>
        <t>
   Instantiating Segment Routing over the MPLS forwarding plane fits
   seamlessly with this principle. An operator may assign multiple MPLS
   labels or indices to the same prefix and assign different forwarding
   behaviors to each label/SID. The MCC in the network downloads
   different MPLS labels/SIDs to the FIB for different forwarding
   behaviors. The MCC at the entry of an SR domain or at any point in
   the domain can choose to apply a particular forwarding behavior to a
   particular packet by applying the PUSH action to that packet using
   the corresponding SID.</t>
      </section>
      <section anchor="convert-section-2.2" numbered="true" toc="default">
        <name>SID Representation in the MPLS Forwarding Plane</name>
        <t>
   When instantiating SR over the MPLS forwarding plane, a SID is
   represented by an MPLS label or an index <xref target="RFC8402" format="default"/>.</t>
        <t>
   A global SID is a label, or an index that may be mapped to an
   MPLS label within the Segment Routing Global Block (SRGB), of the node
   that installs a global SID in its FIB and receives the labeled
   packet. <xref target="convert-section-2.4" format="default"/> specifies the procedure to map a global segment
   represented by an index to an MPLS label within the SRGB.</t>
        <t>
   The MCC <bcp14>MUST</bcp14> ensure that any label value corresponding to any SID it
   installs in the forwarding plane follows the rules below:</t>
        <ul spacing="normal">
          <li>The label value <bcp14>MUST</bcp14> be unique within the router on which the MCC
      is running, i.e., the label <bcp14>MUST</bcp14> only be used to represent the SID
      and <bcp14>MUST NOT</bcp14> be used to represent more than one SID or for any
      other forwarding purpose on the router.</li>
          <li>The label value <bcp14>MUST NOT</bcp14> come from the range of special-purpose
      labels <xref target="RFC7274" format="default"/>.</li>
        </ul>
        <t>
   Labels allocated in this document are considered per-platform downstream
   allocated labels <xref target="RFC3031" format="default"/>.</t>
      </section>
      <section anchor="convert-section-2.3" numbered="true" toc="default">
        <name>Segment Routing Global Block and Local Block</name>
        <t>
   The concepts of SRGB and global SID
   are explained in <xref target="RFC8402" format="default"/>. In general, the SRGB need not be a
   contiguous range of labels.</t>
       <t>
For the rest of this document, the SRGB is specified by the list of
MPLS label ranges [Ll(1),Lh(1)], [Ll(2),Lh(2)],..., [Ll(k),Lh(k)]
where  Ll(i) =&lt; Lh(i).
       </t>
        <t>
   The following rules apply to the list of MPLS ranges representing the
   SRGB:</t>
        <ul spacing="normal">
          <li>The list of ranges comprising the SRGB <bcp14>MUST NOT</bcp14> overlap.</li>
          <li>Every range in the list of ranges specifying the SRGB <bcp14>MUST NOT</bcp14>
      cover or overlap with a reserved label value or range <xref target="RFC7274" format="default"/>,
      respectively.</li>
          <li>If the SRGB of a node does not conform to the structure specified
      in this section or to the previous two rules, the SRGB <bcp14>MUST</bcp14>
      be completely ignored by all routers in the routing domain, and the
      node <bcp14>MUST</bcp14> be treated as if it does not have an SRGB.</li>
          <li>The list of label ranges <bcp14>MUST</bcp14> only be used to instantiate global
      SIDs into the MPLS forwarding plane.</li>
        </ul>
        <t>
   A local segment <bcp14>MAY</bcp14> be allocated from the Segment Routing Local Block
   (SRLB) <xref target="RFC8402" format="default"/> or from any unused label as long as it does not use
   a special-purpose label. The SRLB consists of the range of local
   labels reserved by the node for certain local segments.  In a
   controller-driven network, some controllers or applications <bcp14>MAY</bcp14> use
   the control plane to discover the available set of local SIDs on a
   particular router <xref target="I-D.ietf-spring-segment-routing-policy" format="default"/>. The rules
   applicable to the SRGB are also applicable to the SRLB, except the
   SRGB <bcp14>MUST</bcp14> only be used to instantiate global
   SIDs into the MPLS forwarding plane. The recommended, minimum, or
   maximum size of the SRGB and/or SRLB is a matter of future study.</t>
      </section>
      <section anchor="convert-section-2.4" numbered="true" toc="default">
        <name>Mapping a SID Index to an MPLS Label</name>
        <t>
   This subsection specifies how the MPLS label value is calculated
   given the index of a SID. The value of the index is determined by an
   MCC such as IS-IS <xref target="RFC8667" format="default"/> or OSPF
   <xref target="RFC8665" format="default"/>. This section only
   specifies how to map the index to an MPLS label. The calculated MPLS
   label is downloaded to the FIB, sent out with a forwarded packet, or
   both.</t>
        <t>
   Consider a SID represented by the index "I". Consider an SRGB as
   specified in <xref target="convert-section-2.3" format="default"/>. The total size of the SRGB, represented by
   the variable "Size", is calculated according to the formula:</t>
         <artwork name="" type="" align="left" alt=""><![CDATA[
size = Lh(1)- Ll(1) + 1 + Lh(2)- Ll(2) + 1 + ... + Lh(k)- Ll(k) + 1]]></artwork>
  <t> The following rules <bcp14>MUST</bcp14> be applied by the MCC when calculating the
   MPLS label value corresponding to the SID index value "I".</t>
      
     


  <ul spacing="normal" empty="true">
          <li>0 =&lt; I &lt; size. If index "I" does not satisfy the previous inequality, then the label cannot be calculated.</li>
          <li>
            <t>The label value corresponding to the SID index "I" is calculated
	as follows:

            </t>
            <ul spacing="normal" empty="true">
              <li>j = 1 , temp = 0</li>
              <li>
                <t>While temp + Lh(j)- Ll(j) &lt; I

                </t>
                <ul spacing="normal" empty="true">
                  <li>temp = temp + Lh(j)- Ll(j) + 1</li>
                  <li>j = j+1</li>
                </ul>
              </li>
              <li>label = I - temp + Ll(j)</li>
            </ul>
          </li>
        </ul>

        <t>
   An example for how a router calculates labels and forwards traffic
   based on the procedure described in this section can be found in
   <xref target="convert-section-a.1" format="default"/>.</t>
      </section>
      <section anchor="convert-section-2.5" numbered="true" toc="default">
        <name>Incoming Label Collision</name>
        <t>
   The MPLS Architecture <xref target="RFC3031" format="default"/> defines the term Forwarding
   Equivalence Class (FEC) as the set of packets with similar and/or
   identical characteristics that are forwarded the same way and are
   bound to the same MPLS incoming (local) label. In Segment Routing
   MPLS, a local label serves as the SID for a given FEC.</t>
        <t>
   We define SR FEC <xref target="RFC8402" format="default"/> as one of the following:</t>
        <ul spacing="normal">
          <li>(Prefix, Routing Instance, Topology, Algorithm) <xref target="RFC8402" format="default"/>, where a
      topology identifies a set of links with metrics. For the purpose
      of incoming label collision resolution, the same Topology
      numerical value <bcp14>SHOULD</bcp14> be used on all routers to identify the same
      set of links with metrics. For MCCs where the "Topology" and/or
      "Algorithm" fields are not defined, the numerical value of zero
      <bcp14>MUST</bcp14> be used for these two fields. For the purpose of incoming
      label collision resolution, a routing instance is identified by a
      single incoming label downloader to the FIB. Two MCCs running on the
      same router are considered different routing instances if the only
      way the two instances know about each other's incoming labels
      is through redistribution. The numerical value used to identify a
      routing instance <bcp14>MAY</bcp14> be derived from other configuration or <bcp14>MAY</bcp14> be
      explicitly configured. If it is derived from other configuration,
      then the same numerical value <bcp14>SHOULD</bcp14> be derived from the same
      configuration as long as the configuration survives router reload.
      If the derived numerical value varies for the same configuration,
      then an implementation <bcp14>SHOULD</bcp14> make the numerical value used to
      identify a routing instance configurable.</li>
          <li>(next-hop, outgoing interface), where the outgoing interface is
      physical or virtual.</li>
          <li>(number of adjacencies, list of next-hops, list of outgoing
      interfaces IDs in ascending numerical order). This FEC represents
      parallel adjacencies <xref target="RFC8402" format="default"/>.</li>
          <li>(Endpoint, Color). This FEC represents an SR Policy <xref target="RFC8402" format="default"/>.</li>
          <li>(Mirror SID). The Mirror SID (see <xref target="RFC8402" sectionFormat="comma" section="5.1"/>) is the IP
      address advertised by the advertising node to identify the Mirror SID.
      The IP address is encoded as specified in <xref target="convert-section-2.5.1" format="default"/>.</li>
        </ul>
        <t>
   This section covers the <bcp14>RECOMMENDED</bcp14> procedure for handling the scenario
   where, because of an error/misconfiguration, more than one SR FEC as
   defined in this section maps to the same incoming MPLS label.
   Examples illustrating the behavior specified in this section can be
   found in <xref target="convert-section-a.2" format="default"/>.</t>
        <t>
<!--NOTE new question; ask authors if a space is needed here.

[rfced] Should there be space after 'FEC2'?

Original:
   An incoming label collision occurs if the SIDs of the set of FECs
   {FEC1, FEC2,..., FECk} map to the same incoming SR MPLS label "L1

Perhaps:
   An incoming label collision occurs if the SIDs of the set of FECs
   {FEC1, FEC2, ..., FECk} map to the same incoming SR MPLS label "L1

-->
   An incoming label collision occurs if the SIDs of the set of FECs
   {FEC1, FEC2,..., FECk} map to the same incoming SR MPLS label "L1".</t>
        <t>
   Suppose an anycast prefix is advertised with a prefix-SID by some,
   but not all, of the nodes that advertise that prefix. If the prefix-
   SID sub-TLVs result in mapping that anycast prefix to the same
   incoming label, then the advertisement of the prefix-SID by some, but
   not all, of the advertising nodes <bcp14>MUST NOT</bcp14> be treated as a label
   collision.</t>
        <t>
   An implementation <bcp14>MUST NOT</bcp14> allow the MCCs belonging to the same
   router to assign the same incoming label to more than one SR FEC.</t>
        <t>
   The objective of the following steps is to deterministically install
   in the MPLS Incoming Label Map, also known as label FIB, a single FEC
   with the incoming label "L1". By "deterministically install", we mean
   if the set of FECs {FEC1, FEC2,..., FECk} map to the same incoming SR
   MPLS label "L1", then the steps below assign the same FEC to the
   label "L1" irrespective of the order by which the mappings of this
   set of FECs to the label "L1" are received. For example, first-
   come, first-served tiebreaking is not allowed. The remaining FECs may
   be installed in the IP FIB without an incoming label.</t>
        <t>
   The procedure in this section relies completely on the local FEC and
   label database within a given router.</t>
        <t>
   The collision resolution procedure is as follows:</t>

        <ol spacing="normal" type="1">
          <li>Given the SIDs of the set of FECs, {FEC1, FEC2,..., FECk} map to
      the same MPLS label "L1".</li>
          <li>
            <t>Within an MCC, apply tiebreaking rules to select one FEC only, and
      assign the label to it. The losing FECs are handled as if no
      labels are attached to them. The losing FECs with algorithms other
      than the shortest path first <xref target="RFC8402" format="default"/> are not installed in the
      FIB.
            </t>
            <ol spacing="normal" type="a">
              <li> If the same set of FECs are attached to the same label "L1",
          then the tiebreaking rules <bcp14>MUST</bcp14> always select the same FEC
          irrespective of the order in which the FECs and the label "L1"
          are received. In other words, the tiebreaking rule <bcp14>MUST</bcp14> be
          deterministic.</li>
            </ol>
          </li>
          <li>If there is still collision between the FECs belonging to
      different MCCs, then reapply the tiebreaking rules to the
      remaining FECs to select one FEC only, and assign the label to that
      FEC.</li>
          <li>Install the selected FEC into the IP FIB and its incoming label into
        the label FIB.</li>
          <li>The remaining FECs with the default algorithm (see the
      prefix-SID algorithm specification <xref target="RFC8402" format="default"/>) may be installed
      in the FIB natively, such as pure IP entries in case of Prefix
      FEC, without any incoming labels corresponding to their SIDs. The
      remaining FECs with algorithms other than the shortest path first
      <xref target="RFC8402" format="default"/> are not installed in the FIB.</li>
        </ol>

        <section anchor="convert-section-2.5.1" numbered="true" toc="default">
          <name>Tiebreaking Rules</name>
          <t>
   The default tiebreaking rules are specified as follows:</t>

          <ol spacing="normal" type="1">
            <li>Determine the lowest administrative distance among the competing FECs as defined in the section below. Then filter away all the competing FECs with a higher administrative distance.</li>
            <li>If more than one competing FEC remains after step 1, select the
      smallest numerical FEC value. The numerical value of the FEC is
      determined according to the FEC encoding described later in this
      section.</li>
          </ol>
          <t>
   These rules deterministically select which FEC to install in the MPLS
   forwarding plane for the given incoming label.</t>
          <t>
   This document defines the default tiebreaking rules that <bcp14>SHOULD</bcp14> be
   implemented. An implementation <bcp14>MAY</bcp14> choose to support different tiebreaking
   rules and <bcp14>MAY</bcp14> use one of these instead of the default
   tiebreaking rules. To maximize MPLS forwarding consistency in case
   of a SID configuration error, the network operator <bcp14>MUST</bcp14> deploy, within
   an IGP flooding area, routers implementing the same tiebreaking
   rules.</t>
          <t>
   Each FEC is assigned an administrative distance. The FEC
   administrative distance is encoded as an 8-bit value. The lower the
   value, the better the administrative distance.</t>
          <t>
   The default FEC administrative distance order starting from the
   lowest value <bcp14>SHOULD</bcp14> be:</t>

          <ul spacing="normal">
            <li>
              <t>Explicit SID assignment to a FEC that maps to a label outside the
      SRGB irrespective of the owner MCC. An explicit SID assignment is
      a static assignment of a label to a FEC such that the assignment
      survives a router reboot.</t>
              <ul spacing="normal">
                <li>An example of explicit SID allocation is static assignment of
         a specific label to an Adj-SID.</li>
                <li>An implementation of explicit SID assignment <bcp14>MUST</bcp14> guarantee
         collision freeness on the same router.</li>
              </ul>
            </li>
            <li>
              <t>Dynamic SID assignment:</t>
              <ul spacing="normal">
                <li>All FEC types, except for the SR Policy, are
         ordered using the default administrative distance
         defined by the implementation.</li>
                <li>The Binding SID <xref target="RFC8402" format="default"/> assigned to the SR Policy always has a
         higher default administrative distance than the default
         administrative distance of any other FEC type.</li>
              </ul>
            </li>
          </ul>

          <t>
   To maximize MPLS forwarding consistency, if the same FEC is advertised
   in more than one protocol, a user <bcp14>MUST</bcp14> ensure that the administrative
   distance preference between protocols is the same on all routers of
   the IGP flooding domain. Note that this is not really new as this
   already applies to IP forwarding.</t>
          <t>
   The numerical sort across FECs <bcp14>SHOULD</bcp14> be performed as follows:

          </t>
          <ul spacing="normal">
            <li>
              <t>Each FEC is assigned a FEC type encoded in 8 bits. The type code points 
      for each SR FEC defined at the beginning
      of this section are as follows:
              </t>
        <ul empty="true"><li>
               <dl>
                <dt>120:</dt> <dd>(Prefix, Routing Instance, Topology, Algorithm)</dd>
                <dt>130:</dt> <dd> (next-hop, outgoing interface)</dd>
                <dt>140:</dt> <dd> Parallel Adjacency <xref target="RFC8402" format="default"/></dd>
                <dt>150:</dt> <dd>SR Policy <xref target="RFC8402" format="default"/></dd>
                <dt>160:</dt> <dd> Mirror SID <xref target="RFC8402" format="default"/></dd>
              </dl></li></ul>

                <t>The numerical values above are mentioned to guide
         implementation. If other numerical values are used, then the
         numerical values must maintain the same greater-than ordering
         of the numbers mentioned here.</t>

            </li>
            <li>
              <t>The fields of each FEC are encoded as follows:
</t>
              <ul spacing="normal">
                <li>All fields in all FECs are encoded in big endian order.</li>
                <li>The Routing Instance ID is represented by 16 bits. For routing
         instances that are identified by less than 16 bits, encode the
         Instance ID in the least significant bits while the most
         significant bits are set to zero.</li>
                <li>The address family is represented by 8 bits, where IPv4 is encoded as
         100, and IPv6 is encoded as 110. These numerical values are
         mentioned to guide implementations. If other numerical values
         are used, then the numerical value of IPv4 <bcp14>MUST</bcp14> be less than
         the numerical value for IPv6.</li>
                <li>
                  <t>All addresses are represented in 128 bits as follows:

                  </t>
                  <ul spacing="normal">
                    <li>The IPv6 address is encoded natively.</li>
                    <li>The IPv4 address is encoded in the most significant bits, and
               the remaining bits are set to zero.</li>
                  </ul>
                </li>
                <li>
                  <t>All prefixes are represented by (8 + 128) bits.

                  </t>
                  <ul spacing="normal">
                    <li>A prefix is encoded in the most significant bits, and the
        remaining bits are set to zero.</li>
                    <li>The prefix length is encoded before the prefix in an 8-bit field.</li>
                  </ul>
                </li>
                <li>The Topology ID is represented by 16 bits. For routing instances
         that identify topologies using less than 16 bits, encode the
         topology ID in the least significant bits while the most
         significant bits are set to zero.</li>
                <li>The Algorithm is encoded in a 16-bit field.</li>
                <li>The Color ID is encoded using 32 bits.</li>
              </ul>
            </li>
            <li>Choose the set of FECs of the smallest FEC type code point.</li>
            <li>Out of these FECs, choose the FECs with the smallest address
      family code point.</li>
            <li>
              <t>Encode the remaining set of FECs as follows:

              </t>
              <ul spacing="normal">
                <li>(Prefix, Routing Instance, Topology, Algorithm) is encoded as
         (Prefix Length, Prefix, routing_instance_id, Topology, SR
         Algorithm).</li>
                <li>(next-hop, outgoing interface) is encoded as (next-hop,
         outgoing_interface_id).</li>
                <li>(number of adjacencies, list of next-hops in ascending
         numerical order, list of outgoing interface IDs in ascending
         numerical order) is used to encode a parallel
         adjacency <xref target="RFC8402" format="default"/>.</li>
                <li>(Endpoint, Color) is encoded as (Endpoint_address, Color_id).</li>
                <li>(IP address) is the encoding for a Mirror SID FEC. The IP
         address is encoded as described above in this section.</li>
              </ul>
            </li>
            <li>Select the FEC with the smallest numerical value.</li>
          </ul>
          <t>
   The numerical values mentioned in this section are for guidance only.
   If other numerical values are used, then the other numerical values
   <bcp14>MUST</bcp14> maintain the same numerical ordering among different SR FECs.</t>
        </section>
        <section anchor="convert-section-2.5.2" numbered="true" toc="default">
          <name>Redistribution between Routing Protocol Instances</name>
          <t>
   The following rule <bcp14>SHOULD</bcp14> be applied when redistributing SIDs with
   prefixes between routing protocol instances:</t>
          <ul spacing="normal">
            <li>
              <t>If the SRGB of the receiving instance is the same as the SRGB of the origin
       instance, then:

              </t>
              <ul spacing="normal">
                <li>the index is redistributed with the route.</li>
              </ul>
            </li>
            <li>
              <t>Else,

              </t>
              <ul spacing="normal">
                <li>the index is not redistributed and if the receiving instance
         decides to advertise an index with the redistributed route, it
         is the duty of the receiving instance to allocate a fresh
         index relative to its own SRGB. Note that in this case, the
         receiving instance <bcp14>MUST</bcp14> compute the local label it assigns to
         the route according to <xref target="convert-section-2.4" format="default"/> and install it in FIB.</li>
              </ul>
            </li>
          </ul>
          <t>
   It is outside the scope of this document to define local node
   behaviors that would allow the mapping of the original index into a new index
   in the receiving instance via the addition of an offset or other
   policy means.</t>
          <section anchor="convert-section-2.5.2.1" numbered="true" toc="default">
            <name>Illustration</name>
            <artwork name="" type="" align="left" alt=""><![CDATA[
        A----IS-IS----B---OSPF----C-192.0.2.1/32 (20001)]]></artwork>
            <t>Consider the simple topology above, where:</t>
            <ul spacing="normal">
              <li>A and B are in the IS-IS domain with SRGB [16000-17000]</li>
              <li>B and C are in the OSPF domain with SRGB [20000-21000]</li>
              <li>B redistributes 192.0.2.1/32 into the IS-IS domain</li>
	    </ul>
              <t>In this case, A learns 192.0.2.1/32 as an IP leaf connected to B, which is
      usual for IP prefix redistribution</t>
              <t>However, according to the redistribution rule above, B
      decides not to advertise any index with 192.0.2.1/32 into IS-IS
      because the SRGB is not the same.</t>
          </section>
          <section anchor="convert-section-2.5.2.2" numbered="true" toc="default">
            <name>Illustration 2</name>
            <t>
   Consider the example in the illustration described in <xref target="convert-section-2.5.2.1" format="default"/>.</t>
            <t>
   When router B redistributes the prefix 192.0.2.1/32, router B decides
   to allocate and advertise the same index 1 with the prefix
   192.0.2.1/32.</t>
            <t>
   Within the SRGB of the IS-IS domain, index 1 corresponds to the local
   label 16001.</t>
            <ul spacing="normal">

<!--NOTE new question; ask the authors if the bullet is needed here.

[rfced] Is the bullet preceding the text necessary or can it be
removed? Does this text need to be indented? Please let us know your
preference.

Original:

Within the SRGB of the IS-IS domain, index 1 corresponds to the local label 16001.

   o  Hence according to the redistribution rule above, router B
      programs the incoming label 16001 in its FIB to match traffic
      arriving from the IS-IS domain destined to the prefix
      192.0.2.1/32.
-->
              <li>Hence, according to the redistribution rule above, router B
      programs the incoming label 16001 in its FIB to match traffic
      arriving from the IS-IS domain destined to the prefix
      192.0.2.1/32.</li>
            </ul>
          </section>
        </section>
      </section>
      <section anchor="convert-section-2.6" numbered="true" toc="default">
        <name>Effect of Incoming Label Collision on Outgoing Label Programming</name>
        <t>

   When determining what outgoing label to use, the ingress node
   that pushes new segments, and hence a stack of MPLS labels, <bcp14>MUST</bcp14> use, for
   a given FEC, the label that has been selected by the node
   receiving the packet with that label exposed as the top label. So in case
   of incoming label collision on this receiving node, the ingress node
   <bcp14>MUST</bcp14> resolve this collision by using this same "Incoming Label Collision resolution procedure" and by using the data of the receiving node.</t>
        <t>
   In the general case, the ingress node may not have the exact same
   data as the receiving node, so the result may be different. This is
   under the responsibility of the network operator. But in a typical
   case, e.g., where a centralized node or a distributed link-state IGP
   is used, all nodes would have the same database. However, to minimize
   the chance of misforwarding, a FEC that loses its incoming label to
   the tiebreaking rules specified in <xref target="convert-section-2.5" format="default"/> <bcp14>MUST NOT</bcp14> be
   installed in FIB with an outgoing Segment Routing label based on the
   SID corresponding to the lost incoming label.</t>
        <t>
   Examples for the behavior specified in this section can be found in
   <xref target="convert-section-a.3" format="default"/>.</t>
      </section>
      <section anchor="convert-section-2.7" numbered="true" toc="default">
        <name>PUSH, CONTINUE, and NEXT</name>
        <t>
   PUSH, NEXT, and CONTINUE are operations applied by the forwarding
   plane. The specifications of these operations can be found in
   <xref target="RFC8402" format="default"/>. This subsection specifies how to implement each of these
   operations in the MPLS forwarding plane.</t>
        <section anchor="convert-section-2.7.1" numbered="true" toc="default">
          <name>PUSH</name>
          <t>
   As described in <xref target="RFC8402" format="default"/>, PUSH corresponds to pushing one or more
   labels on top of an incoming packet then sending it out of a
   particular physical interface or virtual interface, such as a UDP
   tunnel <xref target="RFC7510" format="default"/> or the Layer 2 Tunneling Protocol version 3 (L2TPv3) <xref target="RFC4817" format="default"/>, towards a particular
   next-hop.

 When pushing labels onto a packet's label stack, the Time-to-Live
   (TTL) field <xref target="RFC3032" format="default"/> <xref target="RFC3443" format="default"/> and the Traffic Class (TC)
   field <xref target="RFC3032" format="default"/> <xref target="RFC5462" format="default"/> of each label stack entry must, of
   course, be set.  This document does not specify any set of rules for
   setting these fields; that is a matter of local policy. Sections <xref target="convert-section-2.10" format="counter"/> and <xref target="convert-section-2.11" format="counter"/> specify additional details about forwarding
   behavior.</t>
        </section>
        <section anchor="convert-section-2.7.2" numbered="true" toc="default">
          <name>CONTINUE</name>
          <t>
   As described in <xref target="RFC8402" format="default"/>, the CONTINUE operation corresponds to
   swapping the incoming label with an outgoing label. The value of the
   outgoing label is calculated as specified in Sections <xref target="convert-section-2.10" format="counter"/> and <xref target="convert-section-2.11" format="counter"/>.</t>
        </section>
        <section anchor="convert-section-2.7.3" numbered="true" toc="default">
          <name>NEXT</name>
          <t>
   As described in <xref target="RFC8402" format="default"/>, NEXT corresponds to popping the topmost
   label. The action before and/or after the popping depends on the
   instruction associated with the active SID on the received packet
   prior to the popping. For example, suppose the active SID in the
   received packet was an Adj-SID <xref target="RFC8402" format="default"/>; on receiving the
   packet, the node applies the NEXT operation, which corresponds to popping
   the topmost label, and then sends the packet out of the physical or
   virtual interface (e.g., the UDP tunnel <xref target="RFC7510" format="default"/> or L2TPv3 tunnel
   <xref target="RFC4817" format="default"/>) towards the next-hop corresponding to the Adj-SID.</t>
          <section anchor="convert-section-2.7.3.1" numbered="true" toc="default">
            <name>Mirror SID</name>
            <t>
   If the active SID in the received packet was a Mirror SID (see <xref target="RFC8402" sectionFormat="comma" section="5.1"/>) allocated by the receiving router, the receiving
   router applies the NEXT operation, which corresponds to popping the topmost
   label, and then performs a lookup using the contents of the packet
   after popping the outermost label in the mirrored forwarding table. 
   The method by which the lookup is made, and/or the actions applied to
   the packet after the lookup in the mirror table, depends on the
   contents of the packet and the mirror table. Note that the packet
   exposed after popping the topmost label may or may not be an MPLS
   packet. A Mirror SID can be viewed as a generalization of the context
   label in <xref target="RFC5331" format="default"/> because a Mirror SID does not make any
   assumptions about the packet underneath the top label.</t>
          </section>
        </section>
      </section>
      <section anchor="convert-section-2.8" numbered="true" toc="default">
        <name>MPLS Label Downloaded to the FIB for Global and Local SIDs</name>
        <t>
   The label corresponding to the global SID "Si", which is represented by the
   global index "I" and downloaded to the FIB, is used to match packets whose
   active segment (and hence topmost label) is "Si". The value of this
   label is calculated as specified in <xref target="convert-section-2.4" format="default"/>.</t>
        <t>
   For Local SIDs, the MCC is responsible for downloading the correct
   label value to the FIB. For example, an IGP with SR extensions <xref target="RFC8667" format="default"/> <xref target="RFC8665" format="default"/> downloads the MPLS label corresponding to an Adj-SID <xref target="RFC8402" format="default"/>.</t>
      </section>
      <section anchor="convert-section-2.9" numbered="true" toc="default">
        <name>Active Segment</name>
        <t>
   When instantiated in the MPLS domain, the active segment on a packet
   corresponds to the topmost label and is calculated
   according to the procedure specified in Sections <xref target="convert-section-2.10" format="counter"/> and <xref target="convert-section-2.11" format="counter"/>. When
   arriving at a node, the topmost label corresponding to the active SID
   matches the MPLS label downloaded to the FIB as specified in <xref target="convert-section-2.4" format="default"/>.</t>
      </section>
      <section anchor="convert-section-2.10" numbered="true" toc="default">
        <name>Forwarding Behavior for Global SIDs</name>
        <t>
   This section specifies the forwarding behavior, including the calculation
   of outgoing labels, that corresponds to a global SID when applying
   the PUSH, CONTINUE, and NEXT operations in the MPLS forwarding plane.</t>
        <t>
   This document covers the calculation of the outgoing label for the
   top label only. The case where the outgoing label is not the top
   label and is part of a stack of labels that instantiates a routing
   policy or a traffic-engineering tunnel is outside the scope of this
   document and may be covered in other documents such as <xref target="I-D.ietf-spring-segment-routing-policy" format="default"/>.</t>
        <section anchor="convert-section-2.10.1" numbered="true" toc="default">
          <name>Forwarding for PUSH and CONTINUE of Global SIDs</name>
          <t>
  Suppose an MCC on router "R0" determines that, before sending the packet towards a neighbor "N", the PUSH or CONTINUE
  operation is to be applied to an incoming packet related to the global SID "Si".
  SID  "Si" is represented by the global index "I" and owned by the router Ri.  Neighbor "N" may be directly
  connected to "R0" through either a physical or a virtual interface (e.g., 
  UDP tunnel <xref target="RFC7510" format="default"/> or L2TPv3 tunnel <xref target="RFC4817" format="default"/>).
</t>
          <t>
   The method by which the MCC on router "R0" determines that the PUSH or
   CONTINUE operation must be applied using the SID "Si" is beyond the
   scope of this document.
<!--[rfced] Please clarify 'covered by the prefix P/m'. Is the
destination address 'covered' by the prefix P/m?

Original:
   An example of a method to determine the SID
   "Si" for PUSH operation is the case where IS-IS [I-D.ietf-isis-
   segment-routing-extensions] receives the prefix-SID "Si" sub-TLV
   advertised with prefix "P/m" in TLV 135 and the destination address
   of the incoming IPv4 packet is covered by the prefix "P/m".
-->
   An example of a method to determine the SID
   "Si" for the PUSH operation is the case where IS-IS <xref target="RFC8667" format="default"/> 
   receives the prefix-SID "Si" sub-TLV
   advertised with the prefix "P/m" in TLV 135, and the prefix "P/m" is the longest matching 
   network prefix for the incoming IPv4 packet.</t>
          <t>
   For the CONTINUE operation, an example of a method used to determine the SID
   "Si" is the case where IS-IS <xref target="RFC8667" format="default"/> receives the prefix-SID "Si" sub-TLV advertised with
   prefix "P" in TLV 135, and the top label of the incoming packet
   matches the MPLS label in the FIB corresponding to the SID "Si" on
   router "R0".</t>
          <t>
   The forwarding behavior for PUSH and CONTINUE corresponding to the
   SID "Si" is as follows:</t>

          <ul spacing="normal">
            <li>
              <t>If neighbor "N" does not support SR or advertises an invalid
       SRGB or a SRGB that is too small for the SID "Si", then:
              </t>
              <ul spacing="normal">
                <li>If it is possible to send the packet towards neighbor "N"
         using standard MPLS forwarding behavior as specified in
         <xref target="RFC3031" format="default"/> and <xref target="RFC3032" format="default"/>, forward the packet. The method
         by which a router decides whether it is possible to send the
         packet to "N" or not is beyond the scope of this document. For
         example, the router "R0" can use the downstream label
         determined by another MCC, such as LDP <xref target="RFC5036" format="default"/>, to send the
         packet.</li>

                <li>Else, if there are other usable next-hops, use them to forward the incoming packet. 
         The method by which the
         router "R0" decides on the possibility of using other next-hops
         is beyond the scope of this document. For example, the
         MCC on "R0" may chose the send an IPv4 packet without pushing
         any label to another next-hop.</li>
                <li>Otherwise, drop the packet.</li>
              </ul>
            </li>
            <li>
              <t>Else,
              </t>
              <ul spacing="normal">
                <li>
                  Calculate the outgoing label as specified in <xref target="convert-section-2.4" format="default"/> using
          the SRGB of neighbor "N".
                  </li>
                   <li><t>Determine the outgoing label stack</t>
                  <ul spacing="normal">
                    <li>
                      <t>If the operation is PUSH:
                      </t>
                      <ul spacing="normal">
                        <li>Push the calculated label according to the MPLS label
              pushing rules specified in <xref target="RFC3032" format="default"/>.
	</li>
                      </ul>
                    </li>
                    <li>
                      <t>Else,
                      </t>
                      <ul spacing="normal">

                        <li>swap the incoming label with the calculated label
           according to the label-swapping rules in <xref target="RFC3031" format="default"/>.
	</li>
                      </ul>
                    </li>
                    <li>Send the packet towards neighbor "N".</li>
                   </ul>
                </li>
              </ul>
            </li>
          </ul>
	     
    

  <!--<t>Else,
              </t>
              <ul spacing="normal">
                <li>
                  <t>Calculate the outgoing label as specified in <xref target="convert-section-2.4" format="default"/> using
          the SRGB of neighbor "N".
                  </t>
                  <ul spacing="normal">
                    <li>
                      <t>If the operation is PUSH:
                      </t>
                      <ul spacing="normal">
                        <li>Push the calculated label according to the MPLS label
              pushing rules specified in <xref target="RFC3032" format="default"/>.
	</li>
                      </ul>
                    </li>
                    <li>
                      <t>Else,
                      </t>
                      <ul spacing="normal">

                        <li>swap the incoming label with the calculated label
           according to the label-swapping rules in <xref target="RFC3031" format="default"/>.
	</li>
                      </ul>
                    </li>
                    <li>Send the packet towards neighbor "N".</li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>-->



        </section>
        <section anchor="convert-section-2.10.2" numbered="true" toc="default">
          <name>Forwarding for the NEXT Operation for Global SIDs</name>
          <t>
   As specified in <xref target="convert-section-2.7.3" format="default"/>, the NEXT operation corresponds to popping
   the topmost label. The forwarding behavior is as follows:</t>
          <ul spacing="normal">
            <li>Pop the topmost label</li>
            <li>Apply the instruction associated with the incoming label that has
      been popped</li>
          </ul>
          <t>
   The action on the packet after popping the topmost label depends on
   the instruction associated with the incoming label as well as the
   contents of the packet right underneath the top label that was
   popped. Examples of the NEXT operation are described in <xref target="convert-section-a.1" format="default"/></t>
        </section>
      </section>
      <section anchor="convert-section-2.11" numbered="true" toc="default">
        <name>Forwarding Behavior for Local SIDs</name>
        <t>
   This section specifies the forwarding behavior for local SIDs when SR
   is instantiated over the MPLS forwarding plane.</t>
        <section anchor="convert-section-2.11.1" numbered="true" toc="default">
          <name>Forwarding for the PUSH Operation on Local SIDs</name>
          <t>
   Suppose an MCC on router "R0" determines that the PUSH operation is to
   be applied to an incoming packet using the local SID "Si" before
   sending the packet towards neighbor "N", which is directly connected to R0
   through a physical or virtual interface such as a UDP tunnel <xref target="RFC7510" format="default"/>
   or L2TPv3 tunnel <xref target="RFC4817" format="default"/>.</t>
          <t>
   An example of such a local SID is an Adj-SID allocated and advertised
   by IS-IS <xref target="RFC8667" format="default"/>. The method by
   which the MCC on "R0" determines that the PUSH operation is to be applied
   to the incoming packet is beyond the scope of this document. An
   example of such a method is the backup path used to protect against a
   failure using TI-LFA <xref target="I-D.ietf-rtgwg-segment-routing-ti-lfa" format="default"/>.</t>
          <t>
   As mentioned in <xref target="RFC8402" format="default"/>, a local SID is specified by an MPLS label.
   Hence, the PUSH operation for a local SID is identical to the label push
   operation using any MPLS label <xref target="RFC3031" format="default"/>. The forwarding action after
   pushing the MPLS label corresponding to the local SID is also
   determined by the MCC. For example, if the PUSH operation was done to
   forward a packet over a backup path calculated using TI-LFA, then the
   forwarding action may be sending the packet to a certain neighbor
   that will in turn continue to forward the packet along the backup
   path.</t>
        </section>
        <section anchor="convert-section-2.11.2" numbered="true" toc="default">
          <name>Forwarding for the CONTINUE Operation for Local SIDs</name>
          <t>
   A local SID on router "R0" corresponds to a local label.
   In such a
   scenario, the outgoing label towards next-hop "N" is determined by
   the MCC running on the router "R0", and the forwarding behavior for the
   CONTINUE operation is identical to the swap operation on an
   MPLS label <xref target="RFC3031" format="default"/>.</t>
        </section>
        <section anchor="convert-section-2.11.3" numbered="true" toc="default">
          <name>Outgoing Label for the NEXT Operation for Local SIDs</name>
          <t>
  The  NEXT operation for Local SIDs is identical to the NEXT operation for
   global SIDs as specified in <xref target="convert-section-2.10.2" format="default"/>.</t>
        </section>
      </section>
    </section>
    <section anchor="convert-section-3" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <t>
 This document has no IANA actions.</t>
    </section>
    <section anchor="convert-section-4" numbered="true" toc="default">
      <name>Manageability Considerations</name>
      <t>
   This document describes the applicability of Segment Routing over the
   MPLS data plane.  Segment Routing does not introduce any change in
   the MPLS data plane.  Manageability considerations described in
   <xref target="RFC8402" format="default"/> apply to the MPLS data plane when used with Segment
   Routing. SR Operations, Administration, and Maintenance (OAM) use cases for the MPLS data plane are defined in
   <xref target="RFC8403" format="default"/>.  SR OAM procedures for the MPLS data plane are defined in
   <xref target="RFC8287" format="default"/>.</t>
    </section>
    <section anchor="convert-section-5" numbered="true" toc="default">
      <name>Security Considerations</name>
      <t>
   This document does not introduce additional security requirements and
   mechanisms other than the ones described in <xref target="RFC8402" format="default"/>.</t>
    </section>
  </middle>
  <back>


<displayreference target="I-D.ietf-spring-segment-routing-policy" to="ROUTING-POLICY"/>
<displayreference target="I-D.ietf-rtgwg-segment-routing-ti-lfa" to="FAST-REROUTE"/>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8402.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3031.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3032.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3443.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5462.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7274.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>

      </references>
      <references>
        <name>Informative References</name>

<!--draft-ietf-isis-segment-routing-extensions-25; Active - in AUTH48 - part of C340-->
     <reference anchor="RFC8667" target="https://www.rfc-editor.org/info/rfc8667">
          <front>
            <title>IS-IS Extensions for Segment Routing</title>
            <seriesInfo name="DOI" value="10.17487/RFC8667"/>
            <seriesInfo name="RFC" value="8667"/>
            <author initials="S" surname="Previdi" fullname="Stefano Previdi" role="editor">
              <organization/>
            </author>
            <author initials="L" surname="Ginsberg" fullname="Les Ginsberg" role="editor">
              <organization/>
            </author>
            <author initials="C" surname="Filsfils" fullname="Clarence Filsfils">
              <organization/>
            </author>
            <author initials="A" surname="Bashandy" fullname="Ahmed Bashandy">
              <organization/>
            </author>
            <author initials="H" surname="Gredler" fullname="Hannes Gredler">
              <organization/>
            </author>
            <author initials="B" surname="Decraene" fullname="Bruno Decraene">
              <organization/>
            </author>
            <date month="September" year="2019"/>
          </front>
        </reference>

 <!--draft-ietf-ospf-ospfv3-segment-routing-extensions-23; Active - in RFC-Editor - part of C340-->   
     <reference anchor="RFC8666" target="https://www.rfc-editor.org/info/rfc8666">
          <front>
            <title>OSPFv3 Extensions for Segment Routing</title>
            <seriesInfo name="DOI" value="10.17487/RFC8666"/>
            <seriesInfo name="RFC" value="8666"/>
            <author initials="P" surname="Psenak" fullname="Peter Psenak" role="editor">
              <organization/>
            </author>
            <author initials="S" surname="Previdi" fullname="Stefano Previdi" role="editor">
              <organization/>
            </author>
            <date month="September" year="2019"/>
          </front>
        </reference>

<!--draft-ietf-ospf-segment-routing-extensions-27; Active - in RFC-Editor - Part of C340-->
       <reference anchor="RFC8665" target="https://www.rfc-editor.org/info/rfc8665">
          <front>
            <title>OSPF Extensions for Segment Routing</title>
            <seriesInfo name="DOI" value="10.17487/RFC8665"/>
            <seriesInfo name="RFC" value="8665"/>
            <author initials="P" surname="Psenak" fullname="Peter Psenak" role="editor">
              <organization/>
            </author>
            <author initials="S" surname="Previdi" fullname="Stefano Previdi" role="editor">
              <organization/>
            </author>
            <author initials="C" surname="Filsfils" fullname="Clarence Filsfils">
              <organization/>
            </author>
            <author initials="H" surname="Gredler" fullname="Hannes Gredler">
              <organization/>
            </author>
            <author initials="R" surname="Shakir" fullname="Rob Shakir">
              <organization/>
            </author>
            <author initials="W" surname="Henderickx" fullname="Wim Henderickx">
              <organization/>
            </author>
            <author initials="J" surname="Tantsura" fullname="Jeff Tantsura">
              <organization/>
            </author>
            <date month="September" year="2019"/>
          </front>
        </reference>

<!--draft-ietf-spring-segment-routing-ldp-interop-15; Active - in AUTH48 - Part of C340-->
       <reference anchor="RFC8661" target="https://www.rfc-editor.org/info/rfC8661">
          <front>
            <title>Segment Routing Interworking with LDP</title>
            <seriesInfo name="DOI" value="10.17487/RFC8661"/>
            <seriesInfo name="RFC" value="8661"/>
            <author initials="A" surname="Bashandy" fullname="Ahmed Bashandy" role="editor">
              <organization/>
            </author>
            <author initials="C" surname="Filsfils" fullname="Clarence Filsfils" role="editor">
              <organization/>
            </author>
            <author initials="S" surname="Previdi" fullname="Stefano Previdi">
              <organization/>
            </author>
            <author initials="B" surname="Decraene" fullname="Bruno Decraene">
              <organization/>
            </author>
            <author initials="S" surname="Litkowski" fullname="Stephane Litkowski">
              <organization/>
            </author>
            <date month="September" year="2019"/>
          </front>
        </reference>

<!-- &I-D.bashandy-rtgwg-segment-routing-ti-lfa; Replaced by draft-ietf-rtgwg-segment-routing-ti-lfa-01; Expired -->
<xi:include href="http://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-rtgwg-segment-routing-ti-lfa.xml"/>

<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7855.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5036.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5331.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7510.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4817.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8287.xml"/>
<xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8403.xml"/>

<!--draft-ietf-spring-segment-routing-policy-03; Active - I-D Exists-->
<xi:include href="http://xml2rfc.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-spring-segment-routing-policy.xml"/>

      </references>
    </references>

    <section anchor="convert-section-a" numbered="true" toc="default">
      <name>Examples</name>
      <section anchor="convert-section-a.1" numbered="true" toc="default">
        <name>IGP Segment Examples</name>
        <t>
   Consider the network diagram of <xref target="fig1" format="default"/> and the IP addresses and IGP
   segment allocations of <xref target="fig2" format="default"/>. Assume that the network is running
   IS-IS with SR extensions <xref target="RFC8667" format="default"/>,
   and all links have the same metric. The following examples can be
   constructed.</t>
        <figure anchor="fig1">
          <name>IGP Segments -- Illustration</name>
          <artwork name="" type="" align="left" alt=""><![CDATA[
                             +--------+
                            /          \
             R0-----R1-----R2----------R3-----R8
                           | \        / |
                           |  +--R4--+  |
                           |            |
                           +-----R5-----+]]></artwork>
        </figure>
        <figure anchor="fig2">
          <name>IGP Address and Segment Allocation -- Illustration</name>
          <artwork name="" type="" align="left" alt=""><![CDATA[
       +-----------------------------------------------------------+
       | IP addresses allocated by the operator:                   |
       |                      192.0.2.1/32 as a loopback of R1     |
       |                      192.0.2.2/32 as a loopback of R2     |
       |                      192.0.2.3/32 as a loopback of R3     |
       |                      192.0.2.4/32 as a loopback of R4     |
       |                      192.0.2.5/32 as a loopback of R5     |
       |                      192.0.2.8/32 as a loopback of R8     |
       |              198.51.100.9/32 as an anycast loopback of R4 |
       |              198.51.100.9/32 as an anycast loopback of R5 |
       |                                                           |
       | SRGB defined by the operator as [1000,5000]               |
       |                                                           |
       | Global IGP SID indices allocated by the operator:         |
       |                      1 allocated to 192.0.2.1/32          |
       |                      2 allocated to 192.0.2.2/32          |
       |                      3 allocated to 192.0.2.3/32          |
       |                      4 allocated to 192.0.2.4/32          |
       |                      8 allocated to 192.0.2.8/32          |
       |                   1009 allocated to 198.51.100.9/32       |
       |                                                           |
       | Local IGP SID allocated dynamically by R2                 |
       |                     for its "north" adjacency to R3: 9001 |
       |                     for its "east" adjacency to R3 : 9002 |
       |                     for its "south" adjacency to R3: 9003 |
       |                     for its only adjacency to R4   : 9004 |
       |                     for its only adjacency to R1   : 9005 |
       +-----------------------------------------------------------+]]></artwork>
        </figure>
        <t>
   Suppose R1 wants to send IPv4 packet P1 to R8. In this case, R1
   needs to apply the PUSH operation to the IPv4 packet.</t>
        <t>
   Remember that the SID index "8" is a global IGP segment attached to
   the IP prefix 192.0.2.8/32. Its semantic is global within the IGP
   domain: any router forwards a packet received with active segment 8
   to the next-hop along the ECMP-aware shortest path to the related
   prefix.</t>
        <t>
   R2 is the next-hop along the shortest path towards R8. By applying
   the steps in <xref target="convert-section-2.8" format="default"/>, the outgoing label downloaded to R1's FIB
   corresponding to the global SID index 8 is 1008 because the SRGB of
   R2 is [1000,5000] as shown in <xref target="fig2" format="default"/>.</t>
        <t>
   Because the packet is IPv4, R1 applies the PUSH operation using the
   label value 1008 as specified in <xref target="convert-section-2.10.1" format="default"/>. The resulting MPLS
   header will have the "S" bit <xref target="RFC3032" format="default"/> set because it is followed
   directly by an IPv4 packet.</t>
        <t>
   The packet arrives at router R2.
<!--[rfced] May we update the instruction in quote marks?
Specifically, is the intended meaning 'one or multiple ECMP/UCMP
next-hops'? If so, see A below. If it should be 'all ECMP/UCMP
next-hops', see B below. Please let us know which option you
prefer.

A) "and an ECMP/UCMP next-hop(s)..." 
or 
B) "and all ECMP/UCMP next-hops..."

Original:
   Because the top label 1008
   corresponds to the IGP SID "8", which is the prefix-SID attached to
   the prefix 192.0.2.8/32 owned by the node R8, then the instruction
   associated with the SID is "forward the packet using all ECMP/UCMP
   interfaces and all ECMP/UCMP next-hop(s) along the shortest/useable
   path(s) towards R8".
-->
 Because top label 1008
   corresponds to the IGP SID "8", which is the prefix-SID attached to
   the prefix 192.0.2.8/32 owned by node R8, the instruction
   associated with the SID is "forward the packet using an ECMP/UCMP interface(s) and an ECMP/UCMP next-hop(s) along the shortest/usable path(s) towards R8". Because R2 is not the penultimate hop, R2
   applies the CONTINUE operation to the packet and sends it to R3 using
   one of the two links connected to R3 with top label 1008 as specified
   in <xref target="convert-section-2.10.1" format="default"/>.</t>
        <t>
<!--[rfced] May we update the instruction in quote marks?
Specifically, is the intended meaning 'one or multiple
next-hops'? If so, see A below. If it should be 'all next-hops',
see B below. Please let us know which option you prefer.

A) "and a next-hop(s) along..." 
or 
B) "and all next-hops along..."

Original:
   Because the top label
   1008 corresponds to the IGP SID "8", which is the prefix-SID attached
   to the prefix 192.0.2.8/32 owned by the node R8, then the instruction
   associated with the SID is "send the packet using all ECMP interfaces
   and all next-hop(s) along the shortest path towards R8".
-->
   R3 receives the packet with top label 1008. Because top label
   1008 corresponds to the IGP SID "8", which is the prefix-SID attached
   to the prefix 192.0.2.8/32 owned by node R8, the instruction
   associated with the SID is "send the packet using an ECMP interface(s) and a next-hop(s) along the shortest path towards R8". Because R3
   is the penultimate hop, we assume that R3 performs penultimate hop
   popping, which corresponds to the NEXT operation; the packet is then sent to 
   R8. The NEXT operation results in popping the outer label
   and sending the packet as a pure IPv4 packet to R8.</t>
        <t>
   In conclusion, the path followed by P1 is R1-R2--R3-R8.  The ECMP
   awareness ensures that the traffic is load-shared between any ECMP
   path; in this case, it's the two links between R2 and R3.</t>
      </section>
      <section anchor="convert-section-a.2" numbered="true" toc="default">
        <name>Incoming Label Collision Examples</name>
        <t>
   This section outlines several examples to illustrate the handling of
   label collision described in <xref target="convert-section-2.5" format="default"/>.</t>
        <t>
   For the examples in this section, we assume that node A has the
   following:</t>
        <ul spacing="normal">
          <li>OSPF default admin distance for implementation=50</li>
          <li>IS-IS default admin distance for implementation=60</li>
        </ul>
        <section anchor="convert-section-a.2.1" numbered="true" toc="default">
          <name>Example 1</name>
          <t>
   The following example illustrates incoming label collision resolution for the same FEC
   type using MCC administrative distance.</t>
          <t>
   FEC1:</t>
          <t>
            Node A receives an OSPF Prefix SID advertisement from node B for 198.51.100.5/32 with index=5.
            Assuming that OSPF SRGB on node A is [1000,1999], the incoming label is 1005.
          </t>
          <t>
   FEC2:</t>
          <t>
            IS-IS on node A receives a Prefix SID advertisement from node C for 203.0.113.105/32
      with index=5. Assuming that IS-IS SRGB on node A is [1000,1999], the incoming label is 1005.
          </t>
          <t>
   FEC1 and FEC2 both use dynamic SID assignment. 

   Since neither of the
   FECs are of type 'SR Policy', we use the default admin distances of 50 and
   60 to break the tie.  So FEC1 wins.</t>
        </section>
        <section anchor="convert-section-a.2.2" numbered="true" toc="default">
          <name>Example 2</name>
          <t>
   The following example Illustrates incoming label collision resolution for different FEC
   types using the MCC administrative distance.</t>
          <t>
   FEC1:</t>
          <t>
            Node A receives an OSPF Prefix SID advertisement from node B for
      198.51.100.6/32 with index=6.
           Assuming that OSPF SRGB on node A is [1000,1999],
           the incoming label on node A corresponding to
      198.51.100.6/32 is 1006.
          </t>
          <t>
   FEC2:</t>
          <!--[rfced] Please clarify the meaning of "towards one of its
neighbors".  Note that there are 2 more instances in the text.

Original:
   ISIS on node A assigns the label 1006 to the globally significant
   adj-SID (I.e. when advertised the "L" flag is clear in the adj-SID
   sub-TLV as described in [I-D.ietf-isis-segment-routing-extensions])
   towards one of its neighbors.
-->
          <t>
   IS-IS on node A assigns label 1006 to the globally significant
   Adj-SID (i.e., when advertised, the "L" flag is clear in the Adj-SID
   sub-TLV as described in <xref target="RFC8667" format="default"/>). Hence, the incoming label corresponding
   to this Adj-SID is 1006. Assume node A allocates this Adj-SID
   dynamically, and it may differ across router reboots.</t>
          <t>
   FEC1 and FEC2 both use dynamic SID assignment.  Since neither of the
   FECs are of type 'SR Policy', we use the default admin distances of 50 and
   60 to break the tie.  So FEC1 wins.</t>
        </section>
        <section anchor="convert-section-a.2.3" numbered="true" toc="default">
          <name>Example 3</name>
          <t>
   The following example illustrates incoming label collision resolution based on
   preferring static over dynamic SID assignment.</t>
          <t>
   FEC1:</t>
          <t>
   OSPF on node A receives a Prefix SID advertisement from node B for
   198.51.100.7/32 with index=7. Assuming that the OSPF SRGB on node A
   is [1000,1999], the incoming label corresponding to 198.51.100.7/32
   is 1007.</t>
          <t>
   FEC2:</t>
          <t>
   The operator on node A configures IS-IS on node A to assign label
   1007 to the globally significant Adj-SID (i.e., when advertised, the
   "L" flag is clear in the Adj-SID sub-TLV as described in <xref target="RFC8667" format="default"/>) 
   towards one of its neighbor
   advertisements from node A with label=1007.</t>
          <t>
   Node A assigns this Adj-SID explicitly via configuration, so the AdjâSID
   survives router reboots.</t>
          <t>
   FEC1 uses dynamic SID assignment, while FEC2 uses explicit SID
   assignment. So FEC2 wins.</t>
        </section>
        <section anchor="convert-section-a.2.4" numbered="true" toc="default">
          <name>Example 4</name>
          <t>
   The following example illustrates incoming label collision resolution using FEC type
   default administrative distance.</t>
          <t>
   FEC1:</t>
          <t>
   OSPF on node A receives a Prefix SID advertisement from node B for
   198.51.100.8/32 with index=8. Assuming that OSPF SRGB on node A =
   [1000,1999], the incoming label corresponding to 198.51.100.8/32  is
   1008.</t>
          <t>
   FEC2:</t>
          <t>
   Suppose the SR Policy advertisement from the controller to node A for the
   policy identified by (Endpoint = 192.0.2.208, color = 100) that
   consists of SID-List=&lt;S1, S2&gt; assigns the globally significant
   Binding-SID label 1008.</t>
          <t>
   From the point of view of node A, FEC1 and FEC2 both use dynamic SID
   assignment. Based on the default administrative distance outlined in
   <xref target="convert-section-2.5.1" format="default"/>, the Binding SID has a higher administrative distance
   than the prefix-SID; hence, FEC1 wins.</t>
        </section>
        <section anchor="convert-section-a.2.5" numbered="true" toc="default">
          <name>Example 5</name>
          <t>
   The following example illustrates incoming label collision resolution based on FEC type
   preference.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.110/32 with index=10. Assuming that the IS-IS SRGB on node A
   is [1000,1999], the incoming label corresponding to 203.0.113.110/32
   is 1010.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A assigns label 1010 to the globally significant
   Adj-SID (i.e., when advertised, the "L" flag is clear in the Adj-SID
   sub-TLV as described in <xref target="RFC8667" format="default"/>).</t>
          <t>
   Node A allocates this Adj-SID dynamically, and it may differ across
   router reboots. Hence, both FEC1 and FEC2 both use dynamic SID
   assignment.</t>
          <t>
   Since both FECs are from the same MCC, they have the same default
   admin distance. So we compare the FEC type code points. FEC1 has FEC type
   code-point=120, while FEC2 has FEC type code-point=130. Therefore,
   FEC1 wins.</t>
        </section>
        <section anchor="convert-section-a.2.6" numbered="true" toc="default">
          <name>Example 6</name>
          <t>
   The following example illustrates incoming label collision resolution based on address
   family preference.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.111/32 with index 11. Assuming that the IS-IS SRGB on node A
   is [1000,1999], the incoming label on node A for 203.0.113.111/32 is
   1011.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   2001:DB8:1000::11/128 with index=11. Assuming that the IS-IS SRGB on
   node A is [1000,1999], the incoming label on node A for
   2001:DB8:1000::11/128 is 1011.</t>
          <t>
   FEC1 and FEC2 both use dynamic SID assignment. Since both FECs are
   from the same MCC, they have the same default admin distance. So we
   compare the FEC type code points. Both FECs have FEC type codeâpoint=120.
   So we compare the address family. Since IPv4 is preferred over IPv6, FEC1
   wins.</t>
        </section>
        <section anchor="convert-section-a.2.7" numbered="true" toc="default">
          <name>Example 7</name>
          <t>
   The following example illustrates incoming label collision resolution based on prefix
   length.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.112/32 with index 12. Assuming that IS-IS SRGB on node A is
   [1000,1999], the incoming label for 203.0.113.112/32 on node A is
   1012.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   203.0.113.128/30 with index 12. Assuming that the IS-IS SRGB on node A
   is [1000,1999], the incoming label for 203.0.113.128/30 on node A is
   1012.</t>
          <t>
   FEC1 and FEC2 both use dynamic SID assignment. Since both FECs are
   from the same MCC, they have the same default admin distance. So we
   compare the FEC type code points.  Both FECs have FEC type codeâpoint=120.
   So we compare the address family.  Both are a part of the IPv4 address family, so we
   compare the prefix length.  FEC1 has prefix length=32, and FEC2 has
   prefix length=30, so FEC2 wins.</t>
        </section>
        <section anchor="convert-section-a.2.8" numbered="true" toc="default">
          <name>Example 8</name>
          <t>
   The following example illustrates incoming label collision resolution based on the
   numerical value of the FECs.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.113/32 with index 13. Assuming that IS-IS SRGB on node A is
   [1000,1999], the incoming label for 203.0.113.113/32 on node A
   is 1013.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   203.0.113.213/32 with index 13. Assuming that IS-IS SRGB on node A is
   [1000,1999], the incoming label for 203.0.113.213/32 on node A
   is 1013.</t>
          <t>
   FEC1 and FEC2 both use dynamic SID assignment. Since both FECs are
   from the same MCC, they have the same default admin distance. So we
   compare the FEC type code points.  Both FECs have FEC type codeâpoint=120.
   So we compare the address family.  Both are a part of the IPv4 address family, so we
   compare the prefix length.  Prefix lengths are the same, so we compare
   the prefix. FEC1 has the lower prefix, so FEC1 wins.</t>
        </section>
      
        <section anchor="convert-section-a.2.9" numbered="true" toc="default">
          <name>Example 9</name>
          <t>
   The following example illustrates incoming label collision resolution based on the routing
   instance ID.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.114/32 with index 14. Assume that this IS-IS instance on
   node A has Routing Instance ID 1000 and SRGB [1000,1999]. Hence,
   the incoming label for 203.0.113.114/32 on node A is 1014.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   203.0.113.114/32 with index=14. Assume that this is another instance
   of IS-IS on node A but routing Instance ID 2000 is different and
   SRGB [1000,1999] is the same. Hence, the incoming label for 203.0.113.114/32 on
   node A is 1014.</t>
          <t>
   These two FECs match all the way through the prefix length and
   prefix. So the Routing Instance ID breaks the tie, and FEC1 wins.</t>
        </section>
        <section anchor="convert-section-a.2.10" numbered="true" toc="default">
          <name>Example 10</name>
          <t>
   The following example illustrates incoming label collision resolution based on the topology
   ID.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.115/32 with index=15. Assume that this IS-IS instance on
   node A has Routing Instance ID 1000. Assume that the prefix
   advertisement of 203.0.113.115/32 was received in the IS-IS Multi-topology
   advertisement with ID = 50. If the IS-IS SRGB for this routing
   instance on node A is [1000,1999], then the incoming label of
   203.0.113.115/32 for topology 50 on node A is 1015.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   203.0.113.115/32 with index 15. Assume that it has the same routing
   Instance ID = 1000, but 203.0.113.115/32 was advertised with
   IS-IS Multi-topology ID = 40, which is different. If the IS-IS SRGB on node A is
   [1000,1999], then the incoming label of 203.0.113.115/32 for topology 40
   on node A is also 1015.</t>
          <t>
   Since these two FECs match all the way through the prefix length, prefix,
   and Routing Instance ID, we compare the IS-IS Multi-topology ID, so FEC2
   wins.</t>
        </section>
        <section anchor="convert-section-a.2.11" numbered="true" toc="default">
          <name>Example 11</name>
          <t>
   The following example illustrates incoming label collision for resolution based on
   the algorithm ID.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.116/32 with index=16. Assume that IS-IS on node A has Routing
   Instance ID = 1000. Assume that node B advertised 203.0.113.116/32
   with IS-IS Multi-topology ID = 50 and SR algorithm = 0. Assume that
   the IS-IS SRGB on node A = [1000,1999]. Hence, the incoming label
   corresponding to this advertisement of 203.0.113.116/32 is 1016.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   203.0.113.116/32 with index=16. Assume that it is the same IS-IS
   instance on node A with Routing Instance ID = 1000. Also assume that
   node C advertised 203.0.113.116/32 with IS-IS Multi-topology ID = 50
   but with SR algorithm = 22. Since it is the same routing instance,
   the SRGB on node A = [1000,1999]. Hence, the incoming label
   corresponding to this advertisement of 203.0.113.116/32 by node C is
   also 1016.</t>
          <t>
   Since these two FECs match all the way through in terms of the prefix length, prefix,
   Routing Instance ID, and Multi-topology ID, we compare the SR
   algorithm IDs, so FEC1 wins.</t>
        </section>
        <section anchor="convert-section-a.2.12" numbered="true" toc="default">
          <name>Example 12</name>
          <t>
   The following example illustrates incoming label collision resolution based on the FEC
   numerical value, independent of how the SID is assigned to the
   colliding FECs.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.117/32 with index 17. Assume that the IS-IS SRGB on node A
   is [1000,1999]; thus, the incoming label is 1017.</t>
          <t>
   FEC2:</t>
          <t>
   Suppose there is an IS-IS mapping server advertisement (SID / Label
   Binding TLV) from node D that has range = 100 and prefix = 203.0.113.1/32.
   Suppose this mapping server advertisement generates 100 mappings, one
   of which maps 203.0.113.17/32 to index 17.
   Assuming that it is the
   same IS-IS instance, the SRGB is [1000,1999] and hence the
   incoming label for 1017.</t>
          <t>
   Even though FEC1 comes from a normal Prefix SID advertisement and
   FEC2 is generated from a mapping server advertisement, it is not used as
   a tiebreaking parameter. Both FECs use dynamic SID assignment, are
   from the same MCC, and have the same FEC type codeâpoint=120. Their
   prefix lengths are the same as well.  FEC2 wins based on its lower
   numerical prefix value, since 203.0.113.17 is less than
   203.0.113.117.</t>
        </section>
        <section anchor="convert-section-a.2.13" numbered="true" toc="default">
          <name>Example 13</name>
          <t>
   The following example illustrates incoming label collision resolution based on address
   family preference.</t>
          <t>
   FEC1:</t>
          <t>
   SR Policy advertisement from the controller to node A. Endpoint
   address=2001:DB8:3000::100, color=100, SID-List=&lt;S1, S2&gt;, and the
   Binding-SID label=1020.</t>
          <t>
   FEC2:</t>
          <t>
SR Policy advertisement from controller to node A. Endpoint
address=192.0.2.60, color=100, SID-List=&lt;S3, S4&gt;, and the Binding-SID
label=1020.</t>
          <t>The FEC tiebreakers match, and they have the
same FEC type code-point=140. Thus, FEC2 wins based on the IPv4 address family
being preferred over IPv6.</t>
        </section>
        <section anchor="convert-section-a.2.14" numbered="true" toc="default">
          <name>Example 14</name>
          <t>
   The following example illustrates incoming label resolution based on the numerical value of
   the policy endpoint.</t>
          <t>
   FEC1:</t>
          <t>
   SR Policy advertisement from the controller to node A. Endpoint
   address=192.0.2.70, color=100, SID-List=&lt;S1, S2&gt;, and Binding-SID
   label=1021.</t>
          <t>
   FEC2:</t>
          <t>
   SR Policy advertisement from the controller to node A. Endpoint
   address=192.0.2.71, color=100, SID-List=&lt;S3, S4&gt;, and Binding-SID
   label=1021.</t>
          <t>
   The FEC tiebreakers match, and they have the
   same address family. Thus, FEC1 wins by having the lower numerical endpoint
   address value.</t>
        </section>
      </section>
      <section anchor="convert-section-a.3" numbered="true" toc="default">
        <name>Examples for the Effect of Incoming Label Collision on an Outgoing Label</name>
        <t>
   This section presents examples to illustrate the effect of incoming
   label collision on the selection of the outgoing label as described in
   <xref target="convert-section-2.6" format="default"/>.</t>
        <section anchor="convert-section-a.3.1" numbered="true" toc="default">
          <name>Example 1</name>
          <t>
   The following example illustrates the effect of incoming label resolution on the
   outgoing label.</t>
          <t>
   FEC1:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node B for
   203.0.113.122/32 with index 22. Assuming that the IS-IS SRGB on node A
   is [1000,1999], the corresponding incoming label is 1022.</t>
          <t>
   FEC2:</t>
          <t>
   IS-IS on node A receives a Prefix SID advertisement from node C for
   203.0.113.222/32 with index=22. Assuming that the IS-IS SRGB on node A
   is [1000,1999], the corresponding incoming label is 1022.</t>
          <t>

   FEC1 wins based on the lowest numerical prefix value.  This means that
   node A installs a transit MPLS forwarding entry to swap incoming
   label 1022 with outgoing label N and to use outgoing interface I. N is
   determined by the index associated with FEC1 (index 22) and the SRGB
   advertised by the next-hop node on the shortest path to reach
   203.0.113.122/32.</t>
          <t>
   Node A will generally also install an imposition MPLS forwarding
   entry corresponding to FEC1 for incoming prefix=203.0.113.122/32
   pushing outgoing label N, and using outgoing interface I.</t>
          <t>
   The rule in <xref target="convert-section-2.6" format="default"/> means node A <bcp14>MUST NOT</bcp14> install an ingress
   MPLS forwarding entry corresponding to FEC2 (the losing FEC, which
   would be for prefix 203.0.113.222/32).</t>
        </section>
        <section anchor="convert-section-a.3.2" numbered="true" toc="default">
          <name>Example 2</name>
          <t>
   The following example illustrates the effect of incoming label collision resolution on
   outgoing label programming on node A.</t>
          <t>
   FEC1:</t>
       
            <t>SR Policy advertisement from the controller to node A.
            Endpoint address=192.0.2.80, color=100, SID-List=&lt;S1, S2&gt;, and 
            Binding-SID label=1023.
          </t>
          <t>
   FEC2:</t>
          <t>
            SR Policy advertisement from controller to node A.
            Endpoint address=192.0.2.81, color=100, SID-List=&lt;S3, S4&gt;, and
            Binding-SID label=1023.
          </t>
     
          <t>
   FEC1 wins by having the lower numerical endpoint address value. This
   means that node A installs a transit MPLS forwarding entry to swap
   incoming label=1023 with outgoing labels, and the outgoing interface
   is determined by the SID-List for FEC1.</t>
          <t>
   In this example, we assume that node A receives two BGP/VPN routes:</t>

          <ul spacing="normal">
            <li>R1 with VPN label=V1, BGP next-hop = 192.0.2.80, and color=100</li>
            <li>R2 with VPN label=V2, BGP next-hop = 192.0.2.81, and color=100</li>
          </ul>
          <t>
   We also assume that node A has a BGP policy that matches color=100
   and allows its usage as Service Level Agreement (SLA) steering information. In this case,
   node A will install a VPN route with label stack = &lt;S1,S2,V1&gt;
   (corresponding to FEC1).</t>
          <t>
   The rule described in <xref target="convert-section-2.6" format="default"/> means that node A <bcp14>MUST NOT</bcp14> install
   a VPN route with label stack = &lt;S3,S4,V1&gt; (corresponding to FEC2.)</t>
        </section>
      </section>
    </section>
    <section anchor="convert-section-7" numbered="false" toc="default">
      <name>Acknowledgements</name>
      <t>
   The authors would like to thank Les Ginsberg, Chris Bowers, Himanshu
   Shah, Adrian Farrel, Alexander Vainshtein, Przemyslaw Krol, Darren
   Dukes, Zafar Ali, and Martin Vigoureux for their valuable comments on
   this document.</t>
    </section>
    <section anchor="convert-section-6" numbered="false" toc="default">
      <name>Contributors</name>
      <t>
   The following contributors have substantially helped the definition
   and editing of the content of this document:</t>
      <artwork name="" type="" align="left" alt=""><![CDATA[
Martin Horneffer
Deutsche Telekom
Email: Martin.Horneffer@telekom.de]]></artwork>

<artwork name="" type="" align="left" alt=""><![CDATA[
Wim Henderickx
Nokia
Email: wim.henderickx@nokia.com]]></artwork>

<artwork name="" type="" align="left" alt=""><![CDATA[
Jeff Tantsura
Email: jefftant@gmail.com]]></artwork>

<artwork name="" type="" align="left" alt=""><![CDATA[
Edward Crabbe
Email: edward.crabbe@gmail.com]]></artwork>

<artwork name="" type="" align="left" alt=""><![CDATA[
Igor Milojevic
Email: milojevicigor@gmail.com]]></artwork>

<artwork name="" type="" align="left" alt=""><![CDATA[
Saku Ytti
Email: saku@ytti.fi]]></artwork>
    </section>
    <!-- [rfced] Throughout the text, the following terminology appears to be used 
inconsistently. Please review these occurrences and let us know if/how they
may be made consistent.  

A is [1000,1999] vs. A = [1000,1999]

index=X vs. index X vs. index "X"

label=X vs. label = X

  (where X is the value)

routing Instance ID = 1000 vs. Routing Instance ID 1000

SID "8" vs. SID index "8" vs.  SID index 8 vs. IGP SID "8"

SRGB is [1000,1999] vs. SRGB [1000,1999] 
-->
  </back>
</rfc>
