<?xml version="1.0" encoding="US-ASCII" ?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'> 
<!ENTITY RFC2234 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2234.xml'>     
<!ENTITY RFC3588 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3588.xml'>     
<!ENTITY RFC4004 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4004.xml'> 
<!ENTITY RFC4005 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4005.xml'> 
<!ENTITY RFC4072 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4072.xml'> 
<!ENTITY RFC3753 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3753.xml'> 
<!ENTITY RFC2136 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2136.xml'> 
<!ENTITY RFC4640 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4640.xml'>
<!ENTITY RFC3775 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3775.xml'> 
<!ENTITY RFC4186 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4186.xml'> 
<!ENTITY RFC5026 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5026.xml'> 
<!ENTITY RFC5226 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5226.xml'> 
<!ENTITY RFC2865 PUBLIC ''
'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2865.xml'> 


]>

<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes" ?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes"?>
<?rfc strict="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<?rfc rfcedstyle="yes" ?>

<rfc number="5447" category="std">
   <front>
      <title abbrev="Diameter MIPv6 NAS-to-HAAA Interaction">Diameter
	Mobile IPv6: 
Support&nbsp;for&nbsp;Network&nbsp;Access&nbsp;Server&nbsp;to&nbsp;Diameter&nbsp;Server&nbsp;Interaction</title>

      <author role="editor" initials="J" surname="Korhonen" fullname="Jouni Korhonen">
         <organization>Nokia Siemens Networks</organization>
         <address>
                <postal>
                    <street>Linnoitustie 6</street>
                    <city>Espoo</city>
                    <code>FIN-02600</code>
                    <country>Finland</country>
                </postal>
                <email>jouni.nospam@gmail.com</email>
            </address>
      </author>

      <author fullname="Julien Bournelle" surname="Bournelle" initials="J.">
         <organization>Orange Labs</organization>
         <address>
       <postal>
         <street>38-4O rue du general Leclerc</street>
         <city>Issy-Les-Moulineaux</city>
         <code>92794</code>
         <country>France</country>
       </postal>
       <email>julien.bournelle@orange-ftgroup.com</email>
     </address>
      </author>


      <author initials="H." surname="Tschofenig" fullname="Hannes Tschofenig">
         <organization>Nokia Siemens Networks</organization>
         <address>
             <postal>
                <street>Linnoitustie 6</street>
                <city>Espoo</city>
                <code>02600</code>
                <country>Finland</country>
             </postal>
             <email>Hannes.Tschofenig@nsn.com</email>
             <uri>http://www.tschofenig.priv.at</uri>
          </address>
      </author>

      <author initials="C. E." surname="Perkins" fullname="Charles E. Perkins">
         <organization abbrev="WiChorus">WiChorus Inc.</organization>
         <address>
                <postal>
                    <street>3590 North First St., Suite 300</street>
                    <city>San Jose</city><region>CA</region>
                    <code>95134</code>
                    <country>US</country>
                </postal>
                <email>charliep@wichorus.com</email>
            </address>
      </author>

      <author initials="K." surname="Chowdhury" fullname="Kuntal Chowdhury">
         <organization>Starent Networks</organization>
         <address>
                <postal>
                    <street>30 International Place</street>
                    <city>Tewksbury</city><region>MA</region>
                    <code>01876</code>
                    <country>US</country>
                </postal>
                <email>kchowdhury@starentnetworks.com</email>
            </address>
      </author>



      <date month="February" year="2009"/>
      <area>Operations and Management</area>
      <workgroup>Diameter Maintenance and Extensions (DIME)</workgroup>

      <keyword>Diameter</keyword>
      <keyword>Mobile IPv6</keyword>
      <keyword>Integrated Scenario</keyword>

      <abstract>
         <t>A Mobile IPv6 node requires a home agent address, a home
            address, and a security association with its home agent
            before it can start utilizing Mobile IPv6. RFC 3775
            requires that some or all of these parameters be
            statically configured. Mobile IPv6 bootstrapping work aims
            to make this information dynamically available to the
            mobile node. An important aspect of the Mobile IPv6
            bootstrapping solution is to support interworking with
            existing Authentication, Authorization, and Accounting (AAA)
            infrastructures.  This document describes MIPv6
            bootstrapping using the Diameter Network Access Server to
            home AAA server interface. </t>
      </abstract>
   </front>
   <middle>
      <!-- ====================================================================== -->
      <section anchor="introduction" title="Introduction">
         <t>The Mobile IPv6 (MIPv6) specification <xref target="RFC3775"/> requires a mobile node
            (MN) to perform registration with a home agent (HA) with information about its current
            point of attachment (care-of address). The HA creates and
            maintains the binding between the
            MN's home address and the MN's care-of address.
         </t>

         <t>In order to register with an HA, the MN needs to know some information, such as the home
            link prefix, the HA address, the home address(es), the
            home link prefix length, and security-association-related information. 
         </t>

         <t>The aforementioned information may be statically configured. However, static
            provisioning becomes an administrative burden for an operator. Moreover, it does not
            address load balancing, failover, opportunistic home link assignment, or assignment of
            local HAs in close proximity to the MN. Also, the ability to react to sudden
            environmental or topological changes is minimal. Static provisioning may not be
            desirable, in light of these limitations.
         </t>

         <t>Dynamic assignment of MIPv6 home registration information is a desirable feature for
            ease of deployment and network maintenance. For this
            purpose, the AAA infrastructure,
            which is used for access authentication, can be leveraged to assign some or all of the
            necessary parameters. The Diameter server in the Access Service Provider's (ASP's) or
            Mobility Service Provider's (MSP's) network may return these parameters to the AAA client.
            Regarding the bootstrapping procedures, the AAA client might either be the Network
            Access Server, in case
            of the integrated scenario, or the HA, in case of the split scenario <xref
               target="RFC5026"/>. The terms "integrated" and "split"
            are described in the following terminology
            section and were introduced in <xref target="RFC4640"/> and <xref
               target="AAA"/>. </t>
      </section>

      <!-- ====================================================================== -->
      <section anchor="terms" title="Terminology and Abbreviations">
         <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD
            NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as
            described in RFC 2119 <xref target="RFC2119"/>. </t>

         <t>General mobility terminology can be found in <xref target="RFC3753"/>. The following
            additional terms are either borrowed from <xref
            target="RFC4640"/> or <xref target="RFC5026"/> or are introduced in this document:
         </t>

         <t>
            <list style="hanging">
               <t hangText="Access Service Authorizer (ASA):">
                  <vspace blankLines="1"/>A network operator that authenticates an MN and establishes
                  the MN's authorization to receive Internet service.

               </t>

               <t hangText="Access Service Provider (ASP):">
                  <vspace blankLines="1"/> A network operator that
                  provides direct IP packet-forwarding to and from the MN. 

               </t>
               <t hangText="Mobility Service Authorizer (MSA):">
                  <vspace blankLines="1"/> A service provider that authorizes MIPv6 service. 

               </t>
               <t hangText="Mobility Service Provider (MSP):">
                  <vspace blankLines="1"/>A service provider that provides MIPv6 service. In order
                  to obtain such service, the MN must be authenticated
                  and authorized to do so.
               </t>
               <t hangText="Split Scenario:">
                  <vspace blankLines="1"/>A scenario where the mobility service and the network
                  access service are authorized by different entities.

               </t>
               <t hangText="Integrated Scenario:">
                  <vspace blankLines="1"/> A scenario where the mobility service and the network
                  access service are authorized by the same entity.

               </t>
               <t hangText="Network Access Server (NAS):">
                  <vspace blankLines="1"/>A device that provides an access service for a user to a
                  network.

               </t>
               <t hangText="Home AAA (HAAA):">
                  <vspace blankLines="1"/> An Authentication, Authorization, and Accounting server
                  located in the user's home network, i.e., in the home realm.

               </t>
               <t hangText="Local AAA (LAAA):">
                  <vspace blankLines="1"/> An Authentication, Authorization, and Accounting proxy
                  located in the local (ASP) network.

               </t>

               <t hangText="Visited AAA (VAAA):">
                  <vspace blankLines="1"/> An Authentication, Authorization, and Accounting proxy
                  located in a visited network, i.e., in the visited realm. In a roaming case, the
                  local Diameter proxy has the VAAA role (see <xref target="integrated-scenario"/>).
               </t>
            </list>
         </t>
      </section>

      <!-- ====================================================================== -->
      <section title="Overview">
         <t>This document addresses the Authentication, Authorization,
            and Accounting (AAA) functionality
            required for the MIPv6 bootstrapping solutions outlined in
            <xref target="RFC4640"/>, and 
            focuses on the Diameter-based AAA functionality for the
            NAS-to-HAAA (home AAA) server communication.
         </t>

         <t>In the integrated scenario, MIPv6 bootstrapping is provided
            as part of the network access authentication
            procedure.
            <xref target="integrated-scenario"/> shows the participating
            entities. </t>

         <figure anchor="integrated-scenario"
               title="Mobile IPv6 Bootstrapping in the Integrated Scenario">

               <artwork><![CDATA[
                   +---------------------------+  +-----------------+
                   |Access Service Provider    |  |ASA/MSA/(MSP)    |
                   |(Mobility Service Provider)|  |                 |
                   |                           |  |                 |
                   | +--------+                |  |    +--------+   |
                   | |Local   |      Diameter  |  |    |Home    |   |
                   | |Diameter|<---------------------->|Diameter|   |
                   | |Proxy   |         (*)    |  |    |Server  |   |
                   | +--------+                |  |    +--------+   |
                   |     ^ ^                   |  |        ^        |
                   |     | |                   |  |        |(+)     |
                   |     | |                   |  |        |        |
                   |   Diameter                |  |        v        |
                   |     | |(+)      +-------+ |  |    +-------+    |
                   |     | |         |Home   | |  |    |Home   |    |
                   |     | +-------->|Agent  | |  |    |Agent  |    |
                   |  (*)|           |in ASP | |  |    |in MSP |    |
                   |     v           +-------+ |  |    +-------+    |
+-------+ IEEE     | +-----------+   +-------+ |  +-----------------+
|Mobile | 802.1X   | |NAS/Relay  |   |DHCPv6 | |
|Node   |------------|Diameter   |---|Server | |
|       | PANA,    | |Client     |(+)|       | |
+-------+ IKEv2,   | +-----------+   +-------+ |
          DHCP,... +---------------------------+
          (+)

Legend: 
  (*): Functionality in scope of this specification. 
  (+): Extensions described in other documents.
]]></artwork>
         </figure>
         <t>In a typical MIPv6 access scenario, an MN is attached to an
            ASP's network. During the network attachment procedure,
            the MN interacts with the NAS/Diameter
            client. Subsequently, the NAS/Diameter client interacts
            with the Diameter server over the NAS-to-HAAA interface.
         </t>
         <t>When the Diameter server performs the authentication and
            authorization for network access, it
            also determines whether the user is authorized for the
            MIPv6 service. Based on the MIPv6 service authorization
            and the user's policy profile,
            the  Diameter server may return several MIPv6
            bootstrapping-related parameters to the NAS. The
            NAS-to-HAAA interface described in this document is not
            tied to the Dynamic Host Configuration Protocol for IPv6
            (DHCPv6) as the only mechanism to convey MIPv6-related
            configuration parameters from the NAS/Diameter client to the
            mobile node. 
         </t>
         <t>While this specification addresses the bootstrapping of
            MIPv6 HA information and possibly the assignment of the
            home link prefix, it does not address how the Security
            Association (SA) between the MN and the HA for MIPv6
            purposes is created. The creation or the use of the SA
            between the MN and the HA takes places after the procedures
            described in this specification, and therefore are out of scope.
         </t>
      </section>


      <!-- ====================================================================== -->


      <section anchor="cmds" title="Commands, Attribute-Value Pairs, and Advertising Application Support">


         <section anchor="apps" title="Advertising Application Support">
            <t>This document does not define a new application. On the
               other hand, it defines a number of attribute-value
               pairs (AVPs) used in the interface between NAS to
               HAAA for the integrated scenario of MIPv6 bootstrapping.
               These AVPs can be used with any present and future Diameter
               applications, where permitted by the command ABNF. The
               examples using existing applications and their commands
               in the following sections are for informational
               purposes only. The  examples in this document reuse the
               Extensible Authentication Protocol (EAP)
               <xref target="RFC4072"/> application and its respective
               commands. 
            </t>
         </section>



         <section title="Attribute-Value Pair Definitions">
            <section title="MIP6-Agent-Info AVP">

               <t>The MIP6-Agent-Info AVP (AVP code 486) is of type Grouped and
                  contains necessary information to assign an HA to the MN. When
                  the MIP6-Agent-Info AVP is present in a
                  message, it MUST contain either the MIP-Home-Agent-Address AVP, the
                  MIP-Home-Agent-Host AVP, or both AVPs. The grouped
                  AVP has the following modified ABNF (as defined in
                  <xref target="RFC3588"/>):
               </t>
               <figure>
<artwork><![CDATA[
    MIP6-Agent-Info ::= < AVP-Header: 486 >
                      *2[ MIP-Home-Agent-Address ]
                        [ MIP-Home-Agent-Host ]
                        [ MIP6-Home-Link-Prefix ]
                      * [ AVP ]
]]></artwork>
               </figure>

               <t>If both the MIP-Home-Agent-Address and
                  MIP-Home-Agent-Host APVs are present in the
                  MIP6-Agent-Info, the MIP-Home-Agent-Address SHOULD
                  have a precedence over the MIP-Home-Agent-Host. The
                  reason for this recommendation is that the
                  MIP-Home-Agent-Address points to a specific home
                  agent, whereas the MIP-Home-Agent-Host may point to
                  a group of HAs located within the same realm.
                  A Diameter client or agent may use
                  the MIP-Home-Agent-Host AVP, for instance, to find
                  out in which realm the HA is located.
               </t>
               <t>The ABNF allows returning up to two MIPv6 HA
                  addresses. This is a useful feature for deployments
                  where the HA has both IPv6 and IPv4 addresses, and
                  particularly addresses Dual Stack Mobile IPv6
                  (DSMIPv6) deployment scenarios <xref
                  target="DSMIPv6"/>.
               </t>
               <t>The MIP6-Agent-Info AVP 
                  MAY also be attached by the NAS or by the intermediating Diameter
                  proxies in a request message when sent to the Diameter server 
                  as a hint of a locally assigned HA. This AVP MAY also be attached by the
                  intermediating Diameter proxies in a reply message from the Diameter server, 
                  if locally assigned HAs are authorized by the
                  Diameter server. There MAY be multiple instances of
                  the MIP6-Agent-Info AVP in Diameter messages, for
                  example, in cases where the NAS receives HA
                  information from an MN's home network and locally
                  allocated HA information from the visited
                  network. See <xref target="capability"/> for further
                  discussion on possible scenarios.
               </t>
            </section>

            <section title="MIP-Home-Agent-Address AVP">

               <t>The MIP-Home-Agent-Address AVP (AVP Code 334 <xref target="RFC4004"/>) is of type
                  Address and contains the IPv6 or IPv4 address of the
                  MIPv6 HA. 
                  The Diameter server MAY decide to assign an
                  HA to the MN that is in close proximity to the point of attachment (e.g., determined
                  by the NAS-Identifier AVP). There may be other reasons for dynamically assigning
                  HAs to the MN, for example, to share the traffic load. </t>
            </section>

            <section title="MIP-Home-Agent-Host AVP">
               <t>The MIP-Home-Agent-Host AVP (AVP Code 348 <xref target="RFC4004"/>) is of type
                  Grouped and contains the identity of the assigned
                  MIPv6 HA. Both the Destination-Realm
                  and the Destination-Host AVPs of the HA are included in the grouped AVP.
                  The usage of the MIP-Home-Agent-Host AVP is equivalent to the
                  MIP-Home-Agent-Address AVP but offers an
                  additional level of indirection by using the DNS
                  infrastructure. The Destination-Host AVP is used to identify an
                  HA, and the Destination-Realm AVP is used to identify the
                  realm where the HA is located.
               </t>
               <t>Depending on the actual deployment and DNS configuration, the
                  Destination-Host AVP MAY represent one or more home
                  agents. It is RECOMMENDED that the Destination-Host
                  AVP identifies exactly one HA.
               </t>
               <t>It is RECOMMENDED that the MIP-Home-Agent-Host AVP is always included
                  in the MIP6-Agent-Info AVP.  In this way, the HA can be associated with the
                  corresponding realm of the Diameter entity that added the MIP6-Agent-Info
                  AVP using the Destination-Realm AVP, which is included in the MIP-Home-Agent-Host
                  AVP.
               </t>


            </section>

            <section title="MIP6-Home-Link-Prefix AVP">
               <t>The MIP6-Home-Link-Prefix AVP (AVP Code 125) 
  		 is of type OctetString and contains
                  the Mobile IPv6 home network prefix information in a
                  network byte order. The home network prefix MUST be
                  encoded as the 8-bit prefix length information (one octet)
                  followed by the 128-bit field (16 octets) for the available home
                  network prefix. The trailing bits of the IPv6 prefix after the
                  prefix length bits MUST be set to zero (e.g., if the prefix
                  length is 60, then the remaining 68 bits MUST be set to zero).
               </t>
               <t>The HAAA MAY act as a central entity managing prefixes for MNs.  In
                  this case, the HAAA returns to the NAS the prefix allocated to the MN.
                  The NAS/ASP then delivers the home link prefix to the MN using, e.g., mechanisms
                  described in <xref target="INTEGRATED"/>.
                  The NAS/ASP MAY propose to the HAAA a specific
                  prefix to allocate to the MN by including the MIP6-Home-Link-Prefix
                  AVP in the request message. However, the HAAA MAY override the
                  prefix allocation hint proposed by the NAS/ASP and return a different
                  prefix in the response message.
               </t>
            </section>

            <section title="MIP6-Feature-Vector AVP" anchor="capability">
               <t>The MIP6-Feature-Vector AVP (AVP Code 124) is of
		 type Unsigned64 and contains a 64-bit flags field of
		 supported capabilities of the NAS/ASP. Sending and receiving
                  the MIP6-Feature-Vector AVP with value 0 MUST be supported, although that does not
                  provide much guidance about specific needs of bootstrapping. </t>

               <t>The NAS MAY include this AVP to indicate capabilities of the NAS/ASP to the
                  Diameter server. For example, the NAS may indicate that a local HA can be
                  provided. Similarly, the Diameter server MAY include this AVP to inform the
                  NAS/ASP about which of the NAS/ASP indicated capabilities are supported or
                  authorized by the ASA/MSA(/MSP). </t>

               <t>The following capabilities are defined in this document:
               </t>

               <t>
                  <list style="hanging">

                     <t hangText="MIP6_INTEGRATED (0x0000000000000001)">
                        <vspace blankLines="1"/>When this flag is set by the NAS,
                        it means that the Mobile IPv6 integrated scenario
                        bootstrapping functionality is supported
                        by the NAS. When this flag is set by the Diameter server,
                        then the Mobile IPv6 integrated scenario bootstrapping is
                        supported by the Diameter server.

                     </t>
                     <t hangText="LOCAL_HOME_AGENT_ASSIGNMENT (0x0000000000000002)">
                        <vspace blankLines="1"/> When this flag is set in the
                        request message, a local home
                        agent outside the home realm is requested and may be assigned
                        to the MN. When this flag is set by the Diameter 
                        server in the answer message, then the assignment of local HAs is
                        authorized by the Diameter server.
                        <vspace blankLines="1"/>
                        A local HA may be assigned by the NAS, LAAA, or
                        VAAA depending on the network architecture and the
                        deployment.
                     </t>
                  </list>
               </t>

               <t>The following examples show how the
                  LOCAL_HOME_AGENT_ASSIGNMENT (referred to as LOCAL-bit
                  in the examples) capability and the
                  MIP-Agent-Info AVP (referred to as HA-Info in the
                  examples) are used to assign HAs -- either a local
                  HA (L-HA) or a home network HA (H-HA). Below
                  are examples of request message combinations as seen by the HAAA:
<figure><artwork><![CDATA[
 LOCAL-bit  HA-Info  Meaning

   0          -      ASP or [LV]AAA is not able to assign an L-HA.
   0         L-HA    Same as above.  HA-Info must be ignored.
   1          -      ASP or [LV]AAA can/wishes to assign an L-HA.
   1         L-HA    Same as above but the ASP or [LV]AAA also
                     provides a hint of the assigned L-HA.
]]></artwork></figure>
               </t>

               <t>The same as above but for answer message
 combinations as seen by the NAS:
<figure><artwork><![CDATA[
 LOCAL-bit  HA-Info  Meaning

   0          -      No HA assignment allowed for HAAA or [LV]AAA.
   0         H-HA    L-HA is not allowed.  HAAA assigns an H-HA.
   1          -      L-HA is allowed.  No HAAA- or [LV]AAA-assigned HA.
   1         L-HA    L-HA is allowed.  [LV]AAA also assigns an L-HA.
   1         H-HA    L-HA is allowed.  HAAA also assigns an HA.
   1         H-HA    L-HA is allowed.  HAAA assigns an H-HA and
           + L-HA    [LV]AAA also assigns an L-HA.
]]></artwork></figure>

   An NAS should expect to receive multiple MIP6-Agent-Info AVPs.
               </t>
            </section>
         </section>
      </section>

      <!-- ====================================================================== -->
      <!-- ====================================================================== -->
      <section title="Examples">

         <section title="Home Agent Assignment by the NAS">

            <t>In this scenario, we consider the case where the NAS wishes to allocate a local HA to
               the MN. The NAS will also inform the Diameter server about the HA address it has
               assigned to the visiting MN (e.g., 2001:db8:1:c020::1). The Diameter-EAP-Request
               message, therefore, has the MIP6-Feature-Vector with the LOCAL_HOME_AGENT_ASSIGNMENT
               and the MIP6_INTEGRATED set. The MIP6-Agent-Info AVP contains the
               MIP-Home-Agent-Address AVP with the address of the proposed HA. </t>

            <t>
               <figure anchor="example3" title="Home Agent Assignment
               by the NAS">
                  <artwork><![CDATA[
                                                             Diameter
NAS/VAAA                                                       Server
 |                                                                 |
 |  Diameter-EAP-Request                                           |
 |  MIP6-Feature-Vector=(LOCAL_HOME_AGENT_ASSIGNMENT               |
 |                       | MIP6_INTEGRATED)                        |
 |  MIP6-Agent-Info{                                               |
 |       MIP-Home-Agent-Address(2001:db8:1:c020::1)}               |
 |  }                                                              |
 |  Auth-Request-Type=AUTHORIZE_AUTHENTICATE                       |
 |  EAP-Payload(EAP Start)                                         |
 |---------------------------------------------------------------->|
 |                                                                 |
 |                                                                 |
 :              ...more EAP Request/Response pairs...              :
 |                                                                 |
 |                                                                 |
 |                                            Diameter-EAP-Answer  |
 |               MIP6-Feature-Vector=(LOCAL_HOME_AGENT_ASSIGNMENT  |
 |                                    | MIP6_INTEGRATED)           |
 |                                   Result-Code=DIAMETER_SUCCESS  |
 |                                       EAP-Payload(EAP Success)  |
 |                                         EAP-Master-Session-Key  |
 |                                           (authorization AVPs)  |
 |                                                           ...   |
 |<----------------------------------------------------------------|
 |                                                                 |
          ]]></artwork>
               </figure>
            </t>
            <t>Depending on the Diameter server's configuration and the user's
               subscription profile, the Diameter server either accepts or rejects
               the local HA allocated by the NAS.
               In our example, the Diameter server accepts the proposal, and
               the MIP6-Feature-Vector AVP with LOCAL_HOME_AGENT_ASSIGNMENT flag (together with the
               MIP6_INTEGRATED flag) is set and returned to the NAS. </t>
         </section>

         <section title="Home Agent Assignment by the Diameter Server">

            <t>In this scenario, we consider the case where the NAS supports the Diameter MIPv6
               integrated scenario as defined in this document, but does not offer local HA
               assignment. Hence, the MIP6-Feature-Vector AVP only has the MIP6_INTEGRATED flag set.
               The Diameter server allocates an HA to the mobile node and conveys the address
               in the MIP-Home-Agent-Address AVP that is encapsulated in the MIP6-Agent-Info AVP.
               Additionally, the MIP6-Feature-Vector AVP has the MIP6_INTEGRATED flag set.</t>

            <t>
               <figure anchor="example2" title="Home Agent Assignment by the Diameter Server">
                  <artwork><![CDATA[
                                                             Diameter
NAS                                                            Server
 |                                                                 |
 |  Diameter-EAP-Request                                           |
 |  MIP6-Feature-Vector=(MIP6_INTEGRATED)                          |
 |  Auth-Request-Type=AUTHORIZE_AUTHENTICATE                       |
 |  EAP-Payload(EAP Start)                                         |
 |---------------------------------------------------------------->|
 |                                                                 |
 |                                                                 |
 :              ...more EAP Request/Response pairs...              :
 |                                                                 |
 |                                                                 |
 |                                            Diameter-EAP-Answer  |
 |                                               MIP6-Agent-Info{  |
 |            MIP-Home-Agent-Address(2001:db8:6000:302::1)         |
 |                                                              }  |
 |                          MIP6-Feature-Vector=(MIP6_INTEGRATED)  |
 |                                   Result-Code=DIAMETER_SUCCESS  |
 |                                       EAP-Payload(EAP Success)  |
 |                                         EAP-Master-Session-Key  |
 |                                           (authorization AVPs)  |
 |                                                           ...   |
 |<----------------------------------------------------------------|
 |                                                                 |
          ]]></artwork>
               </figure>
            </t>



         </section>

         <section title="Home Agent Assignment by the NAS or Diameter Server">
            <t>This section shows another message flow for the MIPv6 integrated scenario
               bootstrapping where the NAS informs the Diameter server that it is
               able to locally assign an HA to the MN.
               The Diameter server is able to provide an HA to the MN but also authorizes the
               assignment of the local HA. The Diameter server then
               replies to the NAS with HA&nbhy;related
               bootstrapping information.</t>

            <t>Whether the NAS/ASP then offers a locally
               assigned HA or the Diameter-server-assigned HA to the MN
               is, in this example, based on the local ASP policy. </t>
            <t>
               <figure anchor="example1" title="Home Agent Assignment
               by the NAS or Diameter Server">
                  <artwork><![CDATA[
                                                             Diameter
NAS/VAAA                                                       Server
 |                                                                 |
 |  Diameter-EAP-Request                                           |
 |  MIP6-Feature-Vector=(LOCAL_HOME_AGENT_ASSIGNMENT               |
 |                       | MIP6_INTEGRATED)                        |
 |  MIP6-Agent-Info{                                               |
 |       MIP-Home-Agent-Address(2001:db8:1:c020::1)}               |
 |  }                                                              |
 |  Auth-Request-Type=AUTHORIZE_AUTHENTICATE                       |
 |  EAP-Payload(EAP Start)                                         |
 |---------------------------------------------------------------->|
 |                                                                 |
 |                                                                 |
 :              ...more EAP Request/Response pairs...              :
 |                                                                 |
 |                                                                 |
 |                                            Diameter-EAP-Answer  |
 |                                               MIP6-Agent-Info{  |
 |                  MIP-Home-Agent-Address(2001:db8:6000:302::1)}  |
 |               MIP6-Feature-Vector=(LOCAL_HOME_AGENT_ASSIGNMENT  |
 |                                    | MIP6_INTEGRATED)           |
 |                                   Result-Code=DIAMETER_SUCCESS  |
 |                                       EAP-Payload(EAP Success)  |
 |                                         EAP-Master-Session-Key  |
 |                                           (authorization AVPs)  |
 |                                                           ...   |
 |<----------------------------------------------------------------|
 |                                                                 |
                   ]]></artwork>
               </figure>
            </t>
            <t>If the Diameter server does not allow the MN to use a locally
               assigned HA, the Diameter server returns to the MN the MIP6-Feature-Vector AVP with
               the LOCAL_HOME_AGENT_ASSIGNMENT bit unset and the HA address it
               allocated.
            </t>
         </section>

      </section>

      <!-- ====================================================================== -->
      <section title="Attribute-Value Pair Occurrence Tables" anchor="nasavpoccurance">
         <!--section anchor="nasavptable" title="AAR, ACommands AVP Table"-->
            <t><xref target="nasavptable"/> lists the MIPv6 bootstrapping NAS-to-HAAA
               interface AVPs along with a specification determining how many
               of each new AVP may be included in a Diameter command.  They may
               be present in any Diameter application request and answer commands,
               where permitted by the command ABNF.
            </t>
            <t>
               <figure anchor="nasavptable"
                  title="Generic Request and Answer Commands AVP Table">
                  <artwork><![CDATA[
                                  +-----------+
                                  |  Command  | 
                                  |-----+-----+
   Attribute Name                 | Req | Ans |
   -------------------------------|-----+-----|
   MIP6-Agent-Info                | 0+  | 0+  |
   MIP6-Feature-Vector            | 0-1 | 0-1 |
                                  +-----+-----+
                  ]]></artwork>
               </figure>
            </t>
      </section>


      <!-- ====================================================================== -->
      <!-- ====================================================================== -->

      <section title="IANA Considerations">
         <section title="Registration of New AVPs">
            <t>This specification defines the following AVPs that have
              been allocated
              from a normal Diameter AVP Code space (values >= 256):
             <figure><artwork><![CDATA[
  MIP6-Agent-Info                is set to 486
             ]]></artwork></figure>
           </t>
           <t>The following new AVPs are to be allocated from RADIUS
	     Attribute Type space <xref target="RFC2865"/> so that they are
	     RADIUS backward-compatible (AVP Code values between 0-255):
             <figure><artwork><![CDATA[
  MIP6-Feature-Vector            is set to 124
  MIP6-Home-Link-Prefix          is set to 125
             ]]></artwork></figure>
           </t>
         </section>

         <section title="New Registry: Mobility Capability">
            <t>IANA has created a new registry for the Mobility Capability as described
               in <xref target="capability"/>. <figure>
                  <artwork><![CDATA[
Token                             | Value               | Description
----------------------------------+---------------------+------------
MIP6_INTEGRATED                   | 0x0000000000000001  | [RFC5447]
LOCAL_HOME_AGENT_ASSIGNMENT       | 0x0000000000000002  | [RFC5447]
Available for Assignment via IANA | 2^x                 |    
                ]]></artwork>
               </figure> Allocation rule: Only numeric values that are
               2^x (power of two, where x >= 2) are
               allowed, based on the allocation policy described below.
            </t>

            <t>Following the example policies described in <xref
               target="RFC5226"/>, new values for the
               Mobility Capability Registry 
	      will be assigned based on the
               "Specification Required" policy.  No mechanism to mark
               entries as "deprecated" is envisioned.
            </t>
         </section>
      </section>



      <!-- ====================================================================== -->
      <section title="Security Considerations">
         <t>The security considerations for the Diameter interaction required to accomplish the
            integrated scenario are described in <xref
               target="INTEGRATED"/>. Additionally, the security
            considerations for the Diameter base protocol
            <xref target="RFC3588"/>, the Diameter NASREQ
            application <xref target="RFC4005"/>, and the Diameter EAP
            application (with respect to network access authentication
            and the transport of keying material) <xref target="RFC4072"/> are
            applicable to this document.
            Developers should insure that special attention is paid to
            configuring the security associations protecting the messages
            that enable the global positioning and allocation of home agents,
            for instance, as outlined in Section 5.
         </t>
         <t>Furthermore, the Diameter messages may be transported
	   between the NAS and the Diameter server via one or more AAA
	   brokers or Diameter agents (such as proxies).  In this
	   case, the AAA communication from the NAS to the
	   Diameter server relies
	   on the security properties of the intermediate AAA brokers and Diameter agents.</t>
      </section>

      <!-- ====================================================================== -->
      <section title="Acknowledgments">
         <t>This document is heavily based on the ongoing work for
            RADIUS MIPv6 interaction. Hence, credits go to respective
            authors for their work with "RADIUS Mobile IPv6 Support"
            (November 2008).  Furthermore, the authors of this
            document would like to thank the authors of "Diameter
            Mobile IPv6 Application" (November 2004) --
            Franck Le, Basavaraj Patil, Charles E. Perkins, and
            Stefano Faccin -- for their work in the context of MIPv6
            Diameter interworking. Their work influenced this
            document. Jouni Korhonen would like to thank the Academy
            of Finland and TEKES MERCoNe Project for providing funding
            to work on this document while he was with
            TeliaSonera. Julien Bournelle would like to thank GET/INT
            since he began to work on this document while he was in
            their employ. Authors would also like to acknowledge
            Raymond Hsu for his valuable feedback on local HA
            assignment and Wolfgang Fritsche for his thorough
            review. Additionally, we would like to Domagoj Premec for
            his review comments.</t>

         <t>Finally, we would like to thank Alper Yegin, Robert Marks,
	   and David Frascone for their comments at the second WG Last
	   Call. </t>

      </section>
      <!-- ====================================================================== -->
      <!-- ====================================================================== -->

   </middle>
   <back>
      <references title="Normative References">
&RFC3588;
&RFC3775;
&RFC4072;
&RFC4004;
&RFC4005;
&RFC2119;
&RFC2865;
      </references>

      <references title="Informative References"> 
&RFC5026;
&RFC4640;
&RFC3753;
&RFC5226;

<reference anchor="AAA">
	<front>
<title>AAA Goals for Mobile IPv6</title>
	<author initials="G" surname="Giaretta" fullname="Gerardo Giaretta">
<organization/>
</author>
	<author initials="I" surname="Guardini" fullname="Ivano Guardini">
<organization/>
</author>
	<author initials="E" surname="Demaria" fullname="Elena Demaria">
<organization/>
</author>
	<author initials="J" surname="Bournelle" fullname="Julien Bournelle">
<organization/>
</author>
	<author initials="R" surname="Lopez" fullname="Rafa Lopez">
<organization/>
</author>
<date month="May" day="2" year="2008"/>
</front>
<seriesInfo name="Work in" value="Progress"/>
</reference>

<reference anchor="DSMIPv6">
	<front>
	<title>
Mobile IPv6 Support for Dual Stack Hosts and Routers (DSMIPv6)
</title>
	<author initials="H" surname="Solimand" fullname="Hesham  Soliman">
<organization/>
</author>
<date month="December" day="13" year="2008"/>
</front>
<seriesInfo name="Work in" value="Progress"/>
</reference>

<reference anchor="INTEGRATED">
	<front>
<title>MIP6-bootstrapping for the Integrated Scenario</title>
	<author initials="K" surname="Chowdhury" fullname="Kuntal Chowdhury">
<organization/>
</author>
	<author initials="A" surname="Yegin" fullname="Alper  Yegin">
<organization/>
</author>
<date month="April" day="21" year="2008"/>
</front>
<seriesInfo name="Work in" value="Progress"/>
</reference>


      </references>
   </back>

</rfc>
