<?xml version="1.0" encoding="US-ASCII"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [

<!ENTITY RFC2119 PUBLIC '' "reference.RFC.2119.xml">
<!ENTITY RFC4492 PUBLIC '' "reference.RFC.4492.xml">
<!ENTITY RFC4513 PUBLIC '' "reference.RFC.4513.xml">
<!ENTITY RFC5246 PUBLIC '' "reference.RFC.5246.xml">
<!ENTITY RFC5288 PUBLIC '' "reference.RFC.5288.xml">
<!ENTITY RFC5440 PUBLIC '' "reference.RFC.5440.xml">
<!ENTITY RFC5088 PUBLIC '' "reference.RFC.5088.xml">
<!ENTITY RFC5089 PUBLIC '' "reference.RFC.5089.xml">
<!ENTITY RFC5280 PUBLIC '' "reference.RFC.5280.xml">
<!ENTITY RFC5746 PUBLIC '' "reference.RFC.5746.xml">
<!ENTITY RFC5925 PUBLIC '' "reference.RFC.5925.xml">
<!ENTITY RFC6066 PUBLIC '' "reference.RFC.6066.xml">
<!ENTITY RFC6125 PUBLIC '' "reference.RFC.6125.xml">
<!ENTITY RFC6460 PUBLIC '' "reference.RFC.6460.xml">
<!ENTITY RFC6614 PUBLIC '' "reference.RFC.6614.xml">
<!ENTITY RFC6952 PUBLIC '' "reference.RFC.6952.xml">
<!ENTITY RFC6698 PUBLIC '' "reference.RFC.6698.xml">
<!ENTITY RFC7420 PUBLIC '' "reference.RFC.7420.xml">
<!ENTITY RFC7457 PUBLIC '' "reference.RFC.7457.xml">
<!ENTITY RFC7525 PUBLIC '' "reference.RFC.7525.xml">
<!ENTITY RFC7671 PUBLIC '' "reference.RFC.7671.xml">
<!ENTITY RFC8174 PUBLIC '' "reference.RFC.8174.xml">
<!ENTITY RFC8232 PUBLIC '' "reference.RFC.8232.xml">

]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

<?rfc toc="yes" ?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="4"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes"?>
<?rfc subcompact="no"?>
<?rfc compact="yes" ?>

<rfc category="std" number="8253" ipr="pre5378Trust200902" updates="5440" submissionType="IETF" consensus="yes">

  <front>
    <title abbrev="PCEPS">PCEPS: Usage of TLS to Provide a Secure Transport for the Path Computation Element Communication&nbsp;Protocol&nbsp;(PCEP)</title>
    <author fullname="Diego R. Lopez" initials="D. R." surname="Lopez">
      <organization>Telefonica I+D</organization>
      <address>
        <postal>
          <street>Don Ramon de la Cruz, 82</street>
          <city>Madrid</city>
          <region></region>
          <code>28006</code>
          <country>Spain</country>
        </postal>
        <phone>+34 913 129 041</phone>
        <email>diego.r.lopez@telefonica.com</email>
      </address>
    </author>
    <author fullname="Oscar Gonzalez de Dios" initials="O." surname="Gonzalez de Dios">
      <organization>Telefonica I+D</organization>
      <address>
        <postal>
          <street>Don Ramon de la Cruz, 82</street>
          <city>Madrid</city>
          <region></region>
          <code>28006</code>
          <country>Spain</country>
        </postal>
        <phone>+34 913 129 041</phone>
        <email>oscar.gonzalezdedios@telefonica.com</email>
      </address>
    </author>
    <author fullname="Qin Wu" initials="Q." surname="Wu">
      <organization>Huawei</organization>
      <address>
        <postal>
          <street>101 Software Avenue, Yuhua District</street>
          <city>Nanjing</city>
          <region>Jiangsu</region>
          <code>210012</code>
          <country>China</country>
        </postal>
        <email>sunseawq@huawei.com</email>
      </address>
    </author>
    <author fullname="Dhruv Dhody" initials="D." surname="Dhody">
      <organization>Huawei</organization>
      <address>
        <postal>
          <street>Divyashree Techno Park, Whitefield</street>
          <city>Bangalore</city>
          <region>KA</region>
          <code>560066</code>
          <country>India</country>
        </postal>
        <email>dhruv.ietf@gmail.com</email>
      </address>
    </author>
    <date month="October" year="2017"/>

    <area>Routing</area>
    <workgroup>PCE Working Group</workgroup>

    <keyword>PCE, PCEP, PCEPS, security, authentication, encryption, TLS</keyword>

    <abstract>
        <t>The Path Computation Element Communication Protocol (PCEP) defines
	the mechanisms for the communication between a Path Computation Client
	(PCC) and a Path Computation Element (PCE), or among PCEs. This
	document describes PCEPS -- the usage of Transport Layer Security (TLS) to
	provide a secure transport for PCEP.
	The additional security mechanisms are provided by the transport
	protocol supporting PCEP; therefore, they do not affect the
	flexibility and extensibility of PCEP.</t>


        <t>This document updates RFC 5440 in regards to the PCEP initialization phase procedures. </t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
    <t>The Path Computation Element Communication Protocol (PCEP) <xref
    target="RFC5440"/> defines the mechanisms for the communication between a
    Path Computation Client (PCC) and a Path Computation Element (PCE), or
    between two PCEs. These interactions include requests and replies that can
    be critical for a sustainable network operation and adequate resource
    allocation; therefore, appropriate security becomes a key element in the
    PCE infrastructure. As the applications of the PCE framework evolve and
    more complex service patterns emerge, the definition of a secure mode of
    operation becomes more relevant.</t>

    <t>The Security Considerations section of <xref target="RFC5440"/>
    analyzes the potential threats to PCEP and their
    consequences; it also discusses several mechanisms for protecting PCEP against
    security attacks, without making a specific recommendation on a particular
    one or defining their application in depth. Moreover, <xref target="RFC6952"/> states the importance of ensuring PCEP communication confidentiality, especially when PCEP communication endpoints do not reside in the same Autonomous System (AS), as the interception of PCEP messages could leak sensitive information related to computed paths and resources.</t>

    <t>Transport Layer Security (TLS) <xref target="RFC5246"/> is one of the solutions that seems most adequate among those mentioned in these documents, as it provides support for peer authentication, message encryption, and integrity. TLS provides well-known mechanisms to support key configuration and exchange, as well as means to perform security checks on the results of PCE Discovery (PCED) procedures via the Interior Gateway Protocol (IGP) <xref target="RFC5088"/> <xref target="RFC5089"/>.</t>
    
  <t>This document describes a security container for the transport of PCEP messages; therefore, it does not affect the flexibility and extensibility of PCEP.</t>
    <t>This document describes how to apply TLS to secure interactions with
    PCE, including initiation of the TLS procedures, the TLS handshake
    mechanism, the TLS methods for peer authentication, the applicable TLS
    ciphersuites for data exchange, and the handling of errors in the security
    checks.  In the rest of this document, we refer to this usage of TLS
    to provide a secure transport for PCEP as "PCEPS".</t>


    <t>Within this document, PCEP communications are described through a PCC-PCE relationship. The PCE architecture also supports PCE-PCE communication; this is achieved by requesting the PCE to fill the role of a PCC, as usual. Thus, in this document, the PCC refers to a PCC or a PCE initiating the PCEP session 
    and acting as a client.</t>

    </section>

  <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
      "MAY", and "OPTIONAL" in this document are to be interpreted as
      described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they
      appear in all capitals, as shown here.</t>
    </section>

    <section title="Applying PCEPS">
    <section title="Overview">

    <t>The steps involved in establishing a PCEPS session are as follows:</t>
    <t><list style="numbers">
   <t>Establishment of a TCP connection.</t>

   <t>Initiation of the TLS procedures by the StartTLS message from PCE to
   PCC and from PCC to PCE.</t>

   <t>Negotiation and establishment of a TLS connection.</t>

   <t>Start exchange of PCEP messages as per <xref target="RFC5440"/>.</t>
   </list>
   </t>
   <t>This document uses the standard StartTLS procedure in PCEP instead of using a different port for the secured session. This is done to avoid requesting allocation of another port number for PCEPS. The StartTLS procedure makes more efficient use of scarce port numbers and allows simpler configuration of PCEP. </t>

   <t>Implementations SHOULD follow the best practices and recommendations for using TLS, as per <xref target="RFC7525"/>. </t>


   <t>It should be noted that this procedure updates what is defined in Sections
   4.2.1 and 6.7 of <xref target="RFC5440"/> regarding the initialization phase and the processing of messages prior to
   the Open message. The details of processing, including backward compatibility,
   are discussed in the following sections.</t>
   </section>

   <section title="Initiating TLS Procedures" anchor="init">
    <t>Since PCEP can operate either with or without TLS, it is necessary
    for a PCEP speaker to indicate whether it wants to set up a TLS
    connection or not.  For this purpose, this document specifies a new
    PCEP message called "StartTLS". 
    Thus, the PCEP session is secured via TLS from the
   start, before the exchange of any other PCEP message (including the
   Open message). This document thus updates
   <xref target="RFC5440"/>, which requires the
    Open message to be the first PCEP message that is exchanged. In the case of a PCEP
    session using TLS, the StartTLS message will be sent first. Also, 
    a PCEP speaker that supports PCEPS MUST NOT start the OpenWait timer
    after the TCP establishment; instead, it starts a StartTLSWait timer 
    as described in <xref target="start"/>. 
    </t>

    <t>The PCEP speaker MAY
    discover that the PCEP peer supports PCEPS or can be preconfigured
    to use PCEPS for a given peer (see <xref target="Discovery"/> for more
    details). 
    An existing PCEP session cannot be secured via TLS; the session
    MUST be closed and re-established with TLS as per the procedure described in
    this document.</t>

    <t>
    The StartTLS message is a PCEP message sent by a PCC to a PCE and by a
    PCE to a PCC in order to initiate the TLS procedure for PCEP. 
    The PCC initiates the use of TLS by sending a StartTLS message.
    The PCE agrees to the use of TLS by responding with its own
    StartTLS message. If the PCE is configured to only support TLS, it
    may send the StartTLS message immediately upon TCP connection
    establishment; otherwise, it MUST wait to see if the PCC's first
    message is an Open or a StartTLS message.
    The TLS negotiation 
    and establishment procedures are triggered once the PCEP speaker has sent and received
    the StartTLS message. The
    Message-Type field of the PCEP common header for the StartTLS message is
    set to 13.</t>

    <t>Once the TCP connection has been successfully established, the first
    message sent by the PCC to the PCE and by the PCE to the PCC MUST be
    a StartTLS message for PCEPS. Note that this is a significant change
    from <xref target="RFC5440"/>, where the first PCEP message is the Open message.</t>

    <t>A PCEP speaker receiving a StartTLS message, after any other PCEP
    exchange has taken place (by receiving or sending any other messages
    from either side), MUST treat it as an unexpected message and reply with a
    PCEP Error (PCErr) message with Error-Type set to 25 (PCEP StartTLS
    failure) and Error-value set to 1 (Reception of StartTLS after any
    PCEP exchange), and it MUST close the TCP connection.</t> 

    <t>Any message received prior to the StartTLS or Open message MUST trigger a protocol
   error condition causing a PCErr message to be sent with Error-Type
    set to 25 (PCEP StartTLS failure) and
    Error&nbhy;value set to 2 (Reception of any other message apart from
    StartTLS, Open, or PCErr), 
    and it MUST close the TCP connection.</t>

    <t>If the PCEP speaker that does not support PCEPS receives a StartTLS
    message, it will behave according to the existing error mechanism
    described in Section 6.2 of <xref target="RFC5440"/> (if
    the message is received prior to an Open message) or
    Section 6.9 of <xref target="RFC5440"/> (if an
    unknown message is received). See <xref target="Backward"/> for more details.</t>

    <t>If the PCEP speaker that only supports PCEPS connections (as a local policy) receives an Open
    message, it MUST treat it as an unexpected message and reply with a
    PCErr message with Error-Type set to 1 (PCEP session establishment failure) and
    Error-value set to 1 (reception of an invalid Open message or a non Open message), and it MUST close the TCP connection.</t>

    <t>If a PCC supports PCEPS connections and allows non-PCEPS connections (as a local policy), 
      it MUST first try to establish PCEPS by sending a StartTLS message, and
      in case it receives a PCErr message from the PCE,
      it MAY retry to establish a connection without PCEPS by sending an Open message. If a PCE supports 
      PCEPS connections and allows non-PCEPS connections (as a local
      policy), it MUST wait to respond after TCP establishment, 
      based on the message received from the PCC. In case of a StartTLS
      message, the PCE MUST respond by sending a StartTLS message and moving
      to TLS 
      establishment procedures as described in this document. In case of an
    Open message, the PCE MUST respond with an Open message and move to the
    PCEP session establishment procedure as per <xref target="RFC5440"/>. If a
    PCE supports PCEPS connections only (as a local policy), it MAY send a
    StartTLS message to the PCC without waiting to receive a StartTLS message
    from the PCC. </t>


   <t>If a PCEP speaker that is unwilling or unable to negotiate
   TLS receives a StartTLS message, it 
   MUST return a PCErr message (in the clear) with Error-Type set to 25
   (PCEP StartTLS failure) and Error-value set to:
   <list style="symbols">
   <t>3 (Failure, connection without TLS is not possible) if it is not willing to exchange PCEP messages
      without the solicited TLS connection, and it MUST close the TCP
      session.</t>

   <t>4 (Failure, connection without TLS is possible) if it is willing to exchange PCEP messages
      without the solicited TLS connection, and it MUST close the TCP
      session.  The receiver MAY choose to attempt to re-establish the
      PCEP session without TLS next. Re&nbhy;establishing the
      PCEP session without TLS SHOULD be limited to only one attempt.</t>
    </list></t>

    <t>If the PCEP speaker supports PCEPS and can establish a TLS connection, it
    MUST start the TLS connection negotiation and establishment steps described in
    <xref target="Establishment"/> before the PCEP initialization procedure
    (see Section 4.2.1 of <xref target="RFC5440"/>).</t>

   <t>After the exchange of StartTLS messages, if the TLS negotiation
   fails for some reason (e.g., the required
   mechanisms for certificate revocation checking are not available),
   both peers MUST immediately close the connection. </t>

    <t>
    A PCEP speaker that does not support PCEPS sends the Open message
   directly, as per <xref target="RFC5440"/>. A PCEP speaker that 
   supports PCEPS, but has learned in the last exchange the
   peer's willingness to re&nbhy;establish the session without TLS, MAY send the Open
   message directly, as per <xref target="RFC5440"/>. Re-establishing the PCEP session
   without TLS SHOULD be limited to only one attempt.
    </t>

    <t>Given the asymmetric nature of TLS for connection establishment, it is
    relevant to identify the roles of each of the PCEP peers in it. The PCC
    SHALL act as the TLS client, and the PCE SHALL act as the TLS server as per
    <xref target="RFC5246"/>.</t>

    <t>As per the recommendation from <xref target="RFC7525"/> to avoid 
    downgrade attacks, PCEP peers that support PCEPS SHOULD default to 
    strict TLS configuration, i.e., not allowing non-TLS PCEP sessions to 
    be established. PCEPS implementations MAY provide an option to allow 
    the operator to manually override strict TLS configuration and allow
    unsecured connections. Execution of this override SHOULD trigger a 
    warning about the security implications of permitting unsecured 
    connections.</t>
  </section>

      <section title="The StartTLS Message" anchor="start">
            <t>
   The StartTLS message is used to initiate the TLS procedure for a PCEPS
   session between the PCEP peers. A PCEP speaker sends the
   StartTLS message to request negotiation and establishment of a TLS
   connection for PCEP. On receiving a StartTLS message from the PCEP peer (i.e.,
   when the PCEP speaker has sent and received the StartTLS message), it is ready to
   start the negotiation and establishment of TLS and move to the steps described
   in <xref target="Establishment"/>.
   </t>
   <t>The collision resolution procedures described in <xref target="RFC5440"/>
   for the exchange of Open messages MUST be applied by the PCEP peers during
   the exchange of StartTLS messages.</t>
   <t>The format of a StartTLS message is as follows:</t>
             <figure>
            <artwork><![CDATA[
   <StartTLS Message>::= <Common Header>
            ]]></artwork>
          </figure>

   <t>The StartTLS message MUST contain only the PCEP common header with
   the Message-Type field set to 13.</t>

   <t>Once the TCP connection has been successfully established, the 
    PCEP speaker MUST start a timer called the
   "StartTLSWait timer". After the expiration of this timer, if neither the StartTLS
   message nor a PCErr/Open message (in case of failure
   and PCEPS not being supported by the peer, respectively) has been received,
   the PCEP speaker MUST send a PCErr message with Error-Type set to 25 (PCEP
   StartTLS failure) and
   Error-value
   set to 5 (No StartTLS message (nor PCErr/Open) before StartTLSWait timer expiry), and it MUST release the
   TCP connection. A RECOMMENDED
   value for the StartTLSWait timer is 60 seconds. The value of the
   StartTLSWait timer MUST NOT be less than that of the OpenWait timer.

</t>

<t>
  The following figures illustrate the various interactions between a PCC and a PCE, based on the support for the PCEPS capability, during the PCEP session initialization.

</t>



             <figure title="Both PCEP speakers support PCEPS (strict)"
             suppress-title="false" align="left" alt="" width="" height="" anchor="F1">
            <artwork><![CDATA[
               +-+-+                 +-+-+
               |PCC|                 |PCE|
               +-+-+                 +-+-+
                 |                     |
                 | StartTLS            |
                 | msg                 |
                 |-------              |
                 |       \   StartTLS  |
                 |        \  msg       |
                 |         \  ---------|
                 |          \/         |
                 |          /\         |
                 |         /  -------->|
                 |        /            |
                 |<------              |
                 |:::::::::TLS:::::::::|
                 |:::::Establishment:::|
                 |                     |
                 |                     |
                 |:::::::PCEP::::::::::|
                 |                     |
            ]]></artwork></figure>

             <figure title="Both PCEP speakers support PCEPS (strict) but cannot establish TLS"
             suppress-title="false" align="left" alt="" width="" height="" anchor="F2">
            <artwork><![CDATA[
               +-+-+                 +-+-+
               |PCC|                 |PCE|
               +-+-+                 +-+-+
                 |                     |
                 | StartTLS            |
                 | msg                 |
                 |-------              |
                 |       \   StartTLS  |
                 |        \  msg       |
                 |         \  ---------|
                 |          \/         |
                 |          /\         |
                 |         /  -------->|
                 |        /            |
                 |<------              |
                 |:::::::::TLS:::::::::| TLS Establishment
                 |:::::Establishment:::| Failure; both 
                 |                     | peers close 
                                         the session
            ]]></artwork>
          </figure>          


<figure title="PCE does not support connection with PCEPS, whereas PCC supports connection with or without PCEPS"
             suppress-title="false" align="left" alt="" width="" height="" anchor="F3">
            <artwork><![CDATA[
               +-+-+                 +-+-+
               |PCC|                 |PCE|
               +-+-+                 +-+-+
                 |                     |  Does not support
                 | StartTLS            |  PCEPS and thus
                 | msg                 |  sends Open
                 |-------              |  
                 |       \   Open      |
                 |        \  msg       |
                 |         \  ---------|
                 |          \/         |
                 |          /\         |
                 |         /  -------->|
                 |        /            |
                 |<------              |
                 |                     |
                 |<--------------------| Send Error
                 |       PCErr         | Type=1,Value=1
                 |                     | (non-Open message
                 |<--------------------|  received)
                 |       Close         |
                 ///////// TCP /////////
                 //////re-establish/////
       Send Open | Open                |
       this time | msg                 |
                 |-------              |
                 |       \   Open      |
                 |        \  msg       |
                 |         \  ---------|
                 |          \/         |
                 |          /\         |
                 |         /  -------->|
                 |        /            |
                 |<------              |
            ]]></artwork>
          </figure>          


          <figure title="Both PCEP speakers support connection with or without PCEPS"
             suppress-title="false" align="left" alt="" width="" height="" anchor="F4">
            <artwork><![CDATA[
               +-+-+                 +-+-+
               |PCC|                 |PCE|
               +-+-+                 +-+-+
                 |                     |
                 | StartTLS            |
                 | msg                 | PCE waits 
                 |-------------------->| for PCC and
                 |            StartTLS | responds with   
                 |<--------------------| Start TLS
                 |                     |
                 |:::::::::TLS:::::::::|
                 |:::::Establishment:::|
                 |                     |
                 |                     |
                 |:::::::PCEP::::::::::|
                 |                     |
            ]]></artwork>
          </figure>


          <figure title="Both PCEP speakers support connection with or without PCEPS, but PCE cannot start TLS negotiation"
             suppress-title="false" align="left" alt="" width="" height="" anchor="F5">
            <artwork><![CDATA[
               +-+-+                 +-+-+
               |PCC|                 |PCE|
               +-+-+                 +-+-+
                 |                     |
                 | StartTLS            |
                 | msg                 | PCE waits 
                 |-------------------->| for PCC 
                 |               PCErr | 
                 |<--------------------| Send Error
                 |                     | Type=25,Value=3
                 |                     | (Failure, connection 
                 |<--------------------|  without TLS is not 
                 |       Close         |  possible)
            ]]></artwork>
          </figure>


          <figure title="PCE supports connection with or without PCEPS, whereas PCC does not support connection with PCEPS"
             suppress-title="false" align="left" alt="" width="" height="" anchor="F6">
            <artwork><![CDATA[
               +-+-+                 +-+-+
               |PCC|                 |PCE|
               +-+-+                 +-+-+
                 |                     |
                 | Open                |
                 | msg                 | PCE waits 
                 |-------------------->| for PCC and
                 |                Open | responds with   
                 |<--------------------| Open
                 |                     |
                 |:::::::PCEP::::::::::|
                 |                     |
            ]]></artwork>
          </figure>


            

      </section>



      <section title="TLS Connection Establishment" anchor="Establishment">
          <t>Once the establishment of TLS has been agreed upon by the PCEP
	  peers, the connection establishment SHALL follow the following
	  steps:</t>
               <t>
          <list style="numbers">
              <t>Immediately negotiate a TLS session according to <xref target="RFC5246"/>. The following restrictions apply:
              <list style="symbols">
                <t>Support for TLS v1.2 <xref target="RFC5246"/> or later is REQUIRED.</t>

                <t>Support for certificate-based mutual authentication is REQUIRED.</t>
             
                <t>Negotiation of a ciphersuite providing for integrity protection is REQUIRED.</t>

                <t>Negotiation of a ciphersuite providing for confidentiality is RECOMMENDED.</t>
                <t>Support for and negotiation of compression is OPTIONAL.</t>

                <t>PCEPS implementations MUST, at a minimum, support negotiation of the TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 <xref target="RFC6460"/> and SHOULD support TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as well. Implementations SHOULD support the NIST P-256 (secp256r1) curve <xref target="RFC4492"/>. In addition, PCEPS implementations MUST support negotiation of the mandatory&nbhy;to&nbhy;implement ciphersuites required by the versions of TLS that they support from TLS 1.3 onwards.</t>
              </list></t>

            <t>Peer authentication can be performed in any of the following two REQUIRED operation models:
              <list style="symbols">
                <t>TLS with X.509 certificates using Public-Key Infrastructure Exchange (PKIX) trust models:
                  <list style="symbols">
                    <t>Implementations MUST allow the configuration of a list of trusted Certification Authorities (CAs) for incoming connections.</t>
                    <t>Certificate validation MUST include the verification rules as per <xref target="RFC5280"/>.</t>
                    <t>PCEPS implementations SHOULD incorporate revocation
		    methods (Certificate Revocation List (CRL) downloading,
		    Online Certificate Status Protocol (OCSP), etc.) according to the trusted CA policies.</t>

                    <t>Implementations SHOULD indicate their trusted CAs. For TLS 1.2, this is done using "certificate_authorities" on the server side (see Section 7.4.4 of <xref target="RFC5246"/>) and the "TrustedAuthorities" extension on the client side (see Section 6 of <xref target="RFC6066"/>).</t>

                    <t>Implementations MUST follow the rules and guidelines for peer validation as defined in <xref target="RFC6125"/>. If an expected DNS name or IP address for the peer is configured, then the implementations MUST check them against the values in the presented certificate. 
                    The DNS names and the IP addresses can be contained in the Common Name Identifier (CN-ID) <xref target="RFC6125"/> or the subjectAltName entries.  For verification, only one of these entries is considered. The following precedence applies: for DNS name validation, DNS&nbhy;ID <xref target="RFC6125"/> has precedence over CN-ID, and for IP address validation, subjectAltName:iPAddr has precedence over CN&nbhy;ID.</t>

                    <t>Implementations MAY allow the configuration of a set of
		    additional properties of the certificate to check for a
		    peer's authorization to communicate (e.g., a set of
		    allowed values in URI-ID <xref target="RFC6125"/> or a set
		    of allowed X.509 v3 Certificate Policies). The definitions of
		    these properties are out of scope of this document.</t>


                  </list></t>
                <t>TLS with X.509 certificates using certificate fingerprints: Implementations MUST allow the configuration of a list of certificates that are trusted to identify peers, identified via the fingerprint of certificate octets encoded by the Distinguished Encoding Rules (DER). Implementations MUST support SHA-256 as defined by <xref target="SHS"/> as the hash algorithm for the fingerprint, but a later revision may demand support for a stronger hash function.</t>
              </list></t>
            <t>Start exchanging PCEP messages.
            <list style="symbols">
              <t>Once the TLS connection has been successfully established, the PCEP speaker 
   MUST start the OpenWait timer <xref target="RFC5440"/>; after the
   expiration of this timer, if no Open message has been received, the PCEP speaker sends a
   PCErr message and releases the TCP/TLS connection.</t>
            </list></t>    
          </list></t>

      </section>

      
<section title="Peer Identity" anchor="Identity">
<t>
   Depending on the peer authentication method in use, PCEPS supports
   different operation modes to establish a peer's identity and whether it
   is entitled to perform requests or can be considered authoritative in
   its replies.  PCEPS implementations SHOULD provide mechanisms for
   associating peer identities with different levels of access and/or
   authoritativeness, and they MUST provide a mechanism for establishing a
   default level for properly identified peers.  Any connection
   established with a peer that cannot be properly identified SHALL be
   terminated before any PCEP exchange takes place.
</t>
      
        <t>In TLS X.509 mode using fingerprints, a peer is uniquely identified by the fingerprint of the presented certificate.</t>
      
        <t>There are numerous trust models in PKIX environments, and it is beyond the scope of this document to define how a particular deployment determines whether a peer is trustworthy. Implementations that want to support a wide variety of trust models should expose as many details of the presented certificate to the administrator as possible so that the trust model can be implemented by the administrator. 
        At least the following parameters of the X.509 certificate SHOULD be exposed:</t>
          <t><list style="symbols">
            <t>Peer's IP Address</t>
            <t>Peer's Fully Qualified Domain Name (FQDN)</t>
            <t>Certificate Fingerprint</t>
            <t>Issuer</t>
            <t>Subject</t>
            <t>All X.509 v3 Extended Key Usage</t>
            <t>All X.509 v3 Subject Alternative Name</t>
            <t>All X.509 v3 Certificate Policies</t>
          </list></t>
          <t>Note that the remote IP address used for the TCP session establishment is also exposed.</t>

        <t><xref target="RFC8232"/> specifies a Speaker Entity Identifier TLV (SPEAKER&nbhy;ENTITY&nbhy;ID) as an optional
   TLV that is included in the OPEN object. It contains a unique identifier for the
   node that does not change during the lifetime of the PCEP speaker. An implementation would thus expose the speaker entity identifier as part of the X.509 v3 certificate's subjectAltName:otherName, so that
   an implementation could use this identifier for the peer identification trust model.</t>
        <t>In addition, a PCC MAY apply the procedures described in "DNS-Based Authentication of Named Entities (DANE)" <xref target="RFC6698"/> to verify its peer identity when using DNS discovery. See <xref target="DANE"/> for further details.</t>
      </section>

      <section title="Connection Establishment Failure">
        <t>In case the initial TLS negotiation or the peer identity check fails, according to the procedures listed in this document, both peers MUST immediately
   close the connection.</t> 
        <t>The initiator SHOULD follow the procedure listed in <xref target="RFC5440"/> to retry session setup as per the exponential back-off session establishment retry procedure.</t>
      </section>

    </section>

  <section anchor="Discovery" title="Discovery Mechanisms">
    <t>This document does not specify any discovery mechanism for support of
    PCEPS. <xref target="PCE-DISCOVERY-PCEPS-SUPPORT"/>
    and <xref target="PCE-DISCOVERY-DNS"/> make the following proposals:
    <list style="symbols">

    <t>A PCE can advertise its capability to support PCEPS using the IGP's advertisement mechanism of the PCED information. The PCE&nbhy;CAP&nbhy;FLAGS sub-TLV is an optional sub-TLV used to advertise PCE capabilities. It is present within the PCED sub-TLV carried by OSPF or IS-IS. <xref target="RFC5088"/> and <xref target="RFC5089"/> provide the description and processing rules for this sub-TLV when carried within OSPF and IS-IS, respectively. PCE capability bits are defined in <xref target="RFC5088"/>. A new capability flag bit for the PCE&nbhy;CAP&nbhy;FLAGS sub&nbhy;TLV that can be announced as an attribute to distribute PCEP security support information is proposed in <xref target="PCE-DISCOVERY-PCEPS-SUPPORT"/>.</t>

    <t>A PCE can advertise its capability to support PCEPS using DNS <xref target="PCE-DISCOVERY-DNS"/> by identifying the support of TLS.</t>

</list></t>

      <section anchor="DANE" title="DANE Applicability">
        <t>DANE <xref target="RFC6698"/> defines a secure method to associate
	the certificate that is obtained from a TLS server with a domain name
	using DNS, i.e., using the TLSA DNS resource record (RR) to associate
	a TLS server certificate or public key with the domain name where the
	record is found, thus forming a "TLSA certificate association". The
	DNS information needs to be protected by DNS Security (DNSSEC). A PCC
	willing to apply DANE to verify server identity MUST conform to the
	rules defined in Section 4 of <xref target="RFC6698"/>. The
	implementation MUST support service certificate constraint (TLSA
	certificate usages type 1) with Matching type 1 (SHA2-256) as
	described in <xref target="RFC6698"/> and <xref
	target="RFC7671"/>. The server's domain name must be authorized
	separately, as TLSA does not provide any useful authorization
	guarantees.</t>

      </section>

    </section>

  <section anchor="Backward" title="Backward Compatibility">
      <t>The procedures described in this document define a security container
   for the transport of PCEP requests and replies carried by a TLS
   connection initiated by means of a specific extended message
   (StartTLS) that does not interfere with PCEP speaker implementations
   not supporting it.</t>

    <t>A PCC that does not support PCEPS will send an Open message as the
    first message on TCP establishment. A PCE that only supports PCEPS
   will send a StartTLS message on TCP establishment. 
   The PCC would consider the received StartTLS message as an error and behave
   according to the existing error mechanism of <xref target="RFC5440"/>, i.e., it would send a
   PCErr message with Error-Type 1 (PCEP session establishment failure)
   and Error-value 1 (reception of an invalid Open message or a non Open
   message) and close the session.</t>


    <t>A PCC that support PCEPS will send a StartTLS message as the first
    message on TCP establishment. A PCE that does not support PCEPS would
    consider receiving a StartTLS message as an error, respond with a PCErr
    message with Error-Type 1 (PCEP session establishment failure) and
    Error-value 1 (reception of an invalid Open message or a non Open
    message), and close the session.</t> 

   <t>If a StartTLS message is received at any other time by a PCEP speaker
   that does not implement PCEPS, it would consider it as an unknown
   message and would behave according to the existing error mechanism of
   <xref target="RFC5440"/>, i.e., it would send a PCErr message with Error-Type 2 (Capability not
   supported) and close the session.</t>

    
   <t>An existing PCEP session cannot be upgraded to PCEPS; the session needs to be terminated and re-established as per the procedure described in 
   	this document. During the incremental upgrade, the PCEP speaker SHOULD
   allow session establishment with and without TLS. Once both PCEP speakers
   are upgraded to support PCEPS, the PCEP session is re-established with TLS;
   otherwise, a PCEP session without TLS is set up. A redundant PCE MAY also
   be used during the incremental deployment to take over the PCE undergoing
   upgrade. Once the upgrade is completed, support for the unsecured version
   SHOULD be removed.</t>


    <t>A PCE that accepts connections with or without PCEPS would respond based on the message received from the PCC. A PCC that supports connection with or without PCEPS would
    	first attempt to connect with PCEPS, and in case of error, it MAY retry to establish connection without PCEPS. For successful TLS operations with PCEP, both PCEP peers in the network would need to be
   upgraded to support this document.</t>

   	   <t>Note that a PCEP implementation that supports PCEPS would
	   respond with a PCErr message with Error-Type set to 25
   (PCEP StartTLS failure) and Error-value set to 2 (Reception of any other
   message apart from StartTLS, Open, or PCErr) if any other message is
   sent before a StartTLS or Open message. If the sender of the invalid message is a
   PCEP implementation that does not support PCEPS, it will not
   be able to understand this error. A PCEPS implementation could also send
   the PCErr message as per <xref target="RFC5440"/> with Error-Type 1
   (PCEP session establishment failure) and Error-value 1 (reception of an
	   invalid Open message or a non Open message) before closing the
	   session.</t>


  </section>

  <section anchor="IANA" title="IANA Considerations">
  <section title="New PCEP Message">

  <t>The following new message type has been allocated within the "PCEP
   Messages" sub-registry of the "Path Computation Element Protocol (PCEP)
  Numbers" registry:</t>
             <figure>
            <artwork><![CDATA[
   Value      Description                    Reference
   -------------------------------------------------------
   13         StartTLS                       This document
            ]]></artwork>
          </figure>
        </section>
        <section title="New Error-Values">

   <t>The following new error types and error values have been allocated within
   the "PCEP-ERROR Object Error Types and Values" sub-registry of the
   "Path Computation Element Protocol (PCEP) Numbers" registry:</t>
             <figure>
            <artwork><![CDATA[
Error-Type   Meaning           Error-value             Reference
---------------------------------------------------------------------
 25          PCEP StartTLS     0: Unassigned            This document
             failure
                               1: Reception of          This document
                               StartTLS after
                               any PCEP exchange

                               2: Reception of          This document
                               any other message
                               apart from StartTLS,
                               Open, or PCErr

                               3: Failure, connection   This document
                               without TLS is not
                               possible

                               4: Failure, connection   This document
                               without TLS is 
                               possible

                               5: No StartTLS message   This document
                               (nor PCErr/Open) 
                               before StartTLSWait
                               timer expiry
 ]]></artwork>
          </figure>
  </section>
  </section>

  <section title="Security Considerations">
    <t>While the application of TLS satisfies the requirement on confidentiality as well as fine-grained, policy-based peer authentication, there are security threats that it cannot address.  It may be advisable to apply additional protection measures, in particular in what relates to attacks specifically addressed to forging the TCP connection underpinning TLS, especially in the case of long-lived connections. One of these measures is the application of the TCP Authentication Option (TCP-AO) <xref target="RFC5925"/>, which is fully compatible with and deemed as complementary to TLS. The mechanisms to configure the requirements to use TCP-AO and other lower-layer protection measures with a particular peer are outside the scope of this document.</t>

    <t>Since computational resources required by the TLS handshake and ciphersuite are higher than unencrypted TCP, clients connecting to a PCEPS server can more easily create high-load conditions, and a malicious client might create a denial-of-service attack more easily.</t>

    <t>Some TLS ciphersuites only provide integrity validation of their
    payload and provide no encryption; such ciphersuites SHOULD NOT be used by
    default. Administrators MAY allow the usage of these ciphersuites after
    careful weighting of the risk of relevant internal data leakage that can
    occur in such a case, as explicitly stated by <xref
    target="RFC6952"/>.</t>


    <t>When using certificate fingerprints to identify PCEPS peers, any two certificates that produce the same hash value will be considered the same peer. Therefore, it is important to make sure that the hash function used is cryptographically uncompromised, so that attackers are very unlikely to be able to produce a hash collision with a certificate of their choice. This document mandates support for SHA-256 as defined by <xref target="SHS"/>, but a later revision may demand support for stronger functions if suitable attacks on it are known.</t>

    <t>PCEPS implementations that continue to accept connections without TLS are susceptible to downgrade attacks as described in <xref target="RFC7457"/>. An
   attacker could attempt to remove the use of StartTLS messages that
   request the use of TLS as it pass on the wire in clear and could also attempt to
   inject a PCErr message that suggests attempting PCEP connection
   without TLS.
     </t>
    <t>The guidance given in <xref target="RFC7525"/> SHOULD be followed to avoid attacks on TLS.</t>
  </section>

<section title="Manageability Considerations" toc="default">
      <t>All manageability requirements and considerations listed in <xref target="RFC5440"/> apply to PCEP protocol extensions defined in this document. In addition, requirements and considerations listed in this section apply.</t>
      <section title="Control of Function and Policy" toc="default">

    <t>A PCE or PCC implementation SHOULD allow configuring the PCEP security via TLS capabilities as described in this document. </t>

      <t>A PCE or PCC implementation supporting PCEP security via TLS MUST support general TLS configuration as per <xref target="RFC5246"/>. At least the configuration of one of the trust models and its corresponding parameters, as  described in Sections <xref target="Establishment" format="counter"/> and <xref target="Identity" format="counter"/>, MUST be supported by the implementation.</t>

      <t>A PCEPS implementation SHOULD allow configuring the StartTLSWait timer value.
 
   </t>
   <t>PCEPS implementations MAY provide an option to allow the operator to 
   manually override strict TLS configuration and allow unsecure 
   connections. Execution of this override SHOULD trigger a warning about
   the security implications of permitting unsecure connections.</t>
   <t>Further, the operator needs to develop suitable security policies 
   around PCEP within his network. The PCEP peers SHOULD provide 
   ways for the operator to complete the following tasks in regards to a PCEP session:
   <list style="symbols">
      <t>Determine if a session is protected via PCEPS.</t>
      <t>Determine the version of TLS, the mechanism used for authentication, 
      and the ciphersuite in use.</t>
      <t>Determine if the certificate could not be verified and the reason 
      for this circumstance.</t>
      <t>Inspect the certificate offered by the PCEP peer.</t>
      <t>Be warned if the StartTLS procedure fails for the PCEP peers that are
      known to support PCEPS via configurations or capability 
      advertisements.</t>
   </list></t>
</section>
      <section title="Information and Data Models" toc="default">
        <t>The PCEP MIB module is defined in <xref target="RFC7420"/>. The MIB
	module could be extended to include the ability to view the PCEPS
	capability, TLS-related information, and the TLS status for
	each PCEP peer.</t>

        <t>Further, to allow the operator to configure the PCEPS capability and various TLS-related parameters as well as to view the current TLS 
   status for a PCEP session, the PCEP YANG module
   <xref target="PCEP-YANG"/> is extended to include TLS-related information.</t>
      </section>
      <section title="Liveness Detection and Monitoring" toc="default">
        <t>Mechanisms defined in this document do not imply any new liveness detection and monitoring requirements in addition to those already listed in <xref target="RFC5440"/> and <xref target="RFC5246"/>.</t>
      </section>
      <section title="Verifying Correct Operations" toc="default">
        <t>A PCEPS implementation SHOULD log error events and provide PCEPS failure statistics with reasons.</t>
      </section>
      <section title="Requirements on Other Protocols" toc="default">
        <t>Mechanisms defined in this document do not imply any new requirements on other protocols. Note that <xref target="Discovery"/> lists possible 
        discovery mechanisms for support of PCEPS.</t>
      </section>
      <section title="Impact on Network Operation" toc="default">
        <t>Mechanisms defined in this document do not have any significant impact on network operations in addition to those already listed in <xref target="RFC5440"/> and on the policy and management implications discussed above.</t>        
      </section>
    </section>
  
  </middle>

  <back>


    <references title="Normative References">
      &RFC2119;
      &RFC5246;
      &RFC5280;
      &RFC5440;
      &RFC6066;
      &RFC6125;
      &RFC6698;
      &RFC7525;
      &RFC7671;
      &RFC8174;
      <reference anchor="SHS" target="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.180-4.pdf">
        <front>
          <title>Secure Hash Standard (SHS)</title>
          <author>
            <organization>National Institute of Standards and Technology</organization>
          </author>
            <date year="2015" month="August"/>
        </front>
         <seriesInfo name="FIPS PUB" value="180-4"/>
        <seriesInfo name="DOI" value="10.6028/NIST.FIPS.180-4"/>
      </reference>
    </references>

    <references title="Informative References">
      &RFC4492;
      &RFC4513;
      &RFC5088;
      &RFC5089;
      &RFC5925;
      &RFC6460;
      &RFC6614;
      &RFC6952;
      &RFC7420;
      &RFC7457;
      &RFC8232;


<!--draft-ietf-pce-pcep-yang-05; Active - I-D exists-->
<reference anchor='PCEP-YANG'>
<front>
<title>A YANG Data Model for Path Computation Element Communications Protocol (PCEP)</title>
<author initials='D' surname='Dhody' fullname='Dhruv Dhody'>
    <organization />
</author>
<author initials='J' surname='Hardwick' fullname='Jonathan Hardwick'>
    <organization />
</author>
<author initials='V' surname='Beeram' fullname='Vishnu Beeram'>
    <organization />
</author>
<author initials='J' surname='Tantsura' fullname='Jeff Tantsura'>
    <organization />
</author>
<date month='July' year='2017' />
</front>
<seriesInfo name='Work in Progress,' value='draft-ietf-pce-pcep-yang-05' />
</reference>

<!--draft-wu-pce-dns-pce-discovery-10; Expired-->
<reference anchor='PCE-DISCOVERY-DNS'>
<front>
<title>Path Computation Element (PCE) Discovery using Domain Name System(DNS)</title>
<author initials='Q' surname='Wu' fullname='Qin Wu'>
    <organization />
</author>
<author initials='D' surname='Dhody' fullname='Dhruv Dhody'>
    <organization />
</author>
<author initials='D' surname='King' fullname='Daniel King'>
    <organization />
</author>
<author initials='D' surname='Lopez' fullname='Diego Lopez'>
    <organization />
</author>
<author initials='J' surname='Tantsura' fullname='Jeff Tantsura'>
    <organization />
</author>
<date month='March' year='2017' />
</front>
<seriesInfo name='Work in Progress,' value='draft-wu-pce-dns-pce-discovery-10' />
</reference>

<!--draft-wu-pce-discovery-pceps-support-07; Expired-->
<reference anchor='PCE-DISCOVERY-PCEPS-SUPPORT'>
<front>
<title>IGP extension for PCEP security capability support in the PCE discovery</title>
<author initials='D' surname='Lopez' fullname='Diego Lopez'>
    <organization />
</author>
<author initials='Q' surname='Wu' fullname='Qin Wu'>
    <organization />
</author>
<author initials='D' surname='Dhody' fullname='Dhruv Dhody'>
    <organization />
</author>
<author initials='Z' surname='Wang' fullname='Michael Wang'>
    <organization />
</author>
<author initials='D' surname='King' fullname='Daniel King'>
    <organization />
</author>
<date month='March' year='2017' />
</front>
<seriesInfo name='Work in Progress,' value='draft-wu-pce-discovery-pceps-support-07' />
</reference>

    </references>
<section title="Acknowledgements" numbered="no">
    <t>This specification relies on the analysis and profiling of TLS included
    in <xref target="RFC6614"/> and the procedures described for the StartTLS
    command in <xref target="RFC4513"/>.</t>

    <t>We would like to thank Joe Touch for his suggestions and support regarding the StartTLS mechanisms.</t>
    <t>Thanks to Daniel King for reminding the authors about manageability considerations.</t>
    <t>Thanks to Cyril Margaria for shepherding this document.</t>
    <t>Thanks to David Mandelberg for early SECDIR review comments as well as further review during IETF last call.</t>
    <t>Thanks to Dan Frost for the RTGDIR review and comments.</t>
    <t>Thanks to Dale Worley for the Gen-ART review and comments.</t>
    <t>Thanks to Tianran Zhou for the OPSDIR review.</t>
    <t>Thanks to Deborah Brungard for being the responsible AD and guiding
   the authors as needed.</t>
   <t>Also, thanks to Mirja Kuhlewind, Eric Rescorla, Warren Kumari, Kathleen Moriarty, Suresh Krishnan, Ben Campbell, and Alexey Melnikov for the IESG review and comments.</t>
  </section>


  </back>
</rfc>
