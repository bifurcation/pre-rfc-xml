<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<rfc submissionType="IETF" consensus="yes" 
category="info"
     number="6405"
     ipr="trust200902">
  <?rfc toc='yes' ?>
 <?rfc sortrefs="yes" ?>
  <?rfc tocompact='yes' ?>

  <?rfc compact='yes' ?>

  <?rfc subcompact='no' ?>
  <?rfc rfcedstyle='yes' ?>

  <front>
    <title abbrev="VoIP SIP Peering Use Cases">Voice over IP (VoIP) SIP Peering Use
    Cases</title>

    <author fullname="Adam Uzelac" initials="A." role="editor"
            surname="Uzelac">
      <organization abbrev="Global Crossing">Global Crossing</organization>

      <address>
        <postal>
          <country>U.S.A.</country>
        </postal>

        <email>adam.uzelac@globalcrossing.com</email>

        <uri>http://www.globalcrossing.com</uri>
      </address>
    </author>

    <author fullname="Yiu L.Lee" initials="Y." role="editor" 
	    surname="Lee">
      <organization abbrev="Comcast Cable">Comcast Cable</organization>
      <address>
        <postal>

          <country>U.S.A.</country>
        </postal>

        <email>yiu_lee@cable.comcast.com</email>

        <uri>http://www.comcast.com</uri>
      </address>
    </author>

    <date month="November" year="2011" />

    <area>RAI</area>

    <workgroup>SPEERMINT Working Group</workgroup>


    <abstract>
      <t>This document depicts many common Voice over IP (VoIP) use cases for
      Session Initiation Protocol (SIP) peering. These use cases are
      categorized into static and on-demand, and then further sub-categorized
      into direct and indirect. These use cases are not an exhaustive set, but
      rather the most common use cases deployed today.</t>
    </abstract>
  </front>

  <middle>
    <section anchor="intro" title="Introduction">
      <t>This document describes important Voice over IP (VoIP) use cases for
      SIP-based <xref target="RFC3261"></xref>
      peering. These use cases are determined by the Session PEERing for Multimedia INTerconnect (SPEERMINT) working group
      and will assist in identifying requirements and
      other issues to be considered for future resolution by the working group.</t>

      <t>Only use cases related to VoIP are considered in this document. Other
      real-time SIP communications use cases, like Instant Messaging (IM), video
      chat, and presence are out of scope for this document.</t>

      <t>The use cases contained in this document are described as
      comprehensive as possible, but should not be considered the exclusive
      set of use cases.</t>
    </section>

    <section anchor="term" title="Terminology">
      <t>This document uses terms defined in <xref target="RFC5486"></xref>.
      Please refer to it for definitions.</t>
    </section>

    <section anchor="ref-arch" title="Reference Architecture">
      <t>The diagram below provides the reader with a context for the VoIP use
      cases in this document. Terms such as SIP Service Provider (SSP), 
      Lookup Function (LUF), Location Routing Function (LRF), 
      Signaling Path Border Element (SBE), and Data Path Border Element (DBE) are
      defined in <xref target="RFC5486" />.</t>

      <t>The Originating SSP (O-SSP) is the SSP originating a SIP request. The Terminating
      SSP (T-SSP) is the SSP terminating the SIP request originating from the O-SSP.
      The assisting LUF and LRF Provider offer LUF and LRF services
      to the O-SSP. The Indirect SSP (I-SSP) is the SSP providing indirect peering
      service(s) to the O-SSP to connect to the T-SSP.</t>
 
      <figure align="center" anchor="overview">
        <artwork align="center"><![CDATA[

+--------------------+------------------------+--------------------+
|  Originating SSP   |  Assisting LUF and LRF |  Terminating SSP   |
|     Domain         |    Provider Domain     |      Domain        |
|                    |                        |                    |
|  +-----+  +-----+  |    +------+ +------+   |  +-----+  +-----+  |
|  |O-LUF|  |O-LRF|  |    |A-LUF | | A-LRF|   |  |T-LUF|  |T-LRF|  |
|  +-----+  +-----+  |    +------+ +------+   |  +-----+  +-----+  |
|                    |                        |                    |
| +-------+ +-----+  +------------------------+  +-----+ +-------+ |
| |O-Proxy| |O-SBE|  |  Indirect SSP Domain   |  |T-SBE| |T-Proxy| |   
| +-------+ +-----+  |                        |  +-----+ +-------+ |
|                    |    +-----+  +-----+    |                    |
|    +---+  +-----+  |    |O-SBE|  |O-DBE|    |  +-----+  +---+    |
|    |UAC|  |O-DBE|  |    +-----+  +-----+    |  |T-DBE|  |UAS|    |
|    +---+  +-----+  |                        |  +-----+  +---+    |
|                    |                        |                    |
+--------------------+------------------------+--------------------+
          ]]></artwork>

        <postamble>General Overview</postamble>
      </figure>

      <t>Note that some elements included in <xref target="overview"/>
      are optional. </t>
    </section>

    <section anchor="context" title="Contexts of Use Cases">
      <t>Use cases are sorted into two general groups: static and on-demand
      peering <xref target="RFC5486"></xref>. Each
      group can be further sub-divided into Direct Peering and Indirect
      Peering <xref target="RFC5486"></xref>. Although
      there may be some overlap among the use cases in these categories, there
      are different requirements between the scenarios. Each use case must
      specify a basic set of required operations to be performed by each
      SSP when peering.</t>

      <t>These can include:</t>

      <t><list style="symbols">
          <t>Peer Discovery - Peer discovery via a Lookup Function (LUF) to
          determine the Session Establishment Data (SED) 
	  <xref target="RFC5486"/> of the request. In
          VoIP use cases, a request normally contains a phone number. The O-SSP
          will input the phone number to the LUF and the LUF will normally return a
          SIP address of record (AOR) <xref target="RFC3261"/> that contains a domain
          name.</t>

          <t>Next-Hop Routing Determination - Resolving the SED information is
          necessary to route the request to the T-SSP. The LRF is used for this
          determination. After obtaining the SED, the O-SSP may use
          the standard procedure defined in <xref target="RFC3263"/> to
          discover the next-hop address. </t>

          <t>Call setup - SSPs that are interconnecting to one another may
          also define specifics on what peering policies need to be used when
          contacting the next hop in order to a) reach the next hop at all and
          b) prove that the sender is a legitimate peering partner.  Examples: hard-code transport (TCP/UDP/TLS),
          non-standard port number, specific source IP address (e.g., in a
          private Layer 3 network), which TLS client certificate <xref
          target="RFC5246"/> to use, and other authentication schemes.
          </t>

          <t>Call reception - This step ensures that the type of
          relationship (static or on-demand, indirect or direct) is understood
          and acceptable. For example, the receiving SBE needs to determine
          whether the INVITE it received really came from a trusted member.
          </t>
        </list></t>
    </section>

    <section anchor="usecases" title="Use Cases">
      <t>Please note there are intra-domain message flows within the use cases
      to serve as supporting background information. Only inter-domain
      communications are germane to this document.</t>

      <section title="Static Peering Use Cases">
        <t>Static peering <xref
        target="RFC5486"></xref> describes the use case
        when two SSPs form a peering relationship with some form of
        association established prior to the exchange of traffic.
        Pre-association is a prerequisite to static peering. Static peering is
        used in cases when two peers want a consistent and tightly controlled
        approach to peering. In this scenario, a number of variables, such as
        an identification method (remote proxy IP address) and Quality-of-Service 
	(QoS) parameters, can be defined upfront and
        known by each SSP prior to peering.</t>
      </section>

      <section title="Static Direct Peering Use Case" anchor="Static">
        <t>This is the simplest form of a peering use case. Two SSPs negotiate
        and agree to establish a SIP peering relationship. The peer connection
        is statically configured and the peer SSPs are directly connected. The
        peers may exchange interconnection parameters such as Differntiated Service Code Point (DSCP) <xref
        target="RFC2474"></xref> policies, the maximum number of requests per
        second, and proxy location prior to establishing the interconnection.
        Typically, the T-SSP only accepts traffic originating directly from the
        trusted peer.</t>

        <figure align="center" anchor="static_direct">
          <artwork align="center"><![CDATA[
                    

+--------------------+             +---------------------+
|        O-SSP       |             |        T-SSP        |
|       +-----+      |             |       +-----+       |
|       |O-LUF|      |             |       |T-LUF|       |
|       |O-LRF|      |             |      /|T-LRF|       |
|      /+-----+\     |             |     / +-----+       |
|    (2)     (4,5,6) |             |    /                |
|    /           \   |             |   /(8,9)            |
|+-------+     +-----+             +-----+      +-------+|
||O-Proxy|-(3)-|O-SBE+-----(7)-----+T-SBE|-(10)-|T-Proxy||
|+-------+     +-----+             +-----+      +-------+|
|    |               |             |                |    |
|   (1)              |             |               (11)  |
|    |               |             |                |    |
| +-----+      +-----+             +-----+       +-----+ |
| | UAC +======|O-DBE+=====(12)====+T-DBE|=======+ UAS | |
| +-----+      +-----+             +-----+       +-----+ |
+--------------------+             +---------------------+
     example.com                         example.net
    
              ]]></artwork>

          <postamble>Static Direct Peering Use Case</postamble>
        </figure>

        <t>The following is a high-level depiction of the use case:</t>

        <t><list style="numbers">
            <t>The User Agent Client (UAC) initiates a call via SIP INVITE to O-Proxy. O-Proxy is the
            home proxy for UAC. <artwork align="left"><![CDATA[
      INVITE sip:+19175550100@example.com;user=phone SIP/2.0
      Via: SIP/2.0/TCP client.example.com:5060
        ;branch=z9hG4bK74bf9
      Max-Forwards: 10
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=12345
      To: Bob <sip:+19175550100@example.com;user=phone>
      Call-ID: abcde
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@client.example.com;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork> <vspace /> Note that UAC inserted its Fully
            Qualified Domain Name (FQDN) in the VIA and CONTACT headers. This
            example assumes that UAC has its own FQDN. 
	    </t>

            <t>UAC knows the User Agent Server's (UAS's) TN, but does not know UAS's domain. It
            appends its own domain to generate the SIP URI in the Request-URI and
            TO header. O-Proxy checks the Request-URI and discovers
	    that the Request-URI contains the user parameter "user=phone". This 
	    parameter signifies that the Request-URI is a phone number. So 
	    O-Proxy will extract the TN from the Request-URI and query the LUF
	    for SED information from a routing database. 
	    In this example, the LUF is an ENUM <xref
            target="RFC6116" /> database. The ENUM entry looks similar to
            this: <artwork align="left"><![CDATA[
       $ORIGIN 0.0.1.0.5.5.5.7.1.9.1.e164.arpa.
       IN NAPTR ( 
         10 
         100
         "u" 
         "E2U+SIP"
         "!^.*$!sip:+19175550100@example.net!" 
         . ) 
              ]]></artwork> <vspace /> This SED data can be provisioned by
            O-SSP or populated by the T-SSP. </t>

            <t>O-Proxy examines the SED and discovers the domain is external.
            Given the O-Proxy's internal routing policy, O-Proxy decides to
            use O-SBE to reach T-SBE. O-Proxy routes the INVITE request to
            O-SBE and adds a Route header that contains O-SBE. <artwork
            align="left"><![CDATA[  
      INVITE sip:+19175550100@example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP o-proxy.example.com:5060
        ;branch=z9hG4bKye8ad
      Via: SIP/2.0/TCP client.example.com:5060
        ;branch=z9hG4bK74bf9;received=192.0.1.1
      Max-Forwards: 9
      Route: <sip:o-sbe1.example.com;lr>
      Record-Route: <sip:o-proxy.example.com;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=12345
      To: Bob <sip:+19175550100@example.com;user=phone>
      Call-ID: abcde
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@client.example.com;user=phone;
      transport=tcp>
      </allOneLine>
                ]]></artwork></t>

            <t>O-SBE receives the requests and pops the top entry of the Route
            header that contains "o-sbe1.example.com". O-SBE examines the
            Request-URI and does an LRF for "example.net". In this example, the
            LRF is a Naming Authority Pointer (NAPTR) DNS query <xref target="RFC3403" /> of the domain
            name. O-SBE receives a NAPTR response from the LRF. The response looks
            similar to this: <artwork align="left"><![CDATA[
       IN NAPTR (
         50    
         50   
         "S"   
         "SIP+D2T" 
         ""   
         _sip._tcp.t-sbe.example.net. )

       IN NAPTR (
         90    
         50   
         "S"   
         "SIP+D2U" 
         ""   
         _sip._udp.t-sbe.example.net. )
              ]]></artwork></t>

            <t>Given the lower order for TCP in the NAPTR response, O-SBE
            decides to use TCP as the transport protocol, so it sends an SRV DNS
            query for the SRV record <xref target="RFC2782" /> for
            "_sip._tcp.t-sbe.example.net." to O-LRF. 
	    <artwork align="left"><![CDATA[
     ;;     priority  weight   port  target
     IN SRV 0         2        5060  t-sbe1.example.net.
     IN SRV 0         1        5060  t-sbe2.example.net.
              ]]></artwork></t>

            <t>Given the higher weight for "t-sbe1.example.net", O-SBE sends 
an A record DNS query for "t-sbe1.example.net." to
            get the A record: <artwork align="left"><![CDATA[
       ;; DNS ANSWER   
       t-sbe1.example.net.   IN A   192.0.2.100
       t-sbe1.example.net.   IN A   192.0.2.101
                ]]></artwork></t>

            <t>O-SBE sends the INVITE to T-SBE. O-SBE is the egress point to
            the O-SSP domain, so it should ensure subsequent mid-dialog
            requests traverse via itself. If O-SBE chooses to act as a 
            back-to-back user agent (B2BUA) <xref target="RFC3261" />, it will
            generate a new INVITE request in next step.
            If O-SBE chooses to act as a proxy, it should record-route to stay
            in the call path. In this example, O-SBE is a B2BUA. <artwork
            align="left"><![CDATA[
      INVITE sip:+19175550100@example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP o-sbe1.example.com:5060
        ;branch= z9hG4bK2d4zzz
      Max-Forwards: 8
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@example.net;user=phone>
      Call-ID: abcde-osbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@o-sbe1.example.com;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork> <vspace /> Note that O-SBE may re-write the
            Request-URI with the target domain in the SIP URI. Some proxy
            implementations will only accept the request if the Request-URI
            contains their own domains. </t>

            <t>T-SBE determines the called party home proxy and directs the call to
            the called party. T-SBE may use ENUM lookup or other internal mechanism to
            locate the home proxy. If T-SSP uses ENUM lookup, this internal ENUM
            entry is different from the external ENUM entry populated for
            O-SSP. In this example, the internal ENUM query returns the UAS's
            home proxy.<artwork align="left"><![CDATA[
      $ORIGIN 0.0.1.0.5.5.5.7.1.9.1.e164.arpa.
      IN NAPTR (
        10 
        100 
        "u" 
        "E2U+SIP" 
        "!^.*$!sip:+19175550100@t-proxy.example.net!" 
        . )
              ]]></artwork></t>

            <t>T-SBE receives the NAPTR record, and following the requirements
	    in <xref target="RFC3263"/>, queries DNS for the SRV records indicated
	    by the NAPTR result. Not finding any, the T-SBE then queries DNS for
	    the A record of domain "t-proxy.example.net.".
            <artwork align="left"><![CDATA[
       ;; DNS ANSWER   
       t-proxy.example.net.   IN A   192.0.2.2
              ]]></artwork></t>

            <t>T-SBE is a B2BUA, so it generates a new INVITE and sends it to
            UAS's home proxy: <artwork align="left"><![CDATA[
      INVITE sip:bob@t-proxy.example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP t-sbe1.example.net:5060
        ;branch= z9hG4bK28uyyy
      Max-Forwards: 7
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@t-proxy.example.net;user=phone>
      Call-ID: abcde-tsbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@t-sbe1.example.net;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork></t>

            <t>Finally, UAS's home proxy forwards the INVITE request to the UAS.
            <artwork align="left"><![CDATA[
      INVITE sip:+19175550100@server.example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP t-proxy.example.net:5060
        ;branch= z9hG4bK28u111 
      Via: SIP/2.0/TCP t-sbe1.example.net:5060
        ;branch= z9hG4bK28uyyy; received=192.2.0.100
      Max-Forwards: 6
      Record-Route: <sip:t-proxy.example.net:5060;lr>, 
        <sip:t-sbe1.example.net:5060;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@t-proxy.example.net;user=phone>
      Call-ID: abcde-tsbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@t-sbe1.example.net;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork></t>

            <t>RTP is established between the UAC and UAS. Note that the media 
	    shown in <xref target="static_direct"/> passes through O-DBE and 
	    T-DBE, but the use of DBE is optional.</t>
          </list></t>

        <section title="Administrative Characteristics">
          <t>The static direct peering use case is typically implemented in a
          scenario where there is a strong degree of trust between the two
          administrative domains. Both administrative domains typically sign a
          peering agreement that states clearly the policies and terms.</t>
        </section>

        <section title="Options and Nuances">
          <t>In <xref target="static_direct"></xref>, O-SSP and T-SSP peer via
          SBEs. Normally, the operator will deploy the SBE at the edge of its
          administrative domain. The signaling traffic will pass between two
          networks through the SBEs. The operator has many reasons to deploy an
          SBE. For example, the O-SSP may use <xref target="RFC1918"></xref> 
	  addresses for their UA and proxies. These addresses are not routable in the
          target network. The SBE can perform a NAT function. Also, the SBE
          eases the operation cost for deploying or removing Layer 5 network
          elements. Consider the deployment architecture where multiple
          proxies connect to a single SBE. An operator can add or remove a
          proxy without coordinating with the peer operator. The peer operator
          "sees" only the SBE. As long as the SBE is maintained in the path,
          the peer operator does not need to be notified.</t>

          <t>When an operator deploys SBEs, the operator is required to
          advertise the SBE to the peer LRF so that the peer operator can
          locate the SBE and route the traffic to the SBE accordingly.</t>

          <t>SBE deployment is a decision within an administrative domain.
          Either one or both administrative domains can
          decide to deploy SBE(s). To the peer network, most important is to
          identify the next-hop address. This decision does not affect the
	  network's ability to identify the next-hop address.</t>
        </section>
      </section>

      <section title="Static Direct Peering Use Case - Assisting LUF and LRF">
        <t>This use case shares many properties with the Static Direct Peering
	Use Case <xref target="Static" />. There must exist a pre-association between the O-SSP and T-SSP.
        The difference is O-SSP will use the Assisting LUF/LRF Provider for LUF
        and LRF. The LUF/LRF Provider stores the SED to reach T-SSP and 
	provides it to O-SSP when O-SSP requests it.</t>

        <figure align="center" anchor="static_direct_assisting">
          <artwork align="center"><![CDATA[
                
	    
                     +-----------------+
                     |LUF/LRF Provider |
                     |                 |
                     |     +-------+   |
                     |   +-+ A-LUF |   |
                     |  /  | A-LRF |   |
+--------------------+ /  ++-------+   +---------------------+
|       O-SSP        |/  /             |         T-SSP       |
|       +------------/(4,5,6)          |        +-----+      |
|      /             | /               |        |T-LUF|      |
|    (2)           +-+/                |      +-|T-LRF|      |
|    /            /  |                 |     /  +-----+      |
|   /            /   |                 |    /(8,9)           |
|+-------+     +-----+                 +-----+      +-------+|
||O-Proxy|-(3)-|O-SBE+-------(7)-------+T-SBE|-(10)-|T-Proxy||
|+-------+     +-----+                 +-----+      +-------+|
|    |               |                 |                |    |
|   (1)              |                 |              (11)   | 
|    |               |                 |                |    |
| +-----+      +-----+                 +-----+       +-----+ |
| | UAC +======|O-DBE+=======(12)======+T-DBE+=======+ UAS | |
| +-----+      +-----+                 +-----+       +-----+ |
+--------------------+                 +---------------------+
      example.com                            example.net 
  
                ]]></artwork>

          <postamble>Static Direct Peering with Assisting LUF and
          LRF</postamble>
        </figure>

        <t>The call flow looks almost identical to Static Direct Peering Use
        Case except that Steps 2, 4, 5, and 6 involve the LUF/LRF Provider instead of
	happening in O-SSP domain.</t>

        <t>Similar to Static Direct Peering Use Case, the O-DBE and T-DBE in
        <xref target="static_direct_assisting"></xref> are optional.</t>

        <section title="Administrative Characteristics">
          <t>The LUF/LRF Provider supplies the LUF and LRF services for the
          O-SSP. Taken together, the LUF/LRF Provider, O-SSP, and T-SSP form a trusted
          administrative domain. To reach the T-SSP, the O-SSP must still require
          pre-arranged agreements for the peer relationship with the T-SSP. The Layer 5 
          policy is maintained in the O-SSP and T-SSP domains, and the LUF/LRF
          Provider may not be aware of any Layer 5 policy between the O-SSP and
          T-SSP.</t>

          <t>A LUF/LRF Provider can serve multiple administrative domains.
          The LUF/LRF Provider typically does not share SED from one 
	  administrative domain
          to another administrative domain without appropriate permission.
          </t>
        </section>

        <section title="Options and Nuances">
          <t>The LUF/LRF Provider can use multiple methods to provide SED to
          the O-SSP. The most commonly used are an ENUM lookup and a SIP Redirect. 
	  The O-SSP
          should negotiate with the LUF/LRF Provider regarding which query method it will
          use prior to sending a request to the LUF/LRF Provider.</t>

          <t>The LUF/LRF Providers must be populated with the T-SSP's AORs and 
	  SED. 
          Currently, this procedure is non-standardized and labor intensive.
	  A more detailed description of this problem has been documented in 
	  the work in progress <xref target="DRINKS"> 
          </xref>.</t>
        </section>
      </section>

      <section title="Static Indirect Peering Use Case - Assisting LUF and LRF">
        <t>The difference between a Static Direct Use Case and a Static Indirect
        Use Case lies within the Layer 5 relationship maintained by the O-SSP and 
	T-SSP. In the Indirect use case, the O-SSP and T-SSP do not have
        direct Layer 5 connectivity. They require one or multiple Indirect
        Domains to assist with routing the SIP messages and possibly the associated
        media.</t>

        <t>In this use case, the O-SSP and T-SSP want to form a peer relationship.
        For some reason, the O-SSP and T-SSP do not have direct Layer 5
        connectivity. The reasons may vary, for example, business demands
        and/or domain policy controls. Due to this indirect relationship, the
        signaling will traverse from the O-SSP through one or multiple I-SSPs to
        reach the T-SSP.</t>

        <t>In addition, the O-SSP is using a LUF/LRF Provider. This LUF/LRF
        Provider stores the T-SSP's SED pre-populated by the T-SSP. One important
        motivation to use the LUF/LRF Provider is that the T-SSP only needs to
        populate its SED once to the provider. Using an LUF/LRF Provider allows
	the T-SSP to populate its SED once, while any O-SSP
        T-SSP's SED can use this LUF/LRF Provider. Current practice has shown
        that it is rather difficult for the T-SSP to populate its SED to every
        O-SSP who must reach the T-SSP's subscribers. This is especially
        true in the Enterprise environment.</t>

        <t>Note that the LUF/LRF Provider and the I-SSP can be the same provider or
        different providers.</t>

        <figure align="center" anchor="static_indirect_assisting">
          <artwork align="center"><![CDATA[
                      +------------------+
                      | LUF/LRF Provider |
                      |       I-SSP      |
                      |      +-------+   |
                      |   ---+ A-LUF |   |
                      |  /   | A-LRF |   |
 +--------------------+ /    +-------+   +---------------------+
 |       O-SSP        |/     /           |         T-SSP       |
 |      +-------------/     /            |        +-----+      |
 |     /              |(4,5,6)           |        |T-LUF|      |
 |    /               |   /              |   +----+T-LRF|      |
 |  (2)             + +---               |  /     +-----+      |
 |  /              /  |                  | /(9,10)             |
 |+-------+     +-----+     +-----+      +-----+      +-------+|
 ||O-Proxy|-(3)-|O-SBE+-(7)-+I-SBE+-(8)--+T-SBE+-(11)-|T-Proxy||
 |+-------+     +-----+     +-----+      +-----+      +-------+|
 |    |               |                  |                |    |
 |   (1)              |                  |               (12)  |
 |    |               |                  |                |    |
 | +-----+      +-----+     +-----+      +-----+       +-----+ |
 | | UAC +=(13)=|O-DBE+=====+I-DBE+======+T-DBE+=======+ UAS | |
 | +-----+      +-----+     +-----+      +-----+       +-----+ |
 +-------------------------------------------------------------+
      example.com          example.org         example.net

              ]]></artwork>

          <postamble>Indirect Peering via an LUF/LRF Provider and I-SSP (SIP and
          Media)</postamble>
        </figure>

        <t>The following is a high-level depiction of the use case:</t>

        <t><list style="numbers">
            <t>The UAC initiates a call via SIP INVITE to the O-Proxy. The O-Proxy is the
            home proxy for the UAC. <artwork align="left"><![CDATA[
      INVITE sip:+19175550100@example.com;user=phone SIP/2.0
      Via: SIP/2.0/TCP client.example.com:5060
        ;branch=z9hG4bK74bf9
      Max-Forwards: 10
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=12345
      To: Bob <sip:+19175550100@example.com;user=phone>
      Call-ID: abcde
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@client.example.com;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork></t>

            <t>The UAC knows the UAS's TN, but does not know the UAS's domain. It
            appends its own domain to generate the SIP URI in the Request-URI and
            TO header. The O-Proxy checks the Request-URI and discovers
	    that the Request-URI contains the user parameter "user=phone". This 
	    parameter indicates that the Request-URI is a phone number. So, 
	    the O-Proxy will extract the TN from the Request-URI and query the LUF
	    for SED information from a routing database. 
            In this example, the LUF is an ENUM database. The ENUM entry looks
            similar to this: <artwork align="left"><![CDATA[
       $ORIGIN 0.0.1.0.5.5.5.7.1.9.1.e164.arpa.
       IN NAPTR ( 
         10 
         100 
         "u" 
         "E2U+SIP" 
         "!^.*$!sip:+19175550100@example.org!" 
         . ) 
                ]]></artwork> <vspace /> Note that the response shows the
            next-hop is the SBE in I-SSP. 
            Alternatively, the O-SSP may have a pre-association with the I-SSP. As
            such, the O-SSP will forward all requests that contain an
            external domain in the Request-URI or an unknown TN to 
	    the I-SSP. The O-SSP will 
	    rely on the I-SSP to determine the T-SSP and route the request correctly.
            In this configuration, the O-SSP can skip Steps 2, 4, 5, and 6 and forward the
            request directly to the I-SBE. This configuration is commonly used in
	    the Enterprise environment. </t>

            <t>Given the O-Proxy's internal routing policy, the O-Proxy decides to
            use the O-SBE to reach the I-SBE. The O-Proxy routes the INVITE request to
            the O-SBE and adds a Route header that contains the O-SBE. <artwork
            align="left"><![CDATA[
      INVITE sip:+19175550100@example.org;user=phone SIP/2.0
      Via: SIP/2.0/TCP o-proxy.example.com:5060
        ;branch=z9hG4bKye8ad
      Via: SIP/2.0/TCP client.example.com:5060
        ;branch=z9hG4bK74bf9;received=192.0.1.1
      Max-Forwards: 9
      Route: <sip:o-sbe1.example.com;lr>
      Record-Route: <sip:o-proxy.example.com;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=12345
      To: Bob <sip:+19175550100@example.net;user=phone>
      Call-ID: abcde
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@client.example.com;user=phone;
      transport=tcp>
      </allOneLine>
                ]]></artwork></t>

            <t>The O-SBE receives the requests and pops the top entry of the Route
            header that contains "sip:o-sbe1.example.com". The O-SBE examines the
            Request-URI and does an LRF for "example.org". In this example, the
            LRF is a NAPTR DNS query of the domain. The O-SBE receives a response
            similar to this: <artwork align="left"><![CDATA[
       IN NAPTR (
         50    
         50   
         "S"   
         "SIP+D2T" 
         ""   
         _sip._tcp.i-sbe.example.org. )

       IN NAPTR (
         90    
         50   
         "S"   
         "SIP+D2U" 
         ""   
         _sip._udp.i-sbe.example.org. )
              ]]></artwork></t>

            <t>Given the lower order for TCP in the NAPTR response, the O-SBE
            decides to use TCP for transport protocol, so it sends an SRV DNS
            query for the SRV record for "_sip._tcp.i-sbe.example.org." to the O-LRF.
            <artwork align="left"><![CDATA[
     ;;     priority  weight   port  target
     IN SRV 0         2        5060  i-sbe1.example.org.
     IN SRV 0         1        5060  i-sbe2.example.org.
              ]]></artwork></t>

            <t>Given the higher weight for "i-sbe1.example.org", 
the O-SBE sends a DNS query for an A record of "i-sbe1.example.org."
            to get the A record: <artwork align="left"><![CDATA[
       ;; DNS ANSWER   
       i-sbe1.example.org.   IN A   192.0.2.200
       i-sbe1.example.org.   IN A   192.0.2.201
                ]]></artwork></t>

            <t>The O-SBE sends the INVITE to the I-SBE. The O-SBE is the entry point to
            the O-SSP domain, so it should ensure subsequent mid-dialog
            requests traverse via itself. If the O-SBE chooses to act as a B2BUA, it
            will generate a new back-to-back INVITE
            request in the next step. If the O-SBE chooses to act as proxy, it should record-route
            to stay in the call path. In this example, the O-SBE is a B2BUA.
            <artwork align="left"><![CDATA[
      INVITE sip:+19175550100@example.org;user=phone SIP/2.0
      Via: SIP/2.0/TCP o-sbe1.example.com:5060
        ;branch= z9hG4bK2d4zzz
      Max-Forwards: 8
      Route:  <sip:i-sbe1.example.org;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@example.net;user=phone>
      Call-ID: abcde-osbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@o-sbe1.example.com;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork></t>

            <t>The I-SBE receives the request and queries its internal routing
            database on the TN. It determines that the target belongs to the T-SSP.
            Since the I-SBE is a B2BUA, the I-SBE generates a new INVITE request to
            the T-SSP. <artwork align="left"><![CDATA[
      INVITE sip:+19175550100@.example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP i-sbe1.example.org:5060
        ;branch= z9hG4bK2d4777
      Max-Forwards: 7
      Route: <sip:t-sbe1.example.net;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@example.net;user=phone>
      Call-ID: abcde-isbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@i-sbe1.example.org;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork> <vspace /> Note that if the I-SSP wants the media to
            traverse through the I-DBE, the I-SBE must modify the Session Description Protocol (SDP) in the Offer
            to point to its DBE. </t>

            <t>The T-SBE determines the called party home proxy and directs the call to
            the called party. The T-SBE may use ENUM lookup or another internal mechanism to
            locate the home proxy. If the T-SSP uses ENUM lookup, this internal ENUM
            entry is different from the external ENUM entry populated for
            O-SSP. This internal ENUM entry will contain the information to identify the
	    next hop to reach the called party. In this example, the internal 
	    ENUM query returns the UAS's home proxy. <artwork align="left"><![CDATA[
      $ORIGIN 0.0.1.0.5.5.5.7.1.9.1.e164.arpa.
      IN NAPTR ( 
        10 
        100 
        "u" 
        "E2U+SIP" 
        "!^.*$!sip:+19175550100@t-proxy.example.net!" 
        . )
              ]]></artwork> <vspace /> Note that this step is optional. If
            the T-SBE has other ways to locate the UAS home proxy, the T-SBE can skip
            this step and send the request to the UAS's home proxy. We show
            this step to illustrate one of the many possible ways to locate
            UAS's home proxy. </t>

            <t>The T-SBE receives the NAPTR record and, following the requirements in
	    <xref target="RFC3263"/>, queries the DNS for the SRV records indicated by
	    the NAPTR result. Not finding any, the T-SBE then queries DNS for
	    the A record of domain "t-proxy.example.net.".

	    <artwork
            align="left"><![CDATA[
       ;; DNS ANSWER   
       t-proxy.example.net.   IN A   192.0.2.2
              ]]></artwork></t>

            <t>T-SBE sends the INVITE to UAS's home proxy: <artwork
            align="left"><![CDATA[
      INVITE sip:+19175550100@t-proxy.example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP t-sbe1.example.net:5060
        ;branch= z9hG4bK28uyyy
      Max-Forwards: 6
      Record-Route: <sip:t-sbe1.example.net:5060;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@example.net;user=phone>
      Call-ID: abcde-tsbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@t-sbe1.example.com;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork></t>

            <t>Finally, the UAS's home proxy forwards the INVITE request to the UAS.
            <artwork align="left"><![CDATA[
      INVITE sip:+19175550100@server.example.net;user=phone SIP/2.0
      Via: SIP/2.0/TCP t-proxy.example.net:5060
        ;branch= z9hG4bK28u111
      Via: SIP/2.0/TCP t-sbe1.example.net:5060
        ;branch= z9hG4bK28uyyy; received=192.2.0.100
      Max-Forwards: 5
      Record-Route: <sip:t-proxy.example.net:5060;lr>, 
        <sip:t-sbe1.example.net:5060;lr>
      From: Alice <sip:+14085550101@example.com;user=phone>
        ;tag=54321
      To: Bob <sip:+19175550100@example.net;user=phone>
      Call-ID: abcde-tsbe1
      CSeq: 1 INVITE
      <allOneLine>
      Contact: <sip:+19175550100@t-sbe1.example.com;user=phone;
      transport=tcp>
      </allOneLine>
              ]]></artwork></t>

            <t>In <xref target="static_indirect_assisting"/>, 
	    RTP is established between the UAC and UAS via the O-DBE, I-DBE and T-DBE.
	    The use of DBE is optional.</t>
          </list></t>

        <section title="Administrative Characteristics">
          <t>This use case looks very similar to the Static Direct Peering Use Case with
          Assisting LUF and LRF. The major difference is the O-SSP and T-SSP do not
          have direct Layer 5 connectivity. Instead, O-SSP connects to the T-SSP
          indirectly via the I-SSP.</t>

          <t>Typically, an LUF/LRF Provider serves multiple O-SSPs.
          Two O-SSPs may use different I-SSPs to reach the same T-SSP. For
          example, O-SSP1 may use I-SSP1 to reach T-SSP, but O-SSP2 may use
          I-SSP2 to reach T-SSP. Given the O-SSP and T-SSP
          pair as input, the LUF/LRF Provider will return the SED of I-SSP that is
          trusted by O-SSP to forward the request to T-SSP.</t>

          <t>In this use case, there are two levels of trust relationship. The first trust
          relationship is between the O-SSP and the LUF/LRF Provider. The O-SSP
	  trusts the LUF/LRF to provide the T-SSP's SED. The second trust relationship is
          between the O-SSP and I-SSP. The O-SSP trusts the I-SSP to provide Layer 5 
	  connectivity to assist the O-SSP in reaching the T-SSP. 
	  The O-SSP and I-SSP have a pre-arranged agreement for policy. Note that 
	  <xref target="static_indirect_assisting"> </xref> shows a single provider
          to supply both LUF/LRF and I-SSP, but O-SSP can choose two different
          providers.</t>
        </section>

        <section title="Options and Nuances">
          <t>Similar to the Static Direct Peering Use Case, the O-SSP and T-SSP
          may deploy SBE and DBE for NAT traversal, security, transcoding,
          etc. The I-SSP can also deploy the SBE and DBE for similar reasons (as
          depicted in <xref target="static_indirect_assisting"></xref>).</t>
        </section>
      </section>

      <section title="Static Indirect Peering Use Case">
        <t>This use case shares many properties with the Static Indirect
	Use Case with Assisting LUF and LRF. The difference is that the O-SSP 
	uses its internal LUF/LRF to control the routing database. By
        controlling the database, the O-SSP can apply different routing rules and
        policies to different T-SSPs. For example, the O-SSP can use I-SSP1 and
        Policy-1 to reach T-SSP1, and use I-SSP2 and Policy-2 to reach T-SSP2.
        Note that there could be multiple I-SSPs and multiple SIP routes to
        reach the same T-SSP; the selection process is out of scope of this 
	document.</t>

        <figure align="center" anchor="static_indirect">
          <artwork align="center"><![CDATA[
 +--------------------+-------------------+---------------------+
 |       O-SSP        |       I-SSP       |         T-SSP       |
 |      +-----+       |                   |        +-----+      |
 |     -+O-LUF|       |                   |        |T-LUF|      |
 |    / |O-LRF+\      |                   |   +----+T-LRF|      |
 |   /  +-----+ \     |                   |  /     +-----+      |
 |  /(2)         \(4,5,6)                 | /(9,10)             |
 |+-------+     +-----+      +-----+      +-----+      +-------+|
 ||O-Proxy|-(3)-|O-SBE+--(7)-+I-SBE+-(8)--+T-SBE+-(11)-|T-Proxy||
 |+-------+     +-----+      +-----+      +-----+      +-------+|
 |    |               |                   |                |    |
 |   (1)              |                   |               (12)  |
 |    |               |                   |                |    |
 | +-----+      +-----+      +-----+      +-----+       +-----+ |
 | | UAC +=(13)=+O-DBE+======+I-DBE+======+T-DBE+=======+ UAS | |
 | +-----+      +-----+      +-----+      +-----+       +-----+ |
 +--------------------------------------------------------------+
      example.com          example.org          example.net

              ]]></artwork>

          <postamble>Indirect Peering via I-SSP (SIP and Media)</postamble>
        </figure>

        <section title="Administrative Characteristics">
          <t>The Static Indirect Peering Use Case is implemented in cases where no
          direct interconnection exists between the originating and terminating
          domains due to either business or physical constraints.</t>

          <t>O-SSP &lt;---&gt; I-SSP = Relationship O-I</t>

          <t>In the O-I relationship, typical policies, features, or functions
          that deem this relationship necessary are number portability,
          ubiquity of termination options, security certificate management, and
          masquerading of originating VoIP network gear.</t>

          <t>T-SSP &lt;---&gt; I-SSP = Relationship T-I</t>

          <t>In the T-I relationship, typical policies, features, or functions
          observed consist of codec "scrubbing", anonymizing, and transcoding.
          The I-SSP must record-route and stay in the signaling path. The T-SSP will
          not accept any message sent directly from the O-SSP.</t>
        </section>

        <section title="Options and Nuances">
          <t>In <xref target="static_indirect"></xref>, we show an I-DBE. Using 
	  an I-DBE is optional. For example, the I-DBE can be used when the O-SSP 
	  and T-SSP do not have a common
          codec. To involve an I-DBE, the I-SSP should know the list of codecs
          supported by the O-SSP and T-SSP. When the I-SBE receives the INVITE request, it
          will make a decision to invoke the I-DBE. An I-DBE may also be used if
          the O-SSP uses Secure Real-time Transport Protocol (SRTP) <xref target="RFC3711"></xref> for media and T-SSP does 
	  not support SRTP.</t>
        </section>
      </section>

      <section title="On-Demand Peering Use Case">
        <t>On-demand peering <xref target="RFC5486"></xref> describes how two SSPs
        form the peering relationship without a pre-arranged agreement.</t>

        <t>The basis of this use case is built on the fact that there is no
        pre-established relationship between the O-SSP and T-SSP. The
        O-SSP and T-SSP do not share any information prior to the dialog
        initiation request. When the O-Proxy invokes the LUF and LRF on the
        Request-URI, the terminating user information must be publicly
        available. When the O-Proxy routes the request to the
        T-Proxy, the T-Proxy must accept the request without any
        pre-arranged agreement with the O-SSP.</t>

	<t>The On-demand Peering Use Case is uncommon in production.
	In this memo, we capture only the high-level
	descriptions. Further analysis is expected when this use case becomes more
	popular.</t>

        <section title="Administrative Characteristics">
          <t>The On-demand Direct Peering Use Case is typically implemented in
          a scenario where the T-SSP allows any O-SSP to reach its serving
          subscribers. The T-SSP administrative domain does not require any
          pre-arranged agreement to accept the call. The T-SSP makes its
          subscribers information publicly available. This model mimics the
          Internet email model. The sender does not need an pre-arranged agreement
          to send email to the receiver.</t>
        </section>

        <section title="Options and Nuances">
          <t>Similar to the Static Direct Peering Use Case, the O-SSP and T-SSP can
          decide to deploy the SBE. Since the T-SSP is open to the public, the T-SSP is
          considered to be a higher security risk than static model because
          there is no trusted relationship between the O-SSP and T-SSP. The T-SSP
          should protect itself from any attack launched by an untrusted O-SSP.</t>
        </section>
      </section>
    </section>

    <section anchor="acknowledge" title="Acknowledgments">
      <t> Michael Haberler,
      Mike Mammer, Otmar Lendl, Rohan Mahy, David Schwartz, Eli Katz and
      Jeremy Barkan are the authors of the early individual documents. Their use
      cases are captured in this document. Also,
      Jason Livingood, Daryl Malas, David Meyer, Hadriel Kaplan, John Elwell,
      Reinaldo Penno, Sohel Khan, James McEachern, Jon Peterson, Alexander
      Mayrhofer, and Jean-Francois Mule made many valuable comments related to this
      document. The editors would also like to extend a special thank you to Spencer 
      Dawkins for his detailed review of this document.</t>
    </section>

    <section anchor="security" title="Security Considerations">
      <t>Session interconnect for VoIP, as described in this
      document, has a wide variety of security issues that should be
      considered. For example, if the O-SSP and T-SSP peer through
      public Internet, the O-SSP must protect the signaling channel and accept 
      messages only from an authorized T-SSP. This document does not analyze
      the threats in detail.   <xref target="RFC6404">
      </xref> discusses the different security threats and countermeasures 
      related to VoIP peering.</t>
    </section>

  </middle>



  <back>
    <references title="Normative References">

<!--      <?rfc include="reference.I-D.draft-ietf-speermint-voipthreats-01" ?> companion doc-->



<reference anchor='RFC6404'>
<front>
<title>Session PEERing for Multimedia INTerconnect (SPEERMINT) Security Threats and Suggested Countermeasures</title>

<author initials='J' surname='Seedorf' fullname='Jan Seedorf'>
    <organization />
</author>

<author initials='S' surname='Niccolini' fullname='Saverio Niccolini'>
    <organization />

</author>

<author initials='E' surname='Chen' fullname='Eric Chen'>
    <organization />
</author>

<author initials='H' surname='Scholz' fullname='Hendrik Scholz'>
    <organization />
</author>

<date month='November' year='2011' />

<abstract><t>The Session PEERing for Multimedia INTerconnect working group (SPEERMINT) provides a peering framework that leverages the building blocks of existing IETF-defined protocols such as SIP and ENUM for the interconnection between SIP Service Providers (SSPs).  The objective of this document is to identify and enumerate SPEERMINT- specific threat vectors and to give guidance for implementers on selecting appropriate countermeasures.  Security requirements for SPEERMINT which have been derived from the threats detailed in this document can be found in RFC 6271; this document provides concrete countermeasures to meet those SPEERMINT security requirements.  In this document, the different security threats related to SPEERMINT are classified into threats to the Lookup Function (LUF), to the Location Routing Function (LRF), to the Signaling Function (SF), and to the Media Function (MF) of a specific SIP Service Provider. Various instances of the threats are briefly introduced inside the classification.  Finally, existing security solutions for SIP and RTP/RTCP are presented to describe countermeasures currently available for such threats.  Each SSP may have connections to one or more remote SSPs through peering or transit contracts.  A potentially compromised remote SSP which attacks other SSPs is out of the scope of this document; this document focuses on attacks on an SSP from outside the trust domain such an SSP may have with other SSPs.</t></abstract>

</front>

<seriesInfo name='RFC' value='6404' />

</reference>

      <?rfc include="reference.RFC.1918" ?>

      <?rfc include="reference.RFC.2782" ?>

      <?rfc include="reference.RFC.3261" ?>

      <?rfc include="reference.RFC.3263" ?>

      <?rfc include="reference.RFC.3403" ?>

      <?rfc include="reference.RFC.6116" ?>

      <?rfc include="reference.RFC.5486" ?>
    </references>

    <references title="Informative References">
 

<!--     <?rfc include="reference.I-D.draft-ietf-drinks-usecases-requirements-00" ?> exists-->


<reference anchor='DRINKS'>
<front>
<title>Data for Reachability of Inter/tra-NetworK SIP (DRINKS) Use cases and Protocol Requirements</title>

<author initials='S' surname='Channabasappa' fullname='Sumanth Channabasappa'>
    <organization />
</author>

<date month='August' day='12' year='2011' />

<abstract><t>This document captures the use cases and associated requirements for interfaces that provision session establishment data into Session Initiation Protocol (SIP) Service Provider components, to assist with session routing.  Specifically, this document focuses on the provisioning of one such element, termed the registry.</t></abstract>

</front>

<seriesInfo name='Work in' value='Progress' />

</reference>

      <?rfc include="reference.RFC.2474" ?>

      <?rfc include="reference.RFC.3711" ?>

      <?rfc include="reference.RFC.5246" ?>
    </references>

  </back>
</rfc>

