<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">

<?rfc toc="yes"?>
<?rfc symrefs="yes" ?> 
<?rfc sortrefs="yes" ?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>

<rfc number="7789"
     submissionType="IETF"
     consensus="yes"
     ipr='trust200902' 
     category="info">

<front> 
<title abbrev="Impact of BGP Filtering">Impact of BGP Filtering on Inter-Domain Routing Policies</title>

<author initials="C" surname="Cardona" fullname="Camilo Cardona">
<organization>IMDEA Networks/UC3M</organization>
<address>
<postal>
<street>Avenida del Mar Mediterraneo, 22</street>
<city>Leganes</city> <code>28919</code>
<country>Spain</country>
</postal>
<email>juancamilo.cardona@imdea.org</email>
</address>
</author>
<author initials="P" surname="Francois" fullname="Pierre Francois">
<organization>Cisco Systems</organization>
<address>
<postal>
	  <street>170 W. Tasman Drive</street>
	  <city>San Jose, CA</city> <code>95134</code>
	  <country>United States</country>
</postal>
<email>pifranco@cisco.com</email>
</address>
</author>

<author initials="P" surname="Lucente" fullname="Paolo Lucente">
      <organization>Cisco Systems</organization>
      <address>
	<postal>
	  <street>170 W. Tasman Drive</street>
	  <city>San Jose, CA</city> <code>95134</code>
	  <country>United States</country>
	</postal>
	<email>plucente@cisco.com</email>
      </address>
</author>

<date month="April" year="2016"/>
<area>General</area>

<keyword>More-specific prefix, Less-specific prefix, Autonomous systems, Traffic engineering</keyword>

<abstract>
    
    <t>This document describes how unexpected traffic flows can emerge across
        an autonomous system as the result of other autonomous systems
        filtering or restricting the propagation of more-specific prefixes. We
        provide a review of the techniques to detect the occurrence of this
        issue and defend against it.</t>

</abstract>

</front>

<middle>
<section title="Introduction">

    <t>It is common practice for network operators to propagate a more-specific
        prefix in the BGP routing system along with the less-specific 
        prefix that they originate.  It is also possible for some Autonomous
	Systems (ASes) to
	apply different policies to the more specific and the
        less-specific prefix. </t>
    
    <t>Although BGP makes independent, policy-driven decisions for the
        selection of the best path to be used for a given IP prefix, routers
        must forward packets using the longest-prefix-match rule, which
        "precedes" any BGP policy <xref target="RFC1812"/>.
        The existence of a prefix p that is more specific than a prefix p' in
        the Forwarding Information Base (FIB) will let packets whose
        destination matches p be forwarded according to the next hop selected
        as best for p (the more-specific prefix).  This process takes place by
        disregarding the policies applied in the control plane for the
        selection of the best next hop for p'.  When an AS
        filters more-specific prefixes and forwards packets according to the
        less-specific prefix, the discrepancy among the routing policies applied
        to the less and the more-specific prefixes can create unexpected
        traffic flows. These may infringe on the policies of other ASes still holding a
        path towards the more-specific prefix.</t>

    <t>The objective of this document is to shed light on possible side effects
        associated with more-specific prefix filtering. Such actions can be
        explained by traffic engineering action, misconfiguration, or malicious
        intent. This document presents examples of such side effects and
        discusses approaches towards solutions to the problem.  </t>

    <t>The rest of the document is organized as follows: in <xref target =
            "sec:unexpected_flows"/> we provide some scenarios in which the
        filtering of more-specific prefixes leads to the creation of unexpected
        traffic flows; <xref target = "sec.detect"/> and <xref target =
            "sec.tecniques_to_counter"/> discuss some techniques that ASes can
        use for, respectively, detecting and reacting to unexpected traffic
	flows; and the document concludes in <xref target = "sec:conclusions"/>.</t>

    <section title ="Terminology" anchor="sec:terminolgy"> 
    
<t>
<list style="hanging">
        <t hangText="More-specific prefix:"> A prefix in the routing table with an address
            range that is covered by a shorter prefix also present in the routing table.</t>

        <t hangText="Less-specific prefix:"> A prefix in the routing table with an address range
            partially covered by other prefixes.</t>

        <t hangText="Customer-provider peering:"> A peering arrangement in which
            a transit network provides connectivity to a customer in exchange
            of a fee, as derived from <xref target='RFC4384'>RFC
                4384</xref>.</t>

        <t hangText="Settlement-free peering:"> A peering arrangement in which
            two networks agree on a settlement-free traffic exchange, typically
            covering only their customer traffic, as derived from <xref
                target='RFC4384'>RFC 4384</xref>.</t>

        <t hangText="Selective advertisement:"> The behavior of only advertising a self
            originated BGP path for a prefix over a strict subset of the
	    External BGP (eBGP) sessions of the AS.</t> 

        <t hangText="Selective propagation:"> The behavior of only propagating a BGP path
            for a prefix over a strict subset of the eBGP sessions of an
            AS.</t>

        <t hangText="Local filtering:"> The behavior of explicitly ignoring a BGP path
            received over an eBGP session.</t>

        <t hangText="Remote filtering:"> The behavior of triggering selective propagation
            of a BGP path at a distant AS. Note that this is typically achieved
            by tagging a self-originated path with BGP communities defined by
            the distant AS.</t> 

            <t hangText="Unexpected traffic flow:"> Traffic flowing between two neighboring
            ASes of an AS, although the transit policy of that AS is to not
            provide connectivity between these two neighbors. A traffic flow
            across an AS between two of its transit providers or between a
            transit provider and one of its settlement-free peers are
            classic examples of unexpected traffic flows.</t>
	  </list>
	</t>

        <!-- <t> Filtering-affected AS (short, affected AS): An AS which has
            unexpected traffic flows across its network.</t> -->

    </section>

</section>


<section title ="Unexpected Traffic Flows" anchor="sec:unexpected_flows">

    <t>In this section, we describe how more-specific prefix filtering can lead
        to unexpected traffic flows in other, remote, ASes.  We differentiate
        cases in which the filtering is performed locally from those where the
        filtering is triggered remotely.</t>

	<section title ="Local Filtering" anchor="sec:local_scoping_technique">

<t>Different reasons motivate local filtering, for example:</t>
<t>
<list style="hanging">
    <t hangText="Traffic engineering:">An ISP can decide to filter
        more-specific prefixes when it wants to control their local outbound
        traffic distribution using only the policy applied to the less-specific
        prefix.  Such a practice was notably documented in a presentation by
        Init7 <xref target="INIT7-RIPE63"/>.</t>
    
    <t hangText="Enforcing contract compliance:">An ISP can decide to filter
        more-specific prefixes to enforce clauses of their peering agreements.
        For instance, a settlement-free peer of an ISP can use selective
        advertisement of more-specific prefixes to attract traffic to one link.
        If this practice is not allowed by their peering agreement, the ISP can
        filter the more-specific prefixes to prevent it.</t>
    
    <t hangText="Memory preservation:">An ISP can decide to filter
        more-specific prefixes in order to preserve FIB memory of their routers.</t>
</list>
</t>

            <t><xref target = "fig:local_filtering_basic"/> illustrates a
                scenario where one AS performs local filtering due to outbound
                traffic engineering. The figure depicts AS64504 and two of its
                neighboring ASes, AS64502 and AS64505.  AS64504 has a
                settlement-free peering with AS64502 and is a customer of
                AS64505. AS64504 receives from AS64505
                prefixes 2001:DB8::/32 and 2001:DB8::/34. AS64504 only receives
                the less-specific prefix 2001:DB8::/32 from AS64502.</t>
    
                <figure anchor="fig:local_filtering_basic" title="Local Filtering" align="center"><artwork><![CDATA[
              ,-----.
             /       \
            ( AS64505 )
             \       /
              `--+--'
 2001:DB8::/32 | |
 2001:DB8::/34 v |
                 |
              ,--+--.  2001:DB8::/32  ,-----.
             /       \           <-- /       \
            ( AS64504 )-------------( AS64502 )
             \       /               \       /
              `-----'                 `-----'
                ]]>
                </artwork> 
                </figure>

            <t>Due to economic reasons, AS64504 might prefer to send traffic to
                AS64502 instead of AS64505. However, even if paths received
                from AS64502 are given a large local preference, routers in
                AS64504 will still send traffic to prefix 2001:DB8::/34 via
                neighbor AS64505. This situation may push AS64504 to apply
                an inbound filter for the more-specific prefix, 2001:DB8::/34,
                on the session with AS64505. After applying the filter, AS64504
                will send traffic for the more-specific prefix to AS64502. </t>
            
            <section title ="Unexpected Traffic Flows Caused by Local Filtering of More-Specific Prefixes" anchor="sec:local_filtering_uexpected">

                <t>In this section, we show how the decision of AS64504 to
                    perform local filtering creates unexpected traffic flows in
                    AS64502. <xref target = "fig:loc_unexpected"/>
                    shows the whole picture of the scenario where AS64501 is a customer of AS64503 and AS64502.
                    AS64503 is a settlement-free peer with
                    AS64502.  AS64503 and AS64502 are customers of AS64505. The
                    AS originating the two prefixes, AS64501, performs
                    selective advertisement with the more-specific prefix and
                    only announces it to AS64503.</t>

                <t>After AS64504 locally filters the more-specific prefix,
                    traffic from AS64504 to prefix 2001:DB8::/34 is forwarded
                    towards AS64502.  Because AS64502 receives the more-specific
                    prefix from AS64503, traffic from AS64504 to
                    2001:DB8::/34 follows the path
                    AS64504-AS64502-AS64503-AS64501.  AS64502's BGP policies
                    are implemented to avoid transporting traffic between
                    AS64504 and AS64503.  However, due to the  discrepancies of
                    routes between the more and the less-specific prefixes,
                    unexpected traffic flows between AS64504 and AS64503 exist
                    in AS64502's  network.</t>


                <figure anchor="fig:loc_unexpected" title="Unexpected Traffic Flows Due to Local Filtering" align="center"><artwork><![CDATA[
                       ____,,................______
             _,.---''''                            `''---..._
         ,-''   AS64505                                      `-.
         [                                                      /
          -.._                                             __.-'
           .  `'---....______                ______...---''
         + |/32              `'''''''''''''''         |
         | |/34               + |/32                  |
         v |                  v |/34                  |
           |                    |                   ^ |
           |                  ^ |/32                | |/32
           |                  + |                   + |/34
    _,,---.:_               _,,---.._              _,,---.._
  ,'         `.           ,'         `.          ,'         `.
 /  AS64504    \     <-+ /  AS64502    \        /  AS64503    \
 |             |_________|             |________|             |
 |             |     /32 |             |/32  /32|             |
 '.           ,'          .           ,'     /34 .           ,'
   `.       ,'             `.       ,'  +->  <-+  `.       ,'
     ``---''                 ``---''                ``---''
                                 |                  ^ |
                               ^ |2001:DB8::/32     | |2001:DB8::/32
                               | |                  + |2001:DB8::/34
                               + | _....---------...._|
                                ,-'AS64501            ``-.
                              /'                          `.
                              `.                         _,
                                `-.._               _,,,'
                                     `''---------'''
]]>
                </artwork> 
                </figure>
	    </section>
	  </section>
	<section title ="Remote Filtering" anchor="sec:remote_scoping_technique">
	
                <t>ISPs can tag the BGP paths that they propagate to
                    neighboring ASes with communities in order to tweak the
                    propagation behavior of the ASes that handle these paths;
		    see a paper from 2008 by Donnet and Bonaventure <xref target='on_BGP_communities'/>.
                    Some ISPs allow
                    their customers to use such communities to let the
                    receiving AS not export the path to some selected
                    neighboring ASes.  By combining communities, the prefix
                    could be advertised only to a given peer of the AS
                    providing this feature. A network operator can leverage
                    remote filtering to, for instance, limit the scope of
                    prefixes and hence perform more granular inbound traffic
                    engineering. </t>


                <t><xref target="fig:example_remote_triggered"/> illustrates a
                    scenario in which an AS uses BGP communities to command its
                    provider to  selectively propagate a more-specific prefix.
                    Let AS64501 be a customer of AS64502 and AS64503.  AS64501
                    originates prefix 2001:DB8::/32, which it  advertises
                    to AS64502 and AS64503.  AS64502 and
                    AS64503 are settlement-free peers. Let AS64501 do selective
                    advertisement and only propagate 2001:DB8::/34 over
                    AS64503.  AS64503 would normally propagate  this prefix to
                    its customers, providers, and peers, including AS64502.</t>

                <t>Let us consider that AS64501 decides to limit the scope of
                    the more-specific prefix. AS64501 can make this decision
                    based on its traffic engineering strategy. To achieve this,
                    AS64501 can tag the more-specific prefix with a set of
                    communities that leads AS64503 to only propagate the
                    path to AS64502.  </t>
		
	
                <figure anchor="fig:example_remote_triggered" title="Remote-Triggered Filtering" align="center"><artwork><![CDATA[
   ^     \         /     ^       ^    \         /    ^
   |  /32 \       / /32  |       | /32 \       / /32 |
            ,-----.                     ,-----.     
          ,'       `.                 ,'       `.
         / AS64502   \               / AS64503   \
        (             )-------------(             )
         \           / /32       /32 \           /
          `.       ,'   ->       /34  `.       ,'
            '-----;              <-  /  '-----'
                   \                /
                 ^  \              /    ^
                 |   \            /     |
                 |    \          /      |
                 |     \ ,-----.'       |  2001:DB8::/32
                 |     ,'       `.      |  2001:DB8::/34
   2001:DB8::/32 +--  / AS64501   \   --+
                     (             )
                      \           /
                       `.       ,'
                         '-----'
                ]]></artwork> 
                </figure>


	<section title ="Unexpected Traffic Flows Caused by Remotely Triggered Filtering of More-Specific Prefixes" anchor="sec:remote_filtering_unexpected">

            <t><xref target="fig:remote_peering_unexpected"/> expands the
                scenario from <xref target="fig:example_remote_triggered"/> and
                includes other ASes peering with AS64502 and AS64503. Due to
                the limitation on the scope performed on the more-specific
                prefix, ASes that are not customers of AS64502 will not receive
                a path for 2001:DB8::/34.  These ASes will forward packets
                destined to 2001:DB8::/34 according to their routing state for
                2001:DB8::/32.  Let us assume that AS64505 is such an AS and
                that its best path towards 2001:DB8::/32 is through AS64502.
                Packets sent towards 2001:DB8::1 by AS64505 will reach AS64502.
                However, in the data plane of the nodes of AS64502, the longest
                prefix match for 2001:DB8::1 is 2001:DB8::/34, which is reached
                through AS64503, a settlement-free peer of AS64502.  Since
                AS64505 is not in the customer branch of AS64502, traffic flows
                between two noncustomer ASes in AS64502.</t>


            <figure anchor="fig:remote_peering_unexpected" title="Unexpected Traffic Flows Due to Remote-Triggered Filtering" align="center"><artwork><![CDATA[
                       ,-----.
                     ,'       `.
                    / AS64505   \
                   (             )
                    \           /
                    ,`.       ,' \
                   /   '-----'    \
                  /   ^       ^    \
                 /32  |       | /32 '
         ,-----.'     +       +      ,-----.
       ,'       `.                 ,'       `.
      / AS64502   \               / AS64503   \
     (             )-------------(             )
      \           / /32       /32 \           /
       `.       ,'  +->       /34  `.       ,'
         '-----;              <-+ /  '-----'
                \                /
              ^  \              /    ^
              |   \            /     |
              |    \          /      |
              |     \ ,-----.'       |  2001:DB8::/32
              |     ,'       `.      |  2001:DB8::/34
2001:DB8::/32 +--+ / AS64501   \  +--+
                  (             )
                   \           /
                    `.       ,'
                      '-----'
                ]]></artwork> 
                </figure>



	</section>

    </section>
</section>



<section title = "Techniques to Detect Unexpected Traffic Flows Caused by Filtering of More-Specific Prefixes" anchor = "sec.detect">
	
    <section title = "Existence of Unexpected Traffic Flows within an AS">

        <t>To detect if unexpected traffic flows are taking place in its
            network, an ISP can monitor its traffic data to check if it is
            providing transit between two of its peers, although its policy is
            configured to not provide such transit. IPFIX <xref target="RFC7011"/> is
            an example of a technology that can be used to export information
            regarding traffic flows across the network.  Traffic information
            must be analyzed under the perspective of the business
            relationships with neighboring ASes to detect the flows not fitting
            the policy.  Operators can use collection systems that combine
            traffic statistics with policy information for this end.  See the
            pmacct project <xref target="PMACCT"></xref> for an open-source application
            meeting these requirements. </t>

        <t>Note that the AS detecting the unexpected traffic flow may simply
            realize that its policy configuration is broken. The first
            recommended action upon detection of an unexpected traffic flow is
            to verify the correctness of the BGP configuration. </t>


<!--

        <t>Once it has been assessed that the local configuration is correct,
            the operator should check if the problem detected in the data-plane
            arose due to filtering of BGP paths by neighboring ASes. The
            operator should check if the destination address of the unexpected
            traffic flow is locally routed as per a more specific prefix only
            received from non-customer peers. The operator should also checks
            if there are paths to a less specific prefix received from a customer, and
            hence propagated to peers.  If these two situations happen at the
            same time, the neighboring AS at the entry point of the unexpected
            flow is routing the traffic based on the less specific prefix, although
            the ISP is actually forwarding the traffic via non-customer
            links.</t>

        <t>To detect the origin of the problem, human interaction or looking
            glasses can be used in order to find out whether local filtering,
            remote filtering, or selective propagation was performed on the
            more specific prefix. Due to the distributed nature and restricted
            visibility of the steering of BGP policies, such analysis is deemed
            to not identify the origin of the problem with guaranteed accuracy.
            We are not aware, at the time of this writing, of any openly
            available tool that can automatically perform this operation.</t>
-->

            <t>Once the local configuration is confirmed correct,  the operator
                should check if the unexpected flow arose due to filtering of
                BGP paths for more-specific prefixes by neighboring ASes.  This
                can be performed in two steps. First, the operator should check
                whether the neighboring AS originating the
                unexpected flow is forwarding traffic using a less-specific
                prefix that is announced to it by the affected network. The
                second step is to try to infer the reason why the neighboring
                AS does not use the more-specific path for forwarding, i.e.,
                finding why the more-specific prefix was filtered. Due to the
                distributed nature and restricted visibility of the steering of
                BGP policies, this second step does not identify the origin of
                the problem with guaranteed accuracy.</t>

            <t>For the first step, the  operator should check if the
            destination address of the unexpected  traffic flow is locally
            routed as per a more-specific prefix only received from
            noncustomer peers.  The operator should also check if there are
            paths to a less-specific prefix received from a customer and
            hence propagated to peers.  If these two situations happen at the
            same time, the neighboring AS at the entry point of the unexpected
            flow is routing the traffic based on the less-specific prefix,
            although the ISP is actually forwarding the traffic via
            noncustomer links.</t> 

            <t>For the second step, one can rely on human interaction or
                looking glasses to find out whether local filtering, remote
                filtering, or selective propagation was performed on the more-specific
                prefix. No openly available tools that can
                automatically perform this operation have been identified.</t>

    </section><!-- Being the victim of the policy violation-->

    <section title = "Contribution to the Existence of Unexpected Traffic Flows in Another AS">

        <t> It can be considered problematic to trigger unexpected traffic
            flows in another AS. It is thus advisable for an AS to assess the
            risks of filtering more-specific prefixes before implementing them
            by obtaining as much information as possible about its
            surrounding routing environment.</t>
		
        <t> There may be justifiable reasons for one ISP to perform filtering:
            either to enforce established policies or to provide prefix-advertisement
            scoping features to its customers.  These can vary
            from troubleshooting purposes to business-relationship
            implementations.  Restricting the use of these features for the sake of
            avoiding the creation of unexpected traffic flows is not a
            practical option.</t>

        <t>In order to assess the risk of filtering more-specific prefixes, the
            AS would need information on the routing policies and the
            relationships among external ASes to detect if its actions could
            trigger the appearance of unexpected traffic flows. With this
            information, the operator could detect other ASes receiving the
            more-specific prefix from noncustomer ASes while announcing the
            less-specific prefix to other noncustomer ASes. If the filtering
            of the more-specific prefix leads other ASes to send traffic for
            the more-specific prefix to these ASes, an unexpected traffic flow
            can arise.  However, the information required for this operation is
            difficult to obtain since it is frequently considered confidential.</t>

    </section><!--Being a contributor to the policy violation-->

</section>


<section title = "Techniques to Traffic Engineer Unexpected Flows" anchor = "sec.tecniques_to_counter">
   	
     <t> Network operators can adopt different approaches with respect to
          unexpected traffic flows. Note that due to the complexity of
          inter-domain routing policies, there is not a single solution that
          can be applied to all situations. This section provides potential solutions that
          ISPs must evaluate against each particular case. We classify these
          actions according to whether they are proactive or reactive.</t>
                 
    <t>Reactive approaches are those in which the operator tries to detect the
        situations via monitoring and solve unexpected traffic flows manually
        on a case-by-case basis.</t>

    <t>Anticipant or preventive approaches are those in which the routing
        system will not let the unexpected traffic flows actually take place
        when the  scenario arises.</t>

    <t>We use the scenario depicted in <xref target="AS_MEAURES_EXAMPLE"/> to
        describe these two kinds of approaches. Since proactive approaches can
        be complex to implement and can lead to undesired effects, the reactive
        approach is the more reasonable recommendation to deal with unexpected
        flows.</t>


	<figure anchor="AS_MEAURES_EXAMPLE" title="Traffic Engineering of Unexpected Traffic Flows - Base Example" align="center"><artwork><![CDATA[
                      ____,,................______
            _,.---''''                            `''---..._
        ,-''   AS64505                                      `-.
        [                                                      /
         -.._                                             __.-'
          .  `'---....______                ______...---''
        + |/32              `'''''''''''''''         |
        | |/34               + |/32                  |
        v |                  v |/34                  |
          |                    |                   ^ |
          |                  ^ |/32                | |/32
          |                  + |                   + |/34
   _,,---.:_               _,,---.._              _,,---.._
 ,'         `.           ,'         `.          ,'         `.
/  AS64504    \     <-+ /  AS64502    \        /  AS64503    \
|             |_________|             |        |             |
|             |     /32 |             |        |             |
'.           ,'          .           ,'         .           ,'
  `.       ,'             `.       ,'            `.       ,'
    ``---''                 ``---''                ``---''
                                |                  ^ |
                              ^ |2001:DB8::/32     | |2001:DB8::/32
                              | |                  + |2001:DB8::/34
                              + | _....---------...._|
                               ,-'AS64501            ``-.
                             /'                          `.
                             `.                         _,
                               `-.._               _,,,'
                                    `''---------'''
             ]]></artwork> 
</figure>

    <section title = "Reactive Traffic Engineering" anchor="sec:reactive_measurements">

        <t>An operator who detects unexpected traffic flows originated by any
            of the cases described in <xref target="sec:unexpected_flows"/> can contact the
            ASes that are likely to have performed the propagation tweaks,
            inform them of the situation, and persuade them to change their
            behavior.</t>

        <t>If the situation remains, the operator can implement prefix
            filtering in order to stop the unexpected flows. The operator can
            decide to perform this action over the session with the operator
            announcing the more-specific prefix or over the session with the
            neighboring AS from which it is receiving the traffic. Each of
            these options carry a different repercussion for the affected AS.
            We briefly describe the two alternatives.</t>
	
        <t><list style="symbols"> 
                
                <t>An operator can decide to stop announcing the less-specific
                    prefix at the peering session with the neighboring AS from
                    which it is receiving traffic to the more-specific prefix.
                    In the example of <xref target="AS_MEAURES_EXAMPLE"/>, AS64502 would filter out the
                    prefix 2001:DB8::/32 from the eBGP session with AS64504.
                    In this case, traffic heading to the prefix
                    2001:DB8::/32 from AS64501 would no longer traverse
                    AS64502.  AS64502 should evaluate if solving the issues
                    originated by the unexpected traffic flows are worth the
                    loss of this traffic share. </t>
		

                <t>An operator can decide to filter out the more-specific prefix
                    at the peering session over which it was received.  In the
                    example of <xref target="AS_MEAURES_EXAMPLE"/>, AS64502
                    would filter out the incoming prefix 2001:DB8::/34 from the
                    eBGP session with AS64505.  As a result, the traffic
                    destined to that /32 would be forwarded by AS64502 along
                    its link with AS64501, despite the actions performed by
                    AS64501 to have this traffic coming in through its link
                    with AS64503.  However, as AS64502 will no longer know a
                    route to the more-specific prefix, it risks losing the
                    traffic share from customers different from AS64501 to that
                    prefix.  Furthermore, this action can generate conflicts
                    between AS64502 and AS64501, since AS64502 does not follow
                    the routing information expressed by AS64501 in its BGP
                    announcements.</t>

			
	</list></t>
    <!--
        <t> It is possible that the behavior of the neighboring AS 
            causing the unexpected traffic flows opposes the peering agreement.
            In this case, an operator could account the amount of traffic that
            has been subject to the unexpected flows, using traffic measurement
            protocols such as IPFIX, and charge the peer for that
            traffic.  That is, the operator can claim that it has been a
            provider of that peer for the traffic that transited between the
            two ASes.</t>
   -->
        <t>Note that it is possible that the behavior of the neighboring AS
            causing the unexpected traffic flows violates a contractual
            agreement between the two networks.</t>


    </section>

    <section title="Proactive Measures">
        <section title = "Access Lists">

            <t> An operator could install access lists to prevent unexpected
            traffic flows from happening in the first place.  In the example of
            <xref target="AS_MEAURES_EXAMPLE"/>, AS64502 would install an
            access list denying packets matching 2001:DB8::/34 associated with
            the interface connecting to AS64504.  As a result, traffic destined
            to that prefix would be dropped despite the existence of a valid
            route towards 2001:DB8::/32.</t>

           <t>The operational overhead of such a solution is considered high, as
           the operator would have to constantly adapt these access lists to
           accommodate inter-domain routing changes.  Moreover, this technique
           lets packets destined to a valid prefix be dropped while they are
           sent from a neighboring AS that may not know about the policy
           conflict and hence had no means to avoid the creation of unexpected
           traffic flows.  For this reason, this technique can be considered
           harmful.</t> 
       <!--and is thus not recommended for implementation.</t>-->
          	  
	  </section>
	
          <!--
	<section title = "Automatic more specific prefix filtering" anchor="sec.automaticfiltering">

            <t>As described in <xref target="sec:unexpected_flows"/>, the
                filtering of more specific prefixes can in some scenarios lead to
                unexpected traffic flows.  Nevertheless, depending on the
                autonomous system implementing such practice, this operation
                can actually prevent these cases.  This can be illustrated
                using the example described in <xref
                    target="AS_MEAURES_EXAMPLE"/>: if AS64502 or AS64503 filter
                prefix 2001:DB8::/32 , there would be no unexpected traffic
                flow in AS64502.  Nevertheless, as described in <xref
                    target='sec:unexpected_flows' />, the filtering of
                more specific prefixes can generate conflicts between AS64501 and
                AS64502, since AS64502 would not forward traffic according to
                AS64501's policy.  Moreover, AS64502 can lose traffic share for
                the more specific prefix from customers different from
                AS64501.</t>

	</section>

        -->
<!--Depending on the
                autonomous system implementing such practice, this operation
can prevent these cases.--> 
	 <section title = "Neighbor-Specific Forwarding">

             <t>An operator can technically ensure that traffic destined to a
                 given prefix will be forwarded from an entry point of the
                 network based only on the set of paths that have been
                 advertised over that entry point.</t>

             <t>As an example, let us analyze the scenario of <xref
                    target="AS_MEAURES_EXAMPLE"/> from
                 the point of view of AS64502.  The edge router connecting to
                 the AS64504 forwards packets destined to prefix 2001:DB8::/34
                 towards AS64505.  Likewise, it forwards packets destined
                 to prefix 2001:DB8::/32 towards AS64501.  The router, however,
                 only propagates the path of the less-specific prefix
                 (2001:DB8::/32) to AS64504.  An operator could implement the
                 necessary techniques to force the edge router to forward
                 packets coming from AS64504 based only on the paths propagated
                 to AS64504.  Thus, the edge router would forward packets
                 destined to 2001:DB8::/34 towards AS64501, in which case no
                 unexpected traffic flow would occur.</t>

             <t> Different techniques could provide this functionality;
                 however, their technical implementation can be complex to
                 design and operate. An operator could, for instance, employ
                 VPN Routing and Forwarding (VRF) tables <xref target="RFC4364"/>
                 to store the routes announced to a neighbor and forward
                 traffic exclusively based on those routes. A presentation
		 from 2009 <xref
                     target='on_BGP_RS_VPNs' /> describes the use of such an
                 architecture for Internet routing and provides a description
                 of its limitations.</t> 

             <t>In such architecture, packets received from a peer would be
                 forwarded solely based on the paths that fit the path
                 propagation policy for that peer and not based on the global
                 routing table of the router. As a result, a more-specific path
                 that would not be propagated to a peer will not be used to
                 forward a packet from that peer, and the unexpected flow will
                 not take place.  Packets will be forwarded based on the policy-compliant,
                 less-specific prefix.  However, note that an
                 operator must make sure that all their routers could support
                 the potential performance impact of this approach.</t>

                <t>Note that similar to the solution described in <xref
                        target='sec:reactive_measurements'/>, this approach
                    could create conflicts between AS64502 and AS64501, since
                    the traffic forwarding performed by AS64502 goes against
                    the policy of AS64501.</t>

      </section>
		


    </section>
</section>
    
<section title = "Conclusions" anchor = "sec:conclusions"> 

    <t>This document describes how filtering and selective propagation of
        more-specific prefixes can potentially create unexpected traffic flows
        across some ASes. We provided examples of scenarios where these
        practices lead to unexpected traffic flows and introduce some
        techniques for their detection and prevention. Although there are
        reasonable situations in which ASes could filter more-specific
        prefixes, network operators are encouraged to implement this type
        of filter considering the cases described in this document.  Operators
        can implement monitoring systems to detect unexpected traffic flows and
        react to them according to their own policy.</t>

    <!--
    <t>In this document, we described how the filtering of more specific prefixes
        can potentially create unexpected traffic flows in remote ASes.  We
        provided   examples of scenarios in which unexpected traffic flows are
        caused by these practices and introduce some techniques for their
        detection and prevention.  Analyzing the different options for dealing
        with this kind of problems, we recommend ASes to implement monitoring systems that can
        detect them and react to them according to the specific situation.
        Although we observe that there are reasonable situations in which ASes
        could filter more specific prefixes, we encourage network operators
        to implement this type of filters considering the cases described in
        this document.  </t> 
     -->
</section>

<section title = "Security Considerations" anchor = "sec:security"> 
    
    <t>It is possible for an AS to use any of the methods described in this
        document to deliberately reroute traffic flowing through another AS.
        This document described the potential routing security issue and
        analyzed ways for operators to defend against it.</t> 

    <t>It must be noted that, at the time of this document, there are no existing
    or proposed tools to automatically protect against such behavior. Operators
    can use network monitoring and collection tools to detect unexpected flows
    and deal with them on a case-by-case basis.</t>

<!--
    <t>It must be noted that, at the time of this document, there are no
    existing or proposed tools to automatically protect against such behavior.
    Network monitoring allowing for the detection of unexpected traffic flows
    exist, but automated configuration changes to solve the problem do not. </t> 
    -->
            
</section>

</middle>
<back>
 <references title='Normative References'>

<reference  anchor='RFC4384' target='http://www.rfc-editor.org/info/rfc4384'>
<front>
<title>BGP Communities for Data Collection</title>
<author initials='D.' surname='Meyer' fullname='D. Meyer'><organization /></author>
<date year='2006' month='February' />
</front>
<seriesInfo name='BCP' value='114'/>
<seriesInfo name='RFC' value='4384'/>
<seriesInfo name='DOI' value='10.17487/RFC4384'/>
</reference>

<reference  anchor='RFC1812' target='http://www.rfc-editor.org/info/rfc1812'>
<front>
<title>Requirements for IP Version 4 Routers</title>
<author initials='F.' surname='Baker' fullname='F. Baker' role='editor'><organization /></author>
<date year='1995' month='June' />
</front>
<seriesInfo name='RFC' value='1812'/>
<seriesInfo name='DOI' value='10.17487/RFC1812'/>
</reference>
    
<reference  anchor='RFC7011' target='http://www.rfc-editor.org/info/rfc7011'>
<front>
<title>Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of Flow Information</title>
<author initials='B.' surname='Claise' fullname='B. Claise' role='editor'><organization /></author>
<author initials='B.' surname='Trammell' fullname='B. Trammell' role='editor'><organization /></author>
<author initials='P.' surname='Aitken' fullname='P. Aitken'><organization /></author>
<date year='2013' month='September' />
</front>
<seriesInfo name='STD' value='77'/>
<seriesInfo name='RFC' value='7011'/>
<seriesInfo name='DOI' value='10.17487/RFC7011'/>
</reference>

<reference  anchor='RFC4364' target='http://www.rfc-editor.org/info/rfc4364'>
<front>
<title>BGP/MPLS IP Virtual Private Networks (VPNs)</title>
<author initials='E.' surname='Rosen' fullname='E. Rosen'><organization /></author>
<author initials='Y.' surname='Rekhter' fullname='Y. Rekhter'><organization /></author>
<date year='2006' month='February' />
</front>
<seriesInfo name='RFC' value='4364'/>
<seriesInfo name='DOI' value='10.17487/RFC4364'/>
</reference>
 
 </references>

 <references title='Informative References'>
	 <reference anchor='on_BGP_communities' target="http://www.sigcomm.org/sites/default/files/ccr/papers/2008/April/1355734-1355743.pdf">
		<front>
				<title>On BGP Communities</title>
				<author initials='B.' surname='Donnet'
						fullname='Benoit Donnet'>
					<organization abbrev='UCLB'>
					Universite catholique de Louvain, Belgium
					</organization>
				</author>
				 <author initials='O.' surname='Bonaventure'
						fullname=' Olivier Bonaventure'>
					<organization abbrev='UCLB'>
					Universite catholique de Louvain, Belgium
					</organization>
				</author>
				<date month='April' year='2008' />
		</front>
		<seriesInfo name='ACM SIGCOMM Computer Communication Review,'
			    value='Volume 38, Number 2, pp. 55-59' />
		<seriesInfo name="DOI" value="10.1145/1355734.1355743"/>

	 </reference>


    <reference anchor='on_BGP_RS_VPNs' target="http://inl.info.ucl.ac.be/system/files/Cisco_NAG_2009_ns_bgp.pdf">
        <front>
                <title>Customized BGP Route Selection Using BGP/MPLS VPNs</title>
                <author initials='L.' surname='Vanbever'
                        fullname='Laurent Vanbever'>
                    <organization abbrev='UCLB'>
                    Universite catholique de Louvain, Belgium
                    </organization>
                </author>
                <author initials='P.' surname='Francois'
                        fullname='Pierre Francois'>
                    <organization abbrev='UCLB'>
                    Universite catholique de Louvain, Belgium
                    </organization>
                </author>
                 <author initials='O.' surname='Bonaventure'
                        fullname=' Olivier Bonaventure'>
                    <organization abbrev='UCLB'>
                    Universite catholique de Louvain, Belgium
                    </organization>
                </author>
                <author initials='J.' surname='Rexford'
                        fullname='Jennifer Rexford'>
                    <organization abbrev='PRINCETON'>
                    Princeton University, USA
                    </organization>
                </author>
                <date month='October' year='2009' />
        </front>
        <seriesInfo name='Cisco Systems,' value='Routing Symposium' />

     </reference>


	 <reference anchor="INIT7-RIPE63" target="http://ripe63.ripe.net/presentations/48-How-more-specifics-increase-your-transit-bill-v0.2.pdf">
	  <front>
		<title>How More Specifics increase your transit bill (and ways
		to avoid it)</title>
		<author initials="F." surname="Kunzler" fullname="Fredy	Kunzler">
		  <organization>INIT7</organization> </author>
		<date month="October" year="2011"/>
	  </front>
	  <seriesInfo name="Reseaux IP Europeens (RIPE)" value="63rd Meeting"/>
	</reference>

    <reference anchor="PMACCT" target="http://www.pmacct.net">
	  <front>
		<title>pmacct project: IP accounting iconoclasm</title>
		<author/>
		<date/>
	  </front>
	</reference>

 </references>

<section title="Acknowledgements" numbered="no">
<t>The authors would like to thank Wes George, Jon Mitchell, Bruno
Decraene, and Job Snijders for their useful suggestions and comments.</t>
</section>
</back>
</rfc>
