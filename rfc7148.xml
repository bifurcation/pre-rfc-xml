<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
    <!ENTITY rfc2119 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml'>
    <!ENTITY rfc5213 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5213.xml'>
    <!ENTITY rfc5844 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.5844.xml'>
    <!ENTITY rfc3633 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3633.xml'>
    <!ENTITY rfc6275 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6275.xml'>
    <!ENTITY rfc3315 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.3315.xml'>
    <!ENTITY rfc6276 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6276.xml'>
    <!ENTITY rfc4877 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4877.xml'>
    <!ENTITY rfc6603 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6603.xml'>  
    <!ENTITY rfc6656 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.6656.xml'>
    <!ENTITY rfc4301 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4301.xml'>
    <!ENTITY rfc4885 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4885.xml'>
    <!ENTITY rfc4649 PUBLIC ''
      'http://xml.resource.org/public/rfc/bibxml/reference.RFC.4649.xml'>
]>
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="5"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc inline="yes"?>
<?rfc rfcedstyle="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc number="7148" category="std" ipr="trust200902" submissionType="IETF" consensus="yes">

<!--<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>-->

  <front>    
    <title abbrev="Prefix Delegation Support for PMIPv6">
    Prefix Delegation Support for Proxy Mobile IPv6
    </title>

    <!-- AUTHORS -->
    <author initials="X" surname="Zhou" fullname="Xingyue Zhou">
      <organization>ZTE Corporation</organization>
      <address>
	<postal>
          <street>No.50 Software Avenue, Yuhuatai District</street>
	  <region>Nanjing</region>
	  <country>China</country>
	</postal>
	<phone>+86-25-8801-4634</phone>
	<email>zhou.xingyue@zte.com.cn</email>
      </address>
    </author>

    <author initials="J" surname="Korhonen" fullname="Jouni Korhonen">
      <organization abbrev="">Broadcom</organization>
      <address>
        <postal>
          <street>Porkkalankatu 24</street>
          <city>Helsinki</city> 
          <code>FIN-00180</code>
          <country>Finland</country>
        </postal>
        <email>jouni.nospam@gmail.com</email>
      </address>
    </author>

    <author initials="C" surname="Williams" fullname="Carl Williams">
      <organization abbrev="">Consultant</organization>
      <address>
        <postal>
          <street/>
          <city>San Jose, CA</city>
          <code/>
          <country>USA</country>
        </postal>
        <email>carlw@mcsr-labs.org</email>
      </address>
    </author>

    <author initials="S" surname="Gundavelli" fullname="Sri Gundavelli">
      <organization abbrev="">Cisco</organization>
      <address>
        <postal>
          <street>170 West Tasman Drive</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <email>sgundave@cisco.com</email>
      </address>
    </author>

    <author fullname="Carlos J. Bernardos" initials="CJ." surname="Bernardos">
      <organization abbrev="UC3M">
       Universidad Carlos III de Madrid
      </organization>
      <address>
        <postal>
          <street>Av. Universidad, 30</street>
          <city>Leganes, Madrid</city>
          <code>28911</code>
          <country>Spain</country>
        </postal>
        <phone>+34 91624 6236</phone>
        <email>cjbc@it.uc3m.es</email>
        <uri>http://www.it.uc3m.es/cjbc/</uri>
      </address>
    </author>

    <date month="March" year="2014"/>

    <area>Internet</area>

    <workgroup>NETEXT WG</workgroup>

    <keyword>Prefix Delegation</keyword>

    <keyword>Proxy Mobile IPv6</keyword>

    <keyword>PMIPv6</keyword>

    <keyword>Mobile Router</keyword>

    <!-- Abstract -->
    <abstract>



      <t>        
This specification defines extensions to the Proxy Mobile IPv6 protocol for
allowing a mobile router in a Proxy Mobile IPv6 domain to obtain IP prefixes for
its attached mobile networks using DHCPv6 prefix delegation. Network-based
mobility management support is provided for those delegated IP prefixes just as
it is provided for the mobile node's home address. Even if the mobile router
performs a handoff and changes its network point of attachment, mobility support
is ensured for all the delegated IP prefixes and for all the IP nodes in the
mobile network that use IP address configuration from those delegated IP
prefixes.
      </t>
    </abstract>    
    <!-- END Abstract -->

  </front>    

  <middle>

    <!-- 1. Introduction -->
    <section title="Introduction">

      <t>
Proxy Mobile IPv6 <xref target="RFC5213"/> enables network-based mobility
management support for an IP host without requiring its participation in any IP
mobility signaling. In Proxy Mobile IPv6 (PMIPv6), the mobile access gateway
(MAG) performs the mobility management function on behalf of the mobile node
(MN). The local mobility anchor (LMA) is the home agent for the MN and the
topological anchor point. The mobility elements (LMA and MAGs) in the network
allow an IP host to obtain an IPv4 address and/or a set of IPv6 addresses and
be able to obtain IP mobility support for those IP address(es) within the Proxy
Mobile IPv6 domain. In this context, the mobility management support is enabled
for an individual IP host, which is the mobile node. The IPv4 home address or
the IPv6 home network prefixes are logically bound to the link shared between
the mobile access gateway and the mobile node, and only the mobile node can use
those IP address(es) by configuring them on the interface attached to that link.
Currently, there is no mobility support for the mobile networks attached to a
mobile router (MR) in a Proxy Mobile IPv6 domain.
      </t>

      <t>
This specification defines extensions to the Proxy Mobile IPv6 protocol for allowing mobility support to the mobile networks
attached to a mobile router. These extension include definition of a a new mobility option that can be exchanged in the signaling
messages between the mobile access gateway and the local mobility anchor.


The mobile router can request the mobility entities in the Proxy Mobile IPv6 domain for delegated IP prefix(es) using DHCP prefix delegation extensions
<xref target="RFC3633"/>, static configuration of the prefixes, or mechanisms specific to the access technology.


The mobility entities in the PMIPv6
network provide network-based mobility management support for those delegated
prefixes just as it is supported for a home address. The delegated prefixes are
hosted in the mobile network attached to the mobile router. IP mobility is
ensured for all the IP nodes in the mobile network, even as the mobile router
performs a handoff by changing its point of network attachment within the Proxy
Mobile IPv6 domain. 
The local mobility anchor in the Proxy Mobile IPv6 domain will not track the individual IP nodes in the mobile network;
it only tracks a single mobile router session that is hosting the
mobile network and associates the delegated IP prefixes with that session.
Although the protocol solution defined in this specification also allows
signaling IPv4 subnets between the mobile access gateway and the local mobility
anchor, the delegation of IPv4 subnets to the mobile router is out of the scope of
this specification.
      </t>

      <figure anchor="fig1" title="Mobile Router in Proxy Mobile IPv6 Domain">
        <artwork><![CDATA[
                                   _----_
                    +-------+    _(      )_        
                    |       |---( Internet )
                    |  LMA  |    (_      _) 
                    |       |      '----'
                    +-------+
                        |
                   === === === 
                ==    Proxy    ==       
             ==    Mobile IPv6    ==
                ==    Domain   ==
                   === === ===   
             ___________|___________
            |                       | 
        +-------+               +-------+
        |  MAG  |               |  MAG  |
        +-------+               +-------+              
            .
            .
     - - - - - - - -     
    |   +------+    |
    |   |  MR  |    |   
    |   +------+    |     
    |       |       | 
    |    -------    |    
    |    |     |    |
    |   LFN   LFN   |
     - - - - - - - - 
        ]]></artwork>
      </figure>


      <t>
   Within the context of this document, the definition of a mobile
   router extends the definition of a mobile node from 
<xref target="RFC5213"/>  by adding
routing capability between the mobile network and the point of attachment of
the mobile router. 
Local fixed nodes (LFNs) are IP nodes in the mobile network; 
LFNs all move with the mobile router as a single cluster.
As the mobile router moves, the LFNs are not aware of the
mobility of the MR to a new point of attachment. <xref target="fig1"/>
illustrates a mobile router in a Proxy Mobile IPv6 domain. 
      </t>


      <t>
The rest of this document identifies the protocol extensions and the
operational details of the local mobility anchor and mobile access
gateway for realizing prefix delegation support for Proxy Mobile IPv6.
      </t>

    </section>
    <!-- END 1. Introduction -->

    <!-- 2. Terminology  -->
    <section anchor="sec:terminology" title="Terminology">

      <t>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in <xref target="RFC2119"/>.
      </t>
	
      <t>
All the mobility-related terms used in this document are to be interpreted as
defined in Proxy Mobile IPv6 specifications <xref target="RFC5213"/> and
<xref target="RFC5844"/>. All the DHCP-related terms are to be interpreted as
defined in DHCPv6 Prefix Delegation for Network Mobility (NEMO) <xref target="RFC6276"/>, DHCPv6 Prefix Delegation (DHCPv6PD)
<xref target="RFC3633"/>, and Subnet Allocation Option for DHCPv4
<xref target="RFC6656"/>. This document also provides a context-specific
explanation of the following terms used here and originally defined
in the Mobile Network terminology document <xref target="RFC4885"/>.
      </t>

      <t>
Mobile Router (MR)
      </t>

      <t>

        <list style="empty">

          <t>
The term "mobile router" is used to refer to an IP router whose mobility is
managed by the network while being attached to a Proxy Mobile IPv6 domain. The
mobile router is a mobile node as defined in <xref target="RFC5213"/> but with
additional capabilities for supporting an attached mobile network. The MR's
interface used for attachment to the mobile access gateway is referred to as the
"egress interface". Any MR's interface used for attachment to the mobile network
is referred to as the "ingress interface". The mobility entities in the Proxy Mobile
IPv6 domain provide mobility for the IPv4/IPv6 address(es) assigned to the
mobile node's egress link and also mobility support to the network prefixes
hosted in the network attached to the mobile router.
          </t>

        </list>

      </t>

      <t>
Mobile Network
      </t>

      <t>

        <list style="empty">

          <t>
A mobile network is an IP network attached to a mobile router. There can be many IP nodes in
this IP network. The mobile router is a gateway for these IP nodes for reaching
other IP networks or the Internet. The mobile router and the attached IP
networks move as a single  cluster.
          </t>

        </list>

      </t>

      <t>
Delegated Mobile Network Prefix (DMNP)
      </t>

      <t>

        <list style="empty">

          <t>
The Delegated Mobile Network Prefix is an IPv4/IPv6 prefix delegated to a mobile
router and is hosted in the mobile network. The IP nodes in the mobile network
will be able to obtain IP address configuration from the DMNP and will have IP mobility support for that address configuration.
The DMNP is topologically anchored on the local mobility anchor, and the mobility
elements in the Proxy Mobile IPv6 domain provide IP mobility support for the
prefix by forwarding the mobile network traffic to the mobile router.
          </t>

        </list>

      </t>

      <t>
Local Fixed Node (LFN)
      </t>

      <t>

        <list style="empty">

          <t>
A local fixed node is an IP node in the mobile network. As the mobile router
performs a handoff and changes its network point of attachment, the local
fixed node moves along with the mobile router.
          </t>

        </list>

      </t>

    </section>
    <!-- END 2. Terminology  -->

    <!-- 3. Solution Overview  -->
    <section anchor="sec:overview" title="Solution Overview">

      <t>
This section lists the stated assumptions and provides an overview of the operation of this
specification. This document references three different deployment scenarios and explains the protocol
operation.
      </t>

      <!-- 3.1. Stated Assumptions -->
      <section anchor="sec:stated-assumptions" title="Stated Assumptions">

        <t>

          <list style="symbols">

            <t>
The mobile router is a mobile node as defined in <xref target="RFC5213"/> but
with additional capabilities for routing IP packets between its egress interface
(interface used for attachment to the mobile access gateway) and any of its
ingress interfaces (interfaces used for attachment to the mobile network). 
            </t>

            <t>
This specification assumes that a mobile router is an IPv4 and/or IPv6 router
without any capability for mobility management. 
            </t>



            <t>
The mobile router can obtain the delegated IP prefix(es) for its attached mobile
networks using DHCPv6 prefix delegation, static configuration, or 
mechanisms specific to access technology. This document assumes DHCPv6
prefix delegation <xref target="RFC3633"/> in conjunction with the Prefix
Exclude Option <xref target="RFC6603"/> as the default mechanism for prefix
assignment to the mobile node. It defines an interworking between the mobility
entities and the DHCPv6 functional elements in a non-normative way. 
The mechanism that delegates IPv4 subnets to a mobile
router is out of the scope of this specification.
            </t>

            <t>
The mobile router obtains the IP address configuration for its egress roaming
interface as specified in <xref target="RFC5213"/> and <xref target="RFC5844"/>.
The mobile router, along with its mobile networks, will be able to perform
handoff, change its point of attachment in the network, and retain IP
mobility support.
            </t>

            <t>
When using DHCPv6 prefix delegation, this document assumes that the mobile
router uses its egress interface when making DHCPv6 requests.
            </t>

          </list>

        </t>

      </section>
      <!-- END 3.1. Stated Assumptions -->

      <!-- 3.2. Deployment Models -->
      <section anchor="sec:deployment_models" title="Deployment Models">

        <t>
This section explains the protocol operation used to support prefix delegation
in Proxy Mobile IPv6 for the following three deployment models:
i) delegating router co-located with mobile access gateway, ii) delegating
router co-located with local mobility anchor, and iii) static configuration of
delegated prefixes. High-level message call flows between the mobile router,
mobile access gateway, and the local mobility anchor are presented while
explaining the protocol operation.
        </t>

        <!-- 3.2.1. Delegating Router Co-Located with MAG -->
        <section anchor="sec:dm1" title="Delegating Router Co-located with Mobile Access Gateway">

          <t>
In this deployment scenario, the delegating router (DR) function, as specified
in <xref target="RFC3633"/>, is co-located with the mobile access gateway, and a
requesting router (RR) function is enabled on the mobile router.
          </t>


          <t>
<xref target="fig:DR_colocated_with_MAG"/> shows the high-level message call
flow for this case. The mobile router attaches to the mobile access gateway,
which triggers the Proxy Mobile IPv6 signaling between the mobile access
gateway and the local mobility anchor, setting up the bidirectional tunnel
between them (regular Proxy Mobile IPv6 registration). After that, the
DHCPv6 requesting router function running on the mobile router sends a Solicit
message requesting a prefix. This message is received by the DHCPv6
delegating router function running on the mobile access gateway. The mobile
access gateway then sends a Proxy Binding Update message including a Delegated
Mobile Network Prefix (DMNP) option carrying the ALL_ZERO value
<xref target="RFC5213"/>. This serves as a request for the local mobility
anchor to allocate a set of delegated prefixes, conveyed back in one or more
DMNP options in a Proxy Binding Acknowledgement message. The DHCPv6-PD procedure
is then completed as described in <xref target="RFC3633"/>, ending with the
delegating router sending a Reply message conveying the delegated prefixes. If
the requesting router includes a Rapid Commit option in its Solicit message, it
is preferable that the MAG respond directly with a Reply message rather than with an
Advertise message, as described in <xref target="RFC3315"/>, Section 17.2.3.
          </t>

          <figure anchor="fig:DR_colocated_with_MAG" title="Delegating Router Co-located with Mobile Access Gateway">
            <artwork><![CDATA[
   +-----+            +-----+                      +-----+
   | MR  |            | MAG |                      | LMA |
   |(RR) |            | (DR)|                      |     |
   +-----+            +-----+                      +-----+
1)    |-- MN Attach -----|                            |
      |                  |--Proxy Binding Update----->| 
      |                  |                            |
      |                  |<-------Proxy Binding Ack.--|
      |                  |                            |
      |                  |o==========================o|
2)    |                  |       PMIPv6 tunnel        |
      |                  |o==========================o|
3)    |--Solicit for---->|                            |
      | delegated prefix |                            |
4)    |                  |--Proxy Binding Update----->|                        
      |                  |                            |
5)    |                  |<--Proxy Binding Ack.(DMNP)-|
      |                  |                            |
      -                  -<---+                       |
6)    |<------Advertise--|    |                       |
      |                  |    |                       |
7)    |--Request-------->| Optional                   |
      |                  |    |                       |
      -                  -<---+                       |
8)    |<---Reply (DMNP)--|                            |
      |                  |                            |
            ]]> </artwork>
          </figure>

          <t>
From an operational point of view, this is the simplest deployment option, as it
keeps a single protocol interface between the mobile access gateway and the
local mobility anchor.
          </t>

        </section>
        <!-- END 3.2.1. Delegating Router Co-Located with MAG -->

        <!-- 3.2.2. Delegating Router Co-Located with LMA -->
        <section anchor="sec:dm2" title="Delegating Router Co-located with Local Mobility Anchor">

          <t>
In this deployment scenario, the delegating router (DR) function, as specified
in <xref target="RFC3633"/>, is co-located with the local mobility anchor; the
requesting router (RR) function is enabled on the mobile router; and a DHCPv6
relay agent (DRA) function is co-located on the mobile access gateway.
          </t>

          <t>
<xref target="fig:DR_colocated_with_LMA"/> shows the high-level message call
flow for this case. The mobile router attaches to the mobile access gateway,
which triggers the Proxy Mobile IPv6 signaling between the mobile access
gateway and the local mobility anchor, setting up the bidirectional tunnel
between them (regular Proxy Mobile IPv6 registration). After that, the
DHCPv6 requesting router function running on the mobile router requests a prefix
by sending a Solicit message. This message is received by the DHCPv6 relay agent
function running on the mobile access gateway, which then completes the DHCPv6
signaling, according to <xref target="RFC3315"/>. The relay agent function
SHOULD include the relay agent remote-id option <xref target="RFC4649"/> into
Relay-forward messages with appropriate identity information to enable
correlation of mobile router identities used over DHCPv6 and PMIPv6.
          </t>

          <t>
Once the mobile access gateway gets the set of delegated prefixes from the
delegating router function running on the local mobility anchor, the MAG conveys
the delegated prefixes in a Proxy Binding Update. This ensures that the local
mobility anchor properly routes the traffic addressed to the delegated prefixes
via the PMIPv6 tunnel established with the mobile access gateway and that
mobility is provided to these prefixes while the mobile router roams within the
PMIPv6 domain. Note that the relay agent function in the mobile access gateway
has to queue the Reply message for the duration of the PMIPv6 signaling (steps
10 and 11) before forwarding the Reply message to the requesting router. While
this does not change anything from the DHCPv6-PD protocol's point of view,
implementations will need to account for interactions between the timing of
PMIPv6 signaling and the DHCPv6 timeout/retry logic.
          </t>

          <figure anchor="fig:DR_colocated_with_LMA" title="Delegating Router Co-located with Local Mobility Anchor">
            <artwork><![CDATA[
   +-----+            +-----+                    +-----+
   | MR  |            | MAG |                    | LMA |
   |(RR) |            |(DRA)|                    |(DR) |
   +-----+            +-----+                    +-----+
1)    |-- MN Attach -----|                          |
      |                  |--------- PBU ----------->| 
      |                  |                          |
      |                  |<-------- PBA ------------|
      |                  |                          |
      |                  |o========================o|
2)    |                  |      PMIPv6 tunnel       |
      |                  |o========================o|
3)    |-- Solicit for -->|                          |
      | delegated prefix |                          |
4)    |                  |--- Solicit ------------->|
      -                  -                          - <---+
5)    |                  |<-- Advertise ------------|     |
      |                  |                          |     |
6)    |<- Advertise -----|                          |     |
      |                  |                          |  Optional
7)    |-- Request ------>|                          |     |
      |                  |                          |     |
8)    |                  |--- Request ------------->|     |
      -                  -                          - <---+
9)    |                  |<-- Reply (DMNP) ---------|
      |                  |                          |
10)   |                  |----------PBU (DMNP)----->|                        
      |                  |                          |
11)   |                  |<---------PBA (DMNP)------|
      |                  |                          |
12)   |<-- Reply (DMNP) -|                          |
      |                  |                          |
            ]]> </artwork>
          </figure>

          <t>
The DR function can also be located in other entities of the home network
aside from the LMA. This deployment model requires some interworking between
the DR and the LMA and is out of the scope of this specification. Note that this
additional interworking would have no impact on the protocol between the LMA and
MAG defined in this document.
          </t>

        </section>
        <!-- 3.2.2. END Delegating Router Co-Located with LMA -->

        <!-- 3.2.3. Static configuration -->
        <section anchor="sec:dm3" title="Static Configuration of Delegated Mobile Network Prefixes">

          <t>
In this deployment scenario, the DMNPs of the mobile
router are statically configured in the mobile node's policy profile
<xref target="RFC5213"/>. The DMNPs are statically
configured in the mobile network attached to the mobile router. The mobile
router is the default-router for the mobile networks.
          </t>

          <t>
<xref target="fig:static_configuration"/> shows a high-level message call flow
for this example. The mobile access gateway obtains statically configured mobile
network prefixes from the policy profile and registers them with the local
mobility anchor using the extensions specified in this document, that is, the
use of the Delegated Mobile Network Prefix (DMNP) option in the Proxy Mobile
IPv6 signaling. There is no explicit trigger from the mobile router for
registering or de-registering those prefixes. As long as there is a mobility
session for the mobile router's home address, the local mobility anchor enables
mobility support for the mobile network prefixes.
          </t>

          <figure anchor="fig:static_configuration" title="Static Configuration of Delegated Mobile Network                          Prefixes">
            <artwork><![CDATA[
   +-----+            +-----+                    +-----+
   | MR  |            | MAG |                    | LMA |
   |     |            |     |                    |     |
   +-----+            +-----+                    +-----+
1)    |-- MN Attach -----|                          |
2)    |                  - (Policy Profile)         |
      |                  |                          |
3)    |                  |--------- PBU (DMNP) ---->| 
      |                  |                          |
4)    |                  |<-------- PBA (DMNP) -----|
      |                  |                          |
      |                  |o========================o|
5)    |                  |      PMIPv6 tunnel       |
      |                  |o========================o|
      |                  |                          |
            ]]> </artwork>
          </figure>

        </section>
        <!-- END 3.2.3. Static configuration -->

      </section>
      <!-- END 3.2. Deployment Models -->

    </section>
    <!-- END 3. Solution Overview  -->


    <!-- 4. Message Formats -->
    <section anchor="sec:message_formats" title="Message Formats">

      <t>
This section defines extensions to Proxy Mobile IPv6 <xref target="RFC5213"/> 
protocol messages.
      </t>

      <!-- 4.1. DMNP Option -->
      <section anchor="sec:dmnp_format" title="Delegated Mobile Network Prefix Option">

        <t>
A new mobility header option, the Delegated Mobile Network Prefix option, is defined
for use with Proxy Binding Update and Proxy Binding Acknowledgement messages
exchanged between a local mobility anchor and a mobile access gateway. This
option is used for exchanging the mobile router's IPv4/IPv6 DMNP. There can be multiple instances of the Delegated Mobile Network
Prefix option present in a message.
        </t>

        <t>
The Delegated Mobile Network Prefix option has an alignment requirement of 8n+2. 
Its format is as follows:
        </t>



        <figure>
          <artwork><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Type     |   Length      |V|  Reserved   | Prefix Length |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
.                                                               .
+           IPv4 or IPv6 Delegated Mobile Network Prefix        +
|                         (DMNP)                                |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

          ]]></artwork>
        </figure>

        <t>
Type
          <list>

            <t>
55 
            </t>

          </list>

        </t>

        <t>
Length
          <list>

            <t>
8-bit unsigned integer indicating the length of the option in octets, excluding
the Type and Length fields.
            </t>

          </list>

        </t>

        <t>
IPv4 Prefix (V)
          <list>

            <t>
If the IPv4 Prefix (V) flag is set to a value of (1), then it indicates that the
prefix that is included in the DMNP field is an IPv4 prefix. If the IPv4 Prefix
(V) flag is set to a value of (0), then it indicates that the prefix that is
included in the DMNP field is an IPv6 prefix.
            </t>

          </list>

        </t>

        <t>
Reserved
          <list>

            <t>
This field is unused for now. The value MUST be initialized to 0 by the sender
and MUST be ignored by the receiver.
            </t>

          </list>

        </t>

        <t>
Prefix Length
          <list>

            <t>
8-bit unsigned integer indicating the number of leftmost bits covering the network
part of the address contained in the Prefix field.
            </t>

          </list>

        </t>

        <t>
Delegated Mobile Network Prefix
          <list>

            <t>
Contains a mobile router's 4-byte IPv4 or a 16-byte IPv6 Delegated Mobile
Network Prefix.
            </t>

          </list>

        </t>

      </section>
      <!-- END 4.1. DMNP Option -->

      <!-- 4.2. Status Codes -->
      <section title="Status Codes" anchor="status_codes">

        <t>
This document defines the following new status code values for use in the Proxy
Binding Acknowledgement message. These values have been allocated from the same
number space as defined in Section 6.1.8 of <xref target="RFC6275"/>.
        </t>

        <t>
NOT_AUTHORIZED_FOR_DELEGATED_MNP: 177
        </t>

        <t>

          <list style="hanging">

            <t>
Not authorized for DMNP
            </t>

          </list>

        </t>

        <t>
REQUESTED_DMNP_IN_USE: 178
        </t>

        <t>

          <list style="hanging">

            <t>
Requested DMNP is in use
            </t>

          </list>

        </t>

      </section>
      <!-- END 4.2. Status Codes -->

    </section>
    <!-- END 4. Message Formats -->

    <!-- 5. Operational Details -->
    <section anchor="sec:proto-cons" title="Operational Details">

      <!-- 5.1. MAG Considerations -->
      <section anchor="sec:mag-cons" title="MAG Considerations">

        <!-- 5.1.1. BULE Extensions  -->
        <section anchor="sec:mag_bule" title="Extension to Binding Update List Entry Data Structure">

          <t>
In order to support this specification, the conceptual Binding Update List Entry
(BULE) data structure <xref target="RFC5213"/> needs to be extended to include a
Delegated Mobile Network Prefix (DMNP) list. Each entry in the list is used for
storing an IPv4/IPv6 mobile network prefix delegated to the mobile router.
          </t>

        </section>
        <!-- END 5.1.1. BULE Extensions  -->

        <!-- 5.1.2. Signaling Considerations -->
        <section anchor="sec:mag_sig" title="Signaling Considerations">

          <t>
During the mobile router's initial attachment procedure, the mobile access
gateway obtains the mobile router's policy profile, as per the procedures
defined in <xref target="RFC5213"/>. The mobile node's policy profile defined in
<xref target="RFC5213"/> is extended to include a parameter that indicates
Delegated Prefix support. If the policy profile indicates that the mobile router
is authorized for Delegated Prefix support, then the considerations described
next apply.
          </t>

          <t>
The mobile access gateway MUST include one or more Delegated Mobile Network
Prefix (DMNP) options in the Proxy Binding Update message in order to request
the local mobility anchor to allocate DMNP(s) for
the mobile router.
          </t>

          <t>
If the mobile access gateway requests the local mobility anchor to perform the
prefix assignment, then:

            <list style="symbols">

              <t>
There MUST be exactly one instance of the Delegated Mobile Network Prefix
option with an ALL_ZERO value and with the (V) flag set to a value of (0). This
serves as a request to the local mobility anchor to allocate a set of IPv6 DMNPs.  
              </t>

              <t>
There MUST be exactly one instance of the Delegated Mobile Network Prefix option
with an ALL_ZERO value and with the (V) flag set to a value of (1). This serves as
a request to the local mobility anchor to allocate a set of IPv4 DMNP.  
              </t>

              <t>
If the received Proxy Binding Acknowledgement message has the status field value
set to NOT_AUTHORIZED_FOR_DELEGATED_MNP (not authorized for DMNP), the mobile access gateway MUST NOT enable mobility support for
any of the prefixes in the mobile network, and prefix delegation support has to
be disabled.
              </t>

              <t>
If the received Proxy Binding Acknowledgement message has the status field value
set to REQUESTED_DMNP_IN_USE (Requested DMNP is in
use), the mobile access gateway MUST NOT enable mobility support for the
requested prefixes. The mobile access gateway MAY choose to send Proxy Binding
Update message requesting the local mobility anchor to perform the
prefix assignment. 
              </t>

            </list>

          </t>

          <t>
If the mobile access gateway provides the local mobility anchor with the
prefix(es) to be allocated, then:

            <list style="symbols">

              <t>
There MUST be exactly one instance of the Delegated Mobile Network Prefix option
with NON_ZERO prefix value <xref target="RFC5213"/> for each of the mobile
network prefixes that the mobile access gateway is requesting the local mobility
anchor to allocate. The prefix value in the option is the prefix that is either
statically configured for that mobile router in the mobile node's policy
profile or obtained via interactions with the DHCP PD functions. This serves as
a request to the local mobility anchor to allocate the requested IPv4/IPv6
prefix.
              </t>

            </list>

          </t>

          <t>
If the received Proxy Binding Acknowledgement message has the status field value
set to 0 (Proxy Binding Update accepted), the mobile access gateway has to apply
the following considerations.

            <list style="symbols">

              <t>
The Delegated Mobile Network Prefix (DMNP) list in the mobile router's Binding
Update List entry has to be updated with the allocated prefix(es). However, if
the received message was in response to a de-registration request with a
lifetime value of (0), then the DMNP list has to be
removed along with the Binding Update List entry.
              </t>

              <t>
The mobile access gateway has to set up a policy-based route for forwarding the
IP packets received from the mobile network (with the source IP address from any
of the IPv4/IPv6 DMNPs) through the bidirectional
tunnel set up for that mobile router. However, if the received message was in
response to a de-registration request with a lifetime value of (0), then the
created forwarding state has to be removed.
              </t>

            </list>

          </t>

          <t>
This specification assumes that all the mobile access gateways of a PMIPv6
domain support the same prefix delegation mechanism. Any differences
will result in DMNPs getting de-registered and
the mobile network losing the prefix(es). This would result in the attached
local fixed nodes losing the assigned IP addresses. The mobile router MAY
explicitly deprecate these prefixes. Alternatively, the lifetime of the addresses
may expire.
          </t>

        </section>
        <!-- END 5.1.2. Signaling Considerations -->

        <!-- 5.1.3. DHCP - MAG Interactions -->
        <section anchor="sec:mag_sig_ra_mag" title="DHCP -- MAG Interactions">

          <t>
This section describes the interactions between the DHCP and PMIPv6 logical
entities running on the mobile access gateway. This section is applicable only
for deployments that use DHCPv6-based prefix delegation (i.e., it does not apply
if static configuration is used). As described next, these interactions vary
slightly depending on the considered deployment model at the mobile access
gateway (described in <xref target="sec:deployment_models"/>).
          </t>

          <t>
The mobile router, acting as a requesting router as described in
<xref target="RFC3633"/>, sends a Solicit message including one or more IA_PD
option(s) to the delegating router / DHCPv6 relay agent co-located on the mobile
access gateway. This message provides the needed trigger for the mobile access
gateway to request the local mobility anchor to enable DMNP support for that mobility session. We next describe the
subsequent interactions depending on the deployment model.
          </t>

          <!-- 5.1.3.1. Delegating Router Co-Located with MAG -->
          <section anchor="sec:dhcp_mag_inter_dr_mag" title="Delegating Router Co-located with Mobile Access Gateway">

            <t>
The mobile access gateway applies the considerations in
<xref target="sec:mag_sig"/> for requesting the local mobility anchor to enable
delegated prefix support. For example, if the mobile router is soliciting an
IPv4 prefix, the mobile access gateway includes in the Proxy Binding Update
signaling a Delegated Mobile Network Prefix option with an ALL_ZERO value and with
the (V) flag set to a value of (1).
            </t>

            <t>
The mobile access gateway, upon successfully completing the Proxy Binding Update
signaling with the local mobility anchor (following the considerations described
in <xref target="sec:mag_sig"/>), adds the DMNPs to
the Binding Update List. Then, the mobile access gateway provides the obtained
prefixes to the DHCPv6 delegating router for prefix assignment. The way in which
these prefixes are passed to the  DHCPv6 delegating router function is beyond
the scope of this document.

              <list style="symbols">

                <t>
In case the Proxy Binding Update signaling with the local mobility anchor is not
completed successfully, for example, because the local mobility anchor is not
authorized for DMNP or the requested prefix is in
use, the DHCPv6 delegating router will send a Reply message to the requesting
router with no IA_PREFIX suboptions and with a Status Code option as described
in <xref target="RFC3633"/>, Section 11.2.
                </t>

              </list>

            </t>

            <t>
The standard DHCPv6 considerations will be applied with respect to the
interactions between the delegating router and the requesting router. The
requesting router is provided with the delegated prefix(es), which can then be
then advertised in the mobile network and therefore used by the local fixed
nodes to autoconfigure IP addresses, allowing them to gain access to the Internet.
            </t>

            <t>
Any time the requesting router releases the delegated prefixes, the delegating
router removes the assigned prefixes. To do so, the mobile access gateway will
send an Updated Proxy Binding Update following the considerations described in
<xref target="sec:mag_sig"/> for de-registering those prefixes. The way in which
the DHCPv6 delegating router triggers the mobile access gateway in order to
de-register the prefixes is beyond the scope of this document.
            </t>

            <t>
In case the mobile router performs a handover and attaches to a different mobile
access gateway, the following cases are possible:

              <list style="symbols">

                <t>
The new mobile access gateway does not support the delegation of mobile network
prefixes described in this specification. In this case, forwarding of the
previously DMNPs is no longer performed.
                </t>

                <t>
The new mobile access gateway supports the delegation of mobile network prefixes
described in this specification. There are two possible cases upon the reception
of the Solicit message by the delegating router. If the MAG already knows the
DMNPs, it conveys them in a DMNP option included in
the Proxy Binding Update sent to the local mobility anchor, which then
authorizes them based on: a) the content of the associated Binding Cache entry
(if one exists), b) the user profile (if the allocation is static), or c) checking
that the DMNPs are not already allocated. On the
other hand, if the mobile access gateway is not aware of the DMNPs, it will include 0.0.0.0 / :: in a DMNP option included in the
Proxy Binding Update sent to the LMA, which will provide the right prefixes back
in the Proxy Binding Acknowledgement based on a) the content of the associated
Binding Cache entry (if one exits), b) the profile (if static allocation is used),
or c) dynamic assignment.
                </t>

              </list>

            </t>

          </section>
          <!-- END 5.1.3.1. Delegating Router Co-Located with MAG -->

          <!-- 5.1.3.2. Delegating Router Co-Located with LMA -->
          <section anchor="sec:dhcp_mag_inter_dr_lma" title="Delegating Router Co-Located with Local Mobility Anchor">

            <t>
A DHCPv6 relay agent function running on the mobile access gateway will forward
the DHCP messages to the local mobility anchor that has the co-located
delegating router function. The requesting router and the delegating router
complete the DHCP messages related to prefix delegation.
            </t>

            <t>
During the DHCPv6 exchange, the standard DHCPv6 considerations apply with
respect to the interactions between the delegating router, DHCPv6 relay agent,
and requesting router.
            </t>

            <t>
The mobile access gateway learns from the co-located DHCPv6 relay agent the
prefixes allocated by the delegating router. The way in which the mobile access
gateway obtains this information from the DHCPv6 relay agent function is
beyond the scope of this document.
            </t>

            <t>
The mobile access gateway will apply the considerations in
<xref target="sec:mag_sig"/> for requesting the local mobility anchor to enable
delegated prefix support. The mobile access gateway will include exactly one
instance of the Delegated Mobile Network Prefix option with NON_ZERO prefix
value for each of the mobile network prefixes that the mobile access gateway is
requesting the local mobility anchor to allocate. The prefix value(s) in the
option will be the prefix(es) obtained via DHCP prefix delegation.
            </t>

            <t>
The mobile access gateway, upon successfully completing the Proxy Binding Update
signaling with the local mobility anchor, will provide the obtained prefixes to
the DHCPv6 relay agent for prefix assignment. The delegating router is provided
with the delegated prefix(es) completing the standard DHCPv6 signaling. These
prefixes can then be advertised in the mobile network and therefore used
by the local fixed nodes to autoconfigure IP addresses, allowing them to gain
access to the Internet.

              <list style="symbols">

                <t>
In case the Proxy Binding Update signaling with the local mobility anchor is
not completed successfully, for example, because the local mobility anchor is not
authorized for DMNP, the requested prefix is in use,
or the delegated prefix(es) do not match the ones allocated by DHCP prefix
delegation, the DHCPv6 relay agent MAY send a Reply message to the requesting
router with no IA_PREFIX suboptions and with a Status Code option as described
in <xref target="RFC3633"/>, Section 11.2.
                </t>

              </list>

            </t>

            <t>
In case the mobile router performs a handover and attaches to a different mobile
access gateway, the following cases are possible:

              <list style="symbols">

                <t>
The new mobile access gateway does not support the delegation of mobile network
prefixes described in this specification. In this case, forwarding of the
previously delegated mobile network prefixes is no longer performed.
                </t>

                <t>
The new mobile access gateway supports the delegation of mobile network prefixes
described in this specification. There are two possible cases upon the reception
of the Solicit message by the DHCPv6 relay agent. If the MAG already knows the
DMNPs, it conveys them in a DMNP option included in
the Proxy Binding Update sent to the local mobility anchor, which then
authorizes them based on: a) the content of the associated Binding Cache entry
(if one exists), b) the user profile (if the allocation is static), or c) checking
that the DMNPs are not already allocated. On the
other hand, if the mobile access gateway is not aware of the DMNPs, it will include 0.0.0.0 / :: in a DMNP option included in the
Proxy Binding Update sent to the LMA, which will provide the right prefixes back
in the Proxy Binding Acknowledgement based on a) the content of the associated
Binding Cache entry (if one exits), b) the profile (if static allocation is used),
or c) dynamic assignment.
                </t>

              </list>

            </t>
          
          </section>
          <!-- END 5.1.3.2. Delegating Router Co-Located with LMA -->

        </section>
        <!-- END 5.1.3. DHCP - MAG Interactions -->


        <!-- 5.1.4. Packet Forwarding  -->
        <section anchor="sec:mag_fwd" title="Packet Forwarding">

          <t>
On receiving an IP packet from a mobile router, the mobile access gateway MUST
ensure, before
tunneling the packet to the local mobility anchor, that there is an
established binding for the mobile router and that the source IP address of the
packet is a prefix delegated to that mobile router. If the source address of the
received IP packet is not part of the DMNP, then the
mobile access gateway MUST NOT tunnel the packet to the local mobility anchor. 
          </t>

          <t>
On receiving an IP packet from the bidirectional tunnel established with the 
local mobility anchor, the mobile access gateway MUST first decapsulate the
packet (remove the outer header) and then use the destination address of the
(inner) packet to forward it on the interface through which the mobile router is
reachable.
          </t>

          <t>
The above forwarding considerations are not applicable to the IP traffic
sent/received to/from the mobile router's home address (IPv4 HoA / Home Network Prefix (HNP)). For the
mobile router's home address traffic, forwarding considerations from
<xref target="RFC5213"/> and <xref target="RFC5844"/> continue to apply. 
          </t>

        </section>
        <!-- END 5.1.4. Packet Forwarding  -->

      </section>
      <!-- END 5.1. MAG Considerations -->


      <!-- 5.2. LMA Considerations -->
      <section anchor="sec:lma-cons" title="LMA Considerations">

        <!-- 5.2.1 Extensions to Binding Cache Entry Data Structure -->
        <section anchor="sec:lma_bce" title="Extensions to Binding Cache Entry Data Structure">

          <t>
In order to support this specification, the conceptual Binding Cache entry (BCE)  
data structure <xref target="RFC5213"/> needs to be extended to include the
Delegated Mobile Network Prefix (DMNP) list. Each entry in the list represents a
DMNP.
          </t>

        <!-- END 5.2.1 Extensions to Binding Cache Entry Data Structure -->
        </section>

        <!-- 5.2.2. Signaling Considerations -->
        <section anchor="sec:lma_sig" title="Signaling Considerations">

          <t>
If the Proxy Binding Update message does not include any Delegated Mobile
Network Prefix option(s) (<xref target="sec:dmnp_format"/>), then the local
mobility anchor MUST NOT enable Delegated Prefix support for the mobility
session, and the Proxy Binding Acknowledgement message that is sent in response
MUST NOT contain any Delegated Mobile Network Prefix option(s).
          </t>

          <t>
If the Proxy Binding Update message includes one or more Delegated Mobile
Network Prefix options, but the local mobility anchor is not configured with
Delegated Prefix support, then the local mobility anchor will ignore the
option(s) and process the rest of the option as specified in
<xref target="RFC5213"/>.  This would have no effect on the operation of the
rest of the protocol. The Proxy Binding Acknowledgement message that is sent in
response will not include any Delegated Mobile Network Prefix option(s).
          </t>

          <t>
If the Proxy Binding Update message has the Delegated Mobile Network Prefix
option(s) and if the local mobility anchor is configured for Delegated Prefix
support, then the local mobility anchor MUST enable the Delegated Mobile Network
Prefix option for that mobility session. The Proxy Binding Acknowledgement
message that is sent in response MUST include the Delegated Mobile Network
Prefix option(s). The following considerations apply.

            <list style="symbols">

              <t>
If there is at least one instance of the Delegated Mobile Network Prefix option
with an ALL_ZERO <xref target="RFC5213"/> prefix value, then this serves as a
request for the local mobility anchor to perform the assignment of one or more
DMNPs. 

                <list style="symbols">

                  <t>
A Delegated Mobile Network option with an ALL_ZERO value and with the (V) flag set
to a value of (0) is a request for the local mobility anchor to allocate one or
more IPv6 prefixes. 
                  </t>

                  <t>
A Delegated Mobile Network option with an ALL_ZERO value and with the (V) flag set
to a value of (1) is a request for the local mobility anchor to allocate one or
more IPv4 prefixes. 
                  </t>

                  <t>
Inclusion of multiple instances of Delegated Mobile Network options with
ALL_ZERO values, one with the (V) flag set to a value  of (1) and another
instance with the (V) flag set to a value  of (0), is a request to allocate both
IPv4 and IPv6 prefixes.  
                  </t>

                </list>

              </t>


              <t>
If there are no instances of the Delegated Mobile Network Prefix
    option present in the request with an ALL_ZERO value but a
    specific prefix value exists, then this serves as a request for the local
    mobility anchor to perform the allocation of the requested
    prefix(es).
                <list style="symbols">

                  <t>
If any one of the requested prefixes are assigned to some other mobility node,
or not from an authorized pool that the local mobility can allocate for that
mobility session, then the Proxy Binding Update MUST be rejected by sending a
Proxy Binding Acknowledgement message with the Status field set to
REQUESTED_DMNP_IN_USE (Requested DMNP is in use). 
                  </t>

                </list>

              </t>

            </list>

          </t>

          <t>
Upon accepting the Proxy Binding Update, the local mobility anchor MUST send a
Proxy Binding Acknowledgement message with the Status field set to 0 (Proxy
Binding Update accepted). 

            <list style="symbols">

              <t>
The message MUST include one instance of the Delegated Mobile Network Prefix
option for each of the allocated IPv4/IPv6 DMNPs. 
              </t>

              <t>
The Delegated Mobile Network Prefix (DMNP) list in the mobile router's Binding
Cache entry has to be updated with the allocated prefix(es). However, if the
request is a de-registration request with a lifetime value of (0), the DMNP list has to be removed along with the Binding Cache entry. 
              </t>

              <t>
A route (or a platform-specific equivalent function that sets up the forwarding)
for each of the allocated prefixes over the tunnel has to be added. However, if
the request is a de-registration request, with a lifetime value of (0), all the
IPv4/IPv6 delegated prefix routes created for that session have to be removed.
              </t>

            </list>

          </t>

        </section>
        <!-- END 5.2.2. Signaling Considerations -->

        <!-- 5.2.3. Packet Forwarding -->
        <section anchor="sec:lma_fwd" title="Packet Forwarding">

          <t>
The local mobility anchor MUST advertise a connected route into the routing
infrastructure for the IP prefixes delegated to all of the mobile routers that
it is serving.  This step essentially enables the local mobility anchor to be a
routing anchor for those IP prefixes and be able to intercept IP packets sent to
those mobile networks.
          </t>

          <t>
On receiving a packet from a correspondent node with the destination address
matching any of the mobile router's DMNPs, the local
mobility anchor MUST forward the packet through the bidirectional tunnel set up
with the mobile access gateway where the mobile router is attached.
          </t>
         
          <t>
On receiving an IP packet from the bidirectional tunnel established with the 
mobile access gateway, the local mobility anchor MUST first decapsulate the
packet (remove the outer header) and then use the destination address of the
(inner) packet for forwarding decisions. The local mobility anchor MUST ensure
that there is an established binding for the mobile router and that the source IP
address of the packet is a prefix delegated to a mobile router reachable over
that bidirectional tunnel.
          </t>

          <t>
The above forwarding considerations are not applicable to the IP traffic
sent/received to/from the mobile router's home address (IPv4 HoA/HNP). For the
mobile router's home address traffic, forwarding considerations from
<xref target="RFC5213"/> and <xref target="RFC5844"/> continue to apply. 
          </t>

        </section>
        <!-- END 5.2.3. Packet Forwarding -->

      </section>
      <!-- END 5.2. LMA Considerations -->

      <!-- 5.3. SPD Entries -->
      <section anchor="sec:spde" title="Security Policy Database (SPD) Example Entries">

        <t>
The use of DHCPv6, as described in this document, requires message integrity
protection and source authentication. The IPsec security mechanism used by Proxy
Mobile IPv6 <xref target="RFC5213"/> for securing the signaling messages
between the mobile access gateway and the local mobility anchor can be used for
securing the DHCP signaling between the mobile access gateway and the local
mobility anchor.
        </t> 

        <t>
The Security Policy Database (SPD) and Security Association Database (SAD)
entries necessary to protect the DHCP signaling is specified below. The format
of these entries is based on  <xref target="RFC4877"/> conventions. The SPD and
SAD entries are only example configurations. A particular implementation of
mobile access gateway and local mobility anchor implementation can configure
different SPD and SAD entries as long as they provide the required security for
protecting DHCP signaling messages.
        </t>

        <t>
For the examples described in this document, a mobile access gateway with
address "mag_address_1" and a local mobility anchor with address
"lma_address_1" are assumed.
        </t>



<figure><artwork><![CDATA[
   mobile access gateway SPD-S:
     - IF local_address = mag_address_1 &
          remote_address = lma_address_1 & proto = UDP &
          local_port = any & remote_port = DHCP 
       Then use SA1 (OUT) and SA2 (IN)]]>
</artwork></figure>

<figure><artwork><![CDATA[
   mobile access gateway SAD: 
     - SA1(OUT, spi_a, lma_address_1, ESP, TRANSPORT):
           local_address = mag_address_1 &
           remote_address = lma_address_1 &
           proto = UDP & remote_port = DHCP 
     - SA2(IN, spi_b, mag_address_1, ESP, TRANSPORT):
           local_address = lma_address_1 &
           remote_address = mag_address_1 &
           proto = UDP & local_port = DHCP]]>
</artwork></figure>

<figure><artwork><![CDATA[ 
   local mobility anchor SPD-S: 
     - IF local_address = lma_address_1 &
          remote_address = mag_address_1 & proto = UDP &
          local_port = DHCP & remote_port = any 
       Then use SA2 (OUT) and SA1 (IN)]]>
</artwork></figure>


<figure><artwork><![CDATA[ 
   local mobility anchor SAD: 
     - SA2(OUT, spi_b, mag_address_1, ESP, TRANSPORT):
           local_address = lma_address_1 &
           remote_address = mag_address_1 &
           proto = UDP & local_port = DHCP 
     - SA1(IN, spi_a, lma_address_1, ESP, TRANSPORT):
           local_address = mag_address_1 &
           remote_address = lma_address_1 &
           proto = UDP & remote_port = DHCP]]>
</artwork></figure>




      </section>
      <!-- END 5.3. SPD Entries -->

    </section>
    <!-- END 5. Operational Details -->

    <!-- 6. Security Considerations -->
    <section anchor="sec:sec-cons" title="Security Considerations">

      <t>
The Delegated Mobile Network Prefix option defined in this specification is for
use in Proxy Binding Update and Proxy Binding Acknowledgement messages. This
option is carried like any other mobility header option as specified in
<xref target="RFC5213"/>.  Therefore, it inherits from  <xref target="RFC5213"/>
its security guidelines and does not require any additional security
considerations. 
      </t>

      <t>
The use of DHCPv6 in this specification is as defined in the DHCPv6 base
specification  <xref target="RFC3315"/> and DHCPv6 prefix delegation
specification <xref target="RFC3633"/>. The security considerations specified 
in those specifications apply to this document. 
      </t>

      <t>
If IPsec is used, the IPsec security association that is used for protecting the
Proxy Binding Update and Proxy Binding Acknowledgement also needs to be used
for protecting the DHCPv6 signaling between the mobile access gateway and the
local mobility anchor. Considerations specified in <xref target="sec:spde"/>
identify the extensions to security policy entries <xref target="RFC4301"/>
      </t>

    </section>
    <!-- END 6. Security Considerations -->


    <!-- 7. IANA Considerations -->
    <section anchor="sec:iana-cons" title="IANA Considerations">



      <t>

        <list style="symbols">

          <t>
This specification defines a new mobility header option, the Delegated
Mobile Network Prefix option. This mobility option is described in
<xref target="sec:dmnp_format"/>.  The type value 55 for this
message has been allocated from the "Mobility Options" registry at
http://www.iana.org/assignments/mobility-parameters. 
          </t>

          <t>
This document also defines two new status code values for use in the
Proxy Binding Acknowledgement message, as described in
<xref target="status_codes"/>. These status codes are
NOT_AUTHORIZED_FOR_DELEGATED_MNP (not authorized for DMNP) with a status code value of 177 and REQUESTED_DMNP_IN_USE
(Requested DMNP is in use) with a status code value
of 178. These values have been assigned from the same number space
as allocated for other status codes  <xref target="RFC6275"/>.
          </t>

        </list>

      </t>

    </section>
    <!-- END 7. IANA Considerations -->


    <!-- 8. Acknowledgements -->
    <section anchor="Acknowledgements" title="Acknowledgements">

      <t>
The authors would like to acknowledge Ryuji Wakikawa, Alexandru Petrescu, Behcet
Sarikaya, Seil Jeon, Basavaraj Patil, Brian Haberman, and Michal Hoeft for all
the discussions and reviews of this document. 
      </t>

      <t>
The work of Carlos J. Bernardos has also been partially supported by the
European Community's Seventh Framework Programme (FP7-ICT-2009-5) under grant
agreement n. 258053 (MEDIEVAL project) and by the Ministry of Science and
Innovation of Spain under the QUARTET project (TIN2009-13992-C02-01).
      </t>

    </section>
    <!-- END 8. Acknowledgements -->

  </middle>

  <back>

    <references title="Normative References">



&rfc2119;
&rfc6275;
&rfc5213;
&rfc5844;
&rfc3633;
&rfc3315;
&rfc6276;
&rfc4877;
&rfc6603;
&rfc4301;
&rfc4649;


    </references>

    <references title="Informative References">

&rfc6656;
&rfc4885;

    </references>

  </back>

</rfc>
