<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC0791 SYSTEM "reference.RFC.0791.xml">
<!ENTITY RFC2119 SYSTEM "reference.RFC.2119.xml">
<!ENTITY RFC3264 SYSTEM "reference.RFC.3264.xml">
<!ENTITY RFC3550 SYSTEM "reference.RFC.3550.xml">
<!ENTITY RFC3551 SYSTEM "reference.RFC.3551.xml">
<!ENTITY RFC3711 SYSTEM "reference.RFC.3711.xml">
<!ENTITY RFC4175 SYSTEM "reference.RFC.4175.xml">
<!ENTITY RFC4585 SYSTEM "reference.RFC.4585.xml">
<!ENTITY RFC4855 SYSTEM "reference.RFC.4855.xml">
<!ENTITY RFC5124 SYSTEM "reference.RFC.5124.xml">
<!ENTITY RFC5234 SYSTEM "reference.RFC.5234.xml">
<!ENTITY RFC5371 SYSTEM "reference.RFC.5371.xml">
<!ENTITY RFC5888 SYSTEM "reference.RFC.5888.xml">
<!ENTITY RFC6838 SYSTEM "reference.RFC.6838.xml">
<!ENTITY RFC7201 SYSTEM "reference.RFC.7201.xml">
<!ENTITY RFC7202 SYSTEM "reference.RFC.7202.xml">
<!ENTITY RFC7273 SYSTEM "reference.RFC.7273.xml">
<!ENTITY RFC8174 SYSTEM "reference.RFC.8174.xml">

]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>
<rfc number="8331" category="std" submissionType="IETF" consensus="yes" ipr="trust200902">
  <front>

    <title abbrev="RTP Payload for Ancillary Data">RTP Payload for
    Society&nbsp;of&nbsp;Motion&nbsp;Picture&nbsp;and&nbsp;Television&nbsp;Engineers&nbsp;(SMPTE) ST&nbsp;291&nbhy;1&nbsp;Ancillary&nbsp;Data</title>

    <author fullname="Thomas G. Edwards" initials="T.G." surname="Edwards">
      <organization>FOX</organization>

      <address>
        <postal>
          <street>10201 W. Pico Blvd.</street>

          <city>Los Angeles</city>

          <region>CA</region>

          <code>90035</code>

          <country>United States of America</country>
        </postal>

        <phone>+1 310 369 6696</phone>

        <email>thomas.edwards@fox.com</email>

      </address>
    </author>

    <date month="February" year="2018"/>

    <area>General</area>

    <workgroup>A/V Transport Payloads Working Group</workgroup>

<keyword>SDI</keyword>
<keyword>video</keyword>
<keyword>captions</keyword>
<keyword>timecode</keyword>
<keyword>ANC</keyword>
    
    <abstract>
      <t>
This memo describes a Real-time Transport Protocol (RTP) payload format for
          the Society of Motion Picture and Television Engineers (SMPTE)
	  ancillary space (ANC) data,
          as defined by SMPTE ST 291-1. SMPTE ANC data is generally used along with
          professional video formats to carry a
      range of ancillary data types, including time code, Closed
      Captioning, and the Active Format Description (AFD).</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>This memo describes a Real-time Transport Protocol (RTP) payload format for the Society
          of Motion Picture and Television Engineers (SMPTE) ancillary space (ANC) data,
        as defined by <xref target="ST291">SMPTE ST 291-1</xref>. ANC data is transmitted in the 
      ancillary space of serial digital video interfaces, the space outside of the active video
      region of images intended for users to view.  Ancillary space roughly corresponds
      to vertical and horizontal blanking periods of cathode ray tube type
      displays.  ANC data can carry a
      range of data types, including time code, Closed
      Captioning, and the Active Format Description (AFD).</t>
      
      <t>ANC data is
      generally associated with the carriage of metadata within the bit stream
      of a Serial Digital Interface (SDI), such as the standard definition (SD) Serial Digital Interface,
      the 1.5 Gb/s Serial Digital Interface for high definition (HD) television applications, or
      the 3 Gb/s Signal/Data Serial Interface (<xref target="ST259">SMPTE ST 259</xref>, 
        <xref target="ST292">SMPTE ST 292-1</xref>, and <xref target="ST424">SMPTE ST 424</xref>).</t>
      
      <t>ANC data packet
      payload definitions for a specific application are specified by a SMPTE
      Standard, Recommended Practice, Registered Disclosure Document, or by
      a document generated by another organization, a company, or an
      individual (an entity). When a payload format is registered with SMPTE,
      it is identified by a registered data identification word.</t>
      
      <t>This memo describes an RTP payload that supports carriage of ANC data packets
        that originate from any location within any SMPTE-defined SDI
	signal. This payload also supports the carriage of ANC data packets
	that did not originate from an SDI signal. Sufficient
      information is provided to enable the ANC data packets at the output of the
      decoder to be restored to their original locations in the
      serial digital video signal raster (if that is desired).  An optional media type parameter allows for
      the signaling of carriage of one or more types of ANC data as specified by data identification (DID) and secondary
      data identification (SDID) words.  Another optional media type parameter allows for the
      identification of the Video Payload ID (VPID) code of the source interface of ANC data packets.</t>
      
      <t>Note that the Ancillary Data Flag (ADF) word is not specifically carried in this RTP payload.  The ADF might be specified in a document defining an interconnecting digital video interface;
          otherwise, a default ADF is specified by <xref target="ST291">SMPTE ST 291-1</xref>.</t>
      
      <t>This ANC data payload
      can be used by itself or used along with a range of RTP video formats.  In particular, it
      has been designed so that it could be used along with
      "RTP Payload Format for Uncompressed Video" <xref target="RFC4175"/> or "RTP Payload Format for JPEG 2000 Video Streams" <xref
      target="RFC5371" />.</t>
      <t>The data model in this document for the ANC data RTP payload is based on the data model of <xref target="ST2038">SMPTE ST 2038</xref>, which standardizes the carriage of ANC data packets in an MPEG-2 Transport Stream.</t>
	
      
      <section title="Requirements Language">
        <t>
    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
    NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
    "MAY", and "OPTIONAL" in this document are to be interpreted as
    described in BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>

      </section>
    </section>

    <section anchor="payload_format" title="RTP Payload Format for SMPTE ST 291 Ancillary Data">
 
      <t>An example of the format of an RTP packet containing SMPTE ST 291 ANC data is shown below:</t>
<figure align="center" anchor="rtp_payload_figure" title="SMPTE Ancillary Data RTP Packet Format">
<artwork align="center">
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |V=2|P|X| CC    |M|    PT       |        sequence number        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           timestamp                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |           synchronization source (SSRC) identifier            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Extended Sequence Number    |           Length=32           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | ANC_Count=2   | F |                reserved                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |C|   Line_Number=9     |   Horizontal_Offset   |S| StreamNum=0 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         DID       |        SDID       |  Data_Count=0x84  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                             User_Data_Words...
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |   Checksum_Word   |         word_align            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |C|   Line_Number=10    |   Horizontal_Offset   |S| StreamNum=0 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         DID       |        SDID       |  Data_Count=0x105 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                             User_Data_Words...
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                    |   Checksum_Word   |word_align |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
      </figure>
      <t>In this example, two ANC data packets are present.  The first has four 10-bit User_Data_Words, and
          the second has five 10-bit User_Data_Words (note that few ANC data packets are this small;
      thus, this example does not reflect actual defined ANC data packets and does not specifically call out
      the DIDs and SDIDs).  The ANC data packets are located on lines 9 and 10 of the SDI raster.</t>
      <t>The term "network byte order" in the payload format SHALL refer to the 
        Data Transmission Order as defined in Appendix B of <xref
	target="RFC0791">RFC 791</xref>.
      </t>
      <t>RTP packet header fields SHALL be interpreted as per <xref
      target="RFC3550">RFC 3550</xref>, with the following specifics:
        <list hangIndent="3" style="hanging">
          <t hangText="Timestamp: 32 bits"><vspace blankLines="0"/>The
	  timestamp field is interpreted in a similar fashion to <xref
	  target="RFC4175">RFC 4175</xref>:
	  <list>
          <t>For progressive scan video, the timestamp denotes the sampling instant of the frame to which the ANC data in the RTP packet belongs.  RTP packets MUST NOT include ANC data from multiple frames, and all RTP packets with ANC data belonging to the same frame MUST have the same timestamp.</t>
          <t>For interlaced video, the timestamp denotes the sampling instant
	  of the field to which the ANC data in the RTP packet belongs.
	  RTP packets MUST NOT include ANC data packets from multiple fields, and all
	  RTP packets belonging to the same field MUST have the same
	  timestamp.</t>
	  </list></t>
          <t>If the sampling instant does not correspond to an integer value
	  of the clock, the value SHALL be truncated to the next lowest
	  integer with no ambiguity.  Section 3.1 describes timestamp clock rates.</t>
          <t hangText="Marker bit (M): 1 bit"><vspace blankLines="0"/>The
	  marker bit set to "1" indicates the last ANC data RTP packet for a
	  frame (for progressive scan video) or the last ANC data RTP packet
	  for a field (for interlaced video).</t>
        </list></t>
    
      <section title="Payload Header Definitions">
      <t>The ANC data RTP payload header fields are defined as:
      <list hangIndent="8" style="hanging">
        <t hangText="Extended Sequence Number: 16 bits"><vspace blankLines="0"/>
          The high-order bits of the extended 32-bit sequence number, in
	  network byte order.  This is the same as the Extended Sequence
	  Number field in RFC 4175 <xref target="RFC4175" />.
        </t>
        <t hangText="Length: 16 bits"><vspace blankLines="0"/>Number of octets
	of the ANC data RTP payload, beginning with the "C" bit of the first ANC
	packet data header, as an unsigned integer in network byte order.  Note that all word_align
            fields contribute to the calculation of the Length field.</t>
         <t hangText="ANC_Count: 8 bits"><vspace blankLines="0"/>This field is
	 the count of the total number of ANC data packets carried in the RTP
	 payload, as an unsigned integer.  A single ANC data RTP packet payload cannot carry more than 255 ANC data packets.<vspace blankLines="0"/></t>
         <t>
             If more than 255 ANC data packets need to be carried in a field or frame, additional
             RTP packets carrying ANC data MAY be sent with the same RTP timestamp but with
             different sequence numbers. ANC_Count of 0 indicates that there are no
ANC data packets in the payload (for example, an RTP packet that carries no
actual ANC data packets even though its marker bit indicates the last ANC data
RTP
packet in a field/frame).  If the ANC_Count is 0, the Length will also be 0.</t>
         <t hangText="F: 2 bits"><vspace blankLines="0"/>These two bits relate to signaling the field specified by the RTP timestamp in an interlaced SDI raster.
             A value of 0b00 indicates that either the video format is progressive or that no field
             is specified.  A value of 0b10 indicates that the timestamp refers to the first field of an interlaced
             video signal.  A value of 0b11 indicates that the timestamp
	 refers to the second field of an interlaced video signal.  The value
	 0b01 is not valid.  Receivers SHOULD ignore an ANC data packet with
	 an F field value of 0b01 and SHOULD process any other ANC data
	 packets with valid F field values that are present in the RTP
	 payload.</t> 
         <t>Note that some multi-stream SDI interfaces might use multiple
	 interlaced signal streams to transmit progressive images, in which
	 case the "F" bits would refer to the field of the interlaced stream
	 used for transport of the ANC data packet.</t>

        <t hangText="reserved: 22 bits"><vspace blankLines="0"/>
The 22 reserved bits of value "0" follow the 
            F field to ensure that the first ANC data packet header field in
	    the payload begins 32-bit word-aligned with the start of the RTP header 
            to ease implementation.</t>
      </list></t>
        <t>For each ANC data packet in the payload, the following ANC data packet header fields MUST be present:
        <list hangIndent="8" style="hanging">
            <t hangText="C: 1 bit"><vspace blankLines="0"/>
              This flag, when set to "1", indicates that the ANC data
	    corresponds to the color-difference data channel (C).  When set to
	    "0", this flag indicates either that the ANC data corresponds to
	    the luma (Y) data channel, that the ANC data source is from an SD
	    signal, or that the ANC data source has no specific luma or
	    color-difference data channels.  For ANC data from a multi-stream
	    interface source, the C flag SHALL refer to the channel of the
	    stream used to transport the ANC data packet.  For situations where
	    there is no SDI source, if the ANC data type definition
	    specifically requires the use of the C or Y data channel, the C
	    flag SHALL reflect that requirement.  </t>

<t hangText="Line_Number: 11 bits"><vspace blankLines="0"/>This field contains
the digital interface line number that corresponds to the location of the ANC
data packet as an unsigned integer in network byte order.</t>
<t>
The following special Line_Number values indicate that the location of
the ANC data packet is in certain generic vertical regions of the SDI raster:
<figure align="center"> <artwork align="center">     
+-------------+--------------------------------------------------------+
| Line_Number | ANC data packet generic vertical location              |
+-------------+--------------------------------------------------------+ 
|   0x7FF     | Without specific line location within the field or     |
|             | frame                                                  |
|             |                                                        |
|   0x7FE     | On any line in the range from the second line after    | 
|             | the line specified for switching, as defined in SMPTE  |
|             | RP 168 [RP168], to the last line before active video,  |
|             | inclusive                                              |
|             |                                                        |
|   0x7FD     | On a line number larger than can be represented in 11  |
|             | bits of this field (if needed for future formats)      |
+-------------+--------------------------------------------------------+
</artwork></figure></t>
<t>Note that the lines that are available to convey ANC data are as defined in
the applicable sample structure specification (e.g., <xref target="ST274">SMPTE ST 274</xref>, <xref target="ST296">SMPTE ST 296</xref>, <xref
target="BT656">ITU-R BT.656</xref>) and are possibly further restricted per 
<xref target="RP168">SMPTE RP 168</xref>. </t>
<t>In multi-stream interfaces, this field refers to the line number that an
ANC data packet is carried on within a particular data stream in the interface.</t>



<t hangText="Horizontal_Offset: 12 bits"><vspace blankLines="0"/>This field
defines the location of the ANC data packet in an SDI raster relative to the
start of active video (SAV; a digital synchronizing signal present in SDI
interfaces) as an unsigned integer in network byte order.  A value of 0 means 
that the ADF of the ANC data packet begins immediately
following SAV.  The horizontal offset from SAV is measured in terms of 10-bit
words of the indicated data stream and data channel.</t>
<t>The following special Horizontal_Offset values indicate that the location of the
ANC data packet is in certain generic horizontal regions of the SDI raster:

 <figure align="center"> <artwork align="center">
+-------------+--------------------------------------------------------+
| Horizontal_ | ANC data packet generic horizontal location            |
| Offset      |                                                        |
+-------------+--------------------------------------------------------+
|   0xFFF     | Without specific horizontal location                   |
|             |                                                        |
|   0xFFE     | Within horizontal ancillary data space (HANC) as       |
|             | defined in SMPTE ST 291-1 [ST291]                      |
|             |                                                        |
|   0xFFD     | Within the ancillary data space located between SAV    |
|             | (Start of Active Video) and EAV (End of Active Video)  |
|             | markers of the serial digital interface                |
|             |                                                        |
|   0xFFC     | Horizontal offset is larger than can be represented in |
|             | the 12 bits of this field (if needed for future        |
|             | formats or for certain low frame rate 720p formats)    |
+-------------+--------------------------------------------------------+
</artwork></figure></t>
<t>In multi-stream interfaces, this field refers to the
           horizontal location where an ANC data packet is placed on a line
           carried within a particular data stream in the interface.</t>
          <t>Note that HANC data space will generally have higher luma sample numbers than any samples in the active digital line.  Also note that <xref target="ST296">SMPTE ST 296</xref> (1280 x 720 progressive active images) image sampling systems 7 and 8 (1280 x 720 progressive @ 24 fps and 1280 x 720 
            progressive @ 23.98 fps respectively)
          have a luma sample number maximum of 4124.  It is unlikely that an actual
          implementation would have an ANC data packet begin at a Horizontal_Offset beyond 4091 (0xFFB) in these
          formats; should that occur, the Horizontal_Offset value 0xFFC can be used to signal a horizontal
          offset larger than can be represented in the field.  Further note that the 12-bit field of Horizontal_Offset is
          kept that size in this memo to maintain easy conversion to/from
            <xref target="ST2038">SMPTE ST 2038</xref>, which also has a 12-bit Horizontal_Offset field.</t>
            <t hangText="S (Data Stream Flag): 1 bit"><vspace blankLines="0"/>
                This field indicates whether the data stream number of a multi-stream data mapping used to
                transport the ANC data packet is specified.  If the S bit is '0', then the StreamNum field
                provides no guidance regarding the source data stream number of the ANC data packet.  If the
                S bit is '1', then the StreamNum field carries information regarding the source data stream
                number of the ANC data packet.</t>
            <t hangText="StreamNum: 7 bits"><vspace blankLines="0"/>
                If the S bit (Data Stream Flag) is '1', then the StreamNum field MUST carry identification
                of the source data stream number of the ANC data packet.  If the data stream is numbered,
                then the StreamNum field SHALL carry the number of the source data stream minus one.  If
                the source multi-stream interface does not have numbered data streams, the following
                numbers SHALL be used in this field: '0' for link A data
		stream and '1' for link B data stream.
                For stereoscopic multi-stream interface formats that do not have numbered streams, the
                following numbers SHALL be used in this field: '0' for left
	    eye stream and '1' for right eye stream.</t>
                
                <t>Note that in multi-link SDI connections, the physical link that a particular stream utilizes is typically
                  specified by the interface standard.  Also note that numbering of data streams is across the interface as a whole.  For example, in the SMPTE ST 425-3 dual-link 3 Gb/s interface, the data streams are numbered 1-4 with data streams 1 and 2 on link 1 and data streams 3 and 4 on link 2.</t>
        </list></t>
        <t>An ANC data packet with the header fields Line_Number of 0x7FF and Horizontal_Offset of 0xFFF SHALL be considered to be carried without any specific location within the field or frame.</t>
        <t>For each ANC data packet in the payload, immediately after the ANC
	data packet header fields, the following data fields MUST be present with
        the fields DID, SDID, Data_Count, User_Data_Words, and Checksum_Word representing the 10-bit words carried in the ANC data packet, as per <xref target="ST291">SMPTE ST 291-1</xref>:
          <list hangIndent="8" style="hanging">
            <t hangText="DID: 10 bits"><vspace blankLines="0"/>Data identification word</t>
            <t hangText="SDID: 10 bits"><vspace blankLines="0"/>Secondary data identification word.  Used only for a "Type 2" ANC data packet.  Note that in a "Type 1" ANC data packet, this word will actually carry the data block number (DBN).</t>
            <t hangText="Data_Count: 10 bits"><vspace blankLines="0"/>The
	    lower 8 bits of Data_Count, corresponding to bits b7
	    (MSB; most significant bit) through b0 (LSB; least significant bit) of the 10-bit Data_Count word, contain the actual count of 10-bit words in User_Data_Words.  Bit b8 is the even parity for bits b7 through b0, and bit b9 is the inverse (logical NOT) of bit b8.</t>
            <t hangText="User_Data_Words: integer number of 10-bit words"><vspace blankLines="0"/>User_Data_Words (UDW) are used to convey information of a type as identified by the DID word or the DID and SDID words.  The number of 10-bit words in the UDW is defined by the Data_Count field.  The 10-bit words are carried in order starting with the most significant bit and ending with the least significant bit.</t>
            <t hangText="Checksum_Word: 10 bits"><vspace blankLines="0"/>The Checksum_Word can be used to determine the validity of the ANC data packet from the DID word through the UDW.  It consists of 10 bits, where bits b8 (MSB) through b0 (LSB) define the checksum value and
                bit b9 is the inverse (logical NOT) of bit b8.  The checksum
	    value is equal to the nine least significant bits of the sum of
	    the nine least significant bits of the DID word, the SDID word,
	    the Data_Count word, and all User_Data_Words in the ANC data
	    packet.  
The checksum is initialized to zero before calculation, and any "end carry"
resulting from the checksum calculation is ignored.</t> 
            </list></t>
            <t>
At the end of each ANC data packet in the payload:
            <list hangIndent="8" style="hanging">
            <t hangText="word_align: bits as needed to complete 32-bit word"><vspace blankLines="0"/>Word_align contains
	    enough "0" bits as needed to complete the last 32-bit word of an
	    ANC data packet in the RTP payload.  If an ANC data packet in
	    the RTP payload ends and is aligned with a word boundary,
      there is no need to add any word alignment bits.  Word align
	    SHALL be used even for the last ANC data packet in an RTP packet.
	    Word align SHALL NOT be used if there are zero ANC data packets
	    being carried in the RTP packet.</t> 
          </list></t> 
        <t>When reconstructing an SDI signal based on this payload, it is
	important to place ANC data packets into the locations indicated by
	the ANC data packet header fields C, Line_Number and
            Horizontal_Offset, and also to follow the requirements of Section
	    7 of
            <xref target="ST291">SMPTE ST 291-1</xref>, "Ancillary Data Space Formatting (Component or Composite Interface)", which includes rules on the placement of initial ANC data into allowed
                spaces as well as the contiguity of ANC data packet sequences within those spaces in order to assure
                that the resulting ANC data packets in the SDI signal are valid.  The 
        optional media type parameter VPID_Code can inform receivers of the
        type of originating SDI interface. For multi-stream originating interfaces, the StreamNum field
        can provide information regarding which stream an ANC data packet can be placed in
        to match the ANC data location in the originating SDI interface.</t>

        <t>Senders of this payload SHOULD transmit available ANC data packets
	as soon as practical to reduce end-to-end latency, especially if the receivers will be
            embedding the received ANC data packet into an SDI signal emission. One millisecond is a reasonable upper bound for the amount of time between when an ANC
            data packet becomes available to a sender and the emission of an RTP payload containing that ANC data packet.</t>
        <t>ANC data packets with headers that indicate specific location within a field or frame SHOULD be sent in raster scan order, both in terms of packing
            position within an RTP packet and in terms of transmission time of RTP packets.</t>
    </section>
    </section>
    <section title="Payload Format Parameters">
      <t>This RTP payload format is identified using the "video/smpte291" media
      type, which is registered in accordance with <xref target="RFC4855">RFC 4855</xref>;
      the template defined in <xref target="RFC6838">RFC 6838</xref> is used.</t>
      <t>Note that the media type definition is in the "video" tree due to the expected use of SMPTE ST 291 Ancillary Data along with video formats.</t>
      <section title="Media Type Definition" anchor="media_type_definition">
        <t>Type name: video</t>
        <t>Subtype name: smpte291</t>
        <t>Required parameters:
        <list hangIndent="6" style="hanging">
          <t hangText="   Rate:"><vspace blankLines="0"/>RTP timestamp clock rate.</t>
            <t>When an ANC data RTP stream is to be associated with an RTP video stream, the RTP timestamp rates SHOULD be the same to ensure that ANC data packets can be associated with the appropriate frame or field.  Otherwise, a 90 kHz rate SHOULD be used.</t>
              <t>Note that techniques described in <xref
	      target="RFC7273">RFC 7273</xref> can provide a common reference clock for multiple RTP streams intended for synchronized
                  presentation.</t>
        </list></t>
        
        <t>Optional parameters:
        <list hangIndent="6" style="hanging">
        <t hangText="   DID_SDID:"><vspace blankLines="0"/>Data identification and secondary data identification words.</t>

          <t>The presence of the DID_SDID parameters signals that all ANC data packets of this stream are of a particular type or types, i.e., labeled with particular DIDs and SDIDs.
              DID and SDID values of SMPTE-registered ANC data packet types can be
	  found in the <xref target="SMPTE-RA">SMPTE Registry for Data
	  Identification Word Assignments</xref>.</t> 

          <t>"Type 1" ANC data packets (which do not have SDIDs defined) SHALL be labeled with SDID=0x00.</t>
          <t>DID and SDID values can be registered with SMPTE as per <xref target="ST291">SMPTE ST 291-1</xref>.</t>
          <t>The absence of the DID_SDID parameter signals that determination of the DID and SDID of ANC data packets in the payload can only be achieved through direct inspection of the ANC data packet fields.</t>
          <t>The ABNF description of the DID_SDID parameter is described in Section 4.</t>
          
          <t hangText="   VPID_Code:"><vspace blankLines="0"/>This integer parameter specifies the Video Payload ID (VPID)
          code of the source interface of ANC data packets using the value from byte 1 of the VPID as defined in
          <xref target="ST352">SMPTE ST 352</xref>.  The integer SHALL be made with bit 7 of VPID byte 1 being the
          most significant bit and bit 0 of VPID byte 1 being the least significant bit.  For example, 132 refers
          to SMPTE ST 292-1, 720-line video payloads on a 1.5 Gb/s (nominal) serial digital interface.</t>
        </list></t>
      
        <t>Encoding considerations:  This media type is framed and binary; see
	Section 4.8 of <xref target="RFC6838">RFC 6838</xref>.</t>
        <t>Security considerations: See Section <xref target="Security"
	format="counter"/>.</t>
        <t>Interoperability considerations:  Data items in smpte291 can be very diverse.  Receivers might only be capable of interpreting a subset of the possible data items.  Some implementations might care about the location of the ANC data packets in the SDI raster, but other implementations might not care.</t>
        <t>Published specification:  RFC 8331</t>
        <t>Applications that use this media type:  Devices that stream real-time professional video, especially those that interoperate with legacy serial digital interfaces (SDI).</t>
        <t>Additional Information:
            <list>
            <t>Deprecated alias names for this type: N/A</t>
            <t>Magic number(s): N/A</t>
            <t>File extension(s): N/A</t>
            <t>Macintosh file type code(s): N/A</t>
            </list>
        </t>
        <t>Person &amp; email address to contact for further information:
<?rfc subcompact="yes" ?>
<list>
	<t>T.&nbsp;Edwards &lt;thomas.edwards@fox.com&gt;</t>
        <t>IETF Payload Working Group &lt;payload@ietf.org&gt;</t>
</list>
<?rfc subcompact="no" ?>
</t>
        <t>Intended usage: COMMON</t>
        <t>Restrictions on usage:  This media type depends on RTP framing and
	hence is only defined for transfer via RTP <xref target="RFC3550">RFC 3550</xref>.  Transport within other framing protocols is not defined at this time.</t>
        <t>Author: T.&nbsp;Edwards &lt;thomas.edwards@fox.com&gt;</t>
        <t>Change controller:  The IETF PAYLOAD Working Group, or other party as designated by the IESG.</t>
      </section>
    </section>
    <section title="SDP Considerations">
      <t>The mapping of the above-defined payload format media type and its
      parameters SHALL be done according to Section 3 of <xref
      target="RFC4855">RFC 4855</xref>.</t>
      <t><list style="symbols">
        <t>The type name ("video") goes in SDP "m=" as the media name.</t>
        
        <t>The subtype name ("smpte291") goes in SDP "a=rtpmap" as
          the encoding name, followed by a slash ("/") and the rate parameter.</t>
        <t>The optional parameters VPID_Code and DID_SDID, when present, are included in the "a=fmtp" attribute line
            of SDP as a semicolon-separated list of parameter=value pairs.</t>
      </list></t>
      <t>DID and SDID values SHALL be specified in hexadecimal with a "0x" prefix (such as "0x61").
          The ABNF as per <xref target="RFC5234">RFC 5234</xref> of the DID_SDID optional parameter SHALL be:</t>
          <figure>
            <artwork>
        TwoHex = "0x" 1*2(HEXDIG)
        DidSdid = "DID_SDID={" TwoHex "," TwoHex "}"
           </artwork>
          </figure>
          <t>For example, EIA 608 Closed Caption data would be signaled with
	  the parameter DID_SDID={0x61,0x02}.  If a DID_SDID parameter is not
	  specified, then the ANC data stream might potentially contain ANC data packets of any type.</t>
      <t>Multiple DID_SDID parameters can be specified (separated by semicolons) to signal the presence of multiple types of ANC data in the stream. DID_SDID={0x61,0x02};DID_SDID={0x41,0x05}, for example,
          signals the presence of EIA 608 Closed Captions as well as AFD/Bar Data.  Multiple DID_SDID
          parameters do not imply any particular ordering of the different types of ANC data packets
          in the stream.</t>
      <t>If the optional parameter VPID_Code is present, it SHALL be present only once in the semicolon-separated list, taking a single integer value.</t>
      
      <t>A sample SDP mapping for ANC data is as follows:</t>
      <figure><artwork>
   m=video 30000 RTP/AVP 112
   a=rtpmap:112 smpte291/90000
   a=fmtp:112 DID_SDID={0x61,0x02};DID_SDID={0x41,0x05};VPID_Code=132</artwork>
      </figure>
      <t>In this example, a dynamic payload type 112 is used for ANC data.  The 90 kHz RTP timestamp rate is specified in the "a=rtpmap" line after the subtype.  In the "a=fmtp:" line, DID 0x61 and SDID 0x02 are specified (registered to EIA 608 Closed Caption Data by SMPTE), and also DID 0x41 and SDID 0x05 (registered to AFD/Bar Data).  The VPID_Code is 132 (referring to SMPTE ST 292-1, 720-line video payloads on a 1.5 Gb/s serial digital interface).</t>
      <section title="Grouping ANC Data Streams with Other Media Streams">
        <t>To indicate the association of an ANC data stream with a particular video stream, implementers MAY group the "m" lines
          together using Flow Identification ("FID") semantics as defined in
	  RFC 5888
	  <xref target="RFC5888" />.
          </t>
          <t>A sample SDP mapping for grouping ANC data with video as
	  described in RFC 4175 <xref target="RFC4175"/> is as follows:</t>
          <figure><artwork>
     v=0
     o=Al 123456 11 IN IP4 host.example.com
     s=Professional Networked Media Test
     i=A test of synchronized video and ANC data
     t=0 0
     a=group:FID V1 M1
     m=video 50000 RTP/AVP 96
     c=IN IP4 233.252.0.1/255
     a=rtpmap:96 raw/90000
     a=fmtp:96 sampling=YCbCr-4:2:2; width=1280; height=720; depth=10
     a=mid:V1
     m=video 50010 RTP/AVP 97
     c=IN IP4 233.252.0.2/255
     a=rtpmap:97 smpte291/90000
     a=fmtp:97 DID_SDID={0x61,0x02};DID_SDID={0x41,0x05}
     a=mid:M1
          </artwork>
          </figure>
      </section>
    </section>
    <section title="Offer/Answer Model and Declarative Considerations">
        <section title="Offer/Answer Model">
        <t>Receivers might wish to receive ANC data streams with specific DID_SDID
            parameters.  Thus, when offering ANC data streams using the Session
            Description Protocol (SDP) in an Offer/Answer model <xref target="RFC3264"></xref>, the
            offerer MAY provide a list of ANC data streams available with specific
            DID_SDID parameters in the fmtp line.  The answerer MAY
            (1) respond with all or a subset of the streams offered along with fmtp
            lines with all or a subset of the DID_SDID parameters offered, (2)
            set the corresponding port number to 0 to decline the smpte291
            stream if not in the same media section as a corresponding video
	    stream, or (3) remove the corresponding payload type if the smpte291 stream is in the same
            media section as a corresponding video stream.  There are no restrictions on
            updating DID_SDID parameters in a subsequent offer.
            </t>
        </section>
    <section title="Declarative SDP Considerations">
        <t>For declarative use of SDP, nothing specific is defined for this
            payload format.  The configuration given by the SDP MUST be used when
            sending and/or receiving media in the session.
            </t>
        </section>
    </section>
  
    <section anchor="IANA" title="IANA Considerations">
      <t>The media type "video/smpte291" is defined in <xref
      target="media_type_definition" format="default"></xref>.  
IANA has registered "video/smpte291" in the "Media Types" registry.</t>

    </section>

    <section anchor="Security" title="Security Considerations">
<t>RTP packets using the payload format defined in this specification
   are subject to the security considerations discussed in the RTP
   specification <xref target="RFC3550"></xref> and in any applicable RTP profile such as
   RTP/AVP <xref target="RFC3551"></xref>, RTP/AVPF <xref target="RFC4585"></xref>,
   RTP/SAVP <xref target="RFC3711"></xref>, or RTP/SAVPF <xref target="RFC5124"></xref>.
   However, as "Securing the RTP Protocol Framework:
   Why RTP Does Not Mandate a Single Media Security Solution" <xref target="RFC7202"></xref>
   discusses, it is not the responsibility of an RTP payload format to
   discuss or mandate what solutions are to be used to meet the basic security
   goals like confidentiality, integrity, and source authenticity for RTP
   in general.  This responsibility lays on anyone using RTP in an
   application.  They can find guidance on available security mechanisms
   and important considerations in "Options for Securing RTP Sessions"
   <xref target="RFC7201"></xref>.  Applications SHOULD use one or more appropriately strong
   security mechanisms.  The rest of this section
   discusses the security impacting properties of the payload format
   itself.</t>

      <t>To avoid potential buffer overflow attacks, receivers SHOULD validate
      that the ANC data packets in the RTP payload are of the appropriate
      length (using the Data_Count field) for the ANC data type specified by
      DID and SDID.  Also, the Checksum_Word SHOULD be checked against the ANC
      data packet to ensure that its data has not been damaged in transit;
      note that the Checksum_Word is unlikely to provide a payload integrity
      check in case of a directed attack.</t> 

      <t>Some receivers will simply move the ANC data packet bits from the RTP
      payload into SDI.  It might still be a good idea for these
      "re-embedders" to perform the above-mentioned validity tests to avoid
      downstream SDI systems from becoming confused by bad ANC data packets,
      which could be used for a denial-of-service attack.</t> 
      <t>"Re-embedders" into SDI SHOULD also double check that the Line_Number
      and Horizontal_Offset lead to the ANC data packet being inserted into a
      legal area to carry ANC data in the SDI video bit stream of the
      output video format.</t> 
    </section>
  </middle>


  <back>

    <references title="Normative References">

      &RFC0791;
      &RFC2119;
      &RFC3264;
      &RFC3550;
      &RFC3551;
      &RFC3711;
      &RFC4585;
      &RFC4855;
      &RFC5124;
      &RFC5234;
      &RFC5888;
      &RFC6838;
      &RFC8174;


<reference anchor="RP168">
<front>
<title>RP 168:2009, Definition of Vertical Interval Switching Point for Synchronous Video Switching</title>
<author>
<organization>SMPTE</organization>
</author>
<date year="2009"/>
</front>

</reference>

      <reference anchor="ST291" target="http://ieeexplore.ieee.org/document/7291794/">
        <front>
          <title>SMPTE Standard - Ancillary Data Packet and Space Formatting</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="September" year="2011"/>
        </front>
<seriesInfo name="ST" value="291-1:2011"/>
<seriesInfo name="DOI" value="10.5594/SMPTE.ST291-1.2011"/>
      </reference>
      
      
      <reference anchor="ST352" target="http://ieeexplore.ieee.org/document/7290261/">
          <front>
              <title>SMPTE Standard - Payload Identification Codes for Serial Digital Interfaces</title>
              <author>
                  <organization>SMPTE</organization>
              </author>
              <date month="February" year="2013"/>
          </front>
<seriesInfo name="ST" value="352:2013" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST352.2013" />
      </reference>
      
      <reference anchor="ST424" target="http://ieeexplore.ieee.org/document/7290519/">
        <front>
          <title>SMPTE Standard - 3 Gb/s Signal/Data Serial Interface</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="October" year="2012"/>
        </front>
<seriesInfo name="ST" value="424:2012" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST424.2012" />
      </reference>
 
    </references>

    <references title="Informative References">
      
      &RFC4175;
      &RFC5371;
      &RFC7201;
      &RFC7202;
      &RFC7273;
      
      <reference anchor="BT656">      
        <front>
          <title>Interfaces for Digital Component Video Signals in 525-Line and 625-Line Television Systems Operating at the 4:2:2 Level of Recommendation ITU-R BT.601</title>
                    <author>
            <organization>ITU-R</organization>
          </author>
          
          <date year="2007" month="December"/>
        </front>
<seriesInfo name="ITU-R Recommendation" value="BT.656-5"/>
      </reference>
      
      
      <reference anchor="SMPTE-RA" target="https://smpte-ra.org/smpte-ancillary-data-smpte-st-291">
          <front>
              <title>SMPTE Ancillary Data SMPTE ST 291</title>
              <author>
                  <organization>SMPTE Registration Authority, LLC</organization>
              </author>
              <date />
          </front>
      </reference>
      
      <reference anchor="ST259" target="http://ieeexplore.ieee.org/document/7292109/">        
        <front>
          <title>SMPTE Standard - For Television - SDTV Digital Signal/Data - Serial Digital Interface</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="January" year="2008"/>
        </front>
<seriesInfo name="ST" value="259:2008" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST259.2008" />

      </reference>
      
      <reference anchor="ST274" target="http://ieeexplore.ieee.org/document/7290129/">        
        <front>
          <title>SMPTE Standard - For Television - 1920 x 1080 Image Sample
	  Structure, Digital Representation and Digital Timing Reference
	  Sequences for Multiple Picture Rates</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="January" year="2008"/>
        </front>
<seriesInfo name="ST" value="274:2008" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST274.2008" />
      </reference>
      
      <reference anchor="ST292" target="http://ieeexplore.ieee.org/document/7291770/">
        <front>
          <title>SMPTE Standard - 1.5 Gb/s Signal/Data Serial Interface</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="January" year="2012"/>
        </front>
<seriesInfo name="ST" value="292-1:2012" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST292-1.2012" />

      </reference>
      
      <reference anchor="ST296" target="http://ieeexplore.ieee.org/document/7291722/">
        <front>
          <title>SMPTE Standard - 1280 x 720 Progressive Image 4:2:2 and 4:4:4
	  Sample Structure - Analog and Digital Representation and Analog Interface</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="May" year="2012"/>
        </front>
<seriesInfo name="ST" value="296:2012" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST296.2012" />
      </reference>
      
      
      
      <reference anchor="ST2038" target="http://ieeexplore.ieee.org/document/7290549/">
        <front>
          <title>SMPTE Standard - Carriage of Ancillary Data Packets in an
	  MPEG-2 Transport Stream</title>
          <author>
            <organization>SMPTE</organization>
          </author>
          <date month="September" year="2008"/>
        </front>
<seriesInfo name="ST" value="2038:2008" />
<seriesInfo name="DOI" value="10.5594/SMPTE.ST2038.2008" />
      </reference>
      
    </references>
  </back>
</rfc>
