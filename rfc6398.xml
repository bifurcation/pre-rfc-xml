<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
]>

<rfc category="bcp"
     number="6398" seriesNo="168"
     ipr="trust200902" updates="2113, 2711"
     submissionType="IETF" consensus="yes">

  <?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
  <?rfc toc="yes" ?>
  <?rfc symrefs="yes" ?>
  <?rfc sortrefs="yes"?>
  <?rfc iprnotified="no" ?>
  <?rfc compact="yes"?>
  <?rfc subcompact="no"?>
  <?rfc rfcedstyle="yes"?>

  <front>
    <title abbrev="Router Alert Considerations">IP Router Alert Considerations
    and Usage</title>

    <author fullname="Francois Le Faucheur" initials="F." role="editor"
            surname="Le Faucheur">
      <organization abbrev="Cisco">Cisco Systems</organization>

      <address>
        <postal>
          <street>Greenside, 400 Avenue de Roumanille</street>

          <city>Sophia Antipolis</city>

          <code>06410</code>

          <country>France</country>
        </postal>

        <phone>+33 4 97 23 26 19</phone>

        <email>flefauch@cisco.com</email>
      </address>
    </author>

    <date month="October" year="2011" />

    <area>Routing</area>

    <abstract>
      <t>The IP Router Alert Option is an IP option that alerts transit
      routers to more closely examine the contents of an IP packet. The
      Resource reSerVation Protocol (RSVP), Pragmatic General Multicast (PGM),
      the Internet Group Management Protocol (IGMP),
      Multicast Listener Discovery (MLD),
      Multicast Router Discovery (MRD), and General Internet Signaling
      Transport (GIST) are some of the protocols that make use of the IP
      Router Alert Option. This document discusses security aspects and usage
      guidelines around the use of the current IP Router Alert Option, thereby
      updating RFC 2113 and RFC 2711. Specifically, it provides recommendations
      against using the Router Alert in the end-to-end open Internet and
      identifies controlled environments where protocols depending on Router
      Alert can be used safely. It also provides recommendations about
      protection approaches for service providers. Finally, it provides brief
      guidelines for Router Alert implementation on routers.</t>
    </abstract>
  </front>

  <middle>

    <section anchor="intro" title="Introduction">
      <t><xref target="RFC2113"></xref> and <xref target="RFC2711"></xref>
      define the IPv4 and IPv6 Router Alert Options (RAOs), respectively.
      In this document, we collectively refer to those options as the
      IP Router Alert. The IP
      Router Alert Option is an IP option that alerts transit routers to more
      closely examine the contents of an IP packet.</t>

      <t>Some of the protocols that make use of the IP Router Alert
are the Resource reSerVation Protocol (RSVP) 
      (<xref target="RFC2205"></xref>,
      <xref target="RFC3175"></xref>, <xref target="RFC3209"></xref>),
      Pragmatic General Multicast (PGM) (<xref target="RFC3208"></xref>),
      the Internet Group Management Protocol (IGMP) (<xref
      target="RFC3376"></xref>), 
      Multicast Listener Discovery (MLD) (<xref
      target="RFC2710"></xref>, <xref target="RFC3810"></xref>), 
      Multicast
      Router Discovery (MRD) (<xref target="RFC4286"></xref>), and  
      Next Steps in Signaling (NSIS) General
      Internet Signaling Transport (GIST) (<xref target="RFC5971"></xref>).
      </t>

      <t><xref target="concerns"></xref> describes the security concerns
      associated with the use of the Router Alert Option.</t>

      <t><xref target="guidelines"></xref> provides guidelines for the use of
      Router Alert. More specifically, <xref target="end-to-end"></xref>
      recommends that Router Alert not be used for end-to-end applications
      over the Internet, while <xref target="controlled"></xref> presents
      controlled environments where applications/protocols relying on IP
      Router Alert can be deployed effectively and safely. <xref
      target="sp"></xref> provides recommendations on protection approaches to
      be used by service providers in order to protect their network from
      Router-Alert-based attacks.</t>

      <t>Finally, <xref target="implementation"></xref> provides generic
      recommendations for router implementation of Router Alert, aiming at
      increasing protection against attacks.</t>

      <t>This document discusses considerations and practices based on
      the current specifications of IP Router Alert (<xref
      target="RFC2113"></xref>, <xref target="RFC2711"></xref>). Possible
      future enhancements to the specifications of IP Router Alert (in view of
      reducing the security risks associated with the use of IP Router Alert)
      are outside the scope of this document. One such proposal is discussed
      in <xref target="RAO-EXT"></xref>, but
      at the time of this writing, the IETF has not adopted any extensions for
      this purpose.</t>

      <t>The IPv6 base specification <xref target="RFC2460"></xref> defines
      the hop-by-hop options extension header. The hop-by-hop options header is
      used to carry optional information that must be examined by every node
      along a packet's delivery path. The IPv6 Router Alert Option is one
      particular hop-by-hop option. Similar security concerns to those
      discussed in this document for the IPv6 Router Alert apply more
      generically to the concept of the IPv6 hop-by-hop options extension
      header.
      However, thoroughly addressing the broader concept of the IPv6
      hop-by-hop option
      would require additional material so as to cover additional
      considerations associated with it (e.g., the effectiveness of the
      attack could depend on how many options are included and on the range to
      which the option-type value belongs), so this is kept outside the
      scope of this document. A detailed discussion about security
      risks and proposed remedies associated with the IPv6 hop-by-hop option
      can be found in <xref target="IPv6-HOPBYHOP"></xref>.</t>

      <t>The IPv4 base specification <xref target="RFC0791"></xref> defines a
      general notion of IPv4 options that can be included in the IPv4 header
      (without distinguishing between the hop-by-hop and end-to-end options).
      The IPv4 Router Alert Option is one particular IPv4 option. 
      Security concerns similar to those discussed in this document for the
      IPv4 Router Alert apply more generically to the concept of the IPv4
      option. However, thoroughly addressing the security concerns of the
      broader concept of the IPv4 option is kept outside the scope
      of this document,
      because it would require additional material so as to cover additional
      considerations associated with it (such as lack of option ordering,
      etc.), and because other IPv4 options are often blocked in firewalls and
      not very widely used, so the practical risks they present are largely
      nonexistent.</t>
    </section>

    <section title="Terminology">
      <t>For readability, this document uses the following loosely defined
      terms:<list style="symbols">
          <t>Fast path: Hardware or Application-Specific Integrated Circuit
          (ASIC) processing path for packets. This is the nominal processing
          path within a router for IP datagrams.</t>

          <t>Slow path: Software processing path for packets. This is a
          sub-nominal processing path for packets that require special
          processing or differ from assumptions made in fast-path
          heuristics.</t>

          <t>Next level protocol: The protocol transported in the IP datagram.
          In IPv4 <xref target="RFC0791"></xref>, the next level protocol is
          identified by the IANA protocol number conveyed in the 8-bit
          "Protocol" field in the IPv4 header. In IPv6 <xref
          target="RFC2460"></xref>, the next level protocol is identified by
          the IANA protocol number conveyed in the 8-bit "Next Header" field
          in the IPv6 header.</t>
        </list></t>

      <section title="Conventions Used in This Document">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119"></xref>.</t>
      </section>
    </section>

    <section anchor="concerns" title="Security Concerns of Router Alert">
      <t>The IP Router Alert Option is defined (<xref
      target="RFC2113"></xref>, <xref target="RFC2711"></xref>) as a mechanism
      that alerts transit routers to more closely examine the contents of an
      IP packet. <xref target="RFC4081"></xref> and <xref
      target="RFC2711"></xref> mention the security risks associated with the
      use of the IP Router Alert: flooding a router with bogus (or simply
      undesired) IP datagrams that contain the IP Router Alert could impact
      operation of the router in undesirable ways. For example, if the router
      punts the datagrams containing the IP Router Alert Option to the slow
      path, such an attack could consume a significant share of the
      router&rsquo;s slow path and could also lead to packet drops in the slow
      path (affecting operation of all other applications and protocols
      operating in the slow path), thereby resulting in a denial of service
      (DoS) (<xref target="RFC4732"></xref>).</t>

      <t>Furthermore, <xref target="RFC2113"></xref> specifies no (and <xref
      target="RFC2711"></xref> specifies a very limited) mechanism for
      identifying different users of IP Router Alert. As a result, many fast
      switching implementations of IP Router Alert punt most/all packets
      marked with IP Router Alert into the slow path (unless configured to
      systematically ignore or drop all Router Alert packets). However, some
      existing deployed IP routers can and do process IP packets containing
      the Router Alert Option inside the fast path.</t>

      <t>Some IP Router Alert implementations are able to take into account
      the next level protocol as a discriminator for the punting decision for
      different protocols using IP Router Alert. However, this still only
      allows very coarse triage among various protocols using IP Router Alert,
      for two reasons. First, the next level protocol is the same when IP
      Router Alert is used for different applications of the same protocol
      (e.g., RSVP vs. RSVP - Traffic Engineering (RSVP-TE)), or when
      IP Router Alert is used for different
      contexts of the same application (e.g., different levels of RSVP
      aggregation <xref target="RFC3175"></xref>). Thus, it is not always
      possible to achieve the necessary triage in the fast path across IP
      Router Alert packets from different applications or from different
      contexts of an application. Secondly, some protocols requiring punting
      might be carried over a transport protocol (e.g., TCP or UDP), possibly
      because (1) they require the services of that transport protocol,
      (2) the protocol does not justify allocation of a scarce next level
      protocol value, or (3) not relying on a very widely deployed
      transport protocol is likely to result in deployment issues due to
      common middlebox behaviors (e.g., firewalls or NATs discarding packets of
      "unknown" protocols). Thus, considering the next level protocol alone in
      the fast path is not sufficient to allow triage in the fast path of IP
      Router Alert packets from different protocols sharing the same transport
      protocol. Therefore, it is generally not possible to ensure that only
      the IP Router Alert packets for next level protocols of interest are
      punted to the slow path while other IP Router Alert packets are
      efficiently forwarded (i.e., in the fast path).</t>

      <t>Some IP Router Alert implementations are able to take into account
      the Value field inside the Router Alert Option. However, only one value
      (zero) was defined in <xref target="RFC2113"></xref>, and no IANA
      registry for IPv4 Router Alert values was available until recently
      (<xref target="RFC5350"></xref>). So this did not allow most IPv4 Router
      Alert implementations to support useful classification based on the Value
      field in the fast path. Also, while <xref target="RFC2113"></xref>
      states that unknown values should be ignored (i.e., the packets should be
      forwarded as normal IP traffic), it has been reported that some existing
      implementations simply ignore the Value field completely (i.e., process
      any packet with an IPv4 Router Alert regardless of its option value). An
      IANA registry for further allocation of IPv4 Router Alert values has
      been introduced recently (<xref target="RFC5350"></xref>), but this would
      only allow coarse-grain classification, if supported by implementations.
      For IPv6, <xref target="RFC2711"></xref> states that "the Value field
      can be used by an implementation to speed processing of the datagram
      within the transit router" and defines an IANA registry for these
      values. But again, this only allows coarse-grain classification.
      Besides, some existing IPv6 Router Alert implementations are reported to
      depart from that behavior.</t>

      <t><xref target="RFC2711"></xref> mentions that limiting, by rate or
      some other means, the use of the IP Router Alert Option is a way of
      protecting against a potential attack. However, if rate limiting is used
      as a protection mechanism, but if the granularity of the rate limiting
      is not fine enough to distinguish IP Router Alert packets of
      interest from unwanted IP Router Alert packets, an IP Router Alert attack
      could still severely degrade operation of protocols of interest that
      depend on the use of IP Router Alert.</t>

      <t>In a nutshell, the IP Router Alert Option does not provide a
      convenient universal mechanism to accurately and reliably distinguish
      between IP Router Alert packets of interest and unwanted IP Router Alert
      packets. This, in turn, creates a security concern when the IP
      Router Alert Option is used, because, short of appropriate
      router-implementation-specific mechanisms, the router slow path is at
      risk of being flooded by unwanted traffic.</t>

      <t>Note that service providers commonly allow external parties to
      communicate with a control plane application in their routers, such as
      with BGP peering. Depending on the actual environment and BGP security
      practices, with BGP peering, the resulting DoS attack vector is
      similar to or somewhat less serious than it would be with the
      Router Alert Option
      for a number of reasons, including the following:</t>

      <t><list style="symbols">
          <t>With BGP, edge routers only exchange control plane information
          with pre-identified peers and can easily filter out any control
          plane traffic coming from other peers or non-authenticated peers,
          while the Router Alert Option can be received in a datagram with any
          source address and any destination address. However, we note that the
          effectiveness of such BGP filtering is dependent on proper security
          practices; poor BGP security practices (such as infrequent or
          nonexistent update of BGP peers' authentication keys) create
          vulnerabilities through which the BGP authentication mechanisms can
          be compromised.</t>

          <t>With BGP peering, the control plane hole is only open on the edge
          routers, and core routers are completely isolated from any direct
          control plane exchange with entities outside the administrative
          domain. Thus, with BGP, a DoS attack would only affect the edge
          routers, while with the Router Alert Option, the attack could propagate
          to core routers. However, in some BGP environments, the distinction
          between edge and core routers is not strict, and many/most/all
          routers act as both edge and core routers; in such BGP environments,
          a large part of the network is exposed to direct control plane
          exchanges with entities outside the administrative domain (as it
          would be with Router Alert).</t>

          <t>With BGP, the BGP policy control would typically prevent
          re-injection of undesirable information out of the attacked device,
          while with the Router Alert Option, the non-filtered attacking
          messages would typically be forwarded downstream. However, we note
          that there have been real-life occurrences of situations where
          incorrect information was propagated through the BGP system, causing
          widespread problems.</t>
        </list></t>
    </section>

    <section anchor="guidelines" title="Guidelines for Use of Router Alert">
      <t></t>

      <section anchor="end-to-end"
               title="Use of Router Alert End to End in the Internet (Router Alert in Peer Model)">
        <t>Because of the security concerns associated with Router Alert
        discussed in <xref target="concerns"></xref>, network operators SHOULD
        actively protect themselves against externally generated IP Router
        Alert packets. Because there are no convenient universal mechanisms to
        triage between desired and undesired Router Alert packets, network
        operators currently often protect themselves in ways that isolate them
        from externally generated IP Router Alert packets. This might be
        achieved by tunneling IP Router Alert packets <xref
        target="RFC6178"></xref> so that the IP Router Alert Option is hidden
        through that network, or it might be achieved via mechanisms resulting
        in occasional (e.g., rate limiting) or systematic drop of IP Router
        Alert packets.</t>

        <t>Thus, applications and protocols SHOULD NOT be deployed with a
        dependency on processing of the Router Alert Option (as currently
        specified) across independent administrative domains in the Internet.
        <xref target="fig-end-to-end"></xref> illustrates such a hypothetical
        use of Router Alert end to end in the Internet. We refer to such a
        model of Router Alert Option use as a "Peer Model" Router Alert Option
        use, since core routers in different administrative domains would
        partake in processing of Router Alert Option datagrams associated with
        the same signaling flow.</t>

        <figure anchor="fig-end-to-end"
         title="Use of Router Alert End to End in the Open Internet (Router Alert in Peer Model)">

            <artwork><![CDATA[
   --------         --------          --------          --------
  /   A    \       /   B    \        /   C    \        /   D    \
  | (*)    |       | (*)    |        | (*)    |        | (*)    |
  | | |<============>| |<=============>| |<=============>| |    |
  |  -     |       |  -     |        |  -     |        |  -     |
  \        /       \        /        \        /        \        /
   --------         --------          --------          --------

   (*) closer examination of Router Alert Option datagrams

   <==>  flow of Router Alert Option datagrams
]]></artwork>

            <postamble></postamble>
          </figure>

        <t>While this recommendation is framed here specifically in the
        context of Router Alert, the fundamental security risk that network
        operators want to preclude is to allow devices/protocols that are
        outside of their administrative domain (and therefore not controlled)
        to tap into the control plane of their core routers. Similar
        security concerns would probably result whether this
        control plane access is provided through the Router Alert Option
        or provided by any other mechanism (e.g., deep packet inspection).
        In other words, the
        fundamental security concern is associated with the notion of
        end-to-end signaling in a Peer Model across domains in the Internet.
        As a result, it is expected that network operators would typically not
        want to have their core routers partake in end-to-end signaling with
        external uncontrolled devices through the open Internet, and therefore
        prevent deployment of end-to-end signaling in a Peer Model through
        their network (regardless of whether that signaling uses Router Alert
        or not).</t>
      </section>

      <section anchor="controlled"
               title="Use of Router Alert in Controlled Environments">
        <section anchor="intra"
                 title="Use of Router Alert within an Administrative Domain">
          <t>In some controlled environments, such as within a given
          administrative domain, the network administrator can determine that
          IP Router Alert packets will only be received from trusted
          well-behaved devices or can establish that specific protection
          mechanisms (e.g., RAO filtering and rate limiting) against the
          plausible RAO-based DoS attacks are sufficient. In that case, an
          application relying on exchange and handling of RAO packets (e.g.,
          RSVP) can be safely deployed within the controlled network. A
          private enterprise network firewalled from the Internet and using
          RSVP reservations for voice and video flows might be an example of
          such a controlled environment. Such an environment is illustrated in
          <xref target="fig-intra"></xref>.</t>

          <figure anchor="fig-intra"
                  title="Use of Router Alert within an Administrative Domain -
Private Enterprise Network Firewalled from the Internet and Using RSVP Reservations">

            <artwork><![CDATA[
   -------------------------          --------          --------
  /            A            \        /   B    \        /   C    \
  | (*)              (*)    |   --   |        |        |        |
  | | |<============>| |    |--|FW|--|        |--------|        |
  |  -                -     |   --   |        |        |        |
  \                         /        \        /        \        /
   -------------------------          --------          --------

   (*) closer examination of Router Alert Option datagrams

   <==>  flow of Router Alert Option datagrams

   FW: Firewall
]]></artwork>

            <postamble></postamble>
          </figure>

          <t>In some controlled environments, several administrative domains
          have a special relationship whereby they cooperate very tightly and
          effectively operate as a single trust domain. In that case, one
          domain is willing to trust another with respect to the traffic
          injected across the boundary. In other words, a downstream domain is
          willing to trust that the traffic injected at the boundary has been
          properly validated/filtered by the upstream domain. Where it has
          been established that such trust can be applied to Router Alert
          Option packets, an application relying on exchange and handling of
          RAO packets (e.g., RSVP) can be safely deployed within such a
          controlled environment. The entity within a company responsible for
          operating multimedia endpoints and the entity within the same
          company responsible for operating the network might be an example of
          such a controlled environment. For example, they might collaborate so
          that RSVP reservations can be used for video flows from endpoints to
          endpoints through the network.</t>

          <t>In some environments, the network administrator can reliably
          ensure that Router Alert packets from any untrusted device (e.g.,
          from external routers) are prevented from entering a trusted area
          (e.g., the internal routers). For example, this might be achieved by
          ensuring that routers straddling the trust boundary (e.g., edge
          routers) always encapsulate those packets (without setting IP Router
          Alert -or equivalent- in the encapsulating header) through the
          trusted area (as discussed in <xref target="RFC6178"></xref>). In
          such environments, the risks of DoS attacks through the IP Router
          Alert vector are removed (or greatly reduced) in the trusted area
          even if IP Router Alert is used inside the trusted area (say, for
          RSVP-TE). Thus, an application relying on IP Router Alert can be
          safely deployed within the trusted area. A service provider running
          RSVP-TE within its network might be an example of such a protected
          environment. Such an environment is illustrated in <xref
          target="fig-intra2"></xref>.</t>

          <figure anchor="fig-intra2"
                  title="Use of Router Alert within an Administrative Domain -
Service Provider Running RSVP-TE within Its Network">

            <artwork><![CDATA[
   --------         --------------------------          --------
  /   A    \       /             B            \        /   C    \
  |        |       |  (*)               (*)   |        |        |
  |        |-------TT | |<=============>| |  TT------- |        |
  |        |       |   -                 -    |        |        |
  \        /       \                          /        \        /
   --------         --------------------------          --------

   (*) closer examination of Router Alert Option datagrams

   <==>  flow of Router Alert Option datagrams

   TT: Tunneling of Router Alert Option datagrams
]]></artwork>

            <postamble></postamble>
          </figure>
        </section>

        <section anchor="overlay" title="Use of Router Alert in Overlay Model">
          <t>In some controlled environment:</t>

          <t><list style="symbols">
              <t>The sites of a network A are interconnected through a service
              provider network B.</t>

              <t>The service provider network B protects itself from IP Router
              Alert messages without dropping those messages when they transit
              over the
              network (for example, using mechanisms discussed in <xref
              target="RFC6178"></xref>).</t>
            </list>In such a controlled environment, an application relying on
          exchange and handling of RAO packets (e.g., RSVP) in the network A
          sites (but not inside network B) can be safely deployed. We refer to
          such a deployment as a use of Router Alert in a Water-Tight Overlay
          -- "Overlay", because Router Alert Option datagrams are used in
          network A on top of, and completely transparently to, network B; and
          "Water-Tight", because Router Alert Option datagrams from network A
          cannot leak inside network B.&nbsp; A private enterprise intranet
          realized as a
          Virtual Private Network (VPN) over a service provider network and
          using RSVP to perform reservations within the enterprise sites for
          voice and video flows might be an example of such a controlled
          environment. Such an environment is illustrated in <xref
          target="fig-overlay"></xref>.</t>

          <figure anchor="fig-overlay"
              title="Use of Router Alert in Water-Tight Overlay">

              <artwork><![CDATA[
   --------                                --------  
  /   A    \                              /   A    \ 
  | (*)    |                              |   (*)  | 
  | | |<=====================================>| |  |
  |  -     |                              |    -   | 
  \        /                              \        / 
   --------                                -------- 
         \                                 /
          \   -------------------------   /
           \ /           B             \ /
            \|                         |/
             TT                       TT
             |                         |
             \                         / 
              ------------------------- 

   (*) closer examination of Router Alert Option datagrams

   <==>  flow of Router Alert Option datagrams

   TT: Tunneling of Router Alert Option datagrams
]]></artwork>

              <postamble></postamble>
            </figure>

          <t>In the controlled environment described above, an application
          relying on exchange and handling of RAO packets (e.g., RSVP-TE) in
          the service provider network B (but not in network A) can also be
          safely deployed simultaneously. Such an environment with
          independent, isolated deployment of Router Alert in overlay at two
          levels is illustrated in <xref target="fig-overlay2"></xref>.</t>

          <figure anchor="fig-overlay2"
              title="Use of Router Alert in Water-Tight Overlay at Two Levels">

              <artwork><![CDATA[
   --------                                --------  
  /   A    \                              /   A    \ 
  | (*)    |                              |   (*)  | 
  | | |<=====================================>| |  |
  |  -     |                              |    -   | 
  \        /                              \        / 
   --------                                -------- 
         \                                 /
          \   -------------------------   /
           \ /           B             \ /
            \|  (*)              (*)   |/
             TT | |<============>| | TT
             |   -                -    |
             \                         / 
              ------------------------- 

   (*) closer examination of Router Alert Option datagrams

   <==>  flow of Router Alert Option datagrams

   TT: Tunneling of Router Alert Option datagrams
]]></artwork>

              <postamble></postamble>
            </figure>

          <t>In some controlled environment:</t>

          <t><list style="symbols">
              <t>The sites of a network A are interconnected through a service
              provider network B.</t>

              <t>The service provider B processes Router Alert packets on the
              edge routers and protects these edge routers against RAO-based
              attacks using mechanisms such as (possibly per port) RAO rate
              limiting and filtering.</t>

              <t>The service provider network B protects its core routers from
              Router Alert messages without dropping those messages when they
              transit
              over the network (for example, using mechanisms discussed
              in <xref target="RFC6178"></xref>).</t>
            </list>In such a controlled environment, an application relying on
          exchange and handling of RAO packets (e.g., RSVP) in the network A
          sites and in network B's edges (but not in the core of network B) can
          be safely deployed. We refer to such a deployment as a use of Router
          Alert in a Leak-Controlled Overlay -- "Overlay", because Router Alert
          Option datagrams are used in network A on top of, and completely
          transparently to, network B's core; and "Leak-Controlled",
          because Router
          Alert Option datagrams from network A leak inside network B's
          edges but
          not inside network B's core. A private enterprise intranet, whose
          sites are interconnected through a service provider network, using
          RSVP for voice and video within network A sites as well as on
          network B's edge to extend the reservation onto the attachment links
          between networks A and B
          (as specified in <xref target="RFC6016"></xref>),
          might be an example of such a controlled environment. Such an
          environment is illustrated in <xref
          target="fig-overlay3"></xref>.</t>

          <figure anchor="fig-overlay3"
              title="Use of Router Alert in Leak-Controlled Overlay">

              <artwork><![CDATA[
   --------                                --------  
  /   A    \                              /   A    \ 
  |        |                              |        |
  |        |   ------------------------   |        |  
  | (*)    |  /(*)              (*)    \  |   (*)  | 
  | | |<======>| |<============>| |<=========>| |  |
  |  -     |  | -                -     |  |    -   | 
  \        /  |  \    -     -   /      |  \        / 
   --------   |   TT-| |   | |-TT      |   -------- 
              |       -     -          |
              \                        / 
               ------------------------

   (*) closer examination of Router Alert Option datagrams

   <==>  flow of Router Alert Option datagrams

   TT: Tunneling of Router Alert Option datagrams
]]></artwork>

              <postamble></postamble>
            </figure>
        </section>
      </section>

      <section anchor="sp"
               title="Router Alert Protection Approaches for Service Providers">
        <t><xref target="concerns"></xref> discusses the security risks
        associated with the use of the IP Router Alert and how it opens up a
        DoS vector in the router control plane. Thus, a service provider MUST
        implement strong protection of its network against attacks based on IP
        Router Alert.</t>

        <t>As discussed in <xref target="overlay"></xref>, some applications
        can benefit from the use of IP Router Alert packets in an Overlay
        Model (i.e., where Router Alert packets are exchanged transparently on
        top of a service provider). Thus, a service provider protecting its
        network from attacks based on IP Router Alert SHOULD use mechanisms
        that avoid (or at least minimize) the dropping of end-to-end IP Router
        Alert packets (other than those involved in an attack).</t>

        <t>For example, if the service provider does not run any protocol
        depending on IP Router Alert within its network, it might elect to
        simply turn off punting/processing of IP Router Alert packets on its
        routers; this will ensure that end-to-end IP Router Alert packets
        transit transparently and safely through its network.</t>

        <t>As another example, using protection mechanisms such as selective
        filtering and rate limiting (which <xref
        target="implementation"></xref> suggests be supported by IP Router
        Alert implementations), a service provider can protect the operation of
        a protocol depending on IP Router Alert within its network (e.g.,
        RSVP-TE) while at the same time transporting IP Router Alert packets
        carrying another protocol that might be used end to end. Note that the
        service provider might additionally use protocol-specific mechanisms
        that reduce the dependency on Router Alert for operation of this
        protocol inside the service provider environment; use of RSVP refresh
        reduction mechanisms (<xref target="RFC2961"></xref>) would be an
        example of such mechanisms in the case where the service provider is
        running RSVP-TE within its network, since this allows the refresh of
        existing Path and Resv states without the use of the IP Router Alert
        Option.</t>

        <t>As yet another example, using mechanisms such as those discussed in
        <xref target="RFC6178"></xref>, a service provider can safely protect
        the operation of a protocol depending on IP Router Alert within its
        network (e.g., RSVP-TE) while at the same time safely transporting IP
        Router Alert packets carrying another protocol that might be used end
        to end (e.g., IPv4/IPv6 RSVP). We observe that while tunneling of
        Router Alert Option datagrams over an MPLS backbone as discussed in
        <xref target="RFC6178"></xref> is well understood, tunneling Router
        Alert Option datagrams over a non-MPLS IP backbone presents a number
        of issues (in particular, for determining where to forward the
        encapsulated datagram) and is not common practice at the time of
        writing this document.</t>

        <t>As a last resort, if the service provider does not have any means
        to safely transport end-to-end IP Router Alert Option packets over its
        network, the service provider can drop those packets. It must be
        noted that this has the undesirable consequence of preventing the
        use of the Router Alert Option in the Overlay Model on top of that
        network, and therefore prevents users of that network from deploying a
        number of valid applications/protocols in their environment.</t>
      </section>
    </section>

    <section anchor="implementation"
             title="Guidelines for Router Alert Implementation">
      <t>A router implementation of the IP Router Alert Option SHOULD include
      protection mechanisms against Router-Alert-based DoS attacks as
      appropriate for their targeted deployment environments.
      For example, this can include the ability of an edge router
      to "tunnel" received IP Router Alert Option packets
      when forwarding those packets over the core, as discussed in
      <xref target="RFC6178"></xref>. As another example, although not always
      available from current implementations, new implementations MAY include
      protection mechanisms such as selective (possibly dynamic) filtering and
      rate limiting of IP Router Alert Option packets.</t>

      <t>In particular, router implementations of the IP Router Alert Option
      SHOULD offer the configuration option to simply ignore the presence of
      "IP Router Alert" in IPv4 and IPv6 packets. As discussed in <xref
      target="sp"></xref>, that permits IP Router Alert packets to transit a
      network segment without presenting an adverse operational security risk
      to that particular network segment, provided the operator of that
      network segment does not ever use the IP Router Alert messages for any
      purpose.</t>

      <t>If an IP packet contains the IP Router Alert Option, but the next
      level protocol is not explicitly identified as a protocol of interest by
      the router examining the packet, the behavior is not explicitly defined
      by <xref target="RFC2113"></xref>. However, the behavior is implied, and,
      for example, the definition of RSVP in <xref target="RFC2205"></xref>
      assumes that the packet will be forwarded using normal forwarding based
      on the destination IP address. Thus, a router implementation SHOULD
      forward within the "fast path" (subject to all normal policies and
      forwarding rules) a packet carrying the IP Router Alert Option
      containing a next level protocol that is not a protocol of interest to
      that router. The "not punting" behavior protects the router from DoS
      attacks using IP Router Alert packets of a protocol unknown to the
      router. The "forwarding" behavior contributes to transparent end-to-end
      transport of IP Router Alert packets (e.g., to facilitate their use by
      end-to-end applications).</t>

      <t>Similarly, an implementation MAY support selective forwarding within
      the fast path (subject to all normal policies and forwarding rules) or
      punting of a packet with the IP Router Alert Option, based on the Value
      field of the Router Alert Option. This would allow router protection
      against DoS attacks using IP Router Alert packets with a value that is
      not relevant for that router (e.g., nesting levels of aggregated RSVP
      reservation <xref target="RFC5350"></xref>).</t>
    </section>

    <section title="Security Considerations">
      <t>This document expands the security considerations of
      <xref target="RFC2113"></xref> and <xref target="RFC2711"></xref>,
      which define the IPv4 and IPv6 RAOs, respectively, by discussing
      security risks associated with usage of the current IP Router Alert
      Option and associated practices. See <xref target="RFC4081"></xref> for
      additional security considerations.</t>
    </section>

    <section title="Contributors">
      <t>The contributors to this document (in addition to the editor)
      are:

   <figure><artwork>
   Reshad Rahman
   Cisco Systems
   rrahman@cisco.com

   David Ward
   Juniper Networks
   dward@juniper.net

   Ashok Narayanan
   Cisco Systems
   ashokn@cisco.com

   Adrian Farrel
   OldDog Consulting
   adrian@olddog.co.uk

   Tony Li
   Cisco Systems
   tony.li@tony.li
   </artwork></figure></t>

    </section>

    <section anchor="Acknowledgements" title="Acknowledgments">
      <t>The editor and contributors would like to thank
      Dave Oran, Magnus Westerlund, John Scudder,
      Ron Bonica, Ross Callon, Alfred Hines, Carlos Pignataro, Roland Bless,
      Jari Arkko, and Ran Atkinson for their comments. This document also
      benefited from discussions with Jukka Manner and Suresh Krishnan. The
      discussion about use of the Value field in the IPv4 Router Alert is
      borrowed from a similar discussion in <xref target="RFC5971"></xref>.</t>
    </section>
  </middle>

  <back>

<?rfc rfcedstyle="no"?>
    <references title="Normative References">
      <?rfc include="reference.RFC.2113"?>

      <?rfc include="reference.RFC.2119"?>

      <?rfc include="reference.RFC.2711"?>

      <?rfc include="reference.RFC.0791"?>

      <?rfc include="reference.RFC.2460"?>

      <?rfc include="reference.RFC.5350"?>

    </references>

    <references title="Informative References">

<!-- draft-narayanan-rtg-router-alert-extension (Expired) -->
<reference anchor='RAO-EXT'>
<front>
<title>IP Router Alert Option Extension</title>
<author initials='A' surname='Narayanan' fullname='Ashok Narayanan'>
    <organization />
</author>
<author initials='F' surname="Le Faucheur" fullname='Francois Le Faucheur'>
    <organization />
</author>
<author initials='D' surname='Ward' fullname='David Ward'>
    <organization />
</author>
<author initials='R' surname='Rahman' fullname='Reshad Rahman'>
    <organization />
</author>
<date month='March' year='2009' />
</front>
<seriesInfo name='Work in' value='Progress' />
</reference>

<!-- draft-krishnan-ipv6-hopbyhop (Expired) -->
<reference anchor='IPv6-HOPBYHOP'>
<front>
<title>The case against Hop-by-Hop options</title>
<author initials='S' surname='Krishnan' fullname='Suresh Krishnan'>
    <organization />
</author>
<date month='October' year='2010' />
</front>
<seriesInfo name='Work in' value='Progress' />
</reference>

      <?rfc include="reference.RFC.4081"?>

      <?rfc include="reference.RFC.3209"?>

<reference anchor='RFC2205'>
<front>
<title abbrev='RSVP'>Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification</title>
<author initials='R.' surname='Braden' fullname='Bob Braden' role="editor">
<organization>USC Information Sciences Institute</organization>
</author>
<author initials='L.' surname='Zhang' fullname='Lixia Zhang'>
<organization>UCLA Computer Science Department</organization>
</author>
<author initials='S.' surname='Berson' fullname='Steve Berson'>
<organization>USC Information Sciences Institute</organization>
</author>
<author initials='S.' surname='Herzog' fullname='Shai Herzog'>
<organization>IBM T. J. Watson Research Center</organization>
</author>
<author initials='S.' surname='Jamin' fullname='Sugih Jamin'>
<organization>University of Michigan</organization>
</author>
<date year='1997' month='September' />
</front>
<seriesInfo name='RFC' value='2205' />
</reference>

      <?rfc include="reference.RFC.3208"?>

      <?rfc include="reference.RFC.3376"?>

      <?rfc include="reference.RFC.3175"?>

      <?rfc include="reference.RFC.2710"?>

<reference anchor='RFC3810'>
<front>
<title>Multicast Listener Discovery Version 2 (MLDv2) for IPv6</title>
<author initials='R.' surname='Vida' fullname='R. Vida' role="editor">
<organization /></author>
<author initials='L.' surname='Costa' fullname='L. Costa' role="editor">
<organization /></author>
<date year='2004' month='June' />
</front>
<seriesInfo name='RFC' value='3810' />
</reference>

      <?rfc include="reference.RFC.4286"?>

      <?rfc include="reference.RFC.2961"?>

      <?rfc include="reference.RFC.6016"?>

      <?rfc include="reference.RFC.6178"?>

      <?rfc include="reference.RFC.5971"?>

<reference anchor='RFC4732'>
<front>
<title>Internet Denial-of-Service Considerations</title>
<author initials='M.' surname='Handley' fullname='M. Handley' role="editor">
<organization /></author>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla' role="editor">
<organization /></author>
<author>
<organization>IAB</organization></author>
<date year='2006' month='December' />
</front>
<seriesInfo name='RFC' value='4732' />
</reference>

    </references>
<?rfc rfcedstyle="yes"?>
  </back>
</rfc>
