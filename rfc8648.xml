<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" >
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc strict="yes" ?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes" ?>
<?rfc compact="yes" ?>
<?rfc subcompact="no" ?>

<rfc submissionType="IETF" category="std" consensus="yes" number="8648" ipr="trust200902">

  <front>
    <title abbrev="A+P RADIUS Attributes">RADIUS Attributes for Softwire
    Mechanisms Based on Address&nbsp;plus&nbsp;Port&nbsp;(A+P)</title>

    <author fullname="Sheng Jiang" initials="S." surname="Jiang, Ed.">
      <organization abbrev="Huawei">Huawei Technologies Co., Ltd.</organization>

      <address>
        <postal>
          <street>Q14, Huawei Campus, No.156 Beiqing Road</street>

          <city>Hai-Dian District, Beijing, 100095</city>

          <country>China</country>
        </postal>

        <email>jiangsheng@huawei.com</email>
      </address>
    </author>

    <author fullname="Yu Fu" initials="Y." surname="Fu, Ed.">
      <organization>CNNIC</organization>

      <address>
        <postal>
          <street>No.4 South 4th Street, Zhongguancun</street>

          <city>Hai-Dian District, Beijing, 100190</city>

          <country>China</country>
        </postal>

        <email>eleven711711@foxmail.com</email>
      </address>
    </author>

    <author fullname="Chongfeng Xie" initials="C." surname="Xie">
      <organization>China Telecom</organization>

      <address>
        <postal>
          <street></street>

          <city>Beijing</city>

          <code></code>

          <country>China</country>
        </postal>

        <email>xiechf.bri@chinatelecom.cn</email>
      </address>
    </author>

    <author fullname="Tianxiang Li" initials="T" surname="Li">
      <organization>Tsinghua University</organization>

      <address>
        <postal>
          <street></street>

          <city>Beijing</city>

          <code>100084</code>

          <country>China</country>
        </postal>

        <email>peter416733@gmail.com</email>
      </address>
    </author>

    <author fullname="Mohamed Boucadair" initials="M. " role="editor"
            surname="Boucadair">
      <organization>Orange</organization>

      <address>
        <postal>
          <street>Rennes, 35000</street>

          <city>France</city>

          <region></region>

          <code></code>

          <country></country>
        </postal>

        <phone></phone>

        <facsimile></facsimile>

        <email>mohamed.boucadair@orange.com</email>

        <uri></uri>
      </address>
    </author>

    <date month="September" year="2019" />

    <area>Internet Area</area>

    <workgroup>Softwire</workgroup>

    <keyword>IPv6 Transition, MAP-E, MAP-T, Lightweight 4over6, RADIUS,
    address sharing, authorization, AAA, provisioning</keyword>
    
    <abstract>
      <t>IPv4-over-IPv6 transition mechanisms provide IPv4 connectivity
      services over IPv6 native networks during the IPv4/IPv6 coexistence
      period. DHCPv6 options have been defined to configure clients for
      Lightweight 4over6, Mapping of Address and Port with Encapsulation (MAP-E),
      Mapping of Address and Port using Translation (MAP-T) unicast softwire
      mechanisms, and multicast softwires. However, in many networks,
      configuration information is stored in an Authentication, Authorization,
      and Accounting (AAA) server, which utilizes the Remote Authentication Dial In
      User Service (RADIUS) protocol to provide centralized management for
      users. When a new transition mechanism is developed, new RADIUS
      attributes need to be defined correspondingly.</t>

      <t>This document defines new RADIUS attributes to carry softwire
      configuration parameters based on Address plus Port from a
      AAA server to a Broadband
      Network Gateway. Both unicast and multicast attributes are covered.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>Providers have started deploying and transitioning to IPv6. Several
      IPv4 service continuity mechanisms based on Address plus Port (A+P)
      <xref target="RFC6346"></xref> have been proposed for providing unicast
      IPv4-over-IPv6-only infrastructure, such as Mapping of Address and Port
      with Encapsulation (MAP-E) <xref target="RFC7597"></xref>, Mapping of
      Address and Port using Translation (MAP-T) <xref
      target="RFC7599"></xref>, and Lightweight 4over6 <xref
      target="RFC7596"></xref>. Also, <xref target="RFC8114"></xref> specifies
      a generic solution for the delivery of IPv4 multicast services to IPv4
      clients over an IPv6 multicast network. For each of these mechanisms,
      DHCPv6 options have been specified for client configuration.</t>

     

      <t>In many networks, user configuration information is stored in an
      Authentication, Authorization, and Accounting (AAA) server. AAA servers
      generally communicate using the Remote Authentication Dial In User
      Service (RADIUS) <xref target="RFC2865"></xref> protocol. In a fixed
      broadband network, a Broadband Network Gateway (BNG) acts as the access
      gateway for users. That is, the BNG acts as both a AAA client to the
      AAA server and a DHCPv6 server for DHCPv6 messages sent by clients.

      Throughout this document, the term "BNG" describes a device implementing
      both the AAA client and DHCPv6 server functions.</t>

      <t>Since IPv4-in-IPv6 softwire configuration information is stored in a
      AAA server and user configuration information is mainly transmitted
      through DHCPv6 between the BNGs and Customer Premises Equipment (CEs,
      a.k.a., CPE), new RADIUS attributes are needed to propagate the
      information from the AAA servers to BNGs so that they can be provided to
      CEs using the existing DHCPv6 options. </t>

      <t>The RADIUS attributes defined in this document provide the configuration
      to populate the corresponding DHCPv6 options for unicast and multicast
      softwire configurations, specifically:</t>

      <t><list style="symbols">
          <t>"Mapping of Address and Port with Encapsulation (MAP-E)" <xref
          target="RFC7597"></xref> (DHCPv6 options defined in <xref
          target="RFC7598"></xref>).</t>

          <t>"Mapping of Address and Port using Translation (MAP-T)" <xref
          target="RFC7599"></xref> (DHCPv6 options defined in <xref
          target="RFC7598"></xref>).</t>

          <t>"Lightweight 4over6: An Extension to the Dual-Stack Lite
          Architecture" <xref target="RFC7596"></xref> (DHCPv6 options defined
          in <xref target="RFC7598"></xref>).</t>

          <t>"Unified IPv4-in-IPv6 Softwire Customer Premises Equipment (CPE):
          A DHCPv6-Based Prioritization Mechanism" <xref
          target="RFC8026"></xref>.</t>

          <t>"Delivery of IPv4 Multicast Services to IPv4 Clients over an IPv6
          Multicast Network" <xref target="RFC8114"></xref> (DHCPv6 options
          defined in <xref target="RFC8115"></xref>).</t>
        </list></t>

      <t>The contents of the attributes defined in this document have a 1:1
      mapping into the fields of the various DHCPv6 options in <xref
      target="RFC7598"></xref>, <xref target="RFC8026"></xref>, and <xref
      target="RFC8115"></xref>. Table 1 shows how the DHCPv6 options map to
      the corresponding RADIUS attribute. For detailed mappings between each
      DHCPv6 option field and the corresponding RADIUS attribute or field, see
      <xref target="tlv-field-map"></xref>.</t>

      <t><figure
          title="Table 1: Mapping between DHCPv6 Options and RADIUS Attributes">
          <artwork align="center"><![CDATA[+----------------------------+--------------------------------+
|        DHCPv6 Option       |        RADIUS Attribute        |
+----------------------------+--------------------------------+
|     OPTION_S46_RULE (89)   |        Softwire46-Rule         |
|     OPTION_S46_BR (90)     |         Softwire46-BR          |
|     OPTION_S46_DMR (91)    |        Softwire46-DMR          |
|   OPTION_S46_V4V6BIND (92) |      Softwire46-V4V6Bind       |
| OPTION_S46_PORTPARAMS (93) |     Softwire46-PORTPARAMS      |
|  OPTION_S46_PRIORITY (111) |      Softwire46-Priority       |
|  OPTION_V6_PREFIX64 (113)  |      Softwire46-Multicast      |
+----------------------------+--------------------------------+
]]></artwork>
        </figure></t>

      <t>A RADIUS attribute for Dual-Stack Lite <xref target="RFC6333"></xref>
      is defined in <xref target="RFC6519"></xref>.</t>

      <t>This document targets deployments where a trusted relationship is in
      place between the RADIUS client and server.</t>
    </section>

    <section title="Terminology">
        <t>
    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
    NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
    "MAY", and "OPTIONAL" in this document are to be interpreted as
    described in BCP&nbsp;14 <xref target="RFC2119"/> <xref target="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>

      <t>The reader should be familiar with the concepts and terms defined in
      <xref target="RFC7596"></xref>, <xref target="RFC7597"></xref>, <xref
      target="RFC7599"></xref>, and <xref target="RFC8026"></xref>.</t>

      <t>The terms "multicast Basic Bridging BroadBand" element (mB4) and
      "multicast Address Family Transition Router" element (mAFTR) are defined
      in <xref target="RFC8114"></xref>.</t>

      <t>Softwire46 (S46) is used throughout to denote any of the IPv4-in-IPv6
      softwire mechanisms listed above. Additionally, the following
      abbreviations are used within the document:<list style="symbols">
          <t>BNG: Broadband Network Gateway</t>

          <t>BR: Border Relay</t>

          <t>CE: Customer Edge</t>
	  
	  <t>CoA: Change-of-Authorization </t>

          <t>DMR: Default Mapping Rule</t>

	  <t>EA: Embedded Address</t>

          <t>lwAFTR: Lightweight Address Family Transition Router</t>

	  <t>MAP-E: Mapping of Address and Port with Encapsulation</t>

          <t>MAP-T: Mapping of Address and Port using Translation</t>

          <t>PSID: Port Set Identifier</t>

          <t>TLV: Type, Length, Value</t>


        </list></t>
    </section>

    <section title="New RADIUS Attributes">
      <t>This section defines the following attributes: <list style="numbers">
          <t>Softwire46-Configuration Attribute (<xref
          target="conf-attr"></xref>): <vspace blankLines="1" />This attribute
          carries the configuration information for MAP-E, MAP-T, and
          Lightweight 4over6. The configuration information for each
          Softwire46 mechanism is carried in the corresponding Softwire46
          attributes. Different attributes are required for each Softwire46
          mechanism.</t>

          <t>Softwire46-Priority Attribute (<xref
          target="s46-prio-attr"></xref>): <vspace blankLines="1" />Depending
          on the deployment scenario, a client may support several different
          Softwire46 mechanisms. Therefore, a client may request configuration
          for more than one Softwire46 mechanism at a time. The
          Softwire46-Priority Attribute contains information allowing the
          client to prioritize which mechanism to use, corresponding to
          OPTION_S46_PRIORITY defined in <xref target="RFC8026"></xref>.</t>

          <t>Softwire46-Multicast Attribute (<xref
          target="s46-mcast-attr"></xref>): <vspace blankLines="1" />This
          attribute conveys the IPv6 prefixes to be used in <xref
          target="RFC8114"></xref> to synthesize IPv4-embedded IPv6 addresses.
          The BNG uses the IPv6 prefixes returned in the RADIUS
          Softwire46-Multicast Attribute to populate the DHCPv6 PREFIX64
          Option <xref target="RFC8115"></xref>.</t>
        </list></t>

      <t>All of these attributes are allocated from the RADIUS "Extended Type"
      code space per <xref target="RFC6929"></xref>.</t>

      <t>All of these attribute designs follow <xref target="RFC6158"></xref>
      and <xref target="RFC6929"></xref>.</t>

      <t>This document adheres to the guidance in <xref target="RFC8044"></xref> for defining
      new RADIUS attributes.</t>

      <section anchor="conf-attr" title="Softwire46-Configuration Attribute">
        <t>This attribute is of type "tlv", as defined in "Remote Authentication Dial-In User Service (RADIUS) Protocol
        Extensions" <xref target="RFC6929"></xref>. It contains some
        sub-attributes, with the following requirements:</t>

        <t><list style="symbols">
            <t>The Softwire46-Configuration Attribute MUST contain one or more
            of the following attributes: Softwire46-MAP-E, Softwire46-MAP-T,
            and/or Softwire46-Lightweight-4over6.</t>

            <t>The Softwire46-Configuration Attribute conveys the
            configuration information for MAP-E, MAP-T, or Lightweight 4over6.
            The BNG SHALL use the configuration information returned in the
            RADIUS attribute to populate the DHCPv6 Softwire46 container
            option(s) defined in Section 5 of <xref
            target="RFC7598"></xref>.</t>

            <t>The Softwire46-Configuration Attribute MAY appear in an
            Access-Accept packet. It MAY also appear in an Access-Request
            packet to indicate a preferred Softwire46 configuration. However,
            the server is not required to honor such a preference.</t>

            <t>The Softwire46-Configuration Attribute MAY appear in a
            CoA-Request packet.</t>

            <t>The Softwire46-Configuration Attribute MAY appear in an
            Accounting-Request packet.</t>

            <t>The Softwire46-Configuration Attribute MUST NOT appear in any
            other RADIUS packet.</t>
          </list></t>

        <t>The Softwire46-Configuration Attribute is structured as
        follows:</t>

        <t><list style="hanging">
  <t hangText="Type"><vspace />241</t> 

  <t hangText="Length"><vspace />
    Indicates the total length, in bytes, of all fields of
    this attribute, including the Type, Length, Extended-Type, 
    and the entire length of the embedded attributes.</t>

   <t hangText="Extended-Type"><vspace />9</t>

   <t hangText="Value"><vspace />
      Contains one or more of the following attributes. Each attribute
      type may appear once at most:
<list style="hanging">
   <t hangText="Softwire46-MAP-E"><vspace />
         For configuring MAP-E clients. For the construction of
         this attribute, refer to <xref target="etlv"/>.</t>
   <t hangText="Softwire46-MAP-T"><vspace />
         For configuring MAP-T clients. For the construction of
         this attribute, refer to <xref target="ttlv"/>.</t>

   <t hangText="Softwire46-Lightweight-4over6"><vspace />
         For configuring Lightweight 4over6 clients. For the
         construction of this attribute, refer to <xref target="ltlv"/>.</t>
          </list></t>
	</list></t>

        <t>The Softwire46-Configuration Attribute is associated with the
        following identifier: 241.9.</t>

        <section anchor="s46-tlvs" title="Softwire46 Attributes">
          <t>The Softwire46 attributes can only be encapsulated in the
          Softwire46-Configuration Attribute. Depending on the deployment
          scenario, a client might request more than one transition
          mechanism at a time. There MUST be at least one Softwire46 attribute
          encapsulated in one Softwire46-Configuration Attribute. There MUST
          be at most one instance of each type of Softwire46 attribute
          encapsulated in one Softwire46-Configuration Attribute.</t>

          <t>There are three types of Softwire46 attributes, namely:<list
              style="numbers">
              <t>Softwire46-MAP-E (<xref target="etlv"></xref>)</t>

              <t>Softwire46-MAP-T (<xref target="ttlv"></xref>)</t>

              <t>Softwire46-Lightweight 4over6 (<xref
              target="ltlv"></xref>)</t>
            </list>Each type of Softwire46 attribute contains a number of
          sub-attributes, defined in <xref
          target="s46-sub-tlv-format"></xref>. The hierarchy of the Softwire46
          attributes is shown in <xref target="Hierar"></xref>. <xref
          target="s46-sub-tlvs"></xref> describes which sub-attributes are
          mandatory, optional, or not permitted for each defined Softwire46
          attribute.</t>

          <figure anchor="Hierar" title="Softwire46 Attribute Hierarchy">
            <artwork><![CDATA[                                              
                                                /1.Rule-IPv6-Prefix  
S                      /                       |   
o  /                  | 1.Softwire46-Rule -----+ 2.Rule-IPv4-Prefix 
f | Softwire46-MAP-E--+                        |    
t |                   | 2.Softwire46-BR        | 3.EA-Length   
w |                   |                         \   
i |                   |                               /1.PSID-Offset
r |                   |                              |    
e |                   | 3.Softwire46-PORTPARAMS -----+ 2.PSID-Len 
- |                    \                             |    
C |                                                  | 3.PSID  
o |                                                   \   
n |
f |                                             /1.Rule-IPv6-Prefix  
i |                    /                       |    
g |                   | 1.Softwire46-Rule------+ 2.Rule-IPv4-Prefix 
u | Softwire46-MAP-T--+                        |    
r |                   | 2.Softwire46-DMR       | 3.EA-Length 
a |                   |                         \   
t |                   |                               /1.PSID-Offset
i |                   |                              |    
o |                   | 3.Softwire46-PORTPARAMS------+ 2.PSID-Len 
n |                    \                             |    
  |                                                  | 3.PSID
A |                                                   \  
t |                     
t |                                                 /1.IPv4-Address
r |                    /                           |   
i |                   | 1.Softwire46-V4V6Bind -----+ 2.Bind-IPv6-Prefix 
b | Softwire46-       |                             \   
u | Lightweight-4over6+ 2.Softwire46-BR               /1.PSID-Offset
t  \                  |                              |    
e                     | 3.Softwire46-PORTPARAMS  ----+ 2.PSID-Len 
                       \                             |    
                                                     | 3.PSID 
                                                      \  
]]></artwork>
          </figure>

          <section anchor="etlv" title="Softwire46-MAP-E Attribute">
            <t> The Softwire46-MAP-E attribute is designed to carry the
            configuration information for MAP-E. The structure of
            Softwire46-MAP-E is shown below:</t>
<t><list style="hanging">
     <t hangText="TLV-Type"><vspace />
     1</t>  

   <t hangText="TLV-Length"><vspace />
     Indicates the length of this attribute, including
     the TLV-Type, TLV-Length, and TLV-Value fields.</t>

   <t hangText="TLV-Value"><vspace />
     Contains a set of sub-attributes, with the following requirements:
<vspace blankLines="1" />
     It MUST contain Softwire46-Rule, defined in <xref target="s46-rule-sub-tlv"/>.
<vspace blankLines="1" />
     It MUST contain Softwire46-BR, defined in <xref target="s46br"/>.
<vspace blankLines="1" />
     It MAY contain Softwire46-PORTPARAMS, defined in <xref target="s46param"/>.</t>
   </list></t>
          </section>

          <section anchor="ttlv" title="Softwire46-MAP-T Attribute">
            <t>The Softwire46-MAP-T attribute is designed to carry the
            configuration information for MAP-T. The structure of
            Softwire46-MAP-T is shown below:</t>
<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
     2</t> 

<t hangText="TLV-Length"><vspace />
     Indicates the length of this attribute, including
     the TLV-Type, TLV-Length, and TLV-Value fields.</t>

<t hangText="TLV-Value"><vspace />
     Contains a set of sub-attributes, with the following requirements:
<vspace blankLines="1" />
     It MUST contain Softwire46-Rule, defined in <xref target="s46-rule-sub-tlv"/>.
<vspace blankLines="1" />
     It MUST contain Softwire46-DMR, defined in <xref target="s46dmr"/>.
<vspace blankLines="1" />
     It MAY contain Softwire46-PORTPARAMS, defined in <xref target="s46param"/>.</t>
</list></t>
          </section>

          <section anchor="ltlv"
                   title="Softwire46-Lightweight-4over6 Attribute">
            <t>The Softwire46-Lightweight-4over6 attribute is designed to
            carry the configuration information for Lightweight 4over6. The
            structure of Softwire46-Lightweight-4over6 is shown below:</t>
<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
     3</t> 

<t hangText="TLV-Length"><vspace />
     Indicates the length of this attribute, including
     the TLV-Type, TLV-Length, and TLV-Value fields.</t>

<t hangText="TLV-Value"><vspace />
     Contains a set of sub-attributes as follows:
<vspace blankLines="1" />
     It MUST contain Softwire46-BR, defined in <xref target="s46br"/>.
<vspace blankLines="1" />
     It MUST contain Softwire46-V4V6Bind, defined in <xref target="s46bind"/>.
<vspace blankLines="1" />
     It MAY contain Softwire46-PORTPARAMS, defined in <xref target="s46param"/>.</t>
   </list></t>
          </section>
        </section>

        <section anchor="s46-sub-tlvs" title="Softwire46 Sub-attributes">
          <t>Table 2 shows which encapsulated sub-attributes are mandatory,
          optional, or not permitted for each defined Softwire46
          attribute.</t>

          <figure title="Table 2: Softwire46 Sub-attributes">
            <artwork><![CDATA[+-----------------------+-------+-------+--------------------+
| Sub-attributes        | MAP-E | MAP-T | Lightweight 4over6 |
+-----------------------+-------+-------+--------------------+
| Softwire46-BR         |   1+  |   0   |         1+         |
| Softwire46-Rule       |   1   |   1   |          0         |
| Softwire46-DMR        |   0   |   1   |          0         |
| Softwire46-V4V6Bind   |   0   |   0   |          1         |
| Softwire46-PORTPARAMS |  0-1  |  0-1  |         0-1        |
+-----------------------+-------+-------+--------------------+

]]></artwork>
          </figure>

          <t>The following table defines the meaning of the Table 2 entries.</t>
<t><list style="hanging" hangIndent="4">
<t hangText="0">Not permitted</t>
<t hangText="0-1">Optional; zero or one instance of the attribute may be present.</t> 
<t hangText="1">Mandatory; only one instance of the attribute must be present.</t>
<t hangText="1+">Mandatory; one or more instances of the attribute may be present.</t>
    </list></t>
        </section>

        <section anchor="s46-sub-tlv-format"
                 title="Specification of the Softwire46 Sub-attributes">
          <section anchor="s46-rule-sub-tlv" title="Softwire46-Rule Attribute">
            <t>Softwire46-Rule can only be encapsulated in Softwire46-MAP-E
            (<xref target="etlv"></xref>) or Softwire46-MAP-T (<xref
            target="ttlv"></xref>). Depending on the deployment scenario, one
            Basic Mapping Rule (BMR) and zero or more Forwarding Mapping Rules
            (FMRs) MUST be included in one Softwire46-MAP-E or
            Softwire46-MAP-T.</t>

            <t>Each type of Softwire46-Rule also contains a number of
            sub-attributes, including Rule-IPv6-Prefix, Rule-IPv4-Prefix, and
            EA-Length. The structure of the sub-attributes for Softwire46-Rule
            is defined in <xref target="s46-rule-sub-tlvs"></xref>.</t>

            <t>Defining multiple TLV types achieves the same design goals as
            the "Softwire46 Rule Flags" defined in Section 4.1 of <xref
            target="RFC7598"></xref>. Using a TLV type set to 5 is equivalent
	    to setting the F flag in the OPTION_S46_RULE S46 Rule Flags
            field.</t>
<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
     4 Basic Mapping Rule only (not to be used for forwarding)<vspace />
     5 Forwarding Permitted Mapping Rule</t>

<t hangText="TLV-Length"><vspace />
     Indicates the length of this attribute, including
     the TLV-Type, TLV-Length, and TLV-Value fields.</t>

<t hangText="Data Type"><vspace />
     The attribute Softwire46-Rule is of type "tlv" (Section 3.13 of
     <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
     This field contains a set of attributes as follows:
<list style="hanging">
<t hangText="Rule-IPv6-Prefix"><vspace />
        This attribute contains the IPv6 prefix for use in the MAP rule.
        Refer to <xref target="v6prefix"/>.</t>

<t hangText="Rule-IPv4-Prefix"><vspace />
        This attribute contains the IPv4 prefix for use in the MAP rule.
        Refer to <xref target="v4prefix"/>.</t>

<t hangText="EA-Length"><vspace />
        This attribute contains the Embedded Address (EA) bit length.
        Refer to <xref target="ea-length"/>.</t>
</list></t></list></t>
          </section>

          <section anchor="s46br" title="Softwire46-BR Attribute">
            <t>Softwire46-BR can only be encapsulated in Softwire46-MAP-E
            (<xref target="etlv"></xref>) or Softwire46-Lightweight-4over6
            (<xref target="ltlv"></xref>).</t>

            <t>There MUST be at least one Softwire46-BR included in each
            Softwire46-MAP-E or Softwire46-Lightweight-4over6.</t>

            <t>The structure of Softwire46-BR is shown below:</t>

<t><list style="hanging"> 
<t hangText="TLV-Type"><vspace />
      6</t>

<t hangText="TLV-Length"><vspace />
      18 octets</t>

<t hangText="Data Type"><vspace />
      The attribute Softwire46-BR is of type "ipv6addr" (Section 3.9 of
      <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      br-ipv6-address. A fixed-length field of 16 octets that 
      specifies the IPv6 address for the Softwire46 Border Relay (BR).</t>
    </list></t>
          </section>

          <section anchor="s46dmr" title="Softwire46-DMR Attribute">
            <t>Softwire46-DMR may only appear in Softwire46-MAP-T (<xref
            target="ttlv"/>). There MUST be exactly one Softwire46-DMR
            included in one Softwire46-MAP-T.</t>

            <t>The structure of Softwire46-DMR is shown below:</t>

<t><list style="hanging"> 
<t hangText="TLV-Type"><vspace />
      7</t>

<t hangText="TLV-Length"><vspace />
      4 + length of dmr-ipv6-prefix specified in octets.</t>

<t hangText="Data Type"><vspace />
      The attribute Softwire46-DMR is of type "ipv6prefix" (Section 3.10 of
      <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      A variable-length (dmr-prefix6-len) field 
      specifying the IPv6 prefix (dmr-ipv6-prefix) for the BR. This field
      is right-padded with zeros to the nearest octet boundary when 
      dmr-prefix6-len is not divisible by 8. Prefixes with lengths from
      0 to 96 are allowed.</t>
</list></t>
          </section>

          <section anchor="s46bind" title="Softwire46-V4V6Bind Attribute">
            <t>Softwire46-V4V6Bind may only be encapsulated in
            Softwire46-Lightweight-4over6 (<xref target="ltlv"></xref>). There
            MUST be exactly one Softwire46-V4V6Bind included in each
            Softwire46-Lightweight-4over6.</t>

            <t>The structure of Softwire46-V4V6Bind is shown below:</t>

<t><list style="hanging">      
<t hangText="TLV-Type"><vspace />
      8</t>

<t hangText="TLV-Length"><vspace />
      Indicates the length of this attribute, including
      the TLV-Type, TLV-Length, and TLV-Value fields.</t>

<t hangText="Data Type"><vspace />
      The attribute Softwire46-V4V6Bind is of type "tlv" (Section 3.13 of
      <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      This field contains a set of attributes as follows:
<list style="hanging">
   <t hangText="IPv4-Address"><vspace />
         This attribute contains an IPv4 address, used to specify 
         the full or shared IPv4 address of the CE. Refer to 
         <xref target="v4address"/>.</t>

   <t hangText="Bind-IPv6-Prefix"><vspace />
         This attribute contains an IPv6 prefix used to indicate which 
         configured prefix the Softwire46 CE should use for constructing
         the softwire. Refer to <xref target="bindv6"/>.</t>
</list></t></list></t>
          </section>

          <section anchor="s46param" title="Softwire46-PORTPARAMS Attribute">
            <t>Softwire46-PORTPARAMS is optional. It is used to specify port
            set information for IPv4 address sharing between clients.
            Softwire46-PORTPARAMS MAY be included in any of the Softwire46
            attributes.</t>

            <t>The structure of Softwire46-PORTPARAMS is shown below:</t>

<t><list style="hanging">
  <t hangText="TLV-Type"><vspace />
      9</t>

<t hangText="TLV-Length"><vspace />
      Indicates the length of this attribute, including
      the TLV-Type, TLV-Length, and TLV-Value fields.</t>

<t hangText="Data Type"><vspace />
      The attribute Softwire46-PORTPARAMS is of type "tlv" (Section 3.13 
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      This field contains a set of attributes as follows:
<list style="hanging">
<t hangText="PSID-Offset"><vspace />
         This attribute specifies the numeric value for the Softwire46
         algorithm's excluded port range/offset bits (a bits). Refer to 
         <xref target="psid-offset"/>.</t>

<t hangText="PSID-Len"><vspace /> 
         This attribute specifies the number of significant bits in the
         PSID field (also known as 'k'). Refer to <xref target="psid-len"/>.</t>

<t hangText="PSID"><vspace /> 
         This attribute specifies the PSID value. Refer to <xref target="psid"/>.</t>
</list></t></list></t>
          </section>
        </section>

        <section anchor="s46-rule-sub-tlvs"
                 title="Sub-attributes for Softwire46-Rule">
	  
          <t>There are two types of Softwire46-Rule: the Basic Mapping Rule
          and the Forwarding Mapping Rule, indicated by the value in the
          TLV-Type field of Softwire46-Rule (<xref
          target="s46-rule-sub-tlv"></xref>).</t>

          <t>Each type of Softwire46-Rule also contains a number of
          sub-attributes as detailed in the following subsections.</t>

          <section title="Rule-IPv6-Prefix Attribute" anchor="v6prefix">
            <t>Rule-IPv6-Prefix is REQUIRED for every Softwire46-Rule. There
            MUST be exactly one Rule-IPv6-Prefix encapsulated in each type of
            Softwire46-Rule.</t>

            <t>Rule-IPv6-Prefix follows the framed IPv6 prefix designed in
            <xref target="RFC3162"></xref> and <xref
            target="RFC8044"></xref>.</t>

            <t>The structure of Rule-IPv6-Prefix is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      10</t>

<t hangText="TLV-Length"><vspace /> 
      4 + length of rule-ipv6-prefix specified in
      octets.</t>

<t hangText="Data Type"><vspace />
      The attribute Rule-IPv6-Prefix is of type "ipv6prefix" (Section 3.10 
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      A variable-length field that specifies an IPv6 
      prefix (rule-ipv6-prefix) appearing in the MAP rule.</t>
</list></t>
          </section>

          <section title="Rule-IPv4-Prefix Attribute" anchor="v4prefix">
            <t>This attribute is used to convey the MAP Rule IPv4 prefix. The
            structure of Rule-IPv4-Prefix is shown below:</t>

<t><list style="hanging">   
<t hangText="TLV-Type"><vspace />
      11</t>

<t hangText="TLV-Length"><vspace />
      4 + length of rule-ipv4-prefix specified in octets.</t>

<t hangText="Data Type"><vspace />
      The attribute Rule-IPv4-Prefix is of type "ipv4prefix" (Section 3.11
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      A variable-length field that specifies  
      an IPv4 prefix (rule-ipv4-prefix) appearing in the MAP rule.</t>
    </list></t>
          </section>

          <section title="EA-Length Attribute" anchor="ea-length">
            <t>This attribute is used to convey the Embedded Address (EA) bit
            length. The structure of EA-Length is shown below:</t>

<t><list style="hanging">           
<t hangText="TLV-Type"><vspace /> 
      12</t>

<t hangText="TLV-Length"><vspace />
      6 octets</t>

<t hangText="Data Type"><vspace />
      The attribute EA-Length is of type "integer" (Section 3.1 of
      <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      EA-len; 32 bits long. Specifies the Embedded Address (EA) bit 
      length. Allowed values range from 0 to 48.</t>
</list></t>
          </section>
        </section>

        <section title="Attributes for Softwire46-v4v6Bind">
          <section title="IPv4-Address Attribute" anchor="v4address">
            <t>The IPv4-Address MAY be used to specify the full or shared IPv4
            address of the CE.</t>

            <t>The structure of IPv4-Address is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      13</t>

<t hangText="TLV-Length"><vspace />
      6 octets</t> 

<t hangText="Data Type"><vspace />
      The attribute IPv4-Address is of type "ipv4addr" (Section 3.8 
      of <xref target="RFC8044"/>).</t>
<t hangText="TLV-Value"><vspace />
      32 bits long. Specifies the IPv4 address (ipv4-address) to 
      appear in Softwire46-V4V6Bind (<xref target="s46bind"/>).</t>
              </list></t>
          </section>

          <section title="Bind-IPv6-Prefix Attribute" anchor="bindv6">
            <t>The Bind-IPv6-Prefix is used by the CE to identify the correct
            IPv6 prefix to be used as the tunnel source.</t>

            <t>The structure of Bind-IPv6-Prefix is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      14</t>

<t hangText="TLV-Length"><vspace />
      4 + length of bind-ipv6-prefix specified in octets.</t>

<t hangText="Data Type"><vspace />
      The attribute Bind-IPv6-Prefix is of type "ipv6prefix" (Section 3.10 
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace /> 
      A variable-length field specifying the IPv6 
      prefix or address for the Softwire46 CE (bind-ipv6-prefix). 
      This field is right-padded with zeros to the nearest octet 
      boundary when the prefix length is not divisible by 8.</t>
    </list></t>
          </section>
        </section>

        <section title="Attributes for Softwire46-PORTPARAMS">
          <section title="PSID-Offset Attribute" anchor="psid-offset">
            <t>This attribute is used to convey the Port Set Identifier offset
            as defined in <xref target="RFC7597"></xref>. This attribute is
            encoded in 32 bits as per the recommendation in Appendix A.2.1 of
            <xref target="RFC6158"></xref>.</t>

            <t>The structure of PSID-Offset is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      15</t>

<t hangText="TLV-Length"><vspace />
      6 octets</t>

<t hangText="Data Type"><vspace />
      The attribute PSID-Offset is of type "integer" (Section 3.1 
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      Contains the PSID-Offset (8 bits) right
      justified, and the unused bits in this field MUST
      be set to zero. This field specifies the
      numeric value for the Softwire46 algorithm's excluded 
      port range/offset bits (a bits), as per Section 5.1 
      of <xref target="RFC7597"/>.</t>
<t>  
      Default values for this field are specific to the 
      softwire mechanism being implemented and are defined 
      in the relevant specification document.</t>
              </list></t>
          </section>

          <section title="PSID-Len Attribute" anchor="psid-len">
            <t>This attribute is used to convey the PSID length as defined in
            <xref target="RFC7597"></xref>. This attribute is encoded in 32
            bits as per the recommendation in Appendix A.2.1 of <xref
            target="RFC6158"></xref>.</t>

            <t>The structure of PSID-Len is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      16</t>

<t hangText="TLV-Length"><vspace />
      6 octets</t>

<t hangText="Data Type"><vspace />
      The attribute PSID-Len is of type "integer" (Section 3.1
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      Contains the PSID-len (8 bits) right
      justified, and the unused bits in this field MUST
      be set to zero. This field specifies the number of 
      significant bits in the PSID field (also known as
      'k'). When set to 0, the PSID field is to be ignored.
      After the first a bits, there are k bits in the
      port number representing the value of the PSID.
      Subsequently, the address-sharing ratio would be 
      2^k.</t>
              </list></t>
          </section>

          <section title="PSID Attribute" anchor="psid">
            <t>This attribute is used to convey the PSID as defined in <xref
            target="RFC7597"></xref>. This attribute is encoded in 32 bits as
            per the recommendation in Appendix A.2.1 of <xref
            target="RFC6158"></xref>.</t>

            <t>The structure of PSID is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      17</t>

<t hangText="TLV-Length"><vspace />
      6 octets</t>

<t hangText="Data Type"><vspace />
      The attribute PSID is of type "integer" (Section 3.1 
      of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      Contains the PSID (16 bits) right justified, and the unused bits 
      in this field MUST be set to zero.<vspace blankLines="1"/>
      The PSID value algorithmically identifies a set of ports 
      assigned to a CE. The first k bits on the left of this 
      2-octet field are the PSID value. The remaining (16-k) bits 
      on the right are padding zeros.
</t>           </list></t>
          </section>
        </section>
      </section>

      <section anchor="s46-prio-attr" title="Softwire46-Priority Attribute">
        <t>The Softwire46-Priority Attribute includes an ordered list of
        Softwire46 mechanisms allowing the client to prioritize which
        mechanism to use, corresponding to OPTION_S46_PRIORITY defined in
        <xref target="RFC8026"></xref>. The following requirements apply:</t>

        <t><list style="empty">
            <t>The Softwire46-Priority Attribute MAY appear in an
            Access-Accept packet. It MAY also appear in an Access-Request
            packet.</t>

            <t>The Softwire46-Priority Attribute MAY appear in a CoA-Request
            packet.</t>

            <t>The Softwire46-Priority Attribute MAY appear in an
            Accounting-Request packet.</t>

            <t>The Softwire46-Priority Attribute MUST NOT appear in any other
            RADIUS packet.</t>
          </list></t>

        <t>The Softwire46-Priority Attribute is structured as follows:</t>
<t><list style="hanging">
<t hangText="Type"><vspace />
     241</t>

<t hangText="Length"><vspace />
     Indicates the length of this attribute, 
     including the Type, Length, Extended-Type and Value fields.</t>

<t hangText="Extended-Type"><vspace />
     10</t>

<t hangText="TLV-Value"><vspace />
    The attribute includes one or more Softwire46-Option-Code TLVs:
       A Softwire46-Priority Attribute MUST contain at least one 
       Softwire46-Option-Code TLV (<xref target="opc"/>).<vspace blankLines="1"/>

       Softwire46 mechanisms are prioritized in the appearance order
       in the Softwire46-Priority Attribute. That is, 
       the first-appearing mechanism is most preferred.</t>
</list></t>

<t>The Softwire46-Priority Attribute is associated with the following
        identifier: 241.10.</t>

        <section anchor="opc" title="Softwire46-Option-Code">
          <t>This attribute is used to convey an option code assigned to a
          Softwire46 mechanism <xref target="RFC8026"></xref>. This attribute
          is encoded in 32 bits as per the recommendation in Appendix A.2.1 of
          <xref target="RFC6158"></xref>.</t>

          <t>The structure of Softwire46-Option-Code is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      18</t>

<t hangText="TLV-Length"><vspace />
      6 octets</t>

<t hangText="Data Type"><vspace />
      The attribute Softwire46-Option-Code is of type "integer"
     (Section 3.1 of <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace /> 
      A 32-bit IANA-registered option code representing a Softwire46
      mechanism (Softwire46-option-code). The codes and their 
      corresponding Softwire46 mechanisms are listed in <xref target="s46option"/>.</t>
     </list></t>
        </section>
      </section>

      <section anchor="s46-mcast-attr" title="Softwire46-Multicast Attribute">
        <t>The Softwire46-Multicast Attribute conveys the IPv6 prefixes to be
        used to synthesize multicast and unicast IPv4-embedded IPv6 addresses
        as per <xref target="RFC8114"></xref>. This attribute is of type "tlv"
        and contains additional TLVs. The following requirements apply:</t>

        <t><list style="symbols">
            <t>The BNG SHALL use the IPv6 prefixes returned in the RADIUS
            Softwire46-Multicast Attribute to populate the DHCPv6 PREFIX64
            Option <xref target="RFC8115"></xref>.</t>

            <t>This attribute MAY be used in Access-Request packets as a hint
            to the RADIUS server. For example, if the BNG is preconfigured
            for Softwire46-Multicast, these prefixes may be inserted in the
            attribute. The RADIUS server MAY ignore the hint sent by the BNG,
            and it MAY assign a different Softwire46-Multicast Attribute.</t>

            <t>The Softwire46-Multicast Attribute MAY appear in an
            Access-Request, Access-Accept, CoA-Request, and Accounting-Request
            packet.</t>

            <t>The Softwire46-Multicast Attribute MUST NOT appear in any other
            RADIUS packet.</t>

            <t>The Softwire46-Multicast Attribute MAY contain ASM-Prefix64
            (<xref target="TLV0"></xref>), SSM-Prefix64 (<xref
            target="TLV1"></xref>), and U-Prefix64 (<xref
            target="TLV2"></xref>).</t>

            <t>The Softwire46-Multicast Attribute MUST include ASM-Prefix64 or
            SSM-Prefix64, and it MAY include both.</t>

            <t>The U-Prefix64 MUST be present when SSM-Prefix64 is present.
            U-Prefix64 MAY be present when ASM-Prefix64 is present.</t>
          </list></t>

        <t>The Softwire46-Multicast Attribute is structured as follows:</t>

<t><list style="hanging">
<t hangText="Type"><vspace />
     241 (To be confirmed by IANA)</t>

<t hangText="Length"><vspace />
     This field indicates the total length in bytes of all fields of
     this attribute, including the Type, Length, Extended-Type, and the
     entire length of the embedded attributes.</t>

<t hangText="Extended-Type"><vspace />
     11</t>

<t hangText="Value"><vspace />
     This field contains a set of attributes as follows:
<list style="hanging">
<t hangText="ASM-Prefix64"><vspace />
       This attribute contains the Any-Source Multicast (ASM)
       IPv6 prefix. Refer to <xref target="TLV0"/>.</t>

<t hangText="SSM-Prefix64"><vspace />
       This attribute contains the Source-Source Multicast (SSM)
       IPv6 prefix. Refer to <xref target="TLV1"/>.</t>

<t hangText="U-Prefix64"><vspace />
       This attribute contains the IPv4 prefix used for address
       translation. Refer to <xref target="TLV2"/>.</t>
     </list></t></list></t>


        <t>The Softwire46-Multicast Attribute is associated with the following
        identifier: 241.11.</t>
      
        <section anchor="TLV0" title="ASM-Prefix64 Attribute">
          <t>The ASM-Prefix64 attribute is structured as follows:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      19</t>
  
<t hangText="TLV-Length"><vspace />
      16 octets. The length of asm-prefix64 must be /96 <xref target="RFC8115"/>.</t>

<t hangText="Data Type"><vspace />
      The attribute ASM-Prefix64 is of type "ipv6prefix" (Section 3.10 of
      <xref target="RFC8044"/>).</t>

<t hangText="TLV-Value"><vspace />
      This field specifies the IPv6 multicast prefix (asm-prefix64)
      to be used to synthesize the IPv4-embedded IPv6 addresses of the
      multicast groups in the ASM mode. The conveyed multicast IPv6
      prefix MUST belong to the ASM range. </t>
</list></t>

        </section>

        <section anchor="TLV1" title="SSM-Prefix64 Attribute">
          <t>The SSM-Prefix64 attribute is structured as follows:</t>

<t><list style="hanging">
<t hangText="Type"><vspace />
     20</t>

<t hangText="TLV-Length"><vspace />
      16 octets. The length of ssm-prefix64 must be /96 <xref target="RFC8115"/>.</t>

<t hangText="Data Type"><vspace />
      The attribute SSM-Prefix64 is of type "ipv6prefix" (Section 3.10 of
      <xref target="RFC8044"/>).</t>

<t hangText="TLV-Type"><vspace />
      This field specifies the IPv6 multicast prefix (ssm-prefix64)
      to be used to synthesize the IPv4-embedded IPv6 addresses of the
      multicast groups in the SSM mode. The conveyed multicast IPv6
      prefix MUST belong to the SSM range. </t>
</list></t>
        </section>

        <section anchor="TLV2" title="U-Prefix64 Attribute">
          <t>The structure of U-Prefix64 is shown below:</t>

<t><list style="hanging">
<t hangText="TLV-Type"><vspace />
      21</t>

<t hangText="TLV-Length"><vspace />
      4 + length of unicast-prefix. As specified in <xref target="RFC6052"/>, 
      the unicast-prefix prefix length MUST be set to 32, 40, 48,
      56, 64, or 96.</t>
   
<t hangText="Data Type"><vspace />
      The attribute U-Prefix64 is of type "ipv6prefix" (Section 3.10 of
      <xref target="RFC8044"/>).</t>
   
<t hangText="TLV-Value"><vspace />
      This field identifies the IPv6 unicast prefix (u-prefix64) to
      be used in the SSM mode for constructing the IPv4-embedded IPv6
      addresses representing the IPv4 multicast sources in the IPv6
      domain. It may also be used to extract the IPv4 address from the
      received multicast data flows.</t> 
          </list></t>
     </section>
</section>
    </section>

    <section title="A Sample Configuration Process with RADIUS">
      <t><xref target="example"></xref> illustrates how the RADIUS and DHCPv6
      protocols interwork to provide CE with softwire configuration
      information.</t>

      
      <figure align="center" anchor="example"
              title="Interaction between DHCPv6 and AAA Server with RADIUS Authentication">
        <artwork><![CDATA[ 
 CE                             BNG                         AAA Server
 |                               |                               |
 |-------1.DHCPv6 Solicit------->|                               |
 |(ORO with unicast and/or       |                               |
 |    multicast container option |                               |
 |    codes(s))                  |                               |
 |                               |-------2.Access-Request------->|
 |                               |   (Softwire46-Configuration   |
 |                               |       Attribute and/or        |
 |                               |Softwire46-Multicast Attribute)|
 |                               |                               |
 |                               |<------3.Access-Accept---------|
 |                               |   (Softwire46-Configuration   |
 |                               |       Attribute and/or        |
 |                               |Softwire46-Multicast Attribute)|
 |                               |                               |
 |<----4.DHCPv6 Advertisement----|                               |
 |     (container option(s))     |                               |
 |                               |                               |
 |-------5.DHCPv6  Request------>|                               |
 |     (container option(s))     |                               |
 |                               |                               |
 |<--------6.DHCPv6 Reply--------|                               |
 |     (container option(s))     |                               |
 |                               |                               |
              DHCPv6                         RADIUS

]]></artwork>
      </figure>

      <t><list style="numbers">
          <t>The CE creates a DHCPv6 Solicit message. For unicast softwire
          configuration, the message includes an OPTION_REQUEST_OPTION (6)
          with the Softwire46 Container option code(s) as defined in <xref
          target="RFC7598"></xref>. OPTION_S46_CONT_MAPE (94) should be
          included for MAP-E, OPTION_S46_CONT_MAPT (95) for MAP-T, and
          OPTION_S46_CONT_LW (96) for Lightweight 4over6. For multicast
          configuration, the option number for OPTION_V6_PREFIX64 (113) is
          included in the client's Option Request Option (ORO). The message is sent to the BNG.</t>


<!--[rfced]In the following text, what do the numbers (1) and (2) illustrate?  Are these two parts of the RADIUS Access-Request message?  Or are they pointing to the numbers 1 and 2 in Figure 2?

Original:
   2.  On receipt of the Solicit message, the BNG constructs a RADIUS
       Access-Request message containing a User-Name Attribute (1)
       (containing either a CE MAC address, interface-id, or both), a
       User-Password Attribute (2) (with a pre-configured shared
       password between the CE and AAA server as defined in [RFC2865]).

Perhaps (two parts of the message):

   2.  On receipt of the Solicit message, the BNG constructs a RADIUS
       Access-Request message containing (1) a User-Name Attribute
       (containing either a CE MAC address, interface-id, or both) and (2) a
       User-Password Attribute (with a pre-configured shared
       password between the CE and AAA server as defined in [RFC2865]).

-->
	 
          <t>On receipt of the DHCPv6 Solicit message, the BNG constructs a RADIUS
          Access-Request message containing a User-Name Attribute (1)
          (containing either a CE Media Access Control (MAC) address,
	  interface-id, or both) and a
          User-Password Attribute (2) (with a preconfigured shared password
          between the CE and AAA server as defined in <xref
          target="RFC2865"></xref>). The Softwire46-Configuration Attribute
          and/or Softwire46-Multicast Attribute are also included (as
          requested by the client). The resulting message is sent to the AAA
          server.</t>

          <t>The AAA server authenticates the request. If this is successful,
          and a suitable configuration is available, an Access-Accept message
	  is sent to the BNG containing the requested Softwire46-Configuration
          Attribute or Softwire46-Multicast Attribute. It is the
          responsibility of the AAA server to ensure the consistency of the
          provided configuration.</t>

          <t>The BNG maps the received softwire configuration into the
          corresponding fields in the DHCPv6 softwire configuration option(s).
          These are included in the DHCPv6 Advertise message, which is sent to
          the CE.</t>

          <t>The CE sends a DHCPv6 Request message. In the ORO, the option
          codes of any of the required softwire options that were received
          in the DHCPv6 Advertise message are included.</t>

          <t>The BNG sends a DHCPv6 Reply message to the client containing the
          softwire container option(s) enumerated in the ORO.</t>
        </list></t>

      <t>The authorization operation could be done independently after the
      authentication process. In this case, steps 1-5 are completed as above,
      then the following steps are performed:</t>

      <t><list hangIndent="4" style="hanging">
          <t hangText="6a.">When the BNG receives the DHCPv6 Request, it
          constructs a RADIUS Access-Request message, which contains a
          Service-Type Attribute (6) with the value "Authorize Only" (17), the
          corresponding Softwire46-Configuration Attribute, and a State
          Attribute obtained from the previous authentication process
          according to <xref target="RFC5080"></xref>. The resulting message
          is sent to the AAA server.</t>

          <t hangText="7a.">The AAA server checks the authorization request. If it is
          approved, an Access-Accept message is returned to the BNG with the
          corresponding Softwire46-Configuration Attribute.</t>

          <t hangText="8a.">The BNG sends a Reply message to the client
          containing the softwire container options enumerated in the ORO.</t>
        </list></t>

      <t>In addition to the above, the following points need to be
      considered:</t>

      <t><list style="symbols">
          <t>In the configuration message flows described above, the
          Message-Authenticator (type 80) <xref target="RFC2869"></xref>
          should be used to protect both Access-Request and Access-Accept
          messages.</t>

          <t>If the BNG does not receive the corresponding
          Softwire46-Configuration Attribute in the Access-Accept message, it
          may fall back to creating the DHCPv6 softwire configuration options
          using the preconfigured Softwire46 configuration if this is
          present.</t>

          <t>If the BNG receives an Access-Reject from the AAA server, then
          the Softwire46 configuration must not be supplied to the client.</t>

          <t>As specified in <xref target="RFC8415"></xref>, Section 18.2.5
          ("Creation and Transmission of Rebind Messages"), if the DHCPv6 server
          to which the DHCPv6 Renew message was sent at time T1 has not
          responded by time T2, the CE (DHCPv6 client) should enter the Rebind
          state and attempt to contact any available server. In this
          situation, a secondary BNG receiving the DHCPv6 message must
          initiate a new Access-Request message towards the AAA server. The
          secondary BNG includes the Softwire46-Configuration Attribute in
          this Access-Request message.</t>

          <t>For Lightweight 4over6, the CE's binding state needs to be
          synchronized between the clients and the Lightweight AFTR
          (lwAFTR)/BR. This can be achieved in two ways: static
          preconfiguration of the bindings on both the AAA server and lwAFTR
          or on demand, whereby the AAA server updates the lwAFTR with the CE's
          binding state as it is created or deleted.</t>
        </list></t>

      <t>In some deployments, the DHCP server may use the Accounting-Request
      to report the softwire configuration returned to a
      requesting host to a AAA server. It is the responsibility of the DHCP server to ensure
      the consistency of the configuration provided to the requesting hosts.
      Reported data to a AAA server may be required for various operational
      purposes (e.g., regulatory).</t>

      <t>A configuration change (e.g., BR address) may result in an exchange
      of CoA-Requests between the BNG and the AAA server, as shown in <xref
      target="coa"></xref>. Concretely, when the BNG receives a CoA-Request
      message containing Softwire46 attributes, it sends a DHCPv6 Reconfigure
      message to the appropriate CE to inform that CE that an updated
      configuration is available. Upon receipt of such a message, the CE sends a
      DHCPv6 Renew or Information-Request in order to receive the updated
      Softwire46 configuration. In deployments where the BNG embeds a DHCPv6
      relay, CoA-Requests can be used following the procedure specified in
      <xref target="RFC6977"></xref>. </t>

      <t><figure anchor="coa" title="Change of Configuration Example">
          <artwork><![CDATA[       CE                          BNG                       AAA Server
        |                           |                            |
        |---DHCPv6 Solicit--------->|                            |
        |                           |---Access-Request---------->|
        |                           |<--Access-Accept------------|
        |                           |(Softwire46-Configuration   |
        |                           |    Attribute ...)          |
                                  ....
        |                           |                            |
        |                           |<-----CoA-Request-----------|
        |                           |(Softwire46-Configuration   |
        |                           |    Attribute ...)          |
        |                           |------CoA-Response--------->|
        |<--DHCPv6 Reconfigure------|                            |
        |                           |                            |
                                  ....]]></artwork>
        </figure></t>
    </section>

    <section title="Table of Attributes">
      <t>This document specifies three new RADIUS attributes, and their
      formats are as follows:</t>

      <t><list style="symbols">
          <t>Softwire46-Configuration Attribute: 241.9</t>

          <t>Softwire46-Priority Attribute: 241.10</t>

          <t>Softwire46-Multicast Attribute: 241.11</t>
        </list></t>

      <t>Table 3 describes which attributes may be found in which kinds of
      packets and in what quantity.</t>

      <t><figure title="Table 3: Table of Attributes">
          <artwork><![CDATA[Request Accept Reject Challenge Acct CoA-  #       Attribute
                                Req  Req
 0-1     0-1     0      0       0-1  0-1  241.9    Softwire46-
                                                   Configuration
 0-1     0-1     0      0       0-1  0-1  241.10   Softwire46-
                                                   Priority
 0-1     0-1     0      0       0-1  0-1  241.11   Softwire46-
                                                   Multicast
]]></artwork>
        </figure></t>

      <t></t>
    </section>

    <section anchor="Security" title="Security Considerations">
      <t>Section 9 of <xref target="RFC7596"></xref> discusses security issues
      related to Lightweight 4over6, Section 10 of <xref
      target="RFC7597"></xref> discusses security issues related to MAP-E,
      Section 13 of <xref target="RFC7599"></xref> discusses security issues
      related to MAP-T, and Section 9 of <xref target="RFC8114"></xref>
      discusses security issues related to the delivery of IPv4 multicast
      services to IPv4 clients over an IPv6 multicast network.</t>

      <t>This document does not introduce any security issues inherently
      different from those already identified in Section 8 of <xref
      target="RFC2865"></xref> and Section 6 of <xref target="RFC5176"></xref>
      for CoA messages. Known security vulnerabilities of the RADIUS protocol
      discussed in Section 7 of <xref target="RFC2607"></xref> and Section 7
      of <xref target="RFC2869"></xref> apply to this specification. These
      well-established properties of the RADIUS protocol place some
      limitations on how it can safely be used, since there is some inherent
      requirement to trust the counterparty to not misbehave.</t>

      <t>Accordingly, this document targets deployments where a trusted
      relationship is in place between the RADIUS client and server, with
      communication optionally secured by IPsec or Transport Layer Security
      (TLS) <xref target="RFC6614"></xref>. The use of IPsec <xref
      target="RFC4301"></xref> for providing security when RADIUS is carried
      in IPv6 is discussed in <xref target="RFC3162"></xref>.</t>

      <t>Security considerations for interactions between a Softwire46 CE and
      the BNG are discussed in Section 9 of <xref target="RFC7598"></xref>
      (DHCPv6 options for the configuration of Softwire46 address and port-mapped
      clients), Section 3 of <xref target="RFC8026"></xref> (a DHCPv6-based
      Softwire46 prioritization mechanism), and Section 5 of <xref
      target="RFC8115"></xref> (DHCPv6 options for configuration of
      IPv4-embedded IPv6 prefixes).</t>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>IANA has made new code point assignments for RADIUS
      attributes as described in the following subsections. The assignments
      should use the RADIUS registry available at
      &lt;https://www.iana.org/assignments/radius-types/&gt;.</t>

      <section title="New RADIUS Attributes">
        <t>IANA has assigned the attribute types defined
        in this document from the RADIUS namespace as described in the "IANA
        Considerations" section of <xref target="RFC3575"></xref>, in
        accordance with BCP 26 <xref target="RFC8126"></xref>.</t>

        <t>IANA has registered three new RADIUS
        attributes from the "Short Extended Space" section of <xref
        target="RFC6929"></xref>. The attributes are the Softwire46-Configuration
        Attribute, Softwire46-Priority Attribute, and Softwire46-Multicast
        Attribute:</t>

        <figure>
          <artwork><![CDATA[   Type        Description                Data Type   Reference
   ----        -----------                ---------   ---------
   241.9        Softwire46-Configuration   tlv         Section 3.1 
   241.10       Softwire46-Priority        tlv         Section 3.2
   241.11       Softwire46-Multicast       tlv         Section 3.3]]></artwork>
        </figure>
      </section>

      <section title="RADIUS Softwire46 Configuration and Multicast Attributes">
        <t>IANA has created a new registry called "RADIUS
        Softwire46 Configuration and Multicast Attributes".</t>

        <t>All attributes in this registry have one or more parent RADIUS
        attributes in nesting (refer to <xref target="RFC6929"></xref>).</t>

        <t>This registry has been initially populated with the following
        values:</t>

        <t><figure>
            <artwork><![CDATA[Value  Description                     Data Type    Reference
-----  -----------                     ---------    ---------
0      Reserved
1      Softwire46-MAP-E                tlv          Section 3.1.1.1
2      Softwire46-MAP-T                tlv          Section 3.1.1.2
3      Softwire46-Lightweight-4over6   tlv          Section 3.1.1.3 
4      Softwire46-Rule (BMR)           tlv          Section 3.1.3.1
5      Softwire46-Rule (FMR)           tlv          Section 3.1.3.1
6      Softwire46-BR                   ipv6addr     Section 3.1.3.2
7      Softwire46-DMR                  ipv6prefix   Section 3.1.3.3
8      Softwire46-V4V6Bind             tlv          Section 3.1.3.4
9      Softwire46-PORTPARAMS           tlv          Section 3.1.3.5
10     Rule-IPv6-Prefix                ipv6prefix   Section 3.1.4.1
11     Rule-IPv4-Prefix                ipv4prefix   Section 3.1.4.2
12     EA-Length                       integer      Section 3.1.4.3
13     IPv4-Address                    ipv4addr     Section 3.1.5.1
14     Bind-IPv6-Prefix                ipv6prefix   Section 3.1.5.2
15     PSID-Offset                     integer      Section 3.1.6.1
16     PSID-Len                        integer      Section 3.1.6.2
17     PSID                            integer      Section 3.1.6.3
18     Softwire46-Option-Code          integer      Section 3.2.1
19     ASM-Prefix64                    ipv6prefix   Section 3.3.1
20     SSM-Prefix64                    ipv6prefix   Section 3.3.2
21     U-Prefix64                      ipv6prefix   Section 3.3.3
22-255 Unassigned]]></artwork>
          </figure></t>

        <t>The registration procedure for this registry is Standards Action as
        defined in <xref target="RFC8126"></xref>.</t>
      </section>

      <section anchor="s46option" title="Softwire46 Mechanisms and Their Identifying Option Codes">
        <t>The Softwire46-Priority Attribute conveys an ordered list of option
        codes assigned to Softwire46 mechanisms, for which IANA has
        created and will maintain a new registry titled "Option Codes Permitted
        in the Softwire46-Priority Attribute".</t>

        <t>Table 4 shows the initial version of allowed option codes and the
        Softwire46 mechanisms that they represent. The option code for DS-Lite
        is derived from the IANA-allocated RADIUS Attribute Type value for
        DS-Lite <xref target="RFC6519"></xref>. The option codes for MAP-E,
        MAP-T, and Lightweight 4over6 are the TLV-Type values for the MAP-E,
        MAP-T, and Lightweight 4over6 attributes defined in <xref
        target="s46-tlvs"></xref>.</t>

        <figure title="Table 4: Option Codes to S46 Mechanisms">
          <artwork><![CDATA[          +-----------+--------------------+------------+
          |Option Code|Softwire46 Mechanism| Reference  |
          +-----------+--------------------+------------+
          |     1     |        MAP-E       |  RFC 7597  |
          |     2     |        MAP-T       |  RFC 7599  |
          |     3     | Lightweight 4over6 |  RFC 7596  |
          |    144    |      DS-Lite       |  RFC 6519  |
          +-----------+--------------------+------------+
]]></artwork>
        </figure>

        <t>Additional option codes may be added to this list in the future
        using the IETF Review process described in Section 4.8 of <xref
        target="RFC8126"></xref>.</t>
      </section>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include='reference.RFC.2119'?>

      <?rfc include='reference.RFC.2865'?>

      <?rfc include='reference.RFC.3162'?>

      <?rfc include='reference.RFC.8415'?>

      <?rfc include='reference.RFC.3575'?>

      <?rfc include='reference.RFC.5080'?>

      <?rfc include='reference.RFC.8126'?>

      <?rfc include='reference.RFC.6052'?>

      <?rfc include='reference.RFC.6158'?>

      <?rfc include='reference.RFC.6929'?>

      <?rfc include='reference.RFC.8026'?>

      <?rfc include='reference.RFC.8044'?>

      <?rfc include='reference.RFC.8115'?>

      <?rfc include='reference.RFC.8174'?>

      <?rfc include='reference.RFC.5176'?>
    </references>

    <references title="Informative References">
      <?rfc include='reference.RFC.2869'?>

      <?rfc include='reference.RFC.6614'?>

      <?rfc include='reference.RFC.7596'?>

      <?rfc include='reference.RFC.8114'?>

      <?rfc include='reference.RFC.7597'?>

      <?rfc include='reference.RFC.7598'?>

      <?rfc include='reference.RFC.7599'?>

      <?rfc include='reference.RFC.2607'?>

      <?rfc include='reference.RFC.7991'?>

      <?rfc include='reference.RFC.4301'?>

      <?rfc include='reference.RFC.6346'?>

      <?rfc include='reference.RFC.6333'?>

      <?rfc include='reference.RFC.6519'?>

      <?rfc include='reference.RFC.6977'?>

<!-- <?rfc include='reference.I-D.wang-radext-multicast-radius-ext'?>; Expired -->

<reference anchor='RADIUS-EXT'>
<front>
<title>RADIUS Extensions for IPv4-Embedded Multicast and Unicast IPv6 Prefixes</title>

<author initials='Q' surname='Wang' fullname='Qian Wang'>
    <organization />
</author>

<author initials='W' surname='Meng' fullname='Wei Meng'>
    <organization />
</author>

<author initials='C' surname='Wang' fullname='Cui Wang'>
    <organization />
</author>

<author initials='M' surname='Boucadair' fullname='Mohamed Boucadair'>
    <organization />
</author>

<date month='December' year='2015' />

</front>

<seriesInfo name='Work in Progress,' value='draft-wang-radext-multicast-radius-ext-00' />
</reference>


<!--  <?rfc include='reference.I-D.sun-softwire-lw4over6-radext'?>; Expired -->
<reference anchor='LIGHTWEIGHT-4OVER6'>
<front>
<title>Radius Extension for Lightweight 4over6</title>

<author initials='C' surname='Xie' fullname='Chongfeng Xie'>
    <organization />
</author>

<author initials='Q' surname='Sun' fullname='Qi Sun'>
    <organization />
</author>

<author initials='Q' surname='Sun' fullname='Qiong Sun'>
    <organization />
</author>

<author initials='C' surname='Zhou' fullname='Cathy Zhou'>
    <organization />
</author>

<author initials='T' surname='Tsou' fullname='Tina Tsou'>
    <organization />
</author>

<author initials='Z' surname='Liu' fullname='ZiLong Liu'>
    <organization />
</author>

<date month='March' year='2014' />

</front>

<seriesInfo name='Work in Progress,' value='draft-sun-softwire-lw4over6-radext-01' />
</reference>


    </references>

    <section anchor="tlv-field-map" title="DHCPv6 to RADIUS Field Mappings">
      <t>The following sections detail the mappings between the softwire
      DHCPv6 option fields and the relevant RADIUS attributes as defined in
      this document.</t>

      <section title="OPTION_S46_RULE (89) to Softwire46-Rule Sub-TLV Field Mappings">
        <t></t>
    <texttable>
          <ttcol align="center">OPTION_S46_RULE Field</ttcol>

          <ttcol align="center">Softwire46-Rule Name</ttcol>

          <ttcol align="center">TLV Subfield</ttcol>

          <c>flags</c>

          <c>N/A</c>

          <c>TLV-type (4, 5)</c>

          <c>ea-len</c>

          <c>EA-Length</c>

          <c>EA-len</c>

          <c>prefix4-len</c>

          <c>Rule-IPv4-Prefix</c>

          <c>Prefix-Length</c>

          <c>ipv4-prefix</c>

          <c>Rule-IPv4-Prefix</c>

          <c>rule-ipv4-prefix</c>

          <c>prefix6-len</c>

          <c>Rule-IPv6-Prefix</c>

          <c>Prefix-Length</c>

          <c>ipv6-prefix</c>

          <c>Rule-IPv6-Prefix</c>

          <c>rule-ipv6-prefix</c>
        </texttable>
      </section>

      <section title="OPTION_S46_BR (90) to Softwire46-BR Field Mappings">
        <texttable>
          <ttcol align="center">OPTION_S46_BR Field</ttcol>

          <ttcol align="center">Softwire46-BR Subfield</ttcol>

          <c>br-ipv6-address</c>

          <c>br-ipv6-address</c>
        </texttable>
      </section>

      <section title="OPTION_S46_DMR (91) to Softwire46-DMR">
        <texttable>
          <ttcol align="center">OPTION_S46_BR Field</ttcol>

          <ttcol align="center">Softwire46-DMR Subfield</ttcol>

          <c>dmr-prefix6-len</c>

          <c>dmr-prefix6-len</c>

          <c>dmr-ipv6-prefix</c>

          <c>dmr-ipv6-prefix</c>
        </texttable>
      </section>

      <section title="OPTION_S46_V4V6BIND (92) to Softwire46-V4V6Bind">
        <texttable>
          <ttcol align="center">OPTION_S46_V4V6BIND Field</ttcol>

          <ttcol align="center">Softwire46-V4V6Bind Name</ttcol>

          <ttcol align="center">TLV Subfield</ttcol>

          <c>ipv4-address</c>

          <c>IPv4-Address</c>

          <c>ipv4-address</c>

          <c>bindprefix6-len</c>

          <c>Bind-IPv6-Prefix</c>

          <c>Prefix-Length</c>

          <c>bind-ipv6-prefix</c>

          <c>Bind-IPv6-Prefix</c>

          <c>bind-ipv6-prefix</c>
        </texttable>
      </section>

      <section title="OPTION_S46_PORTPARAMS (93) to Softwire46-PORTPARAMS Field Mappings">
        <texttable>
          <ttcol align="center">OPTION_S46_PORTPARAMS Field</ttcol>

          <ttcol align="center">Softwire46-PORTPARAMS Name</ttcol>

          <ttcol align="center">TLV Subfield</ttcol>

          <c>offset</c>

          <c>PSID-Offset</c>

          <c>PSID-Offset</c>

          <c>PSID-len</c>

          <c>PSID-Len</c>

          <c>PSID-len</c>

          <c>PSID</c>

          <c>PSID</c>

          <c>PSID</c>
        </texttable>
      </section>

      <section title="OPTION_S46_PRIORITY (111) to Softwire46-PORTPARAMS Field Mappings">
        <texttable>
          <ttcol align="center">OPTION_S46_PRIORITY Field</ttcol>

          <ttcol align="center">Softwire46-Priority Attribute Subfield</ttcol>

          <c>s46-option-code</c>

          <c>Softwire46-option-code</c>
        </texttable>
      </section>

      <section title="OPTION_V6_PREFIX64 (113) to Softwire46-Multicast Attribute Field Mappings">
        <texttable>
          <ttcol align="center">OPTION_V6_PREFIX64 Field</ttcol>

          <ttcol align="center">Softwire46-Multicast Attribute TLV
          Name</ttcol>

          <ttcol align="center">TLV Subfield</ttcol>

          <c>asm-length</c>

          <c>ASM-Prefix64</c>

          <c>Prefix-Length</c>

          <c>ASM_mPrefix64</c>

          <c>ASM-Prefix64</c>

          <c>asm-prefix64</c>

          <c>ssm-length</c>

          <c>SSM-Prefix64</c>

          <c>Prefix-Length</c>

          <c>SSM_mPrefix64</c>

          <c>SSM-Prefix64</c>

          <c>ssm-prefix64</c>

          <c>unicast-length</c>

          <c>U-Prefix64</c>

          <c>Prefix-Length</c>

          <c>uPrefix64</c>

          <c>U-Prefix64</c>

          <c>u-prefix64</c>
        </texttable>
      </section>
    </section>

       <section anchor="Acknowledgements" title="Acknowledgements" numbered="no">
      <t>The authors would like to thank Peter Lothberg, Wojciech Dec, Ian
      Farrer, Suresh Krishnan, Qian Wang, Wei Meng, Cui Wang, Alan Dekok,
      Stefan Winter, and Yu Tianpeng for their valuable comments regarding this
      document.</t>

      <t>This document was merged with <xref
      target="LIGHTWEIGHT-4OVER6"></xref> and <xref
      target="RADIUS-EXT"></xref>. Thanks to
      everyone who contributed to this document.</t>

      <t>This document was produced using the xml2rfc tool <xref
      target="RFC7991"></xref>.</t>

      <t>Many thanks to Al Morton, Bernie Volz, Joel Halpern, and Donald
      Eastlake for the review.</t>
       </section>
       
    <section title="Contributors" numbered="no">
<t>
Bing Liu<vspace />
Huawei Technologies Co., Ltd.<vspace />
Q14, Huawei Campus, No.156 Beiqing Road<vspace />
Hai-Dian District, Beijing, 100095<vspace />
China<vspace blankLines="1" />

Email: leo.liubing@huawei.com
</t>
<t>
Peter Deacon<vspace />
IEA Software, Inc.<vspace />
P.O. Box 1170<vspace />
Veradale, WA  99037<vspace />
United States of America<vspace blankLines="1" />

Email: peterd@iea-software.com
</t>
<t>
Qiong Sun<vspace />
China Telecom<vspace />
Beijing<vspace />
China<vspace blankLines="1" />

Email: sunqiong@ctbri.com.cn
</t>
<t>
Qi Sun<vspace />
Tsinghua University<vspace />
Department of Computer Science, Tsinghua University<vspace />
Beijing 100084<vspace />
China<vspace blankLines="1" />

Phone: +86-10-6278-5822<vspace />
   
Email: sunqibupt@gmail.com
</t>
<t>
Cathy Zhou<vspace />
Huawei Technologies<vspace />
Bantian, Longgang District<vspace />
Shenzhen 518129<vspace />
China<vspace blankLines="1" />
   
Email: cathy.zhou@huawei.com
</t>
<t>
Tina Tsou<vspace />
Huawei Technologies (USA)<vspace />
2330 Central Expressway<vspace />
Santa Clara, CA 95050<vspace />
United States of America<vspace blankLines="1" />

Email: Tina.Tsou.Zouting@huawei.com
</t>
<t>
ZiLong Liu<vspace />
Tsinghua University<vspace />
Beijing 100084<vspace />
China<vspace blankLines="1" />

Phone: +86-10-6278-5822<vspace />

Email: liuzilong8266@126.com
</t>
<t>
Yong Cui<vspace />
Tsinghua University<vspace />
Beijing 100084<vspace />
China<vspace blankLines="1" />

Phone: +86-10-62603059<vspace />

Email: yong@csnet1.cs.tsinghua.edu.cn
</t>
    </section>

  </back>
</rfc>
