<?xml version="1.0" encoding="US-ASCII"?>

<!--<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>-->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc rfcedstyle="yes" ?>
<?rfc toc="yes"?>
<!--<?rfc compact="no"?>-->
<?rfc subcompact="no"?>
<?rfc symrefs="no"?>
<?rfc sortrefs="yes"?>
<!-- ?rfc strict="yes"? -->

<rfc number="4888" category="info">

<!---------------------------------------------------------------------------->
<!-- FRONT: Title, Authors, Abstract ----------------------------------------->
<!---------------------------------------------------------------------------->

<front>
<title abbrev='NEMO RO Problem Statement'>
  Network Mobility Route Optimization Problem Statement
</title>

<!-- Insert a link to your own authors XML -->
 <author fullname="Chan-Wah Ng" initials="C."
            surname="Ng">
<!-- chanwah: EDIT -->
      <!-- organization>Panasonic Singapore Labs</organization -->
      <organization abbrev="Panasonic Singapore Labs">Panasonic Singapore Laboratories Pte Ltd</organization>
<!-- chanwah: END EDIT -->
      <address>
        <postal>
          <street>Blk 1022 Tai Seng Ave #06-3530</street>
          <city>Tai Seng Industrial Estate</city>
          <region>Singapore</region>
          <code>534415</code>
          <country>SG</country>
        </postal>
        <phone>+65 65505420</phone>
        <email>chanwah.ng@sg.panasonic.com</email>
      </address>
    </author>

 <author fullname="Pascal Thubert" initials="P."
            surname="Thubert">
      <organization>Cisco Systems</organization>
      <address>
        <postal>
          <street>Village d'Entreprises Green Side</street>
	  <street>400, Avenue de Roumanille</street>
          <city>Batiment T3</city>
          <region>Biot - Sophia Antipolis</region>
          <code>06410</code>
          <country>FRANCE</country>
        </postal>
        <email>pthubert@cisco.com</email>
      </address>
    </author>

 <author fullname="Masafumi Watari" initials="M."
            surname="Watari">
<!-- watari: EDIT -->
      <!-- organization>KDDI R&D Labs</organization -->
      <organization abbrev="KDDI R&D Labs">KDDI R&D Laboratories Inc.</organization>
<!-- watari: END EDIT -->
      <address>
        <postal>
          <street>2-1-15 Ohara</street>
          <city>Fujimino</city>
          <region>Saitama</region>
          <code>356-8502</code>
          <country>JAPAN</country>
        </postal>
        <email>watari@kddilabs.jp</email>
      </address>
    </author>

 <author fullname="Fan Zhao" initials="F."
            surname="Zhao">
      <organization>UC Davis</organization>
      <address>
        <postal>
          <street>One Shields Avenue</street>
          <city>Davis</city>
          <region>CA</region>
          <code>95616</code>
          <country>US</country>
        </postal>
        <phone>+1 530 752 3128</phone>
<!-- chanwah: EDIT -->
        <email>fanzhao@ucdavis.edu</email>
<!-- chanwah: END EDIT -->
      </address>
    </author>

<date month="April" year="2007" />

<area>Internet</area>
<workgroup>NEMO Working Group</workgroup>

<keyword>MIPv6</keyword>
<keyword>Mobile IP</keyword>
<keyword>NEMO</keyword>
<keyword>Route Optimization</keyword>

<abstract>

<t>
  With current Network Mobility (NEMO) Basic Support, all 
  communications to and from Mobile Network Nodes must go through the
  bi-directional tunnel established between the Mobile Router and Home
  Agent when the mobile network is away.  This sub-optimal routing results in
  various inefficiencies associated with packet delivery, such as
  increased delay and bottleneck links leading to traffic congestion, 
  which can ultimately disrupt all communications to and from the 
  Mobile Network Nodes.  Additionally, with nesting of Mobile Networks, 
  these inefficiencies get compounded, and stalemate conditions may occur
  in specific dispositions.  
  This document investigates such problems and provides
  the motivation behind Route Optimization (RO) for NEMO.
</t>

</abstract>

</front>


<!---------------------------------------------------------------------------->
<!-- MIDDLE: Main Text ------------------------------------------------------->
<!---------------------------------------------------------------------------->

<middle>

<!---------------------------------------------------------------------------->
<!-- SECTION 1:  INTRODUCTION ------------------------------------------------>
<!---------------------------------------------------------------------------->
<section anchor='sec:intro'
	title="Introduction">

<t>
  With current Network Mobility (NEMO) Basic Support <xref target="RFC3963"/>,
  all communications to and from nodes in a mobile network must go through the
  bi-directional tunnel established between the Mobile Router and its
  Home Agent (also known as the MRHA tunnel) when the mobile network is away.
  Although such an arrangement allows Mobile Network Nodes to reach
  and be reached by any node on the Internet, limitations
  associated to the base protocol degrade overall performance of the
  network and, ultimately, can prevent all communications to and from
  the Mobile Network Nodes.
</t>
<t>
  Some of these concerns already exist with Mobile IPv6 <xref target="RFC3775"/>
  and were
  addressed by the mechanism known as Route Optimization, which is part
  of the base protocol.  With Mobile IPv6, Route Optimization mostly improves
  the end-to-end path between the Mobile Node and Correspondent Node, with an
  additional benefit of reducing the load of the Home Network, thus its name.
</t>
<t>
  NEMO Basic Support presents a number of additional issues,
  making the problem more complex, so it was decided to address
  Route Optimization separately.  In that case, the expected benefits
  are more dramatic, and a Route Optimization mechanism
  could enable connectivity that would be broken otherwise.  In that
  sense, Route Optimization is even more important to NEMO Basic Support
  than it is to Mobile IPv6.
</t>
<t>
  This document explores limitations inherent in NEMO Basic Support, and their
  effects on communications between a Mobile Network Node and its corresponding
  peer.  This is detailed in <xref target="sec:problem"/>.
  It is expected that readers are familiar with general terminologies
  related to mobility in <xref target="RFC3775"/><xref target="RFC3753"/>,
  NEMO-related terms defined in <xref target="RFC4885"/>,
  and NEMO goals and requirements <xref target="RFC4886"/>.
</t>

</section> <!-- EndSect: Intro -->


<!---------------------------------------------------------------------------->
<!-- SECTION 2:  PROBLEM ----------------------------------------------------->
<!---------------------------------------------------------------------------->
<section anchor='sec:problem'
	title="NEMO Route Optimization Problem Statement">

<t>
  Given the NEMO Basic Support protocol, all data packets
  to and from Mobile Network Nodes must go through the Home Agent, 
  even though a shorter path may exist between the Mobile Network Node and 
  its Correspondent Node.  In addition, with the nesting of Mobile Routers,
  these data packets must go through multiple Home Agents and several 
  levels of encapsulation, which may be avoided.  This results in various
  inefficiencies and problems with packet delivery, which can ultimately 
  disrupt all communications to and from the Mobile Network Nodes.
</t>
<t>
  In the following sub-sections, we will describe the effects of a pinball
  route with NEMO Basic Support, how it may cause a bottleneck to be formed
  in the Home Network, and how these get amplified with nesting of
  mobile networks.   Closely related to nesting, we will also look into
  the sub-optimality even when Mobile IPv6 Route Optimization is used over
  NEMO Basic Support.  This is followed by a description of security policy in
  the Home Network that may forbid transit traffic from Visiting Mobile Nodes
  in mobile networks.  In addition, we will explore the impact of the MRHA
  tunnel on communications between two Mobile Network Nodes on different
  links of the same mobile network.  We will also provide additional motivations
  for Route Optimization by considering the potential stalemate situation when
  a Home Agent is part of a mobile network.
</t>

<vspace blankLines='1'/>

<section anchor='sec:problem.sub-optimal'
	title="Sub-Optimality with NEMO Basic Support">

<t>
  With NEMO Basic Support, all packets sent between a Mobile Network Node
  and its Correspondent Node are forwarded through the MRHA tunnel,
  resulting in a pinball route between the two nodes.
  This has the following sub-optimal effects:

  <list style="symbols">
  <t>
    Longer Route Leading to Increased Delay and Additional Infrastructure Load
<!-- RFC Editor Comment: should this read "a longer route
that leads to increased delay and additional infrastructure load"? -->
<!-- chanwah: I'm not a native speaker, but I think both are fine.  The 
original text is shorter though -->
    <vspace blankLines='1'/>
    Because a packet must transit from a mobile network to the Home Agent
    then to the Correspondent Node, the transit time of the packet is usually
    longer than if the packet were to go straight from the mobile network to
    the Correspondent Node.
    When the Correspondent Node (or the mobile network) resides near 
    the Home Agent, the increase in packet delay can be very small. 
    However, when the mobile network and the Correspondent Node are 
    relatively near to one another but far away from the Home Agent on 
    the Internet, the increase in delay is very large.
    Applications such as real-time multimedia streaming may not be able to
    tolerate such increase in packet delay.
    In general, the increase in delay may also impact the performance of
    transport protocols such as TCP, since the sending rate of TCP is 
    partly determined by the round-trip time (RTT) perceived by the 
    communication peers.
    <vspace blankLines='1'/>
    Moreover, by using a longer route, the total resource utilization for
    the traffic would be much higher than if the packets were to follow a
    direct path between the Mobile Network Node and Correspondent Node.
    This would result in additional load in the infrastructure.
  </t>
  <t>
    Increased Packet Overhead
    <vspace blankLines='1'/>
    The encapsulation of packets in the MRHA tunnel results in increased
    packet size due to the addition of an outer header.  This reduces the
    bandwidth efficiency, as an IPv6 header can be quite substantial
    relative to the payload for applications such as voice samples.
    For instance, given a voice application using an 8 kbps algorithm (e.g.,
    G.729) and taking a voice sample every 20 ms (as in RFC 1889 <xref target="RFC1889"/>), the packet
    transmission rate will be 50 packets per second.   Each additional IPv6
    header is an extra 320 bits per packet (i.e., 16 kbps), which is twice the
    actual payload!
  </t>
  <t>
    Increased Processing Delay
    <vspace blankLines='1'/>
    The encapsulation of packets in the MRHA tunnel also results in increased
    processing delay at the points of encapsulation and decapsulation.
    Such increased processing may include encryption/decryption,
    topological correctness verifications, MTU computation,
    fragmentation, and reassembly.
  </t>
  <t>
    Increased Chances of Packet Fragmentation
    <vspace blankLines='1'/>
    The augmentation in packet size due to packet encapsulation may increase
    the chances of the packet being fragmented along the MRHA tunnel.
    This can occur if there is no prior path MTU discovery conducted,
    or if the MTU discovery mechanism did not take into account the
    encapsulation of packets.  Packet fragmentation will result in a
    further increase in packet delays and further reduction of bandwidth
    efficiency.
  </t>
  <t>
    Increased Susceptibility to Link Failure
    <vspace blankLines='1'/>
    Under the assumption that each link has the same probability of link
    failure, a longer routing path would be more susceptible to link
    failure.  Thus, packets routed through the MRHA tunnel may be
    subjected to a higher probability of being lost or delayed due to
    link failure, compared to packets that traverse directly between the
    Mobile Network Node and its Correspondent Node.
  </t>
  </list>
</t>

</section> <!-- EndSect: Problem -- Sub-Optimality -->

<vspace blankLines='10'/>

<section anchor='sec:problem.home-bottleneck'
	title="Bottleneck in the Home Network">

<t>
  Apart from the increase in packet delay and infrastructure load, forwarding packets
  through the Home Agent may also lead to either the Home Agent or the Home Link
  becoming a bottleneck for the aggregated traffic from/to all the Mobile Network
  Nodes.  A congestion at home would lead to additional packet delay, or even packet loss.
  In addition, Home Agent operations such as security check, packet interception,
  and tunneling might not be as optimized in the Home Agent software as plain
  packet forwarding.  This could further limit the Home Agent capacity for data
  traffic.
  Furthermore, with all traffic having to pass through the Home Link, the
  Home Link becomes a single point of failure for the mobile network.
</t>

<t>
  Data packets that are delayed or discarded due to congestion at the
  Home Network would cause additional performance degradation to
  applications.  Signaling packets, such as Binding Update messages, 
  that are delayed
  or discarded due to congestion at the Home Network may affect the
  establishment or update of bi-directional tunnels, causing disruption
  of all traffic flow through these tunnels.
</t>

<t>
  A NEMO Route Optimization mechanism that allows the Mobile Network Nodes
  to communicate with their Correspondent Nodes via a path that is different
  from the MRHA tunneling and thereby avoiding the Home Agent may alleviate
  or even prevent the congestion at the Home Agent or Home Link.
</t>

</section> <!-- EndSect: Problem -- Home Bottleneck -->

<vspace blankLines='1'/>

<section anchor='sec:problem.nested'
	title="Amplified Sub-Optimality in Nested Mobile Networks">

<t>
  By allowing other mobile nodes to join a mobile network,
  and in particular mobile routers, it is possible to
  form arbitrary levels of nesting of mobile networks.  With such nesting,
  the use of NEMO Basic Support further amplifies the sub-optimality of routing.
  We call this the amplification effect of nesting, where the undesirable effects
  of a pinball route
  with NEMO Basic Support are amplified with each level of nesting of mobile
  networks.  This is best illustrated by an example shown in
  <xref target="fig:new-nested-example"/>.
</t>

<vspace blankLines='1'/>
<figure anchor="fig:new-nested-example"
	title="An Example of a Nested Mobile Network">
<artwork><![CDATA[
            +--------+  +--------+  +--------+  +--------+
            | MR2_HA |  | MR3_HA |  | MR4_HA |  | MR5_HA |
            +------+-+  +---+----+  +---+----+  +-+------+
                    \       |           |        /
     +--------+    +------------------------------+
     | MR1_HA |----|         Internet             |-----CN1
     +--------+    +------------------------------+
                                 |
                             +---+---+
                   root-MR   |  MR1  |
                             +-------+
                              |     |
                       +-------+   +-------+
              sub-MR   |  MR2  |   |  MR4  |
                       +---+---+   +---+---+
                           |           |
                       +---+---+   +---+---+
              sub-MR   |  MR3  |   |  MR5  |
                       +---+---+   +---+---+
                           |           |
                       ----+----   ----+----
                          MNN         CN2
]]></artwork>
</figure>
<vspace blankLines='1'/>
<t>
  Using NEMO Basic Support, the flow of packets between a
  Mobile Network Node, MNN, and a Correspondent Node, CN1, would need to
  go through three separate
  tunnels, illustrated in <xref target="fig:nested-tunnel"/> below.
</t>

<vspace blankLines='1'/>
<figure anchor='fig:nested-tunnel'
	title="Nesting of Bi-Directional Tunnels">
<artwork><![CDATA[
                             ----------.
                   ---------/         /----------.
           -------/        |         |          /-------
 MNN -----( -  - | -  -  - | -  -  - | -  -  - |  -  - (------ CN1
        MR3-------\        |         |          \-------MR3_HA
                 MR2--------\         \----------MR2_HA
                           MR1---------MR1_HA
]]></artwork>
</figure>
<vspace blankLines='10'/>

<t>
  This leads to the following problems:
  <list style="symbols">
  <t>
    Pinball Route
    <vspace blankLines='1' />
    Both inbound and outbound packets will flow via the Home Agents of all
    the Mobile Routers on their paths within the mobile network,
    with increased latency, less resilience, and more bandwidth usage.

    <xref target="sec:nestconf"/> illustrates in detail the packets' routes
    under different nesting configurations of the Mobile Network Nodes.
  </t>
  <t>
    Increased Packet Size
    <vspace blankLines='1' />
    An extra IPv6 header is added per level of nesting to all the
    packets. The header compression suggested in <xref
    target='ENCAP-ADDR'/> cannot be applied
    because both the source and destination (the intermediate Mobile Router and its
    Home Agent) are different hop to hop.
  </t>
  </list>
  Nesting also amplifies the probability of congestion at the Home Networks of the
  upstream Mobile Routers.  In addition, the Home Link of each upstream Mobile
  Router will also be a single point of failure for the nested Mobile Router.
</t>

</section> <!-- EndSect: Problem -- Nested NEMO -->

<vspace blankLines='1'/>

<section anchor='sec:problem.mipv6'
	title="Sub-Optimality with Combined Mobile IPv6 Route Optimization" >

<t>
  When a Mobile IPv6 host joins a mobile network, it becomes a
  Visiting Mobile Node of the mobile network.  Packets sent to and
  from the Visiting Mobile Node will have to be routed not only via the
  Home Agent of the Visiting Mobile Node, but also via the Home Agent of
  the Mobile Router in the mobile network.  This suffers the same
  amplification effect of nested mobile network mentioned in
  <xref target="sec:problem.nested"/>.
</t>

<t>
  In addition, although Mobile IPv6 <xref target="RFC3775"/> allows a mobile
  host to perform Route Optimization with its Correspondent Node in order to avoid
  tunneling with its Home Agent, the "optimized" route is no longer optimized
  when the mobile host is attached to a mobile network.  This is because the
  route between the mobile host and its Correspondent Node is subjected to the
  sub-optimality introduced by the MRHA tunnel.  Interested readers may refer
  to <xref target="sec:nestconf"/> for examples of how the routes
  will appear with nesting of Mobile IPv6 hosts in mobile networks.
</t>

<t>
  The readers should also note that the same sub-optimality would apply
  when the mobile host is outside the mobile network and its Correspondent Node
  is in the mobile network.
</t>

</section> <!-- EndSect: Problem -- MIPv6 Host -->

<vspace blankLines='1'/>

<section anchor='sec:problem.visiting-traffic'
	title="Security Policy Prohibiting Traffic from Visiting Nodes">

<t>
  NEMO Basic Support requires all traffic from visitors to be tunneled to
  the Mobile Router's Home Agent.  This might represent a breach in the
  security of the Home Network (some specific attacks against the Mobile
  Router's binding by rogue visitors have been documented in
  <xref target="NEMO-THREATS"/><xref
    target="THREAT-ANALYSIS"/>).  
  Administrators might thus fear that malicious packets will be
  routed into the Home Network via the bi-directional tunnel. As a
  consequence, it can be expected that in many deployment scenarios,
  policies will be put in place to prevent unauthorized Visiting Mobile
  Nodes from attaching to the Mobile Router.
</t>
<t>
  However, there are
  deployment scenarios where allowing unauthorized Visiting Mobile Nodes
  is actually desirable.  For instance, 
  when Mobile Routers attach to other Mobile Routers and form a nested
  NEMO, they depend on each other to reach the Internet.  When Mobile
  Routers have no prior knowledge of one another (no security association,
  Authentication, Authorization, and Accounting (AAA), Public-Key
  Infrastructure (PKI), etc.), it could still be acceptable to forward packets,
  provided that the packets are not tunneled back to the Home Networks.
</t>
<t>
  A Route Optimization mechanism that allows traffic from Mobile Network
  Nodes to bypass the bi-directional tunnel between a Mobile Router and
  its Home Agent would be a necessary first step towards a Tit for Tat
  model, where MRs would benefit from a reciprocal altruism, based on
  anonymity and innocuousness, to extend the Internet infrastructure
  dynamically.
</t>
</section> <!-- EndSect: Problem -- VMN Traffic -->

<vspace blankLines='1'/>

<section anchor='sec:problem.intra-nemo'
	title="Instability of Communications within a Nested Mobile Network">

<t>
  Within a nested mobile network, two Mobile Network Nodes
  may communicate with each other.  Let us consider
  the previous example illustrated in <xref target="fig:new-nested-example"/>
  where MNN and CN2 are sharing a communication session.  With NEMO Basic
  Support, a packet sent from MNN to CN2 will need to be forwarded to
  the Home Agent of each Mobile Router before reaching CN2, whereas, a
  packet following the direct path between them need not even leave the
  mobile network.  Readers are referred to <xref target="app:B.3"/> for
  detailed illustration of the resulting routing paths.
</t>

<t>
  Apart from the consequences of increased packet delay and packet size,
  which are discussed in previous sub-sections, there are two additional effects
  that are undesirable:
  <list style="symbols">
  <t>
  when the nested mobile network is disconnected from the Internet (e.g.,
  MR1 loses its egress connectivity), MNN and CN2 can no longer communicate
  with each other, even though the direct path from MNN to CN2 is unaffected;
  </t>
  <t>
  the egress link(s) of the root Mobile Router (i.e., MR1) becomes a bottleneck 
  for all the traffic that is coming in and out of the nested mobile network.
  </t>
  </list>
</t>
<t>
  A Route Optimization mechanism could allow traffic between two Mobile Network
  Nodes nested within the same mobile network to follow a direct path between
  them, without being routed out of the mobile network.  This may also
  off-load the processing burden of the upstream Mobile Routers when the direct
  path between the two Mobile Network Nodes does not traverse these Mobile Routers.
</t>

</section> <!-- EndSect: Problem -- Intra-NEMO -->

<vspace blankLines='1'/>

<section anchor='sec:problem.ha-in-nemo'
	title="Stalemate with a Home Agent Nested in a Mobile Network">

<t>
  Several configurations for the
  Home Network are described in <xref target="RFC4887"/>.
  In particular, there is a mobile home scenario where a (parent)
  Mobile Router is also a Home Agent for its mobile network.
  In other words, the mobile network is itself an aggregation of Mobile
  Network Prefixes assigned to (children) Mobile Routers.
</t>

<t>
  A stalemate situation exists
  in the case where the parent Mobile Router visits one of its children.
  The child Mobile Router cannot find its Home Agent in the Internet
  and thus cannot establish its MRHA tunnel and forward the visitor's traffic.
  The traffic from the parent is thus blocked from reaching the Internet, and
  it will never bind to its own (grandparent) Home Agent.
  <xref target='sec:stalemate-eg'/> gives a detailed illustration of how 
  such a situation can occur.
</t>

<t>
  Then again, a Route Optimization mechanism that bypasses the nested tunnel 
  might enable
  the parent traffic to reach the Internet and let it bind.  At that point,
  the child Mobile Router would be able to reach its parent and bind in turn.
  Additional nested Route Optimization solutions might also enable the child to 
  locate its Home Agent in the nested structure and bind regardless of whether
  or not the Internet is reachable.
</t>

</section> <!-- EndSect: Problem -- HA-in-NEMO -->

</section> <!-- EndSect: Problem -->

<!--------------------------------------------------------------------------->
<!-- SECTION 3:  CONCLUSION  ------------------------------------------------>
<!--------------------------------------------------------------------------->
<section anchor='sec:conclusion'
	title="Conclusion">

<t>
  With current NEMO Basic Support, all communications to
  and from Mobile Network Nodes must go through the MRHA tunnel when the
  mobile network is away.  This results in various inefficiencies associated
  with packet delivery.  This document investigates such inefficiencies
  and provides the motivation behind Route Optimization for NEMO.
</t>
<?rfc needLines="5" ?>
<t>
  We have described the sub-optimal effects of pinball
  routes with NEMO Basic Support, how they may cause a bottleneck to be formed
  in the Home Network, and how they get amplified with nesting of
  mobile networks.  These effects will also be seen even when Mobile IPv6
  Route Optimization is used over NEMO Basic Support.  In addition, other issues
  concerning the nesting of mobile networks that might provide additional motivation
  for a NEMO Route Optimization mechanism were also explored, such as
  the prohibition of forwarding traffic from a Visiting Mobile Node
  through an MRHA tunnel due to security concerns, the impact of the MRHA tunnel on
  communications between two Mobile Network Nodes on different links of the same
  mobile network, and the possibility of a stalemate situation when
  Home Agents are nested within a mobile network.
</t>

</section> <!-- EndSect: Conclusion -->

<?rfc compact="yes"?>
<!--vspace blankLines='1'/-->

<!--------------------------------------------------------------------------->
<!-- SECTION:  IANA CONSIDERATION  ------------------------------------------>
<!--------------------------------------------------------------------------->
<!--<section anchor='sec:IANA'
	title="IANA Considerations">
<t>
  This is an informational document and does not require any IANA action.
</t>
</section>-->

<!--vspace blankLines='1'/-->

<!--------------------------------------------------------------------------->
<!-- SECTION:  SECURITY CONSIDERATION  ------------------------------------------>
<!--------------------------------------------------------------------------->
<section anchor='sec:security'
	title="Security Considerations">
<t>
   This document highlights some limitations of NEMO Basic Support. 
   In particular, some security concerns could prevent interesting
   applications of the protocol, as detailed in 
   <xref target="sec:problem.visiting-traffic"/>.
</t>
<t> 
   Route Optimization for RFC 3963 <xref target="RFC3963"/>
   might introduce new threats, just as it might
   alleviate existing ones.  This aspect will certainly be a key criterion
   in the evaluation of the proposed solutions.
</t>
</section>

<?rfc compact="no"?>

<!--vspace blankLines='1'/-->

<!---------------------------------------------------------------------------->
<!-- SECTION:  ACKNOWLEDGMENT  ----------------------------------------------->
<!---------------------------------------------------------------------------->
<section anchor='sec:ack'
	title="Acknowledgments">

<t>
  The authors wish to thank the co-authors of previous versions from which this
  document is derived: Marco Molteni, Paik Eun-Kyoung, Hiroyuki Ohnishi, Thierry Ernst,
  Felix Wu, and Souhwan Jung.  Early work by Masafumi Watari on the extracted 
  appendix was written while still at Keio University.
  In addition, sincere appreciation is also extended to
  Jari Arkko, Carlos Bernardos, Greg Daley, T.J. Kniveton, Henrik Levkowetz,
  Erik Nordmark, Alexandru Petrescu, Hesham Soliman, Ryuji Wakikawa, 
  and Patrick Wetterwald for their various contributions.
</t>

</section> <!-- EndSect: Acknowledgments -->

</middle>

<!---------------------------------------------------------------------------->
<!-- BACK: References and Appendix ------------------------------------------->
<!---------------------------------------------------------------------------->

<back>
<?rfc needLines="20" ?>
<references title="Normative Reference">
  <?rfc include="reference.RFC.3963.xml" ?>
  <?rfc include="reference.RFC.3753.xml" ?>
<reference anchor='RFC4885'>
<front>
<title>Network Mobility Support Terminology</title>

<author initials='T' surname='Ernst' fullname='Thierry Ernst'>
    <organization />
</author>

<author initials='H' surname='Lach' fullname='Hong Lach'>
    <organization />
</author>

<date month='April' year='2007' />

<abstract><t>This document defines a terminology for discussing
network mobility (NEMO) issues and solution
requirements.</t></abstract>

</front>

<seriesInfo name='RFC' value='4885' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-nemo-terminology-06.txt' />
</reference>

</references>

<references title="Informative Reference">
  <?rfc include="reference.RFC.1889.xml" ?>

<reference anchor='RFC4886'>
<front>
<title>Network Mobility Support Goals and Requirements</title>

<author initials='T' surname='Ernst' fullname='Thierry Ernst'>
    <organization />
</author>

<date month='April' year='2007' />

<abstract><t>Network mobility arises when a router connecting a
network to the Internet dynamically changes its point of attachment
to the Internet thereby causing the reachability of the said network
to be changed in relation to the fixed Internet topology. Such kind
of network is referred to as a mobile network. With appropriate
mechanisms, sessions established between nodes in the mobile network
and the global Internet can be maintained after the Mobile Router
changes its point of attachment. This document outlines the goals
expected from network mobility support and defines the requirements
that must be met by the NEMO Basic Support solution.</t></abstract>

</front>

<seriesInfo name='RFC' value='4886' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-nemo-requirements-06.txt' />
</reference>


  <?rfc include="reference.RFC.3775.xml" ?>

<reference anchor='RFC4887'>
<front>
<title>Network Mobility Home Network Models</title>

<author initials='P' surname='Thubert' fullname='Pascal Thubert'>
    <organization />
</author>

<author initials='R' surname='Wakikawa' fullname='Ryuji Wakikawa'>
    <organization />
</author>
<author initials='V' surname='Devarapalli' fullname='Vijay Devarapalli'>
    <organization />
</author>

<date month='April' year='2007' />

<abstract><t>This paper documents some usage patterns and the
associated issues when deploying a Home Network for NEMO-enabled
Mobile Routers, conforming the NEMO Basic Support. The aim here is
specifically to provide some examples of organization of the Home
Network, as they were discussed in NEMO related mailing
lists.</t></abstract>

</front>

<seriesInfo name='RFC' value='RFC4887' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-nemo-home-network-models-06.txt' />
</reference>

  <?rfc include="reference.RFC.3484.xml" ?>

<reference anchor="ENCAP-ADDR">
<front>
<title>Redundant Address Deletion when Encapsulating IPv6 in
IPv6</title>

<author initials="S" surname="Deering" fullname="Steve Deering">
    <organization />
</author>

<author initials="B" surname="Zill" fullname="Brian Zill">
    <organization />
</author>

<date month="November" day="20" year="2001" />
</front>

<seriesInfo name="Work in" value="Progress" />
</reference>

<reference anchor='THREAT-ANALYSIS'>
<front>
<title>Threat Analysis on NEMO Basic Operations</title>

<author initials='S' surname='Jung' fullname='Souhwan Jung'>
    <organization />
</author>

<!-- chanwah: EDIT  Why are additional authors removed for drafts?  -->
<author initials='F' surname='Zhao' fullname='Fan Zhao'>
	<organization />
</author>
<author initials='S' surname='Wu' fullname='S Wu'>
	<organization />
</author>
<author initials='H-G' surname='Kim' fullname='H-G Kim'>
	<organization />
</author>
<author initials='S-W' surname='Sohn' fullname='S-W Sohn'>
	<organization />
</author>
<!-- chanwah: END EDIT -->

<date month='July' day='21' year='2004' />

<abstract><t>This document describes potential security threats to
NEMO basic operations. The threats are mostly related to the integral
use of IPsec and IP-in-IP tunnel between MR and HA. Other threats
related to the operations of multiple MRs, and potential DoS attacks
on MR and HA are also investigated.</t></abstract>

</front>

<seriesInfo name='Work in' value='Progress' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-jung-nemo-threat-analysis-02.txt' />
</reference>


<reference anchor='NEMO-THREATS'>
<front>
<title>Threats for Basic Network Mobility Support (NEMO
threats)</title>

<author initials='A' surname='Petrescu' fullname='Alexandru
Petrescu'>
    <organization />
</author>

<!-- chanwah: EDIT  Why are additional authors removed for drafts?  -->
<author initials='A' surname='Olivereau' fullname='A Olivereau'>
	<organization />
</author>
<author initials='C' surname='Janneteau' fullname='C Janneteau'>
	<organization />
</author>
<author initials='H-Y' surname='Lach' fullname='Hong-Yong Lach'>
	<organization />
</author>
<!-- chanwah: END EDIT -->

<date month='January' day='12' year='2004' />
</front>

<seriesInfo name='Work in' value='Progress' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-petrescu-nemo-threats-01.txt' />
</reference>

</references>
<?rfc needLines="10" ?>
<section anchor="sec:nestconf"
	title="Various Configurations Involving Nested Mobile Networks">
<t>
   In the following sections,
   we try to describe different communication models
   that involve a nested mobile network and to clarify the issues for
   each case.
   We illustrate the path followed by packets
   if we assume nodes only use Mobile IPv6 and NEMO Basic Support
   mechanisms.  Different cases are considered where a Correspondent Node
   is located in the fixed infrastructure, in a distinct nested mobile network
   as the Mobile Network Node, or
   in the same nested mobile network as the Mobile Network Node.  Additionally,
   cases where Correspondent Nodes and Mobile Network Nodes are either standard
   IPv6 nodes or Mobile IPv6 nodes are considered.
   As defined in <xref target="RFC4885"/>,
   standard IPv6 nodes are nodes with no
   mobility functions whatsoever, i.e.,  they are not Mobile IPv6 or
   NEMO enabled.   This means that they cannot move around keeping
   open connections and that they cannot process Binding Updates sent by
   peers.

</t>

    <section title="CN Located in the Fixed Infrastructure"
        anchor="app:B.1">
      <t>
       The most typical configuration is the case where a Mobile Network Node
       communicates with a Correspondent Node attached in the
       fixed infrastructure. <xref target="fig:cn-infra"/> below shows
       an example of such topology.
      </t>

      <figure anchor="fig:cn-infra"
	title="CN Located at the Infrastructure">
          <artwork><![CDATA[
                 +--------+  +--------+  +--------+
                 | MR1_HA |  | MR2_HA |  | MR3_HA |
                 +---+----+  +---+----+  +---+----+
                     |           |           |
                    +-------------------------+
                    |        Internet         |----+ CN
                    +-------------------------+
                            |               |
                        +---+---+        +--+-----+
              root-MR   |  MR1  |        | VMN_HA |
                        +---+---+        +--------+
                            |
                        +---+---+
               sub-MR   |  MR2  |
                        +---+---+
                            |
                        +---+---+
               sub-MR   |  MR3  |
                        +---+---+
                            |
                        ----+----
                           MNN
          ]]></artwork>
      </figure>

      <section title="Case A: LFN and Standard IPv6 CN">
        <t>
          The simplest case is where both MNN and CN are fixed nodes
          with no mobility functions.  That is, MNN is a Local Fixed Node, and CN
          is a standard IPv6 node. Packets are encapsulated between
          each Mobile Router and its respective Home Agent (HA).  As shown in <xref
	  target="fig:cn-infra-1"/>, in such a case, the path between
	  the two nodes would go through:
        </t>

        <figure anchor="fig:cn-infra-1"
	title="MNN and CN Are Standard IPv6 Nodes">
          <artwork>
            <![CDATA[
     1       2       3       4          3          2          1
MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA --- CN
LFN                                                         IPv6 Node

          The digits represent the number of IPv6 headers.
              ]]>
          </artwork>
        </figure>
      </section>
      <section title="Case B: VMN and MIPv6 CN">

        <t>
          In this second case, both end nodes are Mobile IPv6-enabled mobile
          nodes, that is, MNN is a Visiting Mobile Node.  Mobile IPv6
	  Route Optimization may thus be
          initiated between the two and packets would not go through
          the Home Agent of the Visiting Mobile Node or the Home Agent
	  of the Correspondent Node (not shown in the
          figure).  However, packets will still be tunneled between each
          Mobile Router and its respective Home Agent, in both directions. As shown in
          <xref target="fig:cn-infra-2"/>, the path between MNN and
          CN would go through:
        </t>

        <figure anchor="fig:cn-infra-2"
	  title="MNN and CN Are MIPv6 Mobile Nodes">
          <artwork>
            <![CDATA[
     1       2       3       4          3          2          1
MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA --- CN
VMN                                                             MIPv6
              ]]>
          </artwork>
        </figure>

      </section>



      <section title="Case C: VMN and Standard IPv6 CN">
        <t>

	  When the communication involves a Mobile IPv6 node either as a
	  Visiting Mobile Node  or as a Correspondent Node, Mobile IPv6
	  Route Optimization cannot be performed
	  because the standard IPv6 Correspondent Node cannot process Mobile IPv6
	  signaling.  Therefore, MNN would establish a bi-directional
	  tunnel with its HA, which causes the flow to go out the
	  nested NEMO.  Packets between MNN and CN would thus go through
	  MNN's own Home Agent (VMN_HA). The path would therefore be as shown in
	  <xref target="fig:cn-infra-3"/>:
        </t>

        <figure anchor="fig:cn-infra-3"
	  title="MNN is an MIPv6 Mobile Node and CN is a
	  Standard IPv6 Node">
          <artwork>
            <![CDATA[
            2       3       4       5          4
       MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA
       VMN                                           |
                                                     | 3
                                    1          2     |
                                CN --- VMN_HA --- MR3_HA
                             IPv6 Node
              ]]>
          </artwork>
        </figure>
        <t>
	  Providing Route Optimization involving a Mobile IPv6 node may
	  require optimization among the Mobile Routers and the Mobile IPv6 node.
        </t>
      </section>
    </section>

    <section title="CN Located in Distinct Nested NEMOs"
             anchor="app:B.2">
      <t>
       The Correspondent Node may be located in another nested mobile network,
       different from the one MNN is attached to, as shown in <xref
       target="fig:cn-distinct-nest"/>.  We define such configuration
       as "distinct nested mobile networks".
      </t>

       <figure anchor="fig:cn-distinct-nest"
	  title="MNN and CN Located in Distinct Nested NEMOs">
          <artwork><![CDATA[
           +--------+  +--------+  +--------+  +--------+
           | MR2_HA |  | MR3_HA |  | MR4_HA |  | MR5_HA |
           +------+-+  +---+----+  +---+----+  +-+------+
                   \       |           |        /
      +--------+    +-------------------------+    +--------+
      | MR1_HA |----|        Internet         |----| VMN_HA |
      +--------+    +-------------------------+    +--------+
                       |                   |
                   +---+---+           +---+---+
         root-MR   |  MR1  |           |  MR4  |
                   +---+---+           +---+---+
                       |                   |
                   +---+---+           +---+---+
          sub-MR   |  MR2  |           |  MR5  |
                   +---+---+           +---+---+
                       |                   |
                   +---+---+           ----+----
          sub-MR   |  MR3  |              CN
                   +---+---+
                       |
                   ----+----
                      MNN
              ]]></artwork>
      </figure>
      <section title="Case D: LFN and Standard IPv6 CN">
        <t>
          Similar to Case A, we start off with the case where both
	  end nodes do not have any mobility functions.  Packets are
	  encapsulated at every Mobile Router on the way out of the
	  nested mobile network, decapsulated by the Home Agents, and
	  then encapsulated again on their way down the nested mobile network.
        </t>

        <figure anchor="fig:cn-distinct-nest-1"
	  title="MNN and CN Are Standard IPv6 Nodes">
          <artwork>
            <![CDATA[
         1       2       3       4          3          2
    MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
    LFN                                                      |
                                                             | 1
                            1       2       3          2     |
                        CN --- MR5 --- MR4 --- MR4_HA --- MR5_HA
                     IPv6 Node
              ]]>
          </artwork>
        </figure>
      </section>
      <section title="Case E: VMN and MIPv6 CN">

        <t>
          Similar to Case B, when both end nodes are Mobile IPv6 nodes,
          the two nodes may initiate Mobile IPv6 Route Optimization.  Again,
          packets will not go through the Home Agent of the MNN or the Home Agent
	  of the Mobile IPv6 Correspondent Node (not shown in the figure).
	  However, packets
          will still be tunneled for each Mobile Router to its Home Agent and vice versa.
          Therefore, the path between MNN and CN would go through:
        </t>

        <figure anchor="fig:cn-distinct-nest-2"
	  title="MNN and CN Are MIPv6 Mobile Nodes">
          <artwork>
            <![CDATA[
         1       2       3       4          3          2
    MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
    VMN                                                      |
                                                             | 1
                            1       2       3          2     |
                        CN --- MR5 --- MR4 --- MR4_HA --- MR5_HA
                    MIPv6 Node
              ]]>
          </artwork>
        </figure>
      </section>
      <section title="Case F: VMN and Standard IPv6 CN">
        <t>

	  Similar to Case C, when the communication involves a Mobile IPv6
	  node either as a Visiting Mobile Node or as a Correspondent Node, MIPv6 Route Optimization
	  cannot be performed because the standard IPv6 Correspondent Node cannot
	  process Mobile IPv6 signaling.  MNN would therefore establish a
	  bi-directional tunnel with its Home Agent.  Packets between MNN and
	  CN would thus go through MNN's own Home Agent as shown in
	  <xref target="fig:cn-distinct-nest-3"/>:
        </t>
	<t>
	</t>

        <figure anchor="fig:cn-distinct-nest-3"
	  title="MNN is an MIPv6 Mobile Node and CN is a Standard IPv6 Node">
          <artwork>
            <![CDATA[
         2       3       4       5          4          3
    MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
    VMN                                                      |
                                                             | 2
                1       2       3           2          1     |
            CN --- MR5 --- MR4 --- MR4_HA  --- MR5_HA --- VMN_HA
         IPv6 Node
              ]]>
          </artwork>
        </figure>
      </section>
    </section>
    <section title="MNN and CN Located in the Same Nested NEMO"
             anchor="app:B.3">
      <t>
	<xref target="fig:cn-onaji-nest"/> below shows the case where
	the two communicating nodes
	are connected behind different Mobile Routers that are connected
	in the same nested mobile network, and thus
        behind the same root Mobile Router.  Route Optimization
	can avoid packets being tunneled outside the nested mobile network.
      </t>

      <figure anchor="fig:cn-onaji-nest"
	  title="MNN and CN Located in the Same Nested NEMO">
          <artwork><![CDATA[
           +--------+  +--------+  +--------+  +--------+
           | MR2_HA |  | MR3_HA |  | MR4_HA |  | MR5_HA |
           +------+-+  +---+----+  +---+----+  +-+------+
                   \       |           |        /
      +--------+    +-------------------------+    +--------+
      | MR1_HA |----|        Internet         |----| VMN_HA |
      +--------+    +-------------------------+    +--------+
                                 |
                             +---+---+
                   root-MR   |  MR1  |
                             +-------+
                              |     |
                       +-------+   +-------+
              sub-MR   |  MR2  |   |  MR4  |
                       +---+---+   +---+---+
                           |           |
                       +---+---+   +---+---+
              sub-MR   |  MR3  |   |  MR5  |
                       +---+---+   +---+---+
                           |           |
                       ----+----   ----+----
                          MNN          CN
                ]]></artwork>
        </figure>
        <section title="Case G: LFN and Standard IPv6 CN">
        <t>
          Again, we start off with the case where both end nodes do
	  not have any mobility functions.  Packets are encapsulated
	  at every Mobile Router on the way out of the nested mobile network via
	  the root Mobile Router, decapsulated and encapsulated by the Home Agents, and
	  then make their way back to the nested mobile network through the same
	  root Mobile Router.  Therefore, the path between MNN and CN would go
	  through:
        </t>

        <figure anchor="fig:cn-onaji-nest-1"
	  title="MNN and CN Are Standard IPv6 nodes">

          <artwork>
            <![CDATA[
         1       2       3       4          3          2
    MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
    LFN                                                      |
                                                             | 1
         1       2       3       4          3          2     |
     CN --- MR5 --- MR4 --- MR1 --- MR1_HA --- MR4_HA --- MR5_HA
  IPv6 Node
              ]]>
          </artwork>
        </figure>

        </section>
        <section title="Case H: VMN and MIPv6 CN">
          <t>
            Similar to Case B and Case E, when both end nodes are Mobile IPv6
            nodes, the two nodes may initiate Mobile IPv6 Route Optimization,
            which will avoid the packets going through the Home Agent of
            MNN or the Home Agent of the Mobile IPv6 CN (not shown in the figure).
            However, packets will still be tunneled between each Mobile Router and its
            respective Home Agent in both directions.  Therefore, the path
            would be the same as with Case G and go through:
          </t>

            <figure anchor="fig:cn-onaji-nest-2"
	  title="MNN and CN Are MIPv6 Mobile Nodes">

            <artwork>
              <![CDATA[
          1       2       3       4          3          2
     MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
     LFN                                                      |
                                                              | 1
          1       2       3       4          3          2     |
      CN --- MR5 --- MR4 --- MR1 --- MR1_HA --- MR4_HA --- MR5_HA
  MIPv6 Node
                ]]>
            </artwork>
          </figure>
        </section>

        <section title="Case I: VMN and Standard IPv6 CN">
          <t>
	    As for Case C and Case F, when the communication
	    involves a Mobile IPv6 node either as a Visiting Mobile Node
	    or as a Correspondent Node, Mobile IPv6
	    Route Optimization cannot be performed.  Therefore, MNN
	    will establish a bi-directional tunnel with its Home Agent.  Packets
	    between MNN and CN would thus go through MNN's own Home Agent. The
            path would therefore be as shown in
            <xref target="fig:cn-onaji-nest-3"/>:
          </t>
          <figure anchor="fig:cn-onaji-nest-3"
	  title="MNN is an MIPv6 Mobile Node and CN is a Standard IPv6 Node">
            <artwork>
              <![CDATA[
         2       3       4       5          4          3
    MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
    VMN                                                      |
                                                             | 2
                                                             |
                                                          VMN_HA
                                                             |
                                                             | 1
          1       2       3       4          3          2    |
      CN --- MR5 --- MR4 --- MR1 --- MR1_HA --- MR4_HA --- MR5_HA
   IPv6 Node
                ]]>
            </artwork>
          </figure>
        </section>
      </section>

      <section title="CN Located Behind the Same Nested MR"
	       anchor="app:B.4">
      <t>
	<xref target="fig:cn-onaji-mr"/> below shows the case where
	the two communicating nodes
	are connected behind the same nested Mobile Router.  The optimization is
	required when the communication involves MIPv6-enabled nodes.

      </t>

    <figure anchor="fig:cn-onaji-mr"
	  title="MNN and CN Located Behind the Same Nested MR">
            <artwork><![CDATA[
           +--------+  +--------+  +--------+  +--------+
           | MR2_HA |  | MR3_HA |  | MR4_HA |  | MR5_HA |
           +------+-+  +---+----+  +---+----+  +-+------+
                   \       |           |        /
      +--------+    +-------------------------+    +--------+
      | MR1_HA |----|        Internet         |----| VMN_HA |
      +--------+    +-------------------------+    +--------+
                                 |
                             +---+---+
                   root-MR   |  MR1  |
                             +---+---+
                                 |
                             +-------+
                    sub-MR   |  MR2  |
                             +---+---+
                                 |
                             +---+---+
                    sub-MR   |  MR3  |
                             +---+---+
                                 |
                             -+--+--+-
                             MNN    CN
                ]]></artwork>
        </figure>

      <section title="Case J: LFN and Standard IPv6 CN">
        <t>
	  If both end nodes are Local Fixed Nodes, no special function is necessary
	  for optimization of their communications.  The path between
	  the two nodes would go through:
        </t>

        <figure anchor="fig:cn-onaji-mr-1"
	  title="MNN and CN Are Standard IPv6 Nodes">
          <artwork>
            <![CDATA[
                               1
                          MNN --- CN
                          LFN   IPv6 Node
              ]]>
          </artwork>
        </figure>
      </section>

      <section title="Case K: VMN and MIPv6 CN">
        <t>
          Similar to Case H, when both end nodes are Mobile IPv6 nodes,
          the two nodes may initiate Mobile IPv6 Route Optimization.
          Although few packets would go out the nested mobile network for the
          Return Routability initialization, however, unlike Case B
          and Case E, packets will not get tunneled outside the nested mobile
          network.  Therefore, packets between MNN and CN would eventually go
          through:
        </t>

        <figure anchor="fig:cn-onaji-mr-2"
	  title="MNN and CN are MIPv6 Mobile Nodes">
          <artwork>
            <![CDATA[
                               1
                          MNN --- CN
                          VMN   MIPv6 Node
              ]]>
          </artwork>
        </figure>
	<t>
	  If the root Mobile Router is disconnected while the nodes exchange keys
	  for the Return Routability procedure, they may not communicate even though they
	  are connected on the same link.
	</t>
      </section>
      <section title="Case L: VMN and Standard IPv6 CN">
        <t>
	  When the communication involves a Mobile IPv6 node either as a Visiting
	  Mobile Network Node
	  or as a Correspondent Node, Mobile IPv6 Route Optimization cannot be performed.
	  Therefore, even though the two nodes are on the same link,
	  MNN will establish a bi-directional tunnel with its Home Agent,
	  which causes the flow to go out the nested mobile network.
	  The path between MNN
	  and CN would require another Home Agent (VMN_HA) to go through for this
	  Mobile IPv6 node:
        </t>

        <figure anchor="fig:cn-onaji-mr-3"
	  title="MNN is an MIPv6 Mobile Node and CN is a
	  Standard IPv6 Node">
          <artwork>
            <![CDATA[
         2       3       4       5          4          3
    MNN --- MR3 --- MR2 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
    VMN                                                      |
                                                             | 2
                                                             |
                                                          VMN_HA
                                                             |
                                                             | 1
          1       2       3       4          3          2    |
      CN --- MR5 --- MR4 --- MR1 --- MR1_HA --- MR2_HA --- MR3_HA
   IPv6 Node
              ]]>
          </artwork>
        </figure>

        <t>
          However, MNN may also decide to use its Care-of Address
(CoA) as the source
          address of the packets, thus avoiding the tunneling with the MNN's Home Agent.
          This is particularly useful for a short-term communications that may
          easily be retried if it fails.  Default Address Selection <xref target="RFC3484"/> 
          provides some mechanisms for controlling the choice of the source
          address.
        </t>


      </section>

    </section>

</section>

<!--------------------------------------------------------------------------->
<!-- SECTION:  APPENDIX  ------------------------------------------>
<!--------------------------------------------------------------------------->
<section anchor='sec:stalemate-eg'
	 title="Example of How a Stalemate Situation Can Occur">
<t>
  <xref target='sec:problem.ha-in-nemo'/> describes the occurrence of a stalemate
  situation where a Home Agent of a Mobile Router is nested behind the Mobile Router.
  Here, we illustrate a simple example where such a situation can occur.
</t>
<t>
  Consider a mobility configuration depicted in 
  <xref target="fig:stalemate-eg-1"/> below.
  MR1 is served by HA1/BR and MR2 is served by HA2.  
  The 'BR' designation indicates that HA1 is a border router.
  Both MR1 and MR2 are at home in the initial step.
  HA2 is placed inside the first mobile network,
  thus representing a "mobile" Home Agent.
</t>

<figure anchor="fig:stalemate-eg-1"
	title="Initial Deployment">
<artwork><![CDATA[
                                                  /-----CN
                                      +----------+
     home link 1         +--------+   |          |
   ----+-----------------| HA1/BR |---| Internet |
       |                 +--------+   |          |
       |                              +----------+
    +--+--+  +-----+
    | MR1 |  | HA2 |
    +--+--+  +--+--+
       |        |
      -+--------+-- mobile net 1 / home link 2
       |
    +--+--+  +--+--+
    | MR2 |  | LFN |
    +--+--+  +--+--+
        |        |
       -+--------+- mobile net 2
]]></artwork>
</figure>

<t>
  In <xref target='fig:stalemate-eg-1'/> above, 
  communications between CN and LFN follow a
  direct path as long as both MR1 and MR2 are positioned at home.  No
  encapsulation intervenes.
</t>
<t>
  In the next step, consider that the MR2's mobile network leaves home
  and visits a foreign network, under Access Router (AR) like in 
  <xref target="fig:stalemate-eg-2"/> below.
</t>

<figure anchor="fig:stalemate-eg-2"
	title="Mobile Network 2 Leaves Home">
<artwork><![CDATA[
                                            /-----CN
                                +----------+
     home link 1   +--------+   |          |
     --+-----------| HA1/BR |---| Internet |
       |           +--------+   |          |
    +--+--+  +-----+            +----------+
    | MR1 |  | HA2 |                        \
    +--+--+  +--+--+                        +-----+
       |        |                           | AR  |
      -+--------+- mobile net 1             +--+--+
                   home link 2                 |
                                            +--+--+  +-----+
                                            | MR2 |  | LFN |
                                            +--+--+  +--+--+
                                               |        |
                                 mobile net 2 -+--------+-
]]></artwork>
</figure>

<t>
  Once MR2 acquires a Care-of Address under AR, the tunnel setup procedure occurs
  between MR2 and HA2.  MR2 sends a Binding Update to HA2 and HA2
  replies with a Binding
  Acknowledgement to MR2.  
  The bi-directional tunnel has MR2 and HA2 as tunnel endpoints.
  After the tunnel MR2HA2 has been set up, the path taken by a packet
  from CN towards LFN can be summarized as:
  <vspace blankLines='1'/>
  &nbsp; &nbsp; CN->BR->MR1->HA2=>MR1=>BR=>AR=>MR2->LFN.  
  <vspace blankLines='1'/>
  Non-encapsulated packets
  are marked "->" while encapsulated packets are marked "=>".
</t>
<t>
  Consider next the attachment of the first mobile network under the
  second mobile network, like in <xref target="fig:stalemate-eg-3"/> below.
</t>

<t>
  After this movement, MR1 acquires a Care-of Address valid in the second mobile
  network.  Subsequently, it sends a Binding Update (BU) message addressed to HA1.
  This Binding Update is encapsulated by MR2 and sent towards HA2, which is
  expected to be placed in mobile net 1 and expected to be at home.
  Once HA1/BR receives this encapsulated BU, it tries to deliver to
  MR1.  Since MR1 is not at home, and a tunnel has not yet been set up
  between MR1 and HA1, HA1 is not able to route this packet and drops
  it.  Thus, the tunnel establishment procedure between MR1 and HA1 is
  not possible, because the tunnel between MR2 and HA2
  had been previously torn down (when the mobile net 1 moved from
  home).  The communications between CN and LFN stops, even though both
  mobile networks are connected to the Internet.
</t>

<figure anchor="fig:stalemate-eg-3"
	title="Stalemate Situation Occurs">
<artwork><![CDATA[
                                   /-----CN
                       +----------+
          +--------+   |          |
          | HA1/BR |---| Internet |
          +--------+   |          |
                       +----------+
                                   \
                                   +-----+
                                   | AR  |
                                   +--+--+
                                      |
                                   +--+--+  +-----+
                                   | MR2 |  | LFN |
                                   +--+--+  +--+--+
                                      |        |
                        mobile net 2 -+--------+-
                                      |
                                   +--+--+  +-----+
                                   | MR1 |  | HA2 |
                                   +--+--+  +--+--+
                                      |        |
                        mobile net 1 -+--------+-
]]></artwork>
</figure>

<t>
  If both tunnels between MR1 and HA1, and between MR2 and HA2,
  were up simultaneously, they would have "crossed over" each other.
  If the tunnels MR1-HA1 and MR2-HA2 were drawn in 
  <xref target="fig:stalemate-eg-3"/>,
  it could be noticed that the path of the tunnel MR1-HA1 includes
  only one endpoint of the tunnel MR2-HA2 (the MR2 endpoint).  Two
  MR-HA tunnels are crossing over each other if the IP path between
  two endpoints of one tunnel includes one and only one endpoint of
  the other tunnel (assuming that both tunnels are up).  When both
  endpoints of one tunnel are included in the path of the other
  tunnel, then tunnels are simply encapsulating each other.
</t>

</section>

</back>

</rfc>
<!-- End of Doc -->

