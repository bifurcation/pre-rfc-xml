<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc category="info" consensus="yes" ipr="trust200902" number="8204"
     submissionType="IETF">
  <front>
    <title abbrev="Benchmarking vSwitches">Benchmarking Virtual Switches in
    the Open Platform for NFV (OPNFV)</title>

    <author fullname="Maryam Tahhan" initials="M." surname="Tahhan">
      <organization>Intel</organization>

      <address>
        <postal>
          <street/>

          <city/>

          <region/>

          <code/>

          <country/>
        </postal>

        <phone/>

        <facsimile/>

        <email>maryam.tahhan@intel.com</email>

        <uri/>
      </address>
    </author>

    <author fullname="Billy O'Mahony" initials="B." surname="O'Mahony">
      <organization>Intel</organization>

      <address>
        <postal>
          <street/>

          <city/>

          <region/>

          <code/>

          <country/>
        </postal>

        <phone/>

        <facsimile/>

        <email>billy.o.mahony@intel.com</email>

        <uri/>
      </address>
    </author>

    <author fullname="Al Morton" initials="A." surname="Morton">
      <organization>AT&amp;T Labs</organization>

      <address>
        <postal>
          <street>200 Laurel Avenue South</street>

          <city>Middletown</city>

          <region>NJ</region>

          <code>07748</code>

          <country>United States of America</country>
        </postal>

        <phone>+1 732 420 1571</phone>

        <facsimile>+1 732 368 1192</facsimile>

        <email>acmorton@att.com</email>

        <uri/>
      </address>
    </author>

    <date month="September" year="2017"/>

    <abstract>
      <t>This memo describes the contributions of the Open Platform for NFV
      (OPNFV) project on Virtual Switch Performance (VSPERF), particularly in
      the areas of test setups and configuration parameters for the system
      under test. This project has extended the current and completed work of
      the Benchmarking Methodology Working Group in the IETF and references
      existing literature. The Benchmarking Methodology Working Group has
      traditionally conducted laboratory characterization of dedicated
      physical implementations of internetworking functions. Therefore, this
      memo describes the additional considerations when virtual switches are
      implemented on general-purpose hardware. The expanded tests and
      benchmarks are also influenced by the OPNFV mission to support
      virtualization of the "telco" infrastructure.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>The Benchmarking Methodology Working Group (BMWG) has traditionally
      conducted laboratory characterization of dedicated physical
      implementations of internetworking functions. The black-box benchmarks
      of throughput, latency, forwarding rates, and others have served our
      industry for many years. Now, Network Function Virtualization (NFV) has
      the goal of transforming how internetwork functions are implemented and
      therefore has garnered much attention.</t>

      <t>A virtual switch (vSwitch) is an important aspect of the NFV
      infrastructure; it provides connectivity between and among physical
      network functions and virtual network functions. As a result, there are
      many vSwitch benchmarking efforts but few specifications to guide the
      many new test design choices. This is a complex problem and an
      industry-wide work in progress. In the future, several of BMWG's
      fundamental specifications will likely be updated as more testing
      experience helps to form consensus around new methodologies, and BMWG
      should continue to collaborate with all organizations that share the
      same goal.</t>

      <t>This memo describes the contributions of the Open Platform for NFV
      (OPNFV) project on Virtual Switch Performance (VSPERF) characterization
      through the Danube 3.0 (fourth) release <xref target="DanubeRel"/> to
      the chartered work of the BMWG (with stable references to their test
      descriptions). This project has extended the current and completed work
      of the BMWG IETF and references existing literature. For example, the
      most often referenced RFC is <xref target="RFC2544"/> (which depends on
      <xref target="RFC1242"/>), so the foundation of the benchmarking work in
      OPNFV is common and strong. The recommended extensions are specifically
      in the areas of test setups and configuration parameters for the system
      under test.</t>

      <t>See <xref target="VSPERFhome"/> for more background and the OPNFV
      website for general information <xref target="OPNFV"/>.</t>

      <t>The authors note that OPNFV distinguishes itself from other open
      source compute and networking projects through its emphasis on existing
      "telco" services as opposed to cloud computing. There are many ways in
      which telco requirements have different emphasis on performance
      dimensions when compared to cloud computing: support for and transfer of
      isochronous media streams is one example.</t>

      <section title="Requirements Language">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described in BCP
        14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only
        when, they appear in all capitals, as shown here.</t>
      </section>

      <section title="Abbreviations">
        <t>For the purposes of this document, the following abbreviations
        apply:<figure>
            <artwork><![CDATA[
 ACK      Acknowledge
 ACPI     Advanced Configuration and Power Interface
 BIOS     Basic Input Output System
 BMWG     Benchmarking Methodology Working Group
 CPDP     Control Plane Data Plane
 CPU      Central Processing Unit
 DIMM     Dual In-line Memory Module
 DPDK     Data Plane Development Kit
 DUT      Device Under Test
 GRUB     Grand Unified Bootloader
 ID       Identification
 IMIX     Internet Mix
 IP       Internet Protocol
 IPPM     IP Performance Metrics 
 LAN      Local Area Network
 LTD      Level Test Design 
 NFV      Network Functions Virtualization
 NIC      Network Interface Card
 NUMA     Non-uniform Memory Access
 OPNFV    Open Platform for NFV
 OS       Operating System
 PCI      Peripheral Component Interconnect
 PDV      Packet Delay Variation
 SR/IOV   Single Root / Input Output Virtualization
 SUT      System Under Test
 TCP      Transmission Control Protocol
 TSO      TCP Segment Offload
 UDP      User Datagram Protocol
 VM       Virtual Machine
 VNF      Virtualised Network Function
 VSPERF   OPNFV vSwitch Performance Project]]></artwork>
          </figure></t>
      </section>
    </section>

    <section title="Scope">
      <t>The primary purpose and scope of the memo is to describe key aspects
      of vSwitch benchmarking, particularly in the areas of test setups and
      configuration parameters for the system under test, and extend the body
      of extensive BMWG literature and experience. Initial feedback indicates
      that many of these extensions may be applicable beyond this memo's
      current scope (to hardware switches in the NFV infrastructure and to
      virtual routers, for example). Additionally, this memo serves as a
      vehicle to include more detail and relevant commentary from BMWG and
      other open source communities under BMWG's chartered work to
      characterize the NFV infrastructure.</t>

      <t>The benchmarking covered in this memo should be applicable to many
      types of vSwitches and remain vSwitch agnostic to a great degree. There
      has been no attempt to track and test all features of any specific
      vSwitch implementation.</t>
    </section>

    <section title="Benchmarking Considerations">
      <t>This section highlights some specific considerations (from <xref
      target="RFC8172"/>) related to benchmarks for virtual switches. The
      OPNFV project is sharing its present view on these areas as they develop
      their specifications in the Level Test Design (LTD) document as defined
      by <xref target="IEEE829"/>.</t>

      <section title="Comparison with Physical Network Functions">
        <t>To compare the performance of virtual designs and implementations
        with their physical counterparts, identical benchmarks are needed.
        BMWG has developed specifications for many physical network functions.
        The BMWG has recommended reusing existing benchmarks and methods in
        <xref target="RFC8172"/>, and the OPNFV LTD expands on them as
        described here. A key configuration aspect for vSwitches is the number
        of parallel CPU cores required to achieve comparable performance with
        a given physical device or whether some limit of scale will be reached
        before the vSwitch can achieve the comparable performance level.</t>

        <t>It's unlikely that the virtual switch will be the only application
        running on the SUT, so CPU utilization, cache utilization, and memory
        footprint should also be recorded for the virtual implementations of
        internetworking functions. However, internally measured metrics such
        as these are not benchmarks; they may be useful for the audience
        (e.g., operations) to know and may also be useful if there is a
        problem encountered during testing.</t>

        <t>Benchmark comparability between virtual and physical/hardware
        implementations of equivalent functions will likely place more
        detailed and exact requirements on the "testing systems" (in terms of
        stream generation, algorithms to search for maximum values, and their
        configurations). This is another area for standards development to
        appreciate; however, this is a topic for a future document.</t>
      </section>

      <section title="Continued Emphasis on Black-Box Benchmarks">
        <t>External observations remain essential as the basis for benchmarks.
        Internal observations with a fixed specification and interpretation
        will be provided in parallel to assist the development of operations
        procedures when the technology is deployed.</t>
      </section>

      <section title="New Configuration Parameters">
        <t>A key consideration when conducting any sort of benchmark is trying
        to ensure the consistency and repeatability of test results. When
        benchmarking the performance of a vSwitch, there are many factors that
        can affect the consistency of results; one key factor is matching the
        various hardware and software details of the SUT. This section lists
        some of the many new parameters that this project believes are
        critical to report in order to achieve repeatability.</t>

        <t>It has been the goal of the project to produce repeatable results,
        and a large set of the parameters believed to be critical is provided
        so that the benchmarking community can better appreciate the increase
        in configuration complexity inherent in this work. The parameter set
        below is assumed sufficient for the infrastructure in use by the
        VSPERF project to obtain repeatable results from test to test.</t>

        <t>Hardware details (platform, processor, memory, and network)
        including:</t>

        <t><list style="symbols">
            <t>BIOS version, release date, and any configurations that were
            modified</t>

            <t>Power management at all levels (ACPI sleep states, processor
            package, OS, etc.)</t>

            <t>CPU microcode level</t>

            <t>Number of enabled cores</t>

            <t>Number of cores used for the test</t>

            <t>Memory information (type and size)</t>

            <t>Memory DIMM configurations (quad rank performance may not be
            the same as dual rank) in size, frequency, and slot locations</t>

            <t>Number of physical NICs and their details (manufacturer,
            versions, type, and the PCI slot they are plugged into)</t>

            <t>NIC interrupt configuration (and any special features in
            use)</t>

            <t>PCI configuration parameters (payload size, early ACK option,
            etc.)</t>
          </list>Software details including:</t>

        <t>
          <list style="symbols">
            <t>OS RunLevel</t>

            <t>OS version (for host and VNF)</t>

            <t>Kernel version (for host and VNF)</t>

            <t>GRUB boot parameters (for host and VNF)</t>

            <t>Hypervisor details (type and version)</t>

            <t>Selected vSwitch, version number, or commit ID used</t>

            <t>vSwitch launch command line if it has been parameterized</t>

            <t>Memory allocation to the vSwitch</t>

            <t>Which NUMA node it is using and how many memory channels</t>

            <t>DPDK or any other software dependency version number or commit
            ID used</t>

            <t>Memory allocation to a VM - if it's from
            Hugepages/elsewhere</t>

            <t>VM storage type - snapshot, independent persistent, independent
            non-persistent</t>

            <t>Number of VMs</t>

            <t>Number of virtual NICs (vNICs) - versions, type, and driver</t>

            <t>Number of virtual CPUs and their core affinity on the host</t>

            <t>Number of vNICs and their interrupt configurations</t>

            <t>Thread affinitization for the applications (including the
            vSwitch itself) on the host</t>

            <t>Details of resource isolation, such as CPUs designated for
            Host/Kernel (isolcpu) and CPUs designated for specific processes
            (taskset).</t>
          </list>
        </t>

        <t>Test traffic information:<list style="symbols">
            <t>Test duration</t>

            <t>Number of flows</t>

            <t>Traffic type - UDP, TCP, and others</t>

            <t>Frame Sizes - fixed or IMIX <xref target="RFC6985"/> (note that
            with <xref target="IEEE802.1ac"/>, frames may be longer than 1500
            bytes and up to 2000 bytes)</t>

            <t>Deployment Scenario - defines the communications path in the
            SUT</t>
          </list></t>

        <t/>
      </section>

      <section title="Flow Classification">
        <t>Virtual switches group packets into flows by processing and
        matching particular packet or frame header information, or by matching
        packets based on the input ports. Thus, a flow can be thought of as a
        sequence of packets that have the same set of header field values or
        have arrived on the same physical or logical port. Performance results
        can vary based on the parameters the vSwitch uses to match for a flow.
        The recommended flow classification parameters for any vSwitch
        performance tests are: the input port (physical or logical), the
        source MAC address, the destination MAC address, the source IP
        address, the destination IP address, and the Ethernet protocol type
        field (although classification may take place on other fields, such as
        source and destination transport port numbers). It is essential to
        increase the flow timeout time on a vSwitch before conducting any
        performance tests that do not intend to measure the flow setup time
        (see Section 3 of <xref target="RFC2889"/>). Normally, the first
        packet of a particular stream will install the flow in the virtual
        switch, which introduces additional latency; subsequent packets of the
        same flow are not subject to this latency if the flow is already
        installed on the vSwitch.</t>
      </section>

      <section title="Benchmarks Using Baselines with Resource Isolation">
        <t>This outline describes the measurement of baselines with isolated
        resources at a high level, which is the intended approach at this
        time.</t>

        <t>
          <list style="numbers">
            <t>Baselines: <list style="symbols">
                <t>Optional: Benchmark platform forwarding capability without
                a vSwitch or VNF for at least 72 hours (serves as a means of
                platform validation and a means to obtain the base performance
                for the platform in terms of its maximum forwarding rate and
                latency). <figure anchor="figure_1"
                    title="Benchmark Platform Forwarding Capability">
                    <artwork align="center"><![CDATA[
                                                       __
   +--------------------------------------------------+   |
   |   +------------------------------------------+   |   |
   |   |                                          |   |   |
   |   |          Simple Forwarding App           |   |  Host
   |   |                                          |   |   |
   |   +------------------------------------------+   |   |
   |   |                 NIC                      |   |   |
   +---+------------------------------------------+---+ __|
              ^                           :
              |                           |
              :                           v
   +--------------------------------------------------+
   |                                                  |
   |                Traffic Generator                 |
   |                                                  |
   +--------------------------------------------------+]]></artwork>
                  </figure></t>

                <t>Benchmark VNF forwarding capability with direct
                connectivity (vSwitch bypass, e.g., SR/IOV) for at least 72
                hours (serves as a means of VNF validation and a means to
                obtain the base performance for the VNF in terms of its
                maximum forwarding rate and latency). The metrics gathered
                from this test will serve as a key comparison point for
                vSwitch bypass technologies performance and vSwitch
                performance. <figure align="center" anchor="figure_2"
                    title="Benchmark VNF Forwarding Capability">
                    <artwork><![CDATA[
                                                                 __
       +--------------------------------------------------+ __     |
       |   +------------------------------------------+   |   |    |
       |   |                                          |   | Host/  |
       |   |                 VNF                      |   | Guest  |
       |   |                                          |   |   |    |
       |   +------------------------------------------+   | __|    |
       |   |          Passthrough/SR-IOV              |   |       Host
       |   +------------------------------------------+   |        |
       |   |                 NIC                      |   |        |
       +---+------------------------------------------+---+      __|
                  ^                           :
                  |                           |
                  :                           v
       +--------------------------------------------------+
       |                                                  |
       |                Traffic Generator                 |
       |                                                  |
       +--------------------------------------------------+]]></artwork>

                    <postamble/>
                  </figure></t>

                <t>Benchmarking with isolated resources alone and with other
                resources (both hardware and software) disabled; for example,
                vSwitch and VM are SUT.</t>

                <t>Benchmarking with isolated resources alone, thus leaving
                some resources unused.</t>

                <t>Benchmarking with isolated resources and all resources
                occupied.</t>
              </list></t>

            <t>Next Steps:<list style="symbols">
                <t>Limited sharing</t>

                <t>Production scenarios</t>

                <t>Stressful scenarios</t>
              </list></t>
          </list>
        </t>
      </section>
    </section>

    <section title="VSPERF Specification Summary">
      <t>The overall specification in preparation is referred to as a Level
      Test Design (LTD) document, which will contain a suite of performance
      tests. The base performance tests in the LTD are based on the
      pre-existing specifications developed by the BMWG to test the
      performance of physical switches. These specifications include:</t>

      <t>
        <list style="symbols">
          <t>Benchmarking Methodology for Network Interconnect Devices <xref
          target="RFC2544"/></t>

          <t>Benchmarking Methodology for LAN Switching <xref
          target="RFC2889"/></t>

          <t>Device Reset Characterization <xref target="RFC6201"/></t>

          <t>Packet Delay Variation Applicability Statement <xref
          target="RFC5481"/></t>
        </list>
      </t>

      <t>The two most recent RFCs above (<xref target="RFC6201"/> and <xref
      target="RFC5481"/>) are being applied in benchmarking for the first time
      and represent a development challenge for test equipment developers.
      Fortunately, many members of the testing system community have engaged
      on the VSPERF project, including an open source test system.</t>

      <t>In addition to this, the LTD also reuses the terminology defined
      by:</t>

      <t>
        <list style="symbols">
          <t>Benchmarking Terminology for LAN Switching Devices <xref
          target="RFC2285"/></t>
        </list>
      </t>

      <t>It is recommended that these references be included in future
      benchmarking specifications:<list style="symbols">
          <t>Methodology for IP Multicast Benchmarking <xref
          target="RFC3918"/></t>

          <t>Packet Reordering Metrics <xref target="RFC4737"/></t>
        </list></t>

      <t>As one might expect, the most fundamental internetworking
      characteristics of throughput and latency remain important when the
      switch is virtualized, and these benchmarks figure prominently in the
      specification.</t>

      <t>When considering characteristics important to "telco" network
      functions, additional performance metrics are needed. In this case, the
      project specifications have referenced metrics from the IETF IP
      Performance Metrics (IPPM) literature. This means that the latency test
      described in <xref target="RFC2544"/> is replaced by measurement of a
      metric derived from IPPM's <xref target="RFC7679"/>, where a set of
      statistical summaries will be provided (mean, max, min, and
      percentiles). Further metrics planned to be benchmarked include packet
      delay variation as defined by <xref target="RFC5481"/>, reordering,
      burst behaviour, DUT availability, DUT capacity, and packet loss in
      long-term testing at the throughput level, where some low level of
      background loss may be present and characterized.</t>

      <t>Tests have been designed to collect the metrics below:</t>

      <t>
        <list style="symbols">
          <t>Throughput tests are designed to measure the maximum forwarding
          rate (in frames per second, fps) and bit rate (in Mbps) for a
          constant load (as defined by <xref target="RFC1242"/>) without
          traffic loss.</t>

          <t>Packet and frame-delay distribution tests are designed to measure
          the average minimum and maximum packet (and/or frame) delay for
          constant loads.</t>

          <t>Packet delay tests are designed to understand latency
          distribution for different packet sizes and to uncover outliers over
          an extended test run.</t>

          <t>Scalability tests are designed to understand how the virtual
          switch performs with an increasing number of flows, number of active
          ports, configuration complexity of the forwarding logic, etc.</t>

          <t>Stream performance tests (with TCP or UDP) are designed to
          measure bulk data transfer performance, i.e., how fast systems can
          send and receive data through the switch.</t>

          <t>Control-path and data-path coupling tests are designed to
          understand how closely the data path and the control path are
          coupled, as well as the effect of this coupling on the performance
          of the DUT (for example, delay of the initial packet of a flow).</t>

          <t>CPU and memory consumption tests are designed to understand the
          virtual switch's footprint on the system and are conducted as
          auxiliary measurements with the benchmarks above. They include CPU
          utilization, cache utilization, and memory footprint.</t>

          <t>The so-called "soak" tests, where the selected test is conducted
          over a long period of time (with an ideal duration of 24 hours but
          only long enough to determine that stability issues exist when
          found; there is no requirement to continue a test when a DUT
          exhibits instability over time). The key performance characteristics
          and benchmarks for a DUT are determined (using short duration tests)
          prior to conducting soak tests. The purpose of soak tests is to
          capture transient changes in performance, which may occur due to
          infrequent processes, memory leaks, or the low-probability
          coincidence of two or more processes. The stability of the DUT is
          the paramount consideration, so performance must be evaluated
          periodically during continuous testing, and this results in use of
          frame rate metrics <xref target="RFC2889"/> instead of throughput
          <xref target="RFC2544"/> (which requires stopping traffic to allow
          time for all traffic to exit internal queues), for example.</t>
        </list>
      </t>

      <t>Additional test specification development should include:<list
          style="symbols">
          <t>Request/response performance tests (with TCP or UDP), which
          measure the transaction rate through the switch.</t>

          <t>Noisy neighbor tests, in order to understand the effects of
          resource sharing on the performance of a virtual switch.</t>

          <t>Tests derived from examination of ETSI NFV Draft GS IFA003
          requirements <xref target="IFA003"/> on characterization of
          acceleration technologies applied to vSwitches.</t>
        </list>The flexibility of deployment of a virtual switch within a
      network means that it is necessary to characterize the performance of a
      vSwitch in various deployment scenarios. The deployment scenarios under
      consideration are shown in the following figures:</t>

      <t>
        <figure anchor="figure_3"
                title="Physical Port to Virtual Switch to Physical Port">
          <artwork><![CDATA[                                                      __
  +--------------------------------------------------+   |
  |              +--------------------+              |   |
  |              |                    |              |   |
  |              |                    v              |   |  Host
  |   +--------------+            +--------------+   |   |
  |   |   PHY Port   |  vSwitch   |   PHY Port   |   |   |
  +---+--------------+------------+--------------+---+ __|
             ^                           :
             |                           |
             :                           v
  +--------------------------------------------------+
  |                                                  |
  |                Traffic Generator                 |
  |                                                  |
  +--------------------------------------------------+]]></artwork>
        </figure>
      </t>

      <t>
        <figure anchor="figure_4"
                title="Physical Port to Virtual Switch to VNF to Virtual   Switch to Physical Port">
          <artwork><![CDATA[                                                      __
  +---------------------------------------------------+   |
  |                                                   |   |
  |   +-------------------------------------------+   |   |
  |   |                 Application               |   |   |
  |   +-------------------------------------------+   |   |
  |       ^                                  :        |   |
  |       |                                  |        |   |  Guest
  |       :                                  v        |   |
  |   +---------------+           +---------------+   |   |
  |   | Logical Port 0|           | Logical Port 1|   |   |
  +---+---------------+-----------+---------------+---+ __|
          ^                                  :
          |                                  |
          :                                  v         __
  +---+---------------+----------+---------------+---+   |
  |   | Logical Port 0|          | Logical Port 1|   |   |
  |   +---------------+          +---------------+   |   |
  |       ^                                  :       |   |
  |       |                                  |       |   |  Host
  |       :                                  v       |   |
  |   +--------------+            +--------------+   |   |
  |   |   PHY Port   |  vSwitch   |   PHY Port   |   |   |
  +---+--------------+------------+--------------+---+ __|
             ^                           :
             |                           |
             :                           v
  +--------------------------------------------------+
  |                                                  |
  |                Traffic Generator                 |
  |                                                  |
  +--------------------------------------------------+]]></artwork>
        </figure>

        <figure anchor="figure_5"
                title="Physical Port to Virtual Switch to VNF to     Virtual Switch to VNF to Virtual Switch to Physical Port">
          <artwork><![CDATA[                                                   __
  +----------------------+  +----------------------+  |
  |   Guest 1            |  |   Guest 2            |  |
  |   +---------------+  |  |   +---------------+  |  |
  |   |  Application  |  |  |   |  Application  |  |  |
  |   +---------------+  |  |   +---------------+  |  |
  |       ^       |      |  |       ^       |      |  |
  |       |       v      |  |       |       v      |  |  Guests
  |   +---------------+  |  |   +---------------+  |  |
  |   | Logical Ports |  |  |   | Logical Ports |  |  |
  |   |   0       1   |  |  |   |   0       1   |  |  |
  +---+---------------+--+  +---+---------------+--+__|
          ^       :                 ^       :
          |       |                 |       |
          :       v                 :       v       _
  +---+---------------+---------+---------------+--+ |
  |   |   0       1   |         |   3       4   |  | |
  |   | Logical Ports |         | Logical Ports |  | |
  |   +---------------+         +---------------+  | |
  |       ^       |                 ^       |      | |  Host
  |       |       \-----------------/       v      | |
  |   +--------------+          +--------------+   | |
  |   |   PHY Ports  | vSwitch  |   PHY Ports  |   | |
  +---+--------------+----------+--------------+---+_|
          ^                                 :
          |                                 |
          :                                 v
  +--------------------------------------------------+
  |                                                  |
  |                Traffic Generator                 |
  |                                                  |
  +--------------------------------------------------+]]></artwork>
        </figure>

        <figure anchor="figure_6"
                title="Physical Port to Virtual Switch to VNF">
          <artwork><![CDATA[                                                       __
  +---------------------------------------------------+   |
  |                                                   |   |
  |   +-------------------------------------------+   |   |
  |   |                 Application               |   |   |
  |   +-------------------------------------------+   |   |
  |       ^                                           |   |
  |       |                                           |   |  Guest
  |       :                                           |   |
  |   +---------------+                               |   |
  |   | Logical Port 0|                               |   |
  +---+---------------+-------------------------------+ __|
          ^
          |
          :                                            __
  +---+---------------+------------------------------+   |
  |   | Logical Port 0|                              |   |
  |   +---------------+                              |   |
  |       ^                                          |   |
  |       |                                          |   |  Host
  |       :                                          |   |
  |   +--------------+                               |   |
  |   |   PHY Port   |  vSwitch                      |   |
  +---+--------------+------------ -------------- ---+ __|
             ^
             |
             :
  +--------------------------------------------------+
  |                                                  |
  |                Traffic Generator                 |
  |                                                  |
  +--------------------------------------------------+]]></artwork>
        </figure>

        <figure anchor="figure_7"
                title="VNF to Virtual Switch to Physical Port">
          <artwork><![CDATA[                                                       __
  +---------------------------------------------------+   |
  |                                                   |   |
  |   +-------------------------------------------+   |   |
  |   |                 Application               |   |   |
  |   +-------------------------------------------+   |   |
  |                                          :        |   |
  |                                          |        |   |  Guest
  |                                          v        |   |
  |                               +---------------+   |   |
  |                               | Logical Port  |   |   |
  +-------------------------------+---------------+---+ __|
                                             :
                                             |
                                             v         __
  +------------------------------+---------------+---+   |
  |                              | Logical Port  |   |   |
  |                              +---------------+   |   |
  |                                          :       |   |
  |                                          |       |   |  Host
  |                                          v       |   |
  |                               +--------------+   |   |
  |                     vSwitch   |   PHY Port   |   |   |
  +-------------------------------+--------------+---+ __|
                                         :
                                         |
                                         v
  +--------------------------------------------------+
  |                                                  |
  |                Traffic Generator                 |
  |                                                  |
  +--------------------------------------------------+]]></artwork>
        </figure>

        <figure anchor="figure_8" title="VNF to Virtual Switch to VNF">
          <artwork><![CDATA[                                                   __
  +----------------------+  +----------------------+  |
  |   Guest 1            |  |   Guest 2            |  |
  |   +---------------+  |  |   +---------------+  |  |
  |   |  Application  |  |  |   |  Application  |  |  |
  |   +---------------+  |  |   +---------------+  |  |
  |              |       |  |       ^              |  |
  |              v       |  |       |              |  |  Guests
  |   +---------------+  |  |   +---------------+  |  |
  |   | Logical Ports |  |  |   | Logical Ports |  |  |
  |   |           0   |  |  |   |   0           |  |  |
  +---+---------------+--+  +---+---------------+--+__|
                  :                 ^
                  |                 |
                  v                 :               _
  +---+---------------+---------+---------------+--+ |
  |   |           1   |         |   1           |  | |
  |   | Logical Ports |         | Logical Ports |  | |
  |   +---------------+         +---------------+  | |
  |               |                 ^              | |  Host
  |               \-----------------/              | |
  |                                                | |
  |                    vSwitch                     | |
  +------------------------------------------------+_|]]></artwork>
        </figure>
      </t>

      <t>A set of deployment scenario figures is available on the VSPERF "Test
      Methodology" wiki page <xref target="TestTopo"/>.</t>
    </section>

    <section title="3x3 Matrix Coverage">
      <t>This section organizes the many existing test specifications into the
      "3x3" matrix (introduced in <xref target="RFC8172"/>). Because the LTD
      specification ID names are quite long, this section is organized into
      lists for each occupied cell of the matrix (not all are occupied; also,
      the matrix has grown to 3x4 to accommodate scale metrics when displaying
      the coverage of many metrics/benchmarks). The current version of the LTD
      specification is available; see <xref target="LTD"/>.</t>

      <t>The tests listed below assess the activation of paths in the data
      plane rather than the control plane.</t>

      <t>A complete list of tests with short summaries is available on the
      VSPERF "LTD Test Spec Overview" wiki page <xref target="LTDoverV"/>.</t>

      <section title="Speed of Activation">
        <t>
          <list style="symbols">
            <t>Activation.RFC2889.AddressLearningRate</t>

            <t>PacketLatency.InitialPacketProcessingLatency</t>
          </list>
        </t>
      </section>

      <section title="Accuracy of Activation">
        <t>
          <list style="symbols">
            <t>CPDP.Coupling.Flow.Addition</t>
          </list>
        </t>
      </section>

      <section title="Reliability of Activation">
        <t>
          <list style="symbols">
            <t>Throughput.RFC2544.SystemRecoveryTime</t>

            <t>Throughput.RFC2544.ResetTime</t>
          </list>
        </t>
      </section>

      <section title="Scale of Activation">
        <t>
          <list style="symbols">
            <t>Activation.RFC2889.AddressCachingCapacity</t>
          </list>
        </t>
      </section>

      <section title="Speed of Operation">
        <t>
          <list style="symbols">
            <t>Throughput.RFC2544.PacketLossRate</t>

            <t>Stress.RFC2544.0PacketLoss</t>

            <t>Throughput.RFC2544.PacketLossRateFrameModification</t>

            <t>Throughput.RFC2544.BackToBackFrames</t>

            <t>Throughput.RFC2889.MaxForwardingRate</t>

            <t>Throughput.RFC2889.ForwardPressure</t>

            <t>Throughput.RFC2889.BroadcastFrameForwarding</t>

            <t>Throughput.RFC2544.WorstN-BestN</t>

            <t>Throughput.Overlay.Network.&lt;tech&gt;.RFC2544.PacketLossRatio</t>
          </list>
        </t>
      </section>

      <section title="Accuracy of Operation">
        <t>
          <list style="symbols">
            <t>Throughput.RFC2889.ErrorFramesFiltering</t>

            <t>Throughput.RFC2544.Profile</t>
          </list>
        </t>
      </section>

      <section title="Reliability of Operation">
        <t>
          <list style="symbols">
            <t>Throughput.RFC2889.Soak</t>

            <t>Throughput.RFC2889.SoakFrameModification</t>

            <t>PacketDelayVariation.RFC3393.Soak</t>
          </list>
        </t>
      </section>

      <section title="Scalability of Operation">
        <t>
          <list style="symbols">
            <t>Scalability.RFC2544.0PacketLoss</t>

            <t>MemoryBandwidth.RFC2544.0PacketLoss.Scalability</t>

            <t>Scalability.VNF.RFC2544.PacketLossProfile</t>

            <t>Scalability.VNF.RFC2544.PacketLossRatio</t>
          </list>
        </t>
      </section>

      <section title="Summary">
        <t>
          <figure>
            <artwork><![CDATA[
|---------------------------------------------------------------------|
|              |           |            |               |             |
|              |   SPEED   |  ACCURACY  |  RELIABILITY  |    SCALE    |
|              |           |            |               |             |
|---------------------------------------------------------------------|
|              |           |            |               |             |
|  Activation  |     X     |     X      |       X       |      X      |
|              |           |            |               |             |
|---------------------------------------------------------------------|
|              |           |            |               |             |
|  Operation   |     X     |     X      |       X       |      X      |
|              |           |            |               |             |
|---------------------------------------------------------------------|
|              |           |            |               |             |
| De-activation|           |            |               |             |
|              |           |            |               |             |
|---------------------------------------------------------------------|]]></artwork>
          </figure>
        </t>
      </section>
    </section>

    <section title="Security Considerations">
      <t>Benchmarking activities as described in this memo are limited to
      technology characterization of a Device Under Test/System Under Test
      (DUT/SUT) using controlled stimuli in a laboratory environment with
      dedicated address space and the constraints specified in the sections
      above.</t>

      <t>The benchmarking network topology will be an independent test setup
      and MUST NOT be connected to devices that may forward the test traffic
      into a production network or misroute traffic to the test management
      network.</t>

      <t>Further, benchmarking is performed on a "black-box" basis and relies
      solely on measurements observable external to the DUT/SUT.</t>

      <t>Special capabilities SHOULD NOT exist in the DUT/SUT specifically for
      benchmarking purposes. Any implications for network security arising
      from the DUT/SUT SHOULD be identical in the lab and in production
      networks.</t>
    </section>

  </middle>

  <back>
    <references title="Normative References">
      <?rfc ?>

      <?rfc include="reference.RFC.2119"?>

      <?rfc include="reference.RFC.8174"?>

      <?rfc include='reference.RFC.2544'?>

      <?rfc include="reference.RFC.7679"?>

      <?rfc include='reference.RFC.4737'?>

      <?rfc include='reference.RFC.2889'?>

      <?rfc include='reference.RFC.3918'?>

      <?rfc include='reference.RFC.6201'?>

      <?rfc include='reference.RFC.2285'?>

      <?rfc include='reference.RFC.6985'?>
    </references>

    <references title="Informative References">
      <?rfc include='reference.RFC.1242'?>

      <?rfc include='reference.RFC.5481'?>

      <?rfc include='reference.RFC.8172'?>

      <!--draft-huang-bmwg-virtual-network-performance-03: I-D Exists-->

      <reference anchor="BENCHMARK-METHOD">
        <front>
          <title>Benchmarking Methodology for Virtualization Network
          Performance</title>

          <author fullname="Lu Huang" initials="L" role="editor"
                  surname="Huang">
            <organization/>
          </author>

          <author fullname="Gu Rong" initials="G" role="editor" surname="Rong">
            <organization/>
          </author>

          <author fullname="Bob Mandeville" initials="B" surname="Mandeville">
            <organization/>
          </author>

          <author fullname="Brooks Hickman" initials="B" surname="Hickman">
            <organization/>
          </author>

          <date month="July" year="2017"/>

          <abstract>
            <t>As the virtual network has been widely established in IDC, the
            performance of virtual network has become a valuable consideration
            to the IDC managers. This draft introduces a benchmarking
            methodology for virtualization network performance based on
            virtual switch.</t>
          </abstract>
        </front>

        <seriesInfo name="Work in Progress,"
                    value="draft-huang-bmwg-virtual-network-performance-03"/>

        <format target="http://www.ietf.org/internet-drafts/draft-huang-bmwg-virtual-network-performance-02.txt"
                type="TXT"/>
      </reference>

      <!--draft-ietf-bmwg-virtual-net-05: I-D Exists-->

      <reference anchor="TestTopo"
                 target="https://wiki.opnfv.org/display/vsperf/Test+Methodology">
        <front>
          <title>Test Methodology</title>

          <author fullname="Eugene Snyder" initials="E" surname="Snyder">
            <organization/>
          </author>

          <date/>
        </front>
      </reference>

      <reference anchor="LTDoverV"
                 target="https://wiki.opnfv.org/display/vsperf/LTD+Test+Spec+Overview">
        <front>
          <title>LTD Test Spec Overview</title>

          <author fullname="Al Morton" initials="A" surname="Morton">
            <organization>OPNFV</organization>
          </author>

          <date/>
        </front>
      </reference>

      <reference anchor="LTD"
                 target="http://docs.opnfv.org/en/stable-danube/submodules/vswitchperf/docs/testing/developer/requirements/vswitchperf_ltd.html#">
        <front>
          <title>VSPERF Level Test Design (LTD)</title>

          <author fullname="Maryam Tahhan" initials="M" surname="Tahhan">
            <organization>OPNFV</organization>
          </author>

          <date/>
        </front>
      </reference>

      <reference anchor="DanubeRel"
                 target="https://wiki.opnfv.org/display/SWREL/Danube">
        <front>
          <title>Danube</title>

          <author>
            <organization>OPNFV</organization>
          </author>

          <date/>
        </front>
      </reference>

      <reference anchor="VSPERFhome"
                 target="https://wiki.opnfv.org/display/vsperf/VSperf+Home">
        <front>
          <title>VSPERF Home</title>

          <author fullname="Maryam Tahhan" initials="M" surname="Tahhan">
            <organization>OPNFV</organization>
          </author>

          <date/>
        </front>
      </reference>

      <reference anchor="OPNFV" target="https://www.opnfv.org/">
        <front>
          <title>OPNFV</title>

          <author>
            <organization>OPNFV</organization>
          </author>

          <date/>
        </front>
      </reference>

      <reference anchor="IFA003"
                 target="http://www.etsi.org/deliver/etsi_gs/NFV-IFA/001_099/003/02.01.01_60/gs_NFV-IFA003v020101p.pdf">
        <front>
          <title>Network Functions Virtualisation (NFV); Acceleration
          Technologies; vSwitch Benchmarking and Acceleration
          Specification</title>

          <author>
            <organization>ETSI</organization>
          </author>

          <date month="April" year="2016"/>
        </front>

        <seriesInfo name="ETSI GS NFV-IFA 003" value="V2.1.1"/>
      </reference>

      <reference anchor="IEEE802.1ac"
                 target="https://standards.ieee.org/findstds/standard/802.1AC-2016.html">
        <front>
          <title>IEEE Standard for Local and metropolitan area networks --
          Media Access Control (MAC) Service Definition</title>

          <author>
            <organization>IEEE</organization>
          </author>

          <date year="2016"/>
        </front>

        <seriesInfo name="IEEE" value="802.1AC-2016"/>

        <seriesInfo name="DOI" value="10.1109/IEEESTD.2017.7875381"/>
      </reference>

<reference anchor="IEEE829"
	   target="http://ieeexplore.ieee.org/document/4578383/">
<front>
<title>IEEE Standard for Software and System Test Documentation</title>
<author><organization>IEEE</organization></author>
<date />
</front>
<seriesInfo name="IEEE" value="829-2008" />
<seriesInfo name="DOI" value="10.1109/IEEESTD.2008.4578383"/>
</reference>

    </references>

    <section anchor="acknowledgements" numbered="no" title="Acknowledgements">
      <t>The authors appreciate and acknowledge comments from Scott Bradner,
      Marius Georgescu, Ramki Krishnan, Doug Montgomery, Martin Klozik,
      Christian Trautman, Benoit Claise, and others for their reviews.</t>

      <t>We also acknowledge the early work in <xref
      target="BENCHMARK-METHOD"/> and useful discussion with the authors.</t>
    </section>
  </back>
</rfc>
